{"version":3,"file":"stable.js","mappings":"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AM8Z,EAA2B,iBAAT9Z,EAAoBA,EAAOA,GAAQA,EAAKxM,KAC5DsmB,GACFK,EAASC,IAAIN,KAKZ3pB,MAAM4b,KAAKoO,EACpB,CAGA,MAAME,EAAarP,EAAuB1V,iBAAmB,GACvD6kB,EAAW,IAAI7F,IAAIgG,IAAqB,IA6B9C,OA1BInqB,MAAM+I,QAAQmhB,IAChBA,EAAWztB,QAAQkJ,IACZA,IAGDA,EAAE6U,gBAAkBxa,MAAM+I,QAAQpD,EAAE6U,iBACtC7U,EAAE6U,eAAe/d,QAAQoT,IACvB,MAAM8Z,EAA2B,iBAAT9Z,EAAoBA,EAAOA,GAAQA,EAAKxM,KAC5DsmB,GACFK,EAASC,IAAIN,KAMfhkB,EAAEiV,mBAAqB5a,MAAM+I,QAAQpD,EAAEiV,oBACzCjV,EAAEiV,kBAAkBne,QAAQoT,IAC1B,MAAM8Z,EAA2B,iBAAT9Z,EAAoBA,EAAOA,GAAQA,EAAKxM,KAC5DsmB,GACFK,EAASC,IAAIN,QAOhB3pB,MAAM4b,KAAKoO,EACpB,CAAE,MAAOjP,GAEP,OADAne,QAAQmK,MAAM,+BAAgCgU,GACvCoP,IAAqB,EAC9B,GAIIA,GAAoB,CAExB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KAEA,OACA,OACA,OACA,MACA,SACA,OACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,MACA,KACA,MAGA,MACA,KACA,OACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,MACA,KACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,KACA,SACA,KACA,KAGA,KACA,MACA,QACA,MACA,KACA,KACA,KACA,MACA,MACA,MACA,KACA,OACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,MACA,KACA,QACA,KACA,KACA,KACA,MACA,KACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,MACA,QACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,KACA,KACA,KAGA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OASIC,GAAwB,CAACC,OAAgB3qB,KAE7C,GAA6B,kBAAlB2qB,EAA6B,CACtC,MAAMC,EAAQD,EACRrO,EAAWN,GAASG,KAAKC,MAAMD,KAAKE,SAAWL,GAAS,EACxD6O,EAAc,IAAMvO,EAAS,GAAKA,EAAS,GAAKA,EAAS,GAEzDwO,EAAgB,KACpB,GAAIF,EAAO,CACT,MAAMG,EAAOF,IACPG,EAAS1O,EAAS,GAAK,EAC7B,OAAOH,KAAKhX,IAAI,EAAGgX,KAAKjX,IAAI,GAAI6lB,EAAOC,GACzC,CAAO,CACL,MAAMD,EAAuB,EAAhBF,IACPG,EAAS1O,EAAS,IAAM,EAC9B,OAAOH,KAAKhX,IAAI,EAAGgX,KAAKjX,IAAI,GAAI6lB,EAAOC,GACzC,GAGI1d,EAAS,CAAC,EAIhB,OAHA6c,GAAeptB,QAAQoT,IACrB7C,EAAO6C,GAAQ2a,MAEVxd,CACT,CAGA,MAAMxG,EAAS6jB,GAAiBxP,EAAuBtV,kBAGvD,IAAKiB,EAAQ,CACX,MAAMwV,EAAWN,GAASG,KAAKC,MAAMD,KAAKE,SAAWL,GAAS,EACxD6O,EAAc,IAAMvO,EAAS,GAAKA,EAAS,GAAKA,EAAS,GACzDhP,EAAS,CAAC,EAMhB,OALA6c,GAAeptB,QAAQoT,IACrB,MAAM4a,EAAuB,EAAhBF,IACPG,EAAS1O,EAAS,IAAM,EAC9BhP,EAAO6C,GAAQgM,KAAKhX,IAAI,EAAGgX,KAAKjX,IAAI,GAAI6lB,EAAOC,MAE1C,CAAED,KAAMzd,EAAQ2d,QAAS,CAAC,EACnC,CAGA,MAAMC,EAAa,CAAC,EACpBpkB,EAAOgU,eAAe/d,QAAQoT,IAC5B,MAAM4K,EAAU5K,EAAK8K,SAAW,GAAG9K,EAAK4K,WAAW5K,EAAK8K,WAAa9K,EAAK4K,QAC1EmQ,EAAW/a,EAAKxM,MAAQ+Y,EAAuB3B,EAAS5K,EAAK6K,MAAO,CAAC,KAIvE,MAAMmQ,EAAgB,CAAC,EAOvB,OANIrkB,EAAOoU,mBAAqB5a,MAAM+I,QAAQvC,EAAOoU,oBACnDpU,EAAOoU,kBAAkBne,QAAQoT,IAC/Bgb,EAAchb,EAAKxM,MAAQ+Y,EAAuBvM,EAAK4K,QAAS5K,EAAK6K,MAAOkQ,KAIzE,CAAEH,KAAMG,EAAYD,QAASE,IAIhCC,GAAoC9Y,MAAM+Y,IAC9C,MAAMthB,EAAU6G,IAAiBC,KACjC,IAAK9G,EAGH,OAFA7M,QAAQmK,MAAM,qDACVyI,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,YAChC,CAAEmR,SAAS,GAGpB,MAAMqR,GAAUwB,GAAyB,WAAbA,GAA6C,KAApBA,EAAShqB,OAC9D,IAAI6K,EAAc,KACdof,GAAkB,EAClBC,GAAkB,EAClBC,EAAW,KAGf,IAAK,MAAMzvB,KAAOgO,EAAS,CACzB,MAAM8B,EAAQ9B,EAAQhO,GACtB,IAAK8P,IAAUA,EAAMlI,OAASkI,EAAM3B,QAAS,SAC7C,MAAM4f,EAAYje,EAAMlI,KAClB1F,EAAU4N,EAAM3B,QAAQ,IAAM,GAGpC,GACE2f,IACCC,EAAUxgB,SAAS,OAASwgB,EAAUxgB,SAAS,OAASwgB,EAAUtN,cAAclT,SAAS,YAEtFuC,EAAM3B,QAAQ,GAAI,CACpBgC,EAAcL,EACdyf,EAAiB,EACjBE,EAAWzvB,EAGX,IAAK,IAAIiD,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GAAIf,EAAQe,IAAMf,EAAQe,GAAGsK,SAAS,QAAS,CAC7CiiB,EAAiBvsB,EACjB,KACF,CAEF,GAAIusB,EAAiB,EACnB,IAAK,IAAIvsB,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GAAIf,EAAQe,IAAMf,EAAQe,GAAGsK,SAAS,MAAO,CAC3CiiB,EAAiBvsB,EACjB,KACF,CAGJ,KACF,CAIF,IACG6qB,IACAC,EAAUxgB,SAAS,OAClBwgB,EAAUxgB,SAAS,QACnBwgB,EAAUxgB,SAAS,OACnBwgB,EAAUtN,cAAclT,SAAS,cACnC,CACA,IAAIygB,EAAa,EACjB,IAAK,IAAI/qB,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GACEf,EAAQe,KACPf,EAAQe,GAAGsK,SAAS,OAASrL,EAAQe,GAAGsK,SAAS,OAASrL,EAAQe,GAAGwd,cAAclT,SAAS,SAC7F,CACAygB,EAAa/qB,EACb,KACF,CAIF,IAAK,IAAIpD,EAAI,EAAGA,EAAIiQ,EAAM3B,QAAQpO,OAAQF,IAAK,CAC7C,MAAMoC,EAAM6N,EAAM3B,QAAQtO,GAC1B,GAAIoC,GAAOA,EAAI+rB,KAAgBsB,EAAU,CACvCnf,EAAcL,EACdyf,EAAiB1vB,EACjB4vB,EAAWzvB,EAGX,IAAK,IAAIiD,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GAAIf,EAAQe,IAAMf,EAAQe,GAAGsK,SAAS,QAAS,CAC7CiiB,EAAiBvsB,EACjB,KACF,CAEF,GAAIusB,EAAiB,EACnB,IAAK,IAAIvsB,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GAAIf,EAAQe,IAAMf,EAAQe,GAAGsK,SAAS,MAAO,CAC3CiiB,EAAiBvsB,EACjB,KACF,CAGJ,KACF,CACF,CACA,GAAIssB,EAAiB,EAAG,KAC1B,CACF,CAGA,IAAKpf,GAAeof,EAAiB,EAGnC,OAFApuB,QAAQmK,MAAM,iDAAkDgkB,GAC5Dvb,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SAASgkB,GAAY,aACrD,CAAE7S,SAAS,GAGpB,GAAI+S,EAAiB,EAGnB,OAFAruB,QAAQmK,MAAM,mDACVyI,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,UAChC,CAAEmR,SAAS,GAIpB,MAAMiT,EAAcvf,EAAYhC,QAAQohB,GAAgBC,IAAmB,GACrEG,EAAgBvI,GAAqBsI,GAGrCE,EAAgBvB,KAChBtjB,EAASqU,EAAuBtV,kBAChC+lB,EAAkB,IAAInH,IAAIkH,GAC5B7kB,GAAUA,EAAOoU,mBACnBpU,EAAOoU,kBAAkBne,QAAQoT,GAAQyb,EAAgBrB,IAAIpa,EAAKxM,OAIpE,MACMkoB,EADcH,EAAc1kB,OAAOmJ,IAASyb,EAAgBxd,IAAI+B,EAAKxM,OACzCxH,IAAIgU,GAAQ,GAAGA,EAAKxM,QAAQwM,EAAK1R,SAAS2D,KAAK,KASjF,OANA8J,EAAYhC,QAAQohB,GAAgBC,GAAkBM,EACtDjb,GAAgB7G,QAGV+hB,GAAa/hB,GAEZ,CACLyO,SAAS,EACTuT,WAAYF,IAKVG,GAA6B1Z,MAAO+Y,EAAUY,EAAUrB,GAAQ,KACpE,MAAM7gB,EAAU6G,IAAiBC,KACjC,IAAK9G,EAGH,OAFA7M,QAAQmK,MAAM,8CACVyI,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,YAChC,CAAEmR,SAAS,GAGpB,MAAMqR,GAAUwB,GAAyB,WAAbA,GAA6C,KAApBA,EAAShqB,OAC9D,IAAI6K,EAAc,KACdof,GAAkB,EAClBC,GAAkB,EAClBC,EAAW,KAGf,IAAK,MAAMzvB,KAAOgO,EAAS,CACzB,MAAM8B,EAAQ9B,EAAQhO,GACtB,IAAK8P,IAAUA,EAAMlI,OAASkI,EAAM3B,QAAS,SAC7C,MAAM4f,EAAYje,EAAMlI,KAClB1F,EAAU4N,EAAM3B,QAAQ,IAAM,GAGpC,GACE2f,IACCC,EAAUxgB,SAAS,OAASwgB,EAAUxgB,SAAS,OAASwgB,EAAUtN,cAAclT,SAAS,YAEtFuC,EAAM3B,QAAQ,GAAI,CACpBgC,EAAcL,EACdyf,EAAiB,EACjBE,EAAWzvB,EAGX,IAAK,IAAIiD,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GAAIf,EAAQe,IAAMf,EAAQe,GAAGsK,SAAS,QAAS,CAC7CiiB,EAAiBvsB,EACjB,KACF,CAEF,GAAIusB,EAAiB,EACnB,IAAK,IAAIvsB,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GAAIf,EAAQe,IAAMf,EAAQe,GAAGsK,SAAS,MAAO,CAC3CiiB,EAAiBvsB,EACjB,KACF,CAGJ,KACF,CAIF,IACG6qB,IACAC,EAAUxgB,SAAS,OAClBwgB,EAAUxgB,SAAS,QACnBwgB,EAAUxgB,SAAS,OACnBwgB,EAAUtN,cAAclT,SAAS,cACnC,CAEA,IAAIygB,EAAa,EACjB,IAAK,IAAI/qB,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GACEf,EAAQe,KACPf,EAAQe,GAAGsK,SAAS,OAASrL,EAAQe,GAAGsK,SAAS,OAASrL,EAAQe,GAAGwd,cAAclT,SAAS,SAC7F,CACAygB,EAAa/qB,EACb,KACF,CAIF,IAAK,IAAIpD,EAAI,EAAGA,EAAIiQ,EAAM3B,QAAQpO,OAAQF,IAAK,CAC7C,MAAMoC,EAAM6N,EAAM3B,QAAQtO,GAC1B,GAAIoC,GAAOA,EAAI+rB,KAAgBsB,EAAU,CACvCnf,EAAcL,EACdyf,EAAiB1vB,EACjB4vB,EAAWzvB,EAGX,IAAK,IAAIiD,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GAAIf,EAAQe,IAAMf,EAAQe,GAAGsK,SAAS,QAAS,CAC7CiiB,EAAiBvsB,EACjB,KACF,CAEF,GAAIusB,EAAiB,EACnB,IAAK,IAAIvsB,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GAAIf,EAAQe,IAAMf,EAAQe,GAAGsK,SAAS,MAAO,CAC3CiiB,EAAiBvsB,EACjB,KACF,CAGJ,KACF,CACF,CACA,GAAIssB,EAAiB,EAAG,KAC1B,CACF,CAGA,IAAKpf,GAAeof,EAAiB,EAGnC,OAFApuB,QAAQmK,MAAM,0CAA2CgkB,GACrDvb,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SAASgkB,GAAY,aACrD,CAAE7S,SAAS,GAGpB,GAAI+S,EAAiB,EAGnB,OAFAruB,QAAQmK,MAAM,4CACVyI,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,yBAChC,CAAEmR,SAAS,GAIpB,MAAMiT,EAAcvf,EAAYhC,QAAQohB,GAAgBC,IAAmB,GACrEG,EAAgBvI,GAAqBsI,GAGrCS,EAAc,CAAC,EACrBR,EAAc3uB,QAAQoT,IACpB+b,EAAY/b,EAAKxM,MAAQwM,EAAK1R,QAIhC,MAAMktB,EAAgBvB,KAChBtjB,EAASqU,EAAuBtV,kBAChC+lB,EAAkB,IAAInH,IAAIkH,GAC5B7kB,GAAUA,EAAOoU,mBACnBpU,EAAOoU,kBAAkBne,QAAQoT,GAAQyb,EAAgBrB,IAAIpa,EAAKxM,OAIpE,IAAIwoB,EAAgB,EACpBR,EAAc5uB,QAAQktB,SACUjqB,IAA1BksB,EAAYjC,IACdkC,MAGJ,MAAMC,EAAaD,IAAkBR,EAAc7vB,OAG7CuwB,EAAc,GACpBX,EAAc3uB,QAAQoT,IACfyb,EAAgBxd,IAAI+B,EAAKxM,OAC5B0oB,EAAYpwB,KAAK,CAAE0H,KAAMwM,EAAKxM,KAAMlF,MAAO0R,EAAK1R,UAKpD,MAAM6tB,EAAc,GAGpBX,EAAc5uB,QAAQktB,IACpB,GAAImC,EAAY,CAEd,MAAM7T,OAAkCvY,IAAvBisB,EAAShC,GAA0BgC,EAAShC,GAAYiC,EAAYjC,QACpEjqB,IAAbuY,GACF+T,EAAYrwB,KAAK,GAAGguB,KAAY1R,IAEpC,WAEgCvY,IAA1BksB,EAAYjC,GACdqC,EAAYrwB,KAAK,GAAGguB,KAAYiC,EAAYjC,WACZjqB,IAAvBisB,EAAShC,IAClBqC,EAAYrwB,KAAK,GAAGguB,KAAYgC,EAAShC,QAM/C9qB,OAAOC,KAAK6sB,GAAUlvB,QAAQktB,IACvB0B,EAAcriB,SAAS2gB,KAEtBmC,IAAeF,EAAYjC,GAE7BqC,EAAYrwB,KAAK,GAAGguB,KAAYgC,EAAShC,MAGzCqC,EAAYrwB,KAAK,GAAGguB,KAAYiC,EAAYjC,SAMlDoC,EAAYtvB,QAAQoT,IAClBmc,EAAYrwB,KAAK,GAAGkU,EAAKxM,QAAQwM,EAAK1R,WAGxC,MAAMotB,EAAgBS,EAAYlqB,KAAK,KAGvC8J,EAAYhC,QAAQohB,GAAgBC,GAAkBM,EACtDjb,GAAgB7G,QAGV+hB,GAAa/hB,GAGnB,MAAMwiB,EAAe,GAKrB,OAJAZ,EAAc5uB,QAAQktB,IACpBsC,EAAatwB,KAAK,CAAE0H,KAAMsmB,EAAUxrB,MAAOwtB,EAAShC,OAG/C,CACLzR,SAAS,EACTkF,MAAO6O,EACPR,WAAYF,EACZW,YAAaJ,IAIXK,GAAgC7C,IACpC,MAAM7f,EAAU6G,IAAiBC,KACjC,IAAK9G,EAAS,MAAO,GAErB,MAAM8f,GAAUD,GAAmC,WAAlBA,GAAuD,KAAzBA,EAAcvoB,OAC7E,IAAIqc,EAAQ,GAEZ,IAAK,MAAM3hB,KAAOgO,EAAS,CACzB,MAAM8B,EAAQ9B,EAAQhO,GACtB,IAAK8P,IAAUA,EAAMlI,OAASkI,EAAM3B,QAAS,SAC7C,MAAM4f,EAAYje,EAAMlI,KAGxB,GACEkmB,IACCC,EAAUxgB,SAAS,OAASwgB,EAAUxgB,SAAS,OAASwgB,EAAUtN,cAAclT,SAAS,YAEtFuC,EAAM3B,QAAQ,GAAI,CACpB,MAAMjM,EAAU4N,EAAM3B,QAAQ,IAAM,GAC9BlM,EAAM6N,EAAM3B,QAAQ,GAW1B,GAVAjM,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEsK,SAAS,MAAO,CACV6Z,GAAqBnlB,EAAII,IAAQ,IACzCrB,QAAQoT,IACRuN,EAAMpV,KAAK3L,GAAKA,EAAEgH,OAASwM,EAAKxM,OACnC+Z,EAAMzhB,KAAKkU,IAGjB,IAEEuN,EAAM5hB,OAAS,EAAG,KACxB,CAIF,IACG+tB,IACAC,EAAUxgB,SAAS,OAClBwgB,EAAUxgB,SAAS,QACnBwgB,EAAUxgB,SAAS,OACnBwgB,EAAUtN,cAAclT,SAAS,cACnC,CACA,MAAMrL,EAAU4N,EAAM3B,QAAQ,IAAM,GAEpC,IAAI6f,EAAa,EACjB,IAAK,IAAI/qB,EAAI,EAAGA,EAAIf,EAAQnC,OAAQkD,IAClC,GACEf,EAAQe,KACPf,EAAQe,GAAGsK,SAAS,OAASrL,EAAQe,GAAGsK,SAAS,OAASrL,EAAQe,GAAGwd,cAAclT,SAAS,SAC7F,CACAygB,EAAa/qB,EACb,KACF,CAGF,IAAK,IAAIpD,EAAI,EAAGA,EAAIiQ,EAAM3B,QAAQpO,OAAQF,IAAK,CAC7C,MAAMoC,EAAM6N,EAAM3B,QAAQtO,GAC1B,GAAIoC,GAAOA,EAAI+rB,KAAgBH,EAAe,CAC5C3rB,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEsK,SAAS,MAAO,CACV6Z,GAAqBnlB,EAAII,IAAQ,IACzCrB,QAAQoT,IACRuN,EAAMpV,KAAK3L,GAAKA,EAAEgH,OAASwM,EAAKxM,OACnC+Z,EAAMzhB,KAAKkU,IAGjB,IAEF,KACF,CACF,CACA,GAAIuN,EAAM5hB,OAAS,EAAG,KACxB,CACF,CAEA,OAAO4hB,GAGHgP,GAAqB,CAACtT,EAAQuT,EAASC,KAC3C,MAAM,GAAQlH,KACRmH,EAAID,GAAe,CAAC,EACpBE,EAAU1T,EAAOjJ,KAAK,OAAS,MAAQgM,KAAKE,SAAS0Q,SAAS,IAAIC,OAAO,EAAG,GAClF5T,EAAOjJ,KAAK,KAAM2c,GAGlB1T,EAAOrJ,SAAS/J,KAAK,sBAAsB8M,SAGtCsG,EAAOrJ,SAASmI,SAAS,yBAC5BkB,EAAO6T,KAAK,4CAId,MAAMC,EAAYhsB,EAAE,4CAA4C4rB,aAChEI,EAAUvU,IAAI,CACZwU,WAAYN,EAAEvL,SAAW,OACzB,eAAgBuL,EAAEtL,QAAU,SAE9BnI,EAAOgU,MAAMF,GAEb,MAAMG,EAAc,CAACrmB,EAAS,MAC5B,MAAMsmB,EAActmB,EAAOwV,cACrBzV,EAAW4lB,EAAQ3lB,OAAOumB,GAAOA,EAAI/Q,cAAclT,SAASgkB,IAE1C,IAApBvmB,EAASjL,OACXoxB,EAAUpU,KAAK,gDAAgD+T,EAAEpL,SAAW,uBAE5EyL,EAAUpU,KACR/R,EACG5K,IACCoxB,GACE,8CAA8C7sB,EAAW6sB,oBAAsBV,EAAErL,UAAY,YAAY9gB,EAAW6sB,YAEvHnrB,KAAK,MAWRorB,EAAe,KACnBN,EAAU9U,YAAY,YAIxBgB,EAAOxB,IAAI,UAAUC,GAAG,0BAA2B,SAAUza,GAC3DA,EAAE0a,kBAXF5W,EAAE,sBAAsBkX,YAAY,WACpCiV,EAAYjU,EAAOhY,OACnB8rB,EAAU9E,SAAS,UAWrB,GAGAhP,EAAOvB,GAAG,cAAe,WACvBwV,EAAYnsB,EAAE3F,MAAM6F,MACtB,GAGA8rB,EACGrV,GAAG,aAAc,qBAAsB,WACtC3W,EAAE3F,MAAMod,IAAI,aAAckU,EAAEhL,WAAa,yBAC3C,GACChK,GAAG,aAAc,qBAAsB,WACtC3W,EAAE3F,MAAMod,IAAI,aAAc,cAC5B,GAGFuU,EAAUrV,GAAG,QAAS,qBAAsB,SAAUza,GACpDA,EAAE0a,kBACF1a,EAAEmc,iBACF,MAAMnY,EAAMF,EAAE3F,MAAMa,KAAK,SACzBgd,EAAOhY,IAAIA,GAAKK,QAAQ,UACxB+rB,GACF,GAGAN,EAAUrV,GAAG,QAAS,SAAUza,GAC9BA,EAAE0a,iBACJ,GAGAsB,EACGpB,QAAQ,uCACRJ,IAAI,eAAiBkV,GACrBjV,GAAG,eAAiBiV,EAAS,SAAU1vB,GACjC8D,EAAE9D,EAAEsQ,QAAQsK,QAAQ,yBAAyBlc,QAChD0xB,GAEJ,IAGEC,GAAiB,CAAC9V,EAAQ+V,EAAed,KAC7C,MAAM,GAAQlH,KACRmH,EAAID,GAAe,CAAC,EAC1BjV,EAAO3R,KAAK0nB,GAAeC,KAAK,WAC9B,MAAMvU,EAASlY,EAAE3F,MAEjB,GAAI6d,EAAOrJ,SAASmI,SAAS,qBAAsB,OAEnDkB,EAAO6T,KAAK,yCAEZ,MAAMW,EAAY1sB,EAChB,uEAAuE2rB,EAAEpL,SAAW,uDAEtFrI,EAAOgU,MAAMQ,GAEbA,EAAU/V,GAAG,QAAS,SAAUza,GAC9BA,EAAEmc,iBACFnc,EAAE0a,kBACFsB,EAAOhY,IAAI,IAAIK,QAAQ,SAASA,QAAQ,UAAU4X,OACpD,GAEAuU,EACG/V,GAAG,aAAc,WAChB3W,EAAE3F,MAAMod,IAAI,CAAEkV,MAAOhB,EAAEjL,QAAU,UAAWkM,QAAS,KACvD,GACCjW,GAAG,aAAc,WAChB3W,EAAE3F,MAAMod,IAAI,CAAEkV,MAAOhB,EAAEpL,SAAW,OAAQqM,QAAS,OACrD,EACJ,IAGIC,GAAwB,CAACnD,GAAQ,KACrC,MAAM,GAAQlF,KACdxkB,EAAE,4BAA4B4R,SAE9B,MAAMhO,EAASiU,KACTiV,EAAUtT,IAEVuT,EAAYrD,EAAQ,WAAa,WACjCsD,EAAYtD,EAAQ,YAAc,YAGlCuD,EAAWvD,EACb,CAAEwD,YAAa,GAAIC,SAAU,GAC7B,CAAED,YAAa,EAAGC,SAAU,GAAIC,QAAS,EAAGC,WAAY,GAGtDC,EAAqB5D,OACI5qB,IAA3BguB,EAAQzT,gBAAgCyT,EAAQzT,iBAAmB4T,EAASC,YAC1EJ,EAAQzT,eACR,QACyBva,IAA3BguB,EAAQ9T,gBAAgC8T,EAAQ9T,iBAAmBiU,EAASC,YAC1EJ,EAAQ9T,eACR,GACAuU,EAAkB7D,OACI5qB,IAAxBguB,EAAQxT,aAA6BwT,EAAQxT,cAAgB2T,EAASE,SACpEL,EAAQxT,YACR,QACsBxa,IAAxBguB,EAAQ3T,aAA6B2T,EAAQ3T,cAAgB8T,EAASE,SACpEL,EAAQ3T,YACR,GACAqU,EACH9D,QAAyC5qB,IAAhCguB,EAAQ5T,qBAAqC4T,EAAQ5T,sBAAwB+T,EAASG,QAE5F,GADAN,EAAQ5T,oBAERuU,EACH/D,QAAoC5qB,IAA3BguB,EAAQ7T,gBAAgC6T,EAAQ7T,iBAAmBgU,EAASI,WAElF,GADAP,EAAQ7T,eAGRyU,EAAUZ,EAAQvT,gBAAkB,iBAEpCoU,EAAejE,EACjB,GACA,+MAI4D8D,mBAAgCP,EAASG,uNAItCK,mBAAmCR,EAASI,sFAKzGvU,EAAY,qHAEyClV,EAAOkU,iIAENiV,gcAOoBO,mBAAoCL,EAASC,0QAIhDK,mBAAiCN,EAASE,6HAGjGQ,kUAKuD,mBAAZD,EAA+B,WAAa,kFAC3C,QAAZA,EAAoB,WAAa,uFACX,kBAAZA,EAA8B,WAAa,wPAKrDV,qPAQhDvW,EAASzW,EAAE8Y,GACjB9Y,EAAE,QAAQgY,OAAOvB,GAEjBA,EAAOgB,IAAI,CACT8E,SAAU,QACVoK,IAAK,IACLiH,KAAM,IACNC,MAAO,IACPC,OAAQ,IACRC,MAAO,QACPC,OAAQ,QACR/B,WAAY,kBACZ,UAAW,aACXgC,QAAS,OACT,cAAe,SACf,kBAAmB,SACnBC,QAAS,OACT,aAAc,eAGhB,MAAMC,EAAa,IAAM1X,EAAO7E,SAChC6E,EAAO3R,KAAK,qBAAqBspB,MAAMD,GACvC1X,EAAOE,GAAG,QAASza,IACb8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,4BAA4BmX,MAGvD1X,EAAO3R,KAAK,kBAAkBspB,MAAM,WAClC,MAAMC,EAAS,CAAE9U,eAAgBvZ,EAAE,iBAAiBE,OAG9CouB,EAAiBtuB,EAAE,qBAAqBE,MAAMC,OAC9CouB,EAAcvuB,EAAE,kBAAkBE,MAAMC,OAE9C,GAAIupB,EACF2E,EAAOhV,eAAoC,KAAnBiV,EAAwBzT,SAASyT,EAAgB,IAAMrB,EAASC,YACxFmB,EAAO/U,YAA8B,KAAhBiV,EAAqB1T,SAAS0T,EAAa,IAAMtB,EAASE,aAC1E,CACLkB,EAAOrV,eAAoC,KAAnBsV,EAAwBzT,SAASyT,EAAgB,IAAMrB,EAASC,YACxFmB,EAAOlV,YAA8B,KAAhBoV,EAAqB1T,SAAS0T,EAAa,IAAMtB,EAASE,SAE/E,MAAMqB,EAAaxuB,EAAE,iBAAiBE,MAAMC,OACtCsuB,EAAgBzuB,EAAE,oBAAoBE,MAAMC,OAClDkuB,EAAOnV,oBAAqC,KAAfsV,EAAoB3T,SAAS2T,EAAY,IAAMvB,EAASG,QACrFiB,EAAOpV,eAAmC,KAAlBwV,EAAuB5T,SAAS4T,EAAe,IAAMxB,EAASI,UACxF,CAEA5T,EAAe4U,GACfF,GACF,GAEA1X,EAAO3R,KAAK,mBAAmBspB,MAAM,WAEnC3X,EAAO3R,KAAK,qBAAqB5E,IAAI,IACrCuW,EAAO3R,KAAK,kBAAkB5E,IAAI,IAC7BwpB,IACHjT,EAAO3R,KAAK,iBAAiB5E,IAAI,IACjCuW,EAAO3R,KAAK,oBAAoB5E,IAAI,IAExC,IAGIwuB,GAAgB,CAACjD,EAAU,CAAC,KAChC,MAAM,GAAQjH,KACdxkB,EAAE,sCAAsC4R,SAExC,MAAMhO,EAASiU,KAGf,IAAI8W,EAFYnV,IAEYJ,cAAgB,QAEvC,aAAapR,KAAK2mB,KACrBA,EAAgB,SAGlB,MAAMC,EAAiBlf,IAAiBC,KACxC,IAAIkf,EAAoB,CAAC,UACrBC,EAAe,GAEnB,GAAIF,EACF,IAAK,MAAM/zB,KAAO+zB,EAAgB,CAChC,MAAMjkB,EAAQikB,EAAe/zB,GAC7B,GAAK8P,GAAUA,EAAMlI,MAASkI,EAAM3B,QAApC,CAEA,GAAmB,UAAf2B,EAAMlI,KACR,IAAK,IAAI/H,EAAI,EAAGA,EAAIiQ,EAAM3B,QAAQpO,OAAQF,IAAK,CAC7C,MAAMoC,EAAM6N,EAAM3B,QAAQtO,GACtBoC,GAAOA,EAAI,IAAI+xB,EAAkB9zB,KAAK+B,EAAI,GAChD,CAGF,GAAmB,SAAf6N,EAAMlI,MAAmBkI,EAAM3B,QAAQ,GAAI,CAC7C,MAAMlM,EAAM6N,EAAM3B,QAAQ,IACV2B,EAAM3B,QAAQ,IAAM,IAC5BnN,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEsK,SAAS,MAAO,CACV6Z,GAAqBnlB,EAAII,IAAQ,IACzCrB,QAAQoT,IACR6f,EAAa1mB,SAAS6G,EAAKxM,OAAOqsB,EAAa/zB,KAAKkU,EAAKxM,OAElE,GAEJ,CApBqD,CAqBvD,CAEF,MAAM,YACJssB,EAAc,KAAI,WAClBC,EAAa,KAAI,SACjBC,EAAWN,EAAa,gBACxBO,EAAkB,MAAK,SACvBC,EAAW,KAAI,cACfC,EAAgB,IACd3D,EAEEE,EAAIlK,IAEJ4N,EAAUrvB,EACd,4IAUF,IAAIsvB,EAAkBJ,EACL,UAAbD,EAAsBK,EAAkB,MACtB,SAAbL,IAAqBK,EAAkB,OAEhD,MAAMC,EAAQvvB,EAAE,sDAC+B4D,EAAOkU,4PAO5B6T,EAAEvL,+CACIuL,EAAEtL,8TAOwBsL,EAAEhL,uCAAuCgL,EAAEtL,6JAC5BsL,EAAEjL,uVAI8BiL,EAAEpL,iQACHoL,EAAEpL,ySAGPoL,EAAEpL,8eAOnC,SAAb0O,EAAsB,SAAW,kFAA+F,SAAbA,EAAsBtD,EAAEjL,OAASiL,EAAEnL,4BAA4BmL,EAAEtL,sCAAmD,SAAb4O,EAAsB,OAAStD,EAAErL,sHAC9O,UAAb2O,EAAuB,SAAW,mFAAgG,UAAbA,EAAuBtD,EAAEjL,OAASiL,EAAEnL,4BAA4BmL,EAAEtL,sCAAmD,UAAb4O,EAAuB,OAAStD,EAAErL,qMAChL,CAAC,OAAQ,SAASlY,SAAS6mB,GAAuBtD,EAAEnL,MAAbmL,EAAEjL,6BAAuCiL,EAAEtL,sCAAuC,CAAC,OAAQ,SAASjY,SAAS6mB,GAAqBtD,EAAErL,SAAX,wJACzM,CAAC,OAAQ,SAASlY,SAAS6mB,GAAuB,GAAXA,yNAKxEtD,EAAEjL,8jBAOEiL,EAAEpL,0HACa/gB,EAAW4vB,6JAG1BzD,EAAEpL,uUAE+IoL,EAAEjL,sCAAsCiL,EAAEjL,4UAIjLlhB,EAAWwvB,GAAc,4VAOnCrD,EAAEpL,oRAIFoL,EAAEpL,0IACqB,OAAhBwO,EAAuBA,EAAc,gZAO5CpD,EAAEpL,sKAtFjC,CAC7B,CAAEnd,GAAI,MAAOX,KAAM,WACnB,CAAEW,GAAI,MAAOX,KAAM,YAuFUxH,IACCoxB,GACE,kBAAkBA,EAAIjpB,OAAOipB,EAAIjpB,KAAOksB,EAAkB,WAAa,MAAMjD,EAAI5pB,iBAEpFvB,KAAK,2MAI0ByqB,EAAEpL,ikBASFoL,EAAEpL,qXAONoL,EAAEpL,+WAII0O,wGAE4BtD,EAAEjL,kYAQ9F1gB,EAAE,QAAQgY,OAAOqX,GAASrX,OAAOuX,GAGjC,MAiBMC,EAAmBrF,IACvB,MAAM3T,EAAa+Y,EAAMzqB,KAAK,sBACxB0X,EAAQ+O,GAA8BpB,GAE5C,IAAIvS,EAAO,GAGP4E,EAAM5hB,OAAS,GACjB4hB,EAAM3gB,QAAQoT,IACZ2I,GAAQ,gDAAgDpY,EAAWyP,EAAKxM,sBAAsBwM,EAAK1R,4CAA4CouB,EAAE7K,4BAA4B6K,EAAEtL,kCAAkCsL,EAAE5K,6CAA6CvhB,EAAWyP,EAAKxM,SAASwM,EAAK1R,mBAKlSqa,GAAQ,yGAAyG+T,EAAEjL,kCAAkCiL,EAAEjL,oJAGvJ9I,GAAQ,2TAERpB,EAAWoB,KAAKA,GAGhBpB,EAAW1R,KAAK,sBAAsBspB,MAAM,WAC1C,MAAMrF,EAAW/oB,EAAE3F,MAAMa,KAAK,QACxBu0B,EAAYzvB,EAAE3F,MAAMa,KAAK,SAC/Bq0B,EAAMzqB,KAAK,mBAAmB5E,IAAI6oB,GAClCwG,EAAMzqB,KAAK,oBAAoB5E,IAAIuvB,GAGnC,MACM/F,EAAqB,SADV6F,EAAMzqB,KAAK,0BAA0B5E,OAAS,OAEzDwvB,EAAW7U,SAAS4U,EAAW,KAAO,EAE5C,GAAI/F,EAAO,CAET,MAAMqF,EAAc9T,KAAKhX,IAAI,EAAG,GAAKyrB,GACrCH,EAAMzqB,KAAK,gBAAgB5E,IAAI6uB,EACjC,MAEEQ,EAAMzqB,KAAK,gBAAgB5E,IAAIuvB,GAIjCF,EAAMzqB,KAAK,oBAAoBvE,QAAQ,SACzC,GAGAiW,EAAW1R,KAAK,0BAA0BspB,MAAMhd,eAAgBlV,GAC9DA,EAAEmc,iBACFnc,EAAE0a,kBAEF,MAAMiQ,EAAO7mB,EAAE3F,MACf,GAAIwsB,EAAK8I,KAAK,YAAa,OAG3B9I,EAAK8I,KAAK,YAAY,GAAMlY,IAAI,UAAW,OAC3C,MAAMmY,EAAe/I,EAAKjP,OAC1BiP,EAAKjP,KAAK,+CAGV,MAAMiY,EAAkB3L,GAAiBG,aACzCH,GAAiBG,aAAe,KAC9BroB,QAAQC,IAAI,uBAGd,IACE,MAAMkuB,EAAWoF,EAAMzqB,KAAK,wBAAwB5E,MAAMC,QAAU,SAEpEnE,QAAQC,IAAI,kBAAmBkuB,GAG/B,MAAM2F,EAAYtG,KAGZuG,EAAYD,EAAUjG,MAAQiG,EAC9BE,EAAeF,EAAU/F,SAAW,CAAC,EAGrCX,EAAW,IAAK2G,KAAcC,UAGflF,GAA2BX,EAAUf,IAE/C9R,SAETkY,EAAiBrF,EAErB,CAAE,MAAOhQ,GACPne,QAAQmK,MAAM,gBAAiBgU,GAC3BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SACzC,C,QAEE+d,GAAiBG,aAAewL,EAChChJ,EAAK8I,KAAK,YAAY,GAAOlY,IAAI,UAAW,KAAKG,KAAKgY,EACxD,CACF,GAGApZ,EAAW1R,KAAK,4BAA4BspB,MAAMhd,eAAgBlV,GAChEA,EAAEmc,iBACFnc,EAAE0a,kBAEF,MAAMiQ,EAAO7mB,EAAE3F,MACf,GAAIwsB,EAAK8I,KAAK,YAAa,OAE3B,MAAMxF,EAAWoF,EAAMzqB,KAAK,wBAAwB5E,MAAMC,QAAU,SAEpE,IAAK8vB,QAAQ,SAAS9F,gCACpB,OAIFtD,EAAK8I,KAAK,YAAY,GAAMlY,IAAI,UAAW,OAC3C,MAAMmY,EAAe/I,EAAKjP,OAC1BiP,EAAKjP,KAAK,+CAGV,MAAMiY,EAAkB3L,GAAiBG,aACzCH,GAAiBG,aAAe,KAC9BroB,QAAQC,IAAI,uBAGd,IACED,QAAQC,IAAI,kBAAmBkuB,UAEVD,GAAkCC,IAE5C7S,SAETkY,EAAiBrF,EAErB,CAAE,MAAOhQ,GACPne,QAAQmK,MAAM,gBAAiBgU,GAC3BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SACzC,C,QAEE+d,GAAiBG,aAAewL,EAChChJ,EAAK8I,KAAK,YAAY,GAAOlY,IAAI,UAAW,KAAKG,KAAKgY,EACxD,CACF,IA5JuB,MACvB,MAAMpZ,EAAa+Y,EAAMzqB,KAAK,sBAC9B,IAAI8S,EAAO,GACXiX,EAAkBhzB,QAAQ4G,IACxB,MAAMyN,EAAuB,WAATzN,EAAoBmN,IAAyBK,EAAwBxN,GACnFytB,EAAYhgB,EAAYtV,OAAS,EAAIsV,EAAYigB,UAAU,EAAG,GAAK,KAAOjgB,EAChF0H,GAAQ,gDAAgDpY,EAAWiD,yCAA4CkpB,EAAEnL,0BAA0BmL,EAAEtL,kCAAkCsL,EAAErL,sEAAsE9gB,EAAW0Q,OAAiB1Q,EAAW0wB,gBAEhS1Z,EAAWoB,KAAKA,GAAQ,oCAAoC+T,EAAEpL,yBAE9D/J,EAAW1R,KAAK,sBAAsBspB,MAAM,WAC1C,MAAMjE,EAAWnqB,EAAE3F,MAAMa,KAAK,QAC9Bq0B,EAAMzqB,KAAK,wBAAwB5E,IAAIiqB,GAAU5pB,QAAQ,SAC3D,IAmJF6vB,GAEAZ,EAAiB,UAEjBD,EAAMzqB,KAAK,sBAAsBspB,MAAM,SAAUlyB,GAC/CA,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAMyZ,EAAYlH,KACZmH,EAAcD,EAAUpV,KAAKC,MAAMD,KAAKE,SAAWkV,EAAUz1B,SACnE20B,EAAMzqB,KAAK,mBAAmB5E,IAAIowB,GAAa/vB,QAAQ,SACzD,GAGAirB,GAAmB+D,EAAMzqB,KAAK,wBAAyB+pB,EAAmBlD,GAC1EH,GAAmB+D,EAAMzqB,KAAK,mBAAoBgqB,EAAcnD,GAEhEY,GAAegD,EAAO,wEAAyE5D,GAG/F4D,EAAMzqB,KAAK,wBAAwB6R,GAAG,+BAAgC,WACpE,MAAMwT,EAAWnqB,EAAE3F,MAAM6F,MAAMC,QAAU,SACnCowB,EAAc9H,GAA0B0B,GAC9CqB,GAAmB+D,EAAMzqB,KAAK,mBAAoByrB,EAAY31B,OAAS,EAAI21B,EAAczB,EAAcnD,GAGvG6D,EAAiBrF,EACnB,GAGAoF,EAAMzqB,KAAK,mBAAmB6R,GAAG,gBAAiB,WAChD,MAAMwT,EAAWoF,EAAMzqB,KAAK,wBAAwB5E,MAAMC,QAAU,SAC9D4oB,EAAW/oB,EAAE3F,MAAM6F,MAAMC,OACzBsvB,EAAY3G,GAAkBqB,EAAUpB,GAC5B,OAAd0G,IACFF,EAAMzqB,KAAK,oBAAoB5E,IAAIuvB,GACnCF,EAAMzqB,KAAK,gBAAgB5E,IAAIuvB,GAEnC,GAGA,MAAMe,EAAuB,CAACC,EAAeC,EAAUC,KACrD,IAAKF,GAAmC,KAAlBA,EAAsB,MAAO,GACnD,MAAMvwB,EAAM2a,SAAS4V,EAAe,IACpC,GAAI9nB,MAAMzI,GAAM,OAAOuwB,EAGvB,MAAMG,EAAaC,IACjB,MAAMjwB,EAAQiwB,EAAKjwB,MAAM,gBACzB,OAAKA,EACEia,SAASja,EAAM,GAAI,IAAMia,SAASja,EAAM,GAAI,IADhC,KAIfkwB,EAAUF,EAAWF,GACrBK,EAAQH,EAAWD,GAGnBK,EAAQ9wB,EAAM4wB,EACdvc,EAAS0G,KAAKW,MAAMoV,EAAQD,GAClC,OAAO9V,KAAKhX,IAAI,EAAGgX,KAAKjX,IAAIuQ,EAAQwc,KAIhCE,EAAiB,KACrB,MACMvH,EAAqB,QADV6F,EAAMzqB,KAAK,0BAA0B5E,MAEhDgxB,EAAe3B,EAAMzqB,KAAK,gBAC1BqsB,EAAqB5B,EAAMzqB,KAAK,4BAChCssB,EAAQ7B,EAAMzqB,KAAK,eAErB4kB,GAEFwH,EAAajiB,KAAK,cAAe,aACjCsgB,EAAMzqB,KAAK,sBAAsBiL,KAAK,MACtCohB,EAAmBjM,OACnBkM,EAAM3Z,IAAI,wBAAyB,aAGnCyZ,EAAajiB,KAAK,cAAe,UACjCsgB,EAAMzqB,KAAK,sBAAsBiL,KAAK,OACtCohB,EAAmBlM,OACnBmM,EAAM3Z,IAAI,wBAAyB,iBAIvC8X,EAAMzqB,KAAK,0BAA0B6R,GAAG,SAAUsa,GAGlDA,IAGA,IAAII,EAAkBpC,EAGtBM,EAAMzqB,KAAK,oBAAoBspB,MAAM,WACnC,MAAMkD,EAAUtxB,EAAE3F,MAAMa,KAAK,QAE7B,GAAgB,WAAZo2B,EAAsB,OAE1B/B,EAAMzqB,KAAK,oBAAoB2S,IAAI,CAAEwU,WAAYN,EAAEnL,MAAOmM,MAAOhB,EAAErL,WACnEtgB,EAAE3F,MAAMod,IAAI,CAAEwU,WAAYN,EAAEjL,OAAQiM,MAAO,SAG3ClT,EAAe,CAAEL,aAAckY,IAC/B,MAAMC,EAAoBvxB,EAAE3F,MAAMa,KAAK,aAAe,MAGhDg2B,EAAe3B,EAAMzqB,KAAK,gBAC1B0sB,EAAmBN,EAAahxB,MAAMC,OAC5C,GAAyB,KAArBqxB,EAAyB,CAC3B,MAAMC,EAAejB,EAAqBgB,EAAkBH,EAAiBC,GAC7EJ,EAAahxB,IAAIuxB,EACnB,CAGA,MAKMC,EALab,KACjB,MAAMjwB,EAAQiwB,EAAKjwB,MAAM,gBACzB,OAAKA,EACEia,SAASja,EAAM,GAAI,IAAMia,SAASja,EAAM,GAAI,IADhC,KAGNgwB,CAAWU,GAC1B/B,EAAMzqB,KAAK,qBAAqBiL,KAAK,UAAU2hB,MAE/CL,EAAkBC,EAClB/B,EAAMzqB,KAAK,iBAAiB5E,IAAIoxB,GAGhC/B,EAAMzqB,KAAK,0BAA0B5E,IAAIqxB,GAAmBhxB,QAAQ,SACtE,GAEAgvB,EAAMzqB,KAAK,wBAAwBspB,MAAM,WAEvCmB,EAAMzqB,KAAK,oBAAoB2S,IAAI,CAAEwU,WAAYN,EAAEnL,MAAOmM,MAAOhB,EAAErL,WACnEtgB,EAAE3F,MAAMod,IAAI,CAAEwU,WAAYN,EAAEjL,OAAQiM,MAAO,SAE3C,MAAMgF,EAAapC,EAAMzqB,KAAK,sBAAsB5E,MAAMC,OAE1D,IAAKwxB,EAEH,YADApC,EAAMzqB,KAAK,sBAAsBqT,QAGnC,IAAK,aAAanQ,KAAK2pB,GAErB,YADI/iB,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,kBAK3C,MAAM0J,EAAe3B,EAAMzqB,KAAK,gBAC1B0sB,EAAmBN,EAAahxB,MAAMC,OAC5C,GAAyB,KAArBqxB,EAAyB,CAC3B,MAAMC,EAAejB,EAAqBgB,EAAkBH,EAAiBM,GAC7ET,EAAahxB,IAAIuxB,EACnB,CAEAlC,EAAMzqB,KAAK,iBAAiB5E,IAAIyxB,GAChCN,EAAkBM,EAGlBlY,EAAe,CAAEL,aAAcuY,IAE/BpC,EAAMzqB,KAAK,0BAA0B5E,IAAI,OAAOK,QAAQ,SAC1D,GAGAgvB,EAAMzqB,KAAK,sBAAsB6R,GAAG,UAAW,SAAUza,GACzC,UAAVA,EAAErB,MACJqB,EAAEmc,iBACFkX,EAAMzqB,KAAK,wBAAwBspB,QAEvC,GA0DAmB,EAAMzqB,KAAK,kBAAkBspB,MAAM,WACjC,MAAMvU,EAAU0V,EAAMzqB,KAAK,iBAAiB5E,MAAMC,QAAU,QACtDyxB,EAAM/W,SAAS0U,EAAMzqB,KAAK,kBAAkB5E,MAAO,KAAO,EAC1D6oB,EAAWwG,EAAMzqB,KAAK,mBAAmB5E,MAAMC,QAAU,OACzD0xB,EAAWtC,EAAMzqB,KAAK,0BAA0B5E,OAAS,MACzD4xB,EAAavC,EAAMzqB,KAAK,oBAAoB5E,OAAS,SAGrDwpB,EAAqB,QAAbmI,EAGR/E,EAAUtT,IACV4T,EAAUN,EAAQ5T,qBAAuB,EACzCmU,EAAaP,EAAQ7T,gBAAkB,EAGvCD,EAAiB0Q,EAAQoD,EAAQxT,aAAe,EAAIwT,EAAQ9T,gBAAkB,EAC9EG,EAAcuQ,EAAQoD,EAAQzT,gBAAkB,GAAKyT,EAAQ3T,aAAe,GAGlF,IAGI3M,EAHAulB,EAAiBxC,EAAMzqB,KAAK,gBAAgB5E,MAAMC,OAClD6xB,EAAezC,EAAMzqB,KAAK,oBAAoB5E,MAAMC,OACpDsvB,EAA6B,KAAjBuC,EAAsBnX,SAASmX,EAAc,IAAM,EAE/DC,GAAe,EAGnB,MAAMC,EAAmBC,IACvB,MAAMvxB,EAAQuxB,EAAWvxB,MAAM,gBAC/B,GAAIA,EAAO,CACT,MAAMwxB,EAAUvX,SAASja,EAAM,GAAI,IAAMia,SAASja,EAAM,GAAI,IAC5D,OAAOqa,KAAKW,MAAMwW,EAAU,EAC9B,CACA,OAAO,IAGc,KAAnBL,EAEFvlB,EAASqO,SAASkX,EAAgB,KAAOG,EAAiBrY,GACjD6P,EAEL+F,EAAY,GACdjjB,EAASyO,KAAKhX,IAAI,EAAG,GAAKwrB,GAC1BwC,GAAe,IAEfzlB,EAAS,GACTylB,GAAe,GAIbxC,EAAY,GACdjjB,EAASijB,EACTwC,GAAe,IAEfzlB,EAAS0lB,EAAiBrY,GAC1BoY,GAAe,GAInB,MAAM7lB,EAnHSyN,KACf,MAAMjZ,EAAQiZ,EAAQjZ,MAAM,0BAC5B,IAAKA,EAAO,MAAO,CAAEiS,MAAO,EAAGkI,MAAO,GAAIlB,WAE1C,MAAMxL,EAAQwM,SAASja,EAAM,GAAI,IAC3Bka,EAAQD,SAASja,EAAM,GAAI,IAC3BmZ,EAAWnZ,EAAM,GAAKia,SAASja,EAAM,GAAI,IAAM,EAE/Cma,EAAQ,GACd,IAAK,IAAIrgB,EAAI,EAAGA,EAAI2T,EAAO3T,IACzBqgB,EAAMhgB,KAAKkgB,KAAKC,MAAMD,KAAKE,SAAWL,GAAS,GAIjD,MAAO,CAAEjI,MAFKkI,EAAM5M,OAAO,CAAC1S,EAAGC,IAAMD,EAAIC,EAAG,GAAKqe,EAEjCgB,QAAOD,QAAOzM,QAAO0L,WAAUF,YAqGhCuB,CAASvB,GAClBwY,EAAajmB,EAAOyG,MAAQ+e,EAGlC,IAAIU,EAAiB9lB,EACjB+lB,EAAkB,GAClBC,EAAgB,EAGpB,IAAK9I,EACH,OAAQoI,GACN,IAAK,OACHQ,EAAiBrX,KAAKC,MAAM1O,EAAS4gB,GACrCmF,EAAkB,KAClBC,EAAgBpF,EAChB,MACF,IAAK,UACHkF,EAAiBrX,KAAKC,MAAM1O,EAAS6gB,GACrCkF,EAAkB,KAClBC,EAAgBnF,EAChB,MACF,IAAK,WACHiF,EAAiBtZ,EACjBuZ,EAAkB,MAClB,MACF,QACEA,EAAkB,GAMxB,IAAIE,GAAgB,EAChBC,GAAgB,EAChBC,GAAY,EACZC,EAAc,GACdC,EAAe,GAqBnB,GAlBInJ,GAEF+I,EAAgBJ,GAAclZ,EAC9BuZ,EAAgBL,GAAcrZ,IAG9ByZ,EAAgBJ,GAAcrZ,EAC9B0Z,EAAgBL,GAAclZ,GAK9BwZ,EADEjJ,EACU2I,GAAcC,EAEdD,GAAcC,EAIxBG,EACFG,EAAc,OACdC,EAAe,UACfF,GAAY,OACP,GAAID,EACTE,EAAc,OACdC,EAAe,UACfF,GAAY,OACP,GAAIA,EAAW,CACpB,GAAIjJ,EACFkJ,EAAc,UACT,GAAmB,SAAfd,EACTc,EAAc,YACT,GAAmB,YAAfd,EACTc,EAAc,WACT,CAEL,MAAME,EAAgB7X,KAAKC,MAAM1O,EAAS6gB,GACpC0F,EAAa9X,KAAKC,MAAM1O,EAAS4gB,GAErCwF,EADEP,GAAcS,EACF,OACLT,GAAcU,EACT,OAEA,IAElB,CACAF,EAAe,SACjB,MACED,EAAc,KACdC,EAAe,UAGjB,MAAMG,EAAerH,EAAE/K,YAEjBqS,EAAiBvJ,EAAQ,IAAM,IAGrC6F,EAAMzqB,KAAK,qBAAqB8S,KAAK,+HACiF+T,EAAEhL,wNAE/CgL,EAAEjL,YAAY2R,wEAChC1G,EAAEpL,aAAa0S,IAAiBX,IAAiBC,EAAkB,IAAMA,EAAkB,IAAM,kLAEH,YAAjBM,EAA6BlH,EAAE9K,UAAY,oCAAqD,YAAjBgS,EAA6BG,EAV3N,eAU4PJ,kDAKjR,MAAMxD,EAAgBG,EAAMzqB,KAAK,wBAAwB5E,MAAMC,QAAU,SACzE,IAAI+yB,EAAY,GAEhB,GAAIT,EAEAS,EADExJ,EACU,GAAG2I,KAAclZ,IAEjB,GAAGkZ,KAAcrZ,SAE1B,GAAI0Z,EAEPQ,EADExJ,EACU,GAAG2I,KAAcrZ,IAEjB,GAAGqZ,KAAclZ,SAE1B,GAAIuQ,EAGPwJ,EADEP,EACU,IAAIM,IAAiBX,KAAkBD,KAAcC,IAErD,IAAIW,IAAiBX,KAAkBD,KAAcC,SAE9D,GAAmB,aAAfR,EAEToB,EAAY,KAAKla,KAAkBqZ,KAAcrZ,SAC5C,GAAmB,WAAf8Y,EAGPoB,EADEP,EACU,KAAKnmB,KAAUgmB,KAAiBH,KAAcC,IAE9C,KAAK9lB,KAAUgmB,KAAiBH,KAAcC,SAI5D,GAAIK,EAAW,CACb,MAAMG,EAAgB7X,KAAKC,MAAM1O,EAAS6gB,GACpC0F,EAAa9X,KAAKC,MAAM1O,EAAS4gB,GAErC8F,EADEb,GAAcS,EACJ,KAAKtmB,KAAU6lB,KAAc7lB,KAAU6gB,IAC1CgF,GAAcU,EACX,KAAKvmB,KAAU6lB,KAAc7lB,KAAU4gB,IAEvC,KAAK5gB,KAAU6lB,KAAc7lB,GAE7C,MACE0mB,EAAY,KAAK1mB,KAAU6lB,KAAc7lB,IAK7C5M,EADuB,GAAGwvB,QAAoBrG,UAAiBsJ,KAAca,MAAcN,KACrD,QAClCzD,GACFA,EAAS,CACP7X,QAASqb,EACT9f,MAAOwf,EACP7lB,SACAomB,cACA7J,WACA8I,WACAI,eACApY,QAASsZ,aAGf,GAGA5D,EAAMzqB,KAAK,4BAA4BspB,MAAM,WACvBmB,EAAMzqB,KAAK,gBAAgB5E,MAAMC,OAArD,MACMizB,EAAiB7D,EAAMzqB,KAAK,oBAAoB5E,MAAMC,OAEtDkzB,GADc9D,EAAMzqB,KAAK,mBAAmB5E,MAC9BqvB,EAAMzqB,KAAK,iBAAiB5E,OAAS,SACnDozB,EAAmB/D,EAAMzqB,KAAK,wBAAwB5E,MAAMC,OAClEguB,IACAoF,GAAiB,CAEfnE,cAAekE,GAAyC,WAArBA,EAAgCA,EAAmB,GACtFE,eAAmC,KAAnBJ,EAAwBvY,SAASuY,EAAgB,SAAMt0B,EACvEmwB,SAAUoE,GAEd,GAEA,MAAMlF,EAAa,KACjBkB,EAAQzd,SACR2d,EAAM3d,UAERyd,EAAQjB,MAAMD,GACdoB,EAAMzqB,KAAK,mBAAmBspB,MAAMD,GAEpCoB,EAAMzqB,KAAK,wBAAwBspB,MAAM,SAAUlyB,GACjDA,EAAE0a,kBACF,MAAM6c,EAAkBlE,EAAMzqB,KAAK,0BAA0B5E,MAE7D2sB,GADkC,QAApB4G,EAEhB,IAIIF,GAAmB,CAAC9H,EAAU,CAAC,KACnC,MAAM,GAAQjH,KACdxkB,EAAE,gFAAgF4R,SAEnEiG,KAIf,IAAI8W,EAHYnV,IAGYJ,cAAgB,QACvC,aAAapR,KAAK2mB,KACrBA,EAAgB,SAIlB,MAAM+E,EAAejI,EAAQiI,cAAgB,GACvCzE,EAAWxD,EAAQwD,UAAYN,EAC/BgF,EAAsBlI,EAAQ2D,eAAiB,GAC/CwE,EAAuBnI,EAAQ+H,eAC/BK,EAAsBpI,EAAQqI,cAE9BjrB,EAAU6G,IAAiBC,KACjC,IAAIokB,EAAc,GACdC,EAAgB,GAGhBC,EAAgB,CAAC,UACrB,GAAIprB,EACF,IAAK,MAAMhO,KAAOgO,EAAS,CACzB,MAAM8B,EAAQ9B,EAAQhO,GACtB,GAAI8P,GAAwB,UAAfA,EAAMlI,MAAoBkI,EAAM3B,QAAS,CACpD,IAAK,IAAItO,EAAI,EAAGA,EAAIiQ,EAAM3B,QAAQpO,OAAQF,IAAK,CAC7C,MAAMoC,EAAM6N,EAAM3B,QAAQtO,GACtBoC,GAAOA,EAAI,IAAIm3B,EAAcl5B,KAAK+B,EAAI,GAC5C,CACA,KACF,CACF,CAGF,IAAIo3B,EAAkB,GACtB,GAAIrrB,EACF,IAAK,MAAMhO,KAAOgO,EAAS,CACzB,MAAM8B,EAAQ9B,EAAQhO,GACtB,GAAI8P,GAAwB,SAAfA,EAAMlI,MAAmBkI,EAAM3B,SAAW2B,EAAM3B,QAAQ,GAAI,CACvE,MAAMjM,EAAU4N,EAAM3B,QAAQ,IAAM,GAC9BlM,EAAM6N,EAAM3B,QAAQ,GAC1BjM,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEsK,SAAS,MAAO,CACV6Z,GAAqBnlB,EAAII,IAAQ,IACzCrB,QAAQoT,IACRilB,EAAgB9rB,SAAS6G,EAAKxM,OAAOyxB,EAAgBn5B,KAAKkU,EAAKxM,OAExE,IAEF,KACF,CACF,CAEF,GAAIoG,EACF,IAAK,MAAMhO,KAAOgO,EAAS,CACzB,MAAM8B,EAAQ9B,EAAQhO,GACtB,GAAK8P,GAAUA,EAAMlI,MAASkI,EAAM3B,QAApC,CAEA,GAAmB,SAAf2B,EAAMlI,MAAmBkI,EAAM3B,QAAQ,GAAI,CAC7C,MAAMmrB,EAAUxpB,EAAM3B,QAAQ,GAAG,IAAM,GACvC+qB,EAAc9R,GAAqBkS,EACrC,CAEA,GAAmB,UAAfxpB,EAAMlI,MAAoBixB,EAC5B,IAAK,IAAIh5B,EAAI,EAAGA,EAAIiQ,EAAM3B,QAAQpO,OAAQF,IAAK,CAC7C,MAAMoC,EAAM6N,EAAM3B,QAAQtO,GAC1B,GAAIoC,GAAOA,EAAI,KAAO42B,EAAc,CAClC,MAAMS,EAAUr3B,EAAI,IAAM,GAC1Bk3B,EAAgB/R,GAAqBkS,GACrC,KACF,CACF,CAfmD,CAiBvD,CAGF,MAAMxI,EAAIlK,IAEJ+N,EAAmB,CAAChT,EAAO4X,KAC/B,GAAqB,IAAjB5X,EAAM5hB,OACR,MAAO,oCAAsC+wB,EAAEpL,QAAU,+CAC3D,IAAI3I,EAAO,GACX,IAAK,IAAIld,EAAI,EAAGA,EAAI8hB,EAAM5hB,OAAQF,IAAK,CACrC,MAAMuU,EAAOuN,EAAM9hB,GACnBkd,GACE,kDACA3I,EAAK1R,MACL,iBACAiC,EAAWyP,EAAKxM,MAChB,gBACA2xB,EACA,uCACAzI,EAAE7K,QACF,qBACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UACF,+CACAvhB,EAAWyP,EAAKxM,MAChB,KACAwM,EAAK1R,MACL,WACJ,CACA,OAAOqa,GAGHyX,EAAUrvB,EACd,+IAEI8Y,EACJ,8IACA6S,EAAEvL,QACF,qBACAuL,EAAEtL,OAHF,mLAMAsL,EAAEhL,UACF,4BACAgL,EAAEtL,OARF,sHAWAsL,EAAEjL,OAXF,oOAeAiL,EAAEpL,QAfF,iNAkBAoL,EAAEpL,QAlBF,sMAqBAoL,EAAEpL,QArBF,2RA4Bc,SAAb0O,EAAsB,UAAY,IACnC,0DACc,SAAbA,EAAsBtD,EAAEjL,OAASiL,EAAEnL,OACpC,qBACAmL,EAAEtL,OACF,6BACc,SAAb4O,EAAsB,OAAStD,EAAErL,UAlClC,mFAqCc,UAAb2O,EAAuB,UAAY,IACpC,2DACc,UAAbA,EAAuBtD,EAAEjL,OAASiL,EAAEnL,OACrC,qBACAmL,EAAEtL,OACF,6BACc,UAAb4O,EAAuB,OAAStD,EAAErL,UA3CnC,mKA8CE,CAAC,OAAQ,SAASlY,SAAS6mB,GAAuBtD,EAAEnL,MAAbmL,EAAEjL,QAC3C,qBACAiL,EAAEtL,OACF,6BACE,CAAC,OAAQ,SAASjY,SAAS6mB,GAAqBtD,EAAErL,SAAX,QAlDzC,uHAqDE,CAAC,OAAQ,SAASlY,SAAS6mB,GAAuB,GAAXA,GACzC,kDACAtD,EAAE7K,QACF,gCACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UA3DF,mIA+DAkO,EA/DA,sCAkEAtD,EAAEjL,OAlEF,sWAsEAiL,EAAEpL,QACF,oJACAoL,EAAE7K,QACF,gCACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UA5EF,oHA+EA4K,EAAEpL,QACF,mPACAoL,EAAEjL,OACF,4BACAiL,EAAEjL,OACF,wPACAiL,EAAE7K,QACF,gCACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UAzFF,6MA8FA4K,EAAEpL,QACF,2FAC0BzhB,IAAzB80B,EAAqCA,EAAuB,IAC7D,sEACAjI,EAAE7K,QACF,gCACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UAtGF,oHAyGA4K,EAAEpL,QACF,kJACAoL,EAAE7K,QACF,gCACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UA/GF,+MAmHAyO,EAAiBuE,EAAa,QAnH9B,0CAsHApI,EAAEjL,OAtHF,2WA0HAiL,EAAEpL,QACF,wFACA/gB,EAAWk0B,GACX,+DACA/H,EAAE7K,QACF,gCACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UAlIF,oHAqIA4K,EAAEpL,QACF,kPACAoL,EAAEjL,OACF,4BACAiL,EAAEjL,OACF,sPACAiL,EAAE7K,QACF,gCACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UA/IF,6MAoJA4K,EAAEpL,QACF,0FACyBzhB,IAAxB+0B,EAAoCA,EAAsB,IAC3D,sEACAlI,EAAE7K,QACF,gCACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UA5JF,oHA+JA4K,EAAEpL,QACF,iJACAoL,EAAE7K,QACF,gCACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UArKF,+MAyKAyO,EAAiBwE,EAAe,OAzKhC,iFA4KArI,EAAEjL,OA5KF,4PAkLI6O,EAAQvvB,EAAE8Y,GAChB9Y,EAAE,QAAQgY,OAAOqX,GAASrX,OAAOuX,GAEjC,MAAM8E,EAAgBD,IACpB,MAAME,EAA6B,SAAfF,EAAwB,6BAA+B,4BACrE5d,EAAa+Y,EAAMzqB,KAAKwvB,GAC9B,IAAI1c,EAAO,GACXqc,EAAcp4B,QAAQ4G,IACpB,MAAMyN,EAAuB,WAATzN,EAAoBmN,IAAyBK,EAAwBxN,GACnFytB,EAAYhgB,EAAYtV,OAAS,EAAIsV,EAAYigB,UAAU,EAAG,GAAK,KAAOjgB,EAChF0H,GACE,mDACApY,EAAWiD,GACX,gBACA2xB,EACA,uCACAzI,EAAEnL,MACF,qBACAmL,EAAEtL,OACF,4BACAsL,EAAErL,SACF,8DACA9gB,EAAW0Q,GACX,KACA1Q,EAAW0wB,GACX,cAEJ1Z,EAAWoB,KAAKA,GAChBpB,EAAW1R,KAAK,yBAAyBspB,MAAM,SAAUlyB,GACvDA,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAMuT,EAAWnqB,EAAE3F,MAAMa,KAAK,QAEjB,SADA8E,EAAE3F,MAAMa,KAAK,QAExBq0B,EAAMzqB,KAAK,yBAAyB5E,IAAIiqB,GAAU5pB,QAAQ,UAE1DgvB,EAAMzqB,KAAK,6BAA6B5E,IAAIiqB,GAAU5pB,QAAQ,SAElE,IAIIg0B,EAAkB,CAAC/X,EAAO4X,KAC9B,MAAME,EAA6B,SAAfF,EAAwB,qBAAuB,oBAC7D5d,EAAa+Y,EAAMzqB,KAAKwvB,GAE9B,IAAI1c,EAAO,GAGP4E,EAAM5hB,OAAS,GACjB4hB,EAAM3gB,QAAQoT,IACZ2I,GACE,kDACA3I,EAAK1R,MACL,iBACAiC,EAAWyP,EAAKxM,MAChB,gBACA2xB,EACA,uCACAzI,EAAE7K,QACF,qBACA6K,EAAEtL,OACF,4BACAsL,EAAE5K,UACF,oCACAvhB,EAAWyP,EAAKxM,MAChB,IACAwM,EAAK1R,MACL,cAKNqa,GACE,uDACAwc,EACA,qEACAzI,EAAEjL,OACF,4BACAiL,EAAEjL,OACF,kKAGF9I,GACE,yDACAwc,EACA,gSAEF5d,EAAWoB,KAAKA,GAGhBpB,EAAW1R,KAAK,yBAAyBspB,MAAM,WAC7C,MAAMluB,EAAMF,EAAE3F,MAAM4U,KAAK,YACnBulB,EAAQx0B,EAAE3F,MAAM4U,KAAK,cAEd,SADAjP,EAAE3F,MAAM4U,KAAK,cAExBsgB,EAAMzqB,KAAK,uBAAuB5E,IAAIA,GACtCqvB,EAAMzqB,KAAK,sBAAsB5E,IAAIs0B,KAErCjF,EAAMzqB,KAAK,sBAAsB5E,IAAIA,GACrCqvB,EAAMzqB,KAAK,qBAAqB5E,IAAIs0B,GAExC,GAGAhe,EAAW1R,KAAK,6BAA6BspB,MAAMhd,eAAgBlV,GACjEA,EAAEmc,iBACFnc,EAAE0a,kBAEF,MAAMiQ,EAAO7mB,EAAE3F,MACf,GAAIwsB,EAAK8I,KAAK,YAAa,OAE3B,MAAMpiB,EAAOsZ,EAAK5X,KAAK,aAGvB4X,EAAK8I,KAAK,YAAY,GAAMlY,IAAI,UAAW,OAC3C,MAAMmY,EAAe/I,EAAKjP,OAC1BiP,EAAKjP,KAAK,+CAGV,MAAMiY,EAAkB3L,GAAiBG,aACzCH,GAAiBG,aAAe,KAC9BroB,QAAQC,IAAI,yBAGd,IAEE,IAAIkuB,EAOJ,GALEA,EADW,SAAT5c,EACSgiB,EAAMzqB,KAAK,yBAAyB5E,MAAMC,QAAU,SAEpDovB,EAAMzqB,KAAK,6BAA6B5E,MAAMC,QAGtDgqB,EAEH,YADIvb,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,WAI3CxrB,QAAQC,IAAI,sBAAuBkuB,EAAU,QAAS5c,GAGtD,MAAMuiB,EAAYtG,KAGZuG,EAAYD,EAAUjG,MAAQiG,EAC9BE,EAAeF,EAAU/F,SAAW,CAAC,EAGrCX,EAAW,IAAK2G,KAAcC,GAKpC,UAFqBlF,GAA2BX,EAAUf,IAE/C9R,QAAS,CAElB,MAAMmd,EAAiBlJ,GAA8BpB,GACrDoK,EAAgBE,EAAgBlnB,EAClC,CACF,CAAE,MAAO4M,GACPne,QAAQmK,MAAM,oBAAqBgU,GAC/BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SACzC,C,QAEE+d,GAAiBG,aAAewL,EAChChJ,EAAK8I,KAAK,YAAY,GAAOlY,IAAI,UAAW,KAAKG,KAAKgY,EACxD,CACF,GAGApZ,EAAW1R,KAAK,+BAA+BspB,MAAMhd,eAAgBlV,GACnEA,EAAEmc,iBACFnc,EAAE0a,kBAEF,MAAMiQ,EAAO7mB,EAAE3F,MACf,GAAIwsB,EAAK8I,KAAK,YAAa,OAE3B,MAAMpiB,EAAOsZ,EAAK5X,KAAK,aAGvB,IAAIkb,EAOJ,GALEA,EADW,SAAT5c,EACSgiB,EAAMzqB,KAAK,yBAAyB5E,MAAMC,QAAU,SAEpDovB,EAAMzqB,KAAK,6BAA6B5E,MAAMC,QAGtDgqB,EAEH,YADIvb,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,WAI3C,IAAKyI,QAAQ,SAAS9F,gCACpB,OAIFtD,EAAK8I,KAAK,YAAY,GAAMlY,IAAI,UAAW,OAC3C,MAAMmY,EAAe/I,EAAKjP,OAC1BiP,EAAKjP,KAAK,+CAGV,MAAMiY,EAAkB3L,GAAiBG,aACzCH,GAAiBG,aAAe,KAC9BroB,QAAQC,IAAI,uBAGd,IACED,QAAQC,IAAI,sBAAuBkuB,EAAU,QAAS5c,GAItD,UAFqB2c,GAAkCC,IAE5C7S,QAAS,CAElB,MAAMmd,EAAiBlJ,GAA8BpB,GACrDoK,EAAgBE,EAAgBlnB,EAClC,CACF,CAAE,MAAO4M,GACPne,QAAQmK,MAAM,oBAAqBgU,GAC/BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SACzC,C,QAEE+d,GAAiBG,aAAewL,EAChChJ,EAAK8I,KAAK,YAAY,GAAOlY,IAAI,UAAW,KAAKG,KAAKgY,EACxD,CACF,IAwBF,GApBAyE,EAAc,QACdA,EAAc,OAEd9E,EAAMzqB,KAAK,8BAA8BspB,MAAM,SAAUlyB,GACvDA,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAMyZ,EAAYlH,KAClB,IAAImH,EAAcD,EAAUpV,KAAKC,MAAMD,KAAKE,SAAWkV,EAAUz1B,SACjE20B,EAAMzqB,KAAK,sBAAsB5E,IAAIowB,GAAa/vB,QAAQ,SAC5D,GAGAgvB,EAAMzqB,KAAK,6BAA6BspB,MAAM,SAAUlyB,GACtDA,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAMyZ,EAAYlH,KAClB,IAAImH,EAAcD,EAAUpV,KAAKC,MAAMD,KAAKE,SAAWkV,EAAUz1B,SACjE20B,EAAMzqB,KAAK,qBAAqB5E,IAAIowB,GAAa/vB,QAAQ,SAC3D,GAEIozB,EAAqB,CACvB,MAAMe,EAAYnJ,GAA8BoI,GAChDY,EAAgBG,EAAW,OAC7B,CACA,GAAIhB,EAAc,CAChB,MAAMiB,EAAWpJ,GAA8BmI,GAC/Ca,EAAgBI,EAAU,MAC5B,CAGAnJ,GAAmB+D,EAAMzqB,KAAK,yBAA0BmvB,EAAetI,GACvEH,GAAmB+D,EAAMzqB,KAAK,6BAA8BmvB,EAAetI,GAC3EH,GAAmB+D,EAAMzqB,KAAK,sBAAuBovB,EAAiBvI,GACtEH,GAAmB+D,EAAMzqB,KAAK,qBAAsBovB,EAAiBvI,GACrEY,GACEgD,EACA,8KACA5D,GAIF4D,EAAMzqB,KAAK,yBAAyB6R,GAAG,+BAAgC,WACrE,MAAMwT,EAAWnqB,EAAE3F,MAAM6F,MAAMC,QAAU,SACnCowB,EAAc9H,GAA0B0B,GAC9CqB,GAAmB+D,EAAMzqB,KAAK,sBAAuByrB,EAAY31B,OAAS,EAAI21B,EAAc2D,EAAiBvI,GAC7G,MAAMiJ,EAAYrJ,GAA8BpB,GAChDoK,EAAgBK,EAAW,OAC7B,GAGArF,EAAMzqB,KAAK,6BAA6B6R,GAAG,+BAAgC,WACzE,MAAMwT,EAAWnqB,EAAE3F,MAAM6F,MAAMC,OACzBowB,EAAc9H,GAA0B0B,GAC9CqB,GAAmB+D,EAAMzqB,KAAK,qBAAsByrB,EAAY31B,OAAS,EAAI21B,EAAc2D,EAAiBvI,GAC5G,MAAMiJ,EAAYrJ,GAA8BpB,GAChDoK,EAAgBK,EAAW,MAC7B,GAGArF,EAAMzqB,KAAK,sBAAsB6R,GAAG,gBAAiB,WACnD,MAAMwT,EAAWoF,EAAMzqB,KAAK,yBAAyB5E,MAAMC,QAAU,SAC/D4oB,EAAW/oB,EAAE3F,MAAM6F,MAAMC,OACzBsvB,EAAY3G,GAAkBqB,EAAUpB,GAC5B,OAAd0G,GACFF,EAAMzqB,KAAK,uBAAuB5E,IAAIuvB,EAE1C,GAGAF,EAAMzqB,KAAK,qBAAqB6R,GAAG,gBAAiB,WAClD,MAAMwT,EAAWoF,EAAMzqB,KAAK,6BAA6B5E,MAAMC,OACzD4oB,EAAW/oB,EAAE3F,MAAM6F,MAAMC,OACzBsvB,EAAY3G,GAAkBqB,EAAUpB,GAC5B,OAAd0G,GACFF,EAAMzqB,KAAK,sBAAsB5E,IAAIuvB,EAEzC,GAGAF,EAAMzqB,KAAK,uBAAuBspB,MAAM,WACtC,MAAMkD,EAAUtxB,EAAE3F,MAAMa,KAAK,QAEb,WAAZo2B,IAEJ/B,EAAMzqB,KAAK,uBAAuB2S,IAAI,CAAEwU,WAAYN,EAAEnL,MAAOmM,MAAOhB,EAAErL,WACtEtgB,EAAE3F,MAAMod,IAAI,CAAEwU,WAAYN,EAAEjL,OAAQiM,MAAO,SAC3C4C,EAAMzqB,KAAK,sBAAsB5E,IAAIoxB,GAGrC7X,EAAe,CAAEL,aAAckY,IACjC,GAGA/B,EAAMzqB,KAAK,2BAA2BspB,MAAM,WAE1CmB,EAAMzqB,KAAK,uBAAuB2S,IAAI,CAAEwU,WAAYN,EAAEnL,MAAOmM,MAAOhB,EAAErL,WACtEtgB,EAAE3F,MAAMod,IAAI,CAAEwU,WAAYN,EAAEjL,OAAQiM,MAAO,SAE3C,IAAIgF,EAAapC,EAAMzqB,KAAK,wBAAwB5E,MAAMC,OAErDwxB,EAIA,aAAa3pB,KAAK2pB,IAKvBpC,EAAMzqB,KAAK,sBAAsB5E,IAAIyxB,GAGrClY,EAAe,CAAEL,aAAcuY,KAPzB/iB,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,iBAJzC+H,EAAMzqB,KAAK,wBAAwBqT,OAYvC,GAGAoX,EAAMzqB,KAAK,wBAAwB6R,GAAG,UAAW,SAAUza,GAC3C,UAAVA,EAAErB,MACJqB,EAAEmc,iBACFkX,EAAMzqB,KAAK,2BAA2BspB,QAE1C,GAEA,MAAMhT,EAAW,SAAUvB,GACzB,MAAMjZ,EAAQiZ,EAAQjZ,MAAM,0BAC5B,IAAKA,EAAO,MAAO,CAAEiS,MAAO,EAAGkI,MAAO,GAAID,MAAO,KACjD,MAAMzM,EAAQwM,SAASja,EAAM,GAAI,IAC3Bka,EAAQD,SAASja,EAAM,GAAI,IAC3BmZ,EAAWnZ,EAAM,GAAKia,SAASja,EAAM,GAAI,IAAM,EAC/Cma,EAAQ,GACd,IAAK,IAAIrgB,EAAI,EAAGA,EAAI2T,EAAO3T,IACzBqgB,EAAMhgB,KAAKkgB,KAAKC,MAAMD,KAAKE,SAAWL,GAAS,GAEjD,MAAO,CACLjI,MACEkI,EAAM5M,OAAO,SAAU1S,EAAGC,GACxB,OAAOD,EAAIC,CACb,EAAG,GAAKqe,EACVgB,MAAOA,EACPD,MAAOA,EAEX,EAEM+Z,EAAkB,SAAUC,EAAMtoB,EAAQsO,GAC9C,OAAc,MAAVA,EACEga,GAAQ,EAAU,CAAEtX,MAAO,EAAG/a,KAAM,MAAOkqB,MAAO,WAClDmI,GAAQ,GAAW,CAAEtX,OAAQ,EAAG/a,KAAM,MAAOkqB,MAAO,WACpDmI,GAAQ7Z,KAAKC,MAAM1O,EAAS,GAAW,CAAEgR,MAAO,EAAG/a,KAAM,OAAQkqB,MAAO,WACxEmI,GAAQ7Z,KAAKC,MAAM1O,EAAS,GAAW,CAAEgR,MAAO,EAAG/a,KAAM,OAAQkqB,MAAO,WACxEmI,GAAQtoB,EAAe,CAAEgR,MAAO,EAAG/a,KAAM,OAAQkqB,MAAO,WACrD,CAAEnP,OAAQ,EAAG/a,KAAM,KAAMkqB,MAAO,WAE1B,KAATmI,EAAoB,CAAEtX,MAAO,EAAG/a,KAAM,MAAOkqB,MAAO,WAC3C,IAATmI,EAAmB,CAAEtX,OAAQ,EAAG/a,KAAM,MAAOkqB,MAAO,WACpDmI,GAAQtoB,EAAe,CAAEgR,MAAO,EAAG/a,KAAM,KAAMkqB,MAAO,WACnD,CAAEnP,OAAQ,EAAG/a,KAAM,KAAMkqB,MAAO,UAE3C,EAEA4C,EAAMzqB,KAAK,qBAAqBspB,MAAM,WACpC,IAYI2G,EAZAlb,EAAU0V,EAAMzqB,KAAK,sBAAsB5E,OAAS,QAEpD80B,EAAWzF,EAAMzqB,KAAK,yBAAyB5E,MAAMC,QAAU,SAC/D80B,EAAe1F,EAAMzqB,KAAK,sBAAsB5E,MAAMC,QAAU,OAEhE+0B,EAAa,SAAU/C,GACzB,IAAIgD,EAAIhD,EAAWvxB,MAAM,gBACzB,OAAIu0B,EAAUla,KAAKW,MAAOf,SAASsa,EAAE,GAAI,IAAMta,SAASsa,EAAE,GAAI,IAAO,GAC9D,EACT,EAEIC,EAAiB7F,EAAMzqB,KAAK,uBAAuB5E,MAAMC,OAI3D40B,EAFqB,KAAnBK,EAEUF,EAAWrb,GAEXgB,SAASua,EAAgB,KAAOF,EAAWrb,GAEzD,IACIwb,EADAC,EAAkB/F,EAAMzqB,KAAK,wBAAwB5E,MAAMC,OAG7Dk1B,EADsB,KAApBC,EACWza,SAASya,EAAiB,IAG1BP,EAGf,IAGIQ,EAHAC,EAAUjG,EAAMzqB,KAAK,6BAA6B5E,MAAMC,QAAU,KAClEs1B,EAAclG,EAAMzqB,KAAK,qBAAqB5E,MAAMC,QAAU80B,EAC9DS,EAAgBnG,EAAMzqB,KAAK,sBAAsB5E,MAAMC,OAIzDo1B,EAFoB,KAAlBG,EAESR,EAAWrb,GAEXgB,SAAS6a,EAAe,KAAOR,EAAWrb,GAEvD,IACI8b,EADAC,EAAiBrG,EAAMzqB,KAAK,uBAAuB5E,MAAMC,OAG3Dw1B,EADqB,KAAnBC,EACU/a,SAAS+a,EAAgB,IAGzBL,EAGd,IAKIM,EAAQC,EALRC,EAAa3a,EAASvB,GACtBmc,EAAY5a,EAASvB,GACrBoc,EAAcpB,EAAgBkB,EAAWljB,MAAOwiB,EAAYU,EAAWjb,OACvEob,EAAarB,EAAgBmB,EAAUnjB,MAAO8iB,EAAWK,EAAUlb,OAInE4S,EADUlU,IACQD,gBAAkB,iBAEpC0c,EAAYzY,MAAQ0Y,EAAW1Y,OACjCqY,EAASb,EAAW,MACpBc,EAAc,UACDG,EAAYxzB,KAAgByzB,EAAWzzB,MAC3CwzB,EAAYzY,MAAQ0Y,EAAW1Y,OACxCqY,EAASL,EAAU,MACnBM,EAAc,UACDI,EAAWzzB,KAAgBwzB,EAAYxzB,OAGvC,QAAUwzB,EAAYxzB,KACnB,kBAAZirB,GACFmI,EAAS,MAAQb,EAAW,MAC5Bc,EAAc,WACO,QAAZpI,GACTmI,EAAS,OACTC,EAAc,YAGdD,EAAS,MAAQb,EAAW,MAC5Bc,EAAc,YAIlBvG,EACGzqB,KAAK,wBACL8S,KACC,2CACE+T,EAAEhL,UADJ,gQAMEgL,EAAEpL,QACF,+EACA/gB,EAAWw1B,GARb,6DAWErJ,EAAEjL,OACF,MACAqV,EAAWljB,MAbb,kDAgBEojB,EAAYtJ,MACZ,oEACAsJ,EAAYxzB,KAlBd,mCAsBEkpB,EAAEpL,QAtBJ,yJA0BE2V,EAAWvJ,MACX,oEACAuJ,EAAWzzB,KA5Bb,6DA+BEkpB,EAAEjL,OACF,MACAsV,EAAUnjB,MAjCZ,4CAoCE8Y,EAAEpL,QACF,+EACA/gB,EAAWg2B,GAtCb,+EA2CEM,EA3CF,kFA8CED,EA9CF,uBAoDJ,MAAMM,EACJ,SAASlB,QAAmBQ,WACzBT,QAAeK,SAAkBU,EAAWljB,aAAaojB,EAAYxzB,SACrE+yB,QAAcG,SAAiBK,EAAUnjB,aAAaqjB,EAAWzzB,eAC3DozB,KACXj2B,EAAsBu2B,EAAmB,OAC3C,GAEA5G,EAAMzqB,KAAK,0BAA0BspB,MAAM,WACzC,IAAIgH,EAAiB7F,EAAMzqB,KAAK,uBAAuB5E,MAAMC,OACzDi2B,EAAkB7G,EAAMzqB,KAAK,sBAAsB5E,OAAS,GAC5DmzB,EAAc9D,EAAMzqB,KAAK,sBAAsB5E,OAAS,QACxDozB,EAAmB/D,EAAMzqB,KAAK,yBAAyB5E,MAAMC,OACjEguB,IACAO,GAAc,CAEZK,YAAgC,KAAnBqG,EAAwBva,SAASua,EAAgB,IAAM,KACpEpG,WAAYoH,EACZnH,SAAUoE,EACVjE,cAAekE,GAEnB,GAGA/D,EAAMzqB,KAAK,2BAA2BspB,MAAM,SAAUlyB,GACpDA,EAAE0a,kBACF,MAAMyc,EAAc9D,EAAMzqB,KAAK,sBAAsB5E,OAAS,QAE9D2sB,GAD8B,SAAhBwG,EAEhB,GACA,IAAIlF,EAAa,WACfkB,EAAQzd,SACR2d,EAAM3d,QACR,EACAyd,EAAQjB,MAAMD,GACdoB,EAAMzqB,KAAK,sBAAsBspB,MAAMD,IAGnCkI,GAAkB,CAACx5B,EAAWE,EAASD,EAAK8B,EAAU03B,KAC1D,MAAM,GAAQ9R,KACdxkB,EAAE,wBAAwB4R,SAE1B,MAAMhO,EAASiU,KAIToL,GAHIxB,IAGI3kB,EAAI,IAAM,MAGxB,IAAIoY,EAAW,GACf,IAAK,IAAIxa,EAAI,EAAGA,EAAIqC,EAAQnC,OAAQF,IAAK,CACvC,MAAMgoB,EAAa3lB,EAAQrC,GACrB67B,EAAYz5B,EAAIpC,GACjBgoB,GAAD,MAAe6T,GAA+D,KAAdA,IAEpErhB,GAAY,uGAEmC1V,EAAWkjB,gEACXljB,EAAWE,OAAO62B,kDAGnE,CAGA,MAAMlH,EAAUrvB,EAAE,2DACkC4D,EAAOkU,4QAK3BtY,EAAWyjB,0QAKrB/N,GAAY,wKAMlClV,EAAE,QAAQgY,OAAOqX,GAGjBA,EAAQvqB,KAAK,sBAAsBspB,MAAM,IAAMiB,EAAQzd,UACvDyd,EAAQ1Y,GAAG,QAAS,SAAUza,GACxB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,wBAAwBqY,EAAQzd,QAC3D,IAII4kB,GAAwBC,IAC5B,MAAM,GAAQjS,KACdxkB,EAAE,+BAA+B4R,SAEjC,MAAMhO,EAASiU,KACT8T,EAAIlK,IAEJ1kB,EAAU05B,EAAS15B,SAAW,GAC9B4hB,EAAO8X,EAAS9X,MAAQ,GAExB+X,EAAU35B,EAAQyK,UAAU1J,GAAKA,IAAMA,EAAEsK,SAAS,OAAStK,EAAEsK,SAAS,SAAW,EACjFuuB,EAAc55B,EAAQyK,UAAU1J,GAAKA,GAAKA,EAAEsK,SAAS,SACrDwuB,EAAcH,EAAS57B,KAAO,GAEpC,GAAI87B,EAAc,EAEhB,YADI/nB,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,eAI3C,MAAMqP,EAAQ,IAAInrB,IACZorB,EAAQ,GAERC,EAAct0B,GAAQ0N,EAAcc,eAAexO,GAEnDoG,EAAU6G,IAAiBC,KACjC,IAAIe,EAAa,KACjB,GAAI7H,EACF,IAAK,MAAMhO,KAAOgO,EAAS,CACzB,MAAM8B,EAAQ9B,EAAQhO,GACtB,GAAI8P,GAAOlI,MAAM2F,SAAS,OAASuC,EAAM3B,UAAU,GAAI,CACrD0H,EAAa/F,EAAM3B,QAAQ,GAAG,IAAM,KACpC,KACF,CACF,CAEF,MAAMguB,EAAqBD,EAAYrmB,GACjCumB,EAAiB,MACrB,IAAK,MAAMjjB,KAAKnL,EACd,GAAIA,EAAQmL,IAAIvR,MAAM2F,SAAS,MAAO,OAAO4L,EAE/C,MAAO,EACR,EALsB,GAMvB6iB,EAAM5xB,IAAI+xB,EAAoB,CAC5Bv0B,KAAMu0B,EACNnmB,UAAU,EACVqmB,EAAG,EACHC,EAAG,EACHb,SAAUW,EACVr4B,SAAU,IAIZ,MAAMw4B,EAAgBr6B,EAAQyK,UAAU1J,GAAKA,GAAKA,EAAEsK,SAAS,OAE7DuW,EAAK9iB,QAAQ,CAACiB,EAAKI,KACjB,MAAMm6B,EAAav6B,EAAI45B,GACvB,IAAKW,EAAY,OAEjB,MAAMC,EAAUP,EAAYM,GAG5B,IAAIE,GAAY,EAChB,GAAIH,EAAgB,EAAG,CACrB,MAAMI,EAAa93B,OAAO5C,EAAIs6B,IAAkB,IAC7Cj3B,OACAmb,cAIDic,EAHa73B,OAAO3C,EAAQq6B,IAAkB,IAAI9b,cAEzClT,SAAS,MACS,MAAfovB,GAAqC,UAAfA,GAAyC,OAAfA,EAG1DA,EAAW18B,WAAW,OAAwB,SAAf08B,GAAwC,MAAfA,GAAqC,QAAfA,CAEpF,CAEKX,EAAM3pB,IAAIoqB,IACbT,EAAM5xB,IAAIqyB,EAAS,CACjB70B,KAAM60B,EACNzmB,UAAU,EACVqmB,EAAG,EACHC,EAAG,EACHb,SAAUM,EACVh4B,SAAU1B,EACVq6B,UAAWA,IAIf,MAAME,EAAc36B,EAAI65B,IAAgB,GACtBtU,GAAwBoV,GAEhC57B,QAAQ67B,IAChB,IAAKA,EAAIj1B,KAAM,OACf,MAAMk1B,EAAkBZ,EAAYW,EAAIj1B,MAExC,GAAIk1B,IAAoBL,EAAS,OAEjC,IAAKT,EAAM3pB,IAAIyqB,GAAkB,CAE/B,IAAIC,GAAe,EACnB,IAAK,IAAIC,EAAK,EAAGA,EAAKlZ,EAAK/jB,OAAQi9B,IACjC,GAAId,EAAYpY,EAAKkZ,GAAInB,MAAciB,EAAiB,CACtDC,EAAcC,EACd,KACF,CAEFhB,EAAM5xB,IAAI0yB,EAAiB,CACzBl1B,KAAMk1B,EACN9mB,SAAU8mB,IAAoBX,EAC9BE,EAAG,EACHC,EAAG,EACHb,SAAUsB,GAAe,EAAIhB,EAAc,GAC3Ch4B,SAAUg5B,GAAe,EAAIA,OAAc94B,GAE/C,CAGA,MAsLMg5B,EAtLgBC,KACpB,IAAKA,EAAQ,MAAO,GACpB,MAAM/2B,EAAQtB,OAAOq4B,GAClBrvB,MAAM,sCACNzN,IAAIwE,GAAKA,EAAEU,QACX2F,OAAOrG,GAAKA,GAAKA,EAAE7E,OAAS,IAGzBo9B,EAAkB,CACtB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,MACA,KACA,KACA,MAGF,OAAOh3B,EACJ/F,IAAI8J,IAIH,MAAMkzB,GAFNlzB,EAAIA,EAAEpF,QAAQ,kBAAmB,IAAIQ,QAERS,MAAM,kBAyCnC,IAHAmE,GAFAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GADAA,GAHAA,GADAA,GADAA,GAHAA,GADAA,GADAA,GAPEA,EADEkzB,EACEA,EAAmB,GAGnBlzB,EAAEpF,QAAQ,kDAAmD,KAI7DA,QAAQ,0BAA2B,KACnCA,QAAQ,wBAAyB,MACjCA,QAAQ,oBAAqB,KAG7BA,QAAQ,MAAO,KACfA,QAAQ,MAAO,KACfA,QAAQ,MAAO,KAGfA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,SAAU,OAClBA,QAAQ,qBAAsB,OAC9BA,QAAQ,cAAe,OACvBA,QAAQ,qBAAsB,OAC9BA,QAAQ,eAAgB,OACxBA,QAAQ,eAAgB,OACxBA,QAAQ,iBAAkB,QAC1BA,QAAQ,iBAAkB,QAC1BA,QAAQ,gBAAiB,OACzBA,QAAQ,eAAgB,OACxBA,QAAQ,qBAAsB,SAC9BA,QAAQ,kBAAmB,OAC3BA,QAAQ,qBAAsB,OAE9BQ,QAGAvF,OAAS,EAAG,CAEhB,IAAK,MAAM88B,KAAOM,EAChB,GAAIjzB,EAAEyD,SAASkvB,GACb,OAAOA,EAIX,MAAMQ,EAAYnzB,EAAEnJ,OAAO,GAC3B,IAAK,MAAM87B,KAAOM,EAChB,GAAIE,EAAU9vB,SAASsvB,GACrB,OAAOA,EAIX,OAAO3yB,EAAEnJ,OAAO,EAClB,CAEA,OAAOmJ,IAERe,OAAOrG,GAAKA,GAAKA,EAAE7E,OAAS,GAAK6E,EAAE7E,QAAU,IAG5Bu9B,CAAcT,EAAIx0B,UACX,IAAzB40B,EAAcl9B,QAAck9B,EAAc/8B,KAAK,IAGnD,IAAIq9B,EAAetB,EAAMhyB,KACvB5I,GACGA,EAAEwJ,SAAW4xB,GAAWp7B,EAAEsQ,SAAWmrB,GACrCz7B,EAAEwJ,SAAWiyB,GAAmBz7B,EAAEsQ,SAAW8qB,GAGlD,GAAKc,EAWH,GAAIA,EAAa1yB,SAAW4xB,EAAS,CAEnC,MAAMe,EAAW,IAAKD,EAAaE,kBAAoB,MAAQR,GAE/DM,EAAaE,iBAAmB,IAAI,IAAI/U,IAAI8U,IAAWz8B,MAAM,EAAG,EAClE,KAAO,CAEL,MAAMy8B,EAAW,IAAKD,EAAaG,kBAAoB,MAAQT,GAC/DM,EAAaG,iBAAmB,IAAI,IAAIhV,IAAI8U,IAAWz8B,MAAM,EAAG,EAClE,MAlBAk7B,EAAM/7B,KAAK,CACT2K,OAAQ4xB,EACR9qB,OAAQmrB,EAERW,iBAAkBR,EAAcl8B,MAAM,EAAG,GACzC28B,iBAAkB,SAkB1B,MAAMC,EAAUp5B,MAAM4b,KAAK6b,EAAM9yB,UAC3B00B,EAAU,IACdC,EAAU,IAGNC,EAAkB,IAAIjtB,IAC5B8sB,EAAQ38B,QAAQ+8B,GAAQD,EAAgB1zB,IAAI2zB,EAAKn2B,KAAM,IACvDq0B,EAAMj7B,QAAQg9B,IACZF,EAAgB1zB,IAAI4zB,EAAKnzB,QAASizB,EAAgBl0B,IAAIo0B,EAAKnzB,SAAW,GAAK,GAC3EizB,EAAgB1zB,IAAI4zB,EAAKrsB,QAASmsB,EAAgBl0B,IAAIo0B,EAAKrsB,SAAW,GAAK,KAI7E,MAAMssB,EAAelqB,OAAOmqB,YAAc,IACpCC,EAAaF,EAAe,GAAK,GACjCG,EAAYH,EAAe,GAAK,GAChCI,EAAmBJ,EAAe,GAAK,GACvCK,EAAsBL,EAAe,IAAM,IAYjDN,EAAQ38B,QAAQ+8B,IACdA,EAAKQ,OAXe,EAACC,EAAUxoB,KAC/B,GAAIA,EAAU,CACZ,MAAMxC,EAAQsqB,EAAgBl0B,IAAI40B,IAAa,EAC/C,OAAOpe,KAAKjX,IAAIi1B,EAAWC,EAAmBje,KAAKqe,KAAKjrB,GAAS8qB,EACnE,CACA,MAAM9qB,EAAQsqB,EAAgBl0B,IAAI40B,IAAa,EAC/C,OAAOpe,KAAKjX,IAAIi1B,EAAWD,EAAa/d,KAAKqe,KAAKjrB,GAAS8qB,IAK7CI,CAAcX,EAAKn2B,KAAMm2B,EAAK/nB,YAI9C,MAAM2oB,EAAgBve,KAAKhX,OAAOu0B,EAAQv9B,IAAIsgB,GAAKA,EAAE6d,SAC/CA,EAASne,KAAKjX,IAAI,IAAKiX,KAAKhX,IAAI,IAAsB,GAAjBu0B,EAAQ59B,OAAc4+B,IACjEhB,EAAQ38B,QAAQ,CAAC+8B,EAAMl+B,KACrB,GAAIk+B,EAAK/nB,SACP+nB,EAAK1B,EAAIuB,EACTG,EAAKzB,EAAIuB,MACJ,CACL,MAAMe,EAAS,EAAIxe,KAAKye,GAAKh/B,EAAK89B,EAAQ59B,OAC1Cg+B,EAAK1B,EAAIuB,EAAUW,EAASne,KAAK0e,IAAIF,GACrCb,EAAKzB,EAAIuB,EAAUU,EAASne,KAAK2e,IAAIH,EACvC,IAIF,IAAIjpB,EAAQ,EACRqpB,EAAO,EACPC,EAAO,EACX,MAGMzK,EAAUrvB,EAAE,kEACyC4D,EAAOkU,2wCAeQ6T,EAAEpL,mSAGFoL,EAAEpL,gSAGJoL,EAAEjL,iSAGFiL,EAAEjL,ivBAWrBzF,KAAKW,MAAc,IAARpL,gGAMhExQ,EAAE,QAAQgY,OAAOqX,GAEjB,MAAM0K,EAAO1K,EAAQvqB,KAAK,kBACpBk1B,EAAa3K,EAAQvqB,KAAK,wBAC1Bm1B,EAAc5K,EAAQvqB,KAAK,oBAC3Bo1B,EAAc7K,EAAQvqB,KAAK,oBAC3Bq1B,EAAe9K,EAAQvqB,KAAK,qBAC5Bs1B,EAAW/K,EAAQvqB,KAAK,6BAExBu1B,EAAkB,KACtBL,EAAW/qB,KAAK,YAAa,aAAa4qB,MAASC,YAAetpB,MAClE2pB,EAAapqB,KAAK,GAAGkL,KAAKW,MAAc,IAARpL,QAG5B8pB,EAAS,CAACC,EAAU9B,EAAU,IAAKC,EAAU,OACjD,MAAM8B,EAAWhqB,EACjBA,EAAQyK,KAAKhX,IA7DE,GA6DYgX,KAAKjX,IA5DjB,EA4D+Bu2B,IAC9C,MAAME,EAAcjqB,EAAQgqB,EAC5BX,EAAOpB,GAAWA,EAAUoB,GAAQY,EACpCX,EAAOpB,GAAWA,EAAUoB,GAAQW,EACpCJ,KAGIK,EAAStpB,UACb,IAAIupB,EAAY,GAChB7D,EAAMj7B,QAAQ,CAACg9B,EAAM+B,KACnB,MAAMl1B,EAASmxB,EAAMpyB,IAAIo0B,EAAKnzB,QACxB8G,EAASqqB,EAAMpyB,IAAIo0B,EAAKrsB,QAC9B,IAAK9G,IAAW8G,EAAQ,OAGxB,MAAMquB,EAAKruB,EAAO0qB,EAAIxxB,EAAOwxB,EACvB4D,EAAKtuB,EAAO2qB,EAAIzxB,EAAOyxB,EACvB4D,EAAM9f,KAAKqe,KAAKuB,EAAKA,EAAKC,EAAKA,IAAO,EACtCE,EAAKH,EAAKE,EACVE,EAAKH,EAAKC,EAGVG,GAAMD,EACNE,EAAKH,EAGLI,EACJvC,EAAKP,kBAAoBO,EAAKP,iBAAiB19B,OAAS,GAAKi+B,EAAKP,iBAAiBlxB,KAAKi0B,GAAKA,GACzFC,EACJzC,EAAKN,kBAAoBM,EAAKN,iBAAiB39B,OAAS,GAAKi+B,EAAKN,iBAAiBnxB,KAAKi0B,GAAKA,GAGzFE,EAAe71B,EAAO0zB,QAAU,GAChCoC,EAAehvB,EAAO4sB,QAAU,GAEhCqC,EAAK/1B,EAAOwxB,EAAI8D,GAAMO,EADX,IAEXG,EAAKh2B,EAAOyxB,EAAI8D,GAAMM,EAFX,IAGXI,EAAKnvB,EAAO0qB,EAAI8D,GAAMQ,EAHX,IAIXI,EAAKpvB,EAAO2qB,EAAI8D,GAAMO,EAJX,IAOjB,IAAIK,GAAahD,EAAKP,kBAAoB,IAAIxyB,OAAOu1B,GAAKA,GACtDS,GAAajD,EAAKN,kBAAoB,IAAIzyB,OAAOu1B,GAAKA,GAG1D,MAAMU,EAAS,IAAIxY,IAAIsY,GACjBG,EAAS,IAAIzY,IAAIuY,GACjBG,EAAe,IAAIF,GAAQj2B,OAAOu1B,GAAKW,EAAO9uB,IAAImuB,IAGlDa,EAAYL,EAAU/1B,OAAOu1B,IAAMY,EAAa7zB,SAASizB,IACzDc,EAAYL,EAAUh2B,OAAOu1B,IAAMY,EAAa7zB,SAASizB,IAG/D,IAAIe,EAAc,GACdC,EAAY,GACZjB,IAAeiB,EAAY,uBAC3Bf,IAAec,EAAc,yBAEjCzB,GAAa,oCAAoCc,UAAWC,UAAWC,UAAWC,2BACpES,EAAY,eAAeA,KAAe,2BAC1CD,EAAc,iBAAiBA,KAAiB,0CACjCxB,QAG7B,MAAM0B,GAAQ52B,EAAOwxB,EAAI1qB,EAAO0qB,GAAK,EAC/BqF,GAAQ72B,EAAOyxB,EAAI3qB,EAAO2qB,GAAK,EAG/BqF,EAAUvhB,KAAKqe,KAAKuB,EAAKA,EAAKC,EAAKA,GAQzC,GALwBM,GAAiBE,GAEpBW,EAAarhC,OAAS,GAA0B,IAArBshC,EAAUthC,QAAqC,IAArBuhC,EAAUvhC,OAKlFqhC,EAAargC,MAAM,EAAG,GAAGC,QAAQ,CAAC4gC,EAAK/hC,KACrC,IAAK+hC,EAAK,OACV,MAAMC,EAAkB,IAANhiC,EAAU,GAAK,EAC3BiiC,EAAa,EAAQ,GAAJjiC,EAGvBigC,GAAa,yCAFF2B,EAAOpB,EAAKwB,EAAYC,SACxBJ,EAAOpB,EAAKuB,EAAYC,qBACmD/B,MAAYp7B,EAAWi9B,kBAE1G,CAIL,MAAMG,EAAa3hB,KAAKhX,IAAI,GAAIgX,KAAKjX,IAAc,IAAVw4B,EAAgB,KAGnDK,EAAmB,CACvB,CACEC,MAAO,KACP5gB,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OAGJ,CACE4gB,MAAO,WACP5gB,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OAGJ,CACE4gB,MAAO,KACP5gB,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OAGJ,CACE4gB,MAAO,KACP5gB,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OAGJ,CAAE4gB,MAAO,KAAM5gB,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OAC1E,CAAE4gB,MAAO,KAAM5gB,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MAAO,OAC/D,CAAE4gB,MAAO,KAAM5gB,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OAC1E,CAAE4gB,MAAO,KAAM5gB,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OACpE,CAAE4gB,MAAO,KAAM5gB,SAAU,CAAC,KAAM,KAAM,KAAM,KAAM,QAI9C6gB,EAAmBN,IACvB,IAAKA,EAAK,MAAO,GACjB,IAAK,MAAM7a,KAASib,EAClB,IAAK,MAAMxe,KAAMuD,EAAM1F,SACrB,GAAIugB,EAAIr0B,SAASiW,GACf,OAAOoe,EAAM7a,EAAMkb,MAIzB,OAAOL,GAIHO,EAAgB,CAACP,EAAKQ,EAAS,KACnC,IAAKR,EAAK,MAAO,GACjB,MAAMS,EAAYT,EAAI7hC,OAASqiC,EAASR,EAAItM,UAAU,EAAG8M,GAAU,KAAOR,EAC1E,OAAOM,EAAiBG,IAe1B,GAXIjB,EAAarhC,OAAS,GACxBqhC,EAAargC,MAAM,EAAG,GAAGC,QAAQ,CAAC4gC,EAAK/hC,KACrC,IAAK+hC,EAAK,OAIV9B,GAAa,yCAFF2B,EAAY,EAALpB,SACPqB,EAAY,EAALpB,EAAS,qBAC2DP,MAAYp7B,EAAWw9B,EAAcP,EAAK,eAKhIP,EAAUthC,OAAS,GAAMwgC,IAAkBE,GAAyC,IAAxBW,EAAarhC,OAAe,CAC1F,MAAMuiC,EAAejB,EAAUthC,OAAS,EAAIshC,EAAYL,EAElDuB,EAAad,EAAOtB,EAAK4B,EACzBS,EAAad,EAAOtB,EAAK2B,EAE/BO,EAAavhC,MAAM,EAAG,GAAGC,QAAQ,CAAC4gC,EAAK/hC,KACrC,IAAK+hC,EAAK,OAEV,MAAMa,EAAkC,IAAd,IAAN5iC,EAAU,GAAK,GAGnCigC,GAAa,yCAFFyC,EAAalC,EAAKoC,SAClBD,EAAalC,EAAKmC,qBACyD1C,MAAYp7B,EAAWw9B,EAAcP,EAAK,cAEpI,CAGA,GAAIN,EAAUvhC,OAAS,GAAM0gC,IAAkBF,GAAyC,IAAxBa,EAAarhC,OAAe,CAC1F,MAAMuiC,EAAehB,EAAUvhC,OAAS,EAAIuhC,EAAYL,EAElDsB,EAAad,EAAOtB,EAAK4B,EACzBS,EAAad,EAAOtB,EAAK2B,EAE/BO,EAAavhC,MAAM,EAAG,GAAGC,QAAQ,CAAC4gC,EAAK/hC,KACrC,IAAK+hC,EAAK,OAEV,MAAMa,EAAkC,IAAd,IAAN5iC,GAAW,EAAI,GAGnCigC,GAAa,yCAFFyC,EAAalC,EAAKoC,SAClBD,EAAalC,EAAKmC,qBACyD1C,MAAYp7B,EAAWw9B,EAAcP,EAAK,cAEpI,CACF,IAEFxC,EAAYriB,KAAK+iB,GAGjB,IAAI4C,EAAY,GAChB,IAAK,MAAM3E,KAAQJ,EAAS,CAE1B,MAAMgF,QAAmBrtB,EAAcS,SAASgoB,EAAKn2B,MAC/CoO,EAAW+nB,EAAK/nB,SAGhB4sB,EAAkBxiB,KAAKhX,IAAI,EAAiB,IAAd20B,EAAKQ,QACnCsE,EAAgC,IAAd9E,EAAKQ,OACvBuE,EAAmB/E,EAAKrB,UAC1B,mDAAmDmG,WAAyBA,SAAuBD,kFACnG,GAEEG,EAAkB3tB,EAAwB2oB,EAAKn2B,MACrD86B,GAAa,mFAC2D/9B,EAAWo5B,EAAKn2B,0BAA0Bm2B,EAAKtC,UAAY,4BAAyCx3B,IAAlB85B,EAAKh6B,SAAyBg6B,EAAKh6B,SAAW,4BAA4Bg6B,EAAK1B,MAAM0B,EAAKzB,wDAC3MtmB,EAAW,SAAW,UAAU+nB,EAAKQ,mCAEhEoE,EACI,MACE,MAAMltB,EAAUH,EAAckB,WAAWunB,EAAKn2B,MACxC8N,EAAUJ,EAAcoB,WAAWqnB,EAAKn2B,MACxCo7B,EAAW1tB,EAAcqB,SAASonB,EAAKn2B,MACvC6K,EAA2B,GAAnBsrB,EAAKQ,OAAS,GAC5B,MAAO,sBAAsB9rB,EAAO,UAAUA,EAAO,aAAaA,cAAiBA,8HAEtEA,iDACCA,qHAEekwB,0DACNK,6DACIvtB,MAAYC,oJAIxC,EAhBD,GAiBA,2CAA2C/Q,EAAWo+B,EAAgBE,OAAO,qCAEjFH,2DACiC/E,EAAKQ,OAAS,OAAO55B,EAAWo+B,+CAGjF,CACA1D,EAAYtiB,KAAK2lB,IAGnB7C,IAASqD,KAAK,KACZ1D,MAIF,MAAM2D,EAAgB3E,IACpBU,EAAK7S,SAAS,gBAGdgT,EAAYp1B,KAAK,mBAAmB2nB,KAAK,WACnCzsB,EAAE3F,MAAMa,KAAK,UAAYm+B,GAC3Br5B,EAAE3F,MAAM6sB,SAAS,cAErB,GAGA,MAAM+W,EAAiB,IAAI1a,IAAI,CAAC8V,IAEhCvC,EAAMj7B,QAAQg9B,IACZ,GAAIA,EAAKnzB,SAAW2zB,GAAYR,EAAKrsB,SAAW6sB,EAAU,CACxD,MAAM6E,EAAYrF,EAAKnzB,SAAW2zB,EAAWR,EAAKrsB,OAASqsB,EAAKnzB,OAChEu4B,EAAe5U,IAAI6U,EACrB,IAIFhE,EAAYp1B,KAAK,mBAAmB2nB,KAAK,WACnCwR,EAAe/wB,IAAIlN,EAAE3F,MAAMa,KAAK,UAClC8E,EAAE3F,MAAM6sB,SAAS,cAErB,GAGA,MAAMiX,EAAuB,IAAI5a,IACjCuT,EAAMj7B,QAAQ,CAACg9B,EAAM37B,KACf27B,EAAKnzB,SAAW2zB,GAAYR,EAAKrsB,SAAW6sB,GAC9C8E,EAAqB9U,IAAInsB,KAI7B+8B,EAAYn1B,KAAK,mBAAmB2nB,KAAK,WACvC,MAAMmO,EAAU/f,SAAS7a,EAAE3F,MAAM4U,KAAK,iBAAkB,IACpDkvB,EAAqBjxB,IAAI0tB,KAC3B56B,EAAE3F,MAAM6sB,SAAS,eACblnB,EAAE3F,MAAM4U,KAAK,eACfjP,EAAE3F,MAAM4U,KAAK,aAAc,0BAEzBjP,EAAE3F,MAAM4U,KAAK,iBACfjP,EAAE3F,MAAM4U,KAAK,eAAgB,4BAGnC,GAEAgrB,EAAYn1B,KAAK,yBAAyB2nB,KAAK,WAC7C,MAAMmO,EAAU/f,SAAS7a,EAAE3F,MAAM4U,KAAK,iBAAkB,IACpDkvB,EAAqBjxB,IAAI0tB,IAC3B56B,EAAE3F,MAAM6sB,SAAS,cAErB,IAGIkX,EAAiB,KACrBrE,EAAK7iB,YAAY,gBACjBgjB,EAAYp1B,KAAK,gBAAgBoS,YAAY,eAC7C+iB,EAAYn1B,KAAK,gBAAgBoS,YAAY,eAC7C+iB,EAAYn1B,KAAK,mBAAmB2nB,KAAK,WACnCzsB,EAAE3F,MAAM4U,KAAK,eACfjP,EAAE3F,MAAM4U,KAAK,aAAc,uBAEzBjP,EAAE3F,MAAM4U,KAAK,iBACfjP,EAAE3F,MAAM4U,KAAK,eAAgB,wBAEjC,IAWF,GAPsB,iBAAkBL,QAAU8X,UAAU2X,eAAiB,EAO1D,CAEjB,IAAIC,EAAyB,KAE7BpE,EAAYvjB,GAAG,cAAe,kBAAmB,SAAUza,GACzD,MAAMqiC,EAAQv+B,EAAE3F,MACVg/B,EAAWkF,EAAMrjC,KAAK,QACtBsjC,EAAStiC,EAAEuiC,QACXC,EAASxiC,EAAEyiC,QACXC,EAAYpiC,KAAKC,MACvB,IAAIoiC,GAAW,EACXC,GAAqB,EAGzB,GAAIR,EAMF,OALAF,IACAE,EAAyB,KAEzBpiC,EAAEmc,sBACFnc,EAAE0a,kBAKJ,MAAMmoB,EAAiBrnB,WAAW,MAC3BmnB,GAAYxF,IACfyF,GAAqB,EACrBR,EAAyBjF,EACzB2E,EAAc3E,GACV3S,UAAUsY,SAAStY,UAAUsY,QAAQ,MAE1C,KA8CHh/B,EAAE0V,UAAUiB,GAAG,yBA5CAsoB,IACb,MAAMpE,EAAK5f,KAAKikB,IAAID,EAAMR,QAAUD,GAC9B1D,EAAK7f,KAAKikB,IAAID,EAAMN,QAAUD,IAChC7D,EAAK,GAAKC,EAAK,KACjB+D,GAAW,EACXM,aAAaJ,MAwCjB/+B,EAAE0V,UAAUiB,GAAG,gDApCF,KACX3W,EAAE0V,UAAUgB,IAAI,wEAChByoB,aAAaJ,GAEb,MAAMK,EAAU5iC,KAAKC,MAAQmiC,EAG7B,IAAIE,IAKAD,GAKAO,EAAU,IAAK,CACjB,MAAM9I,EAAWiI,EAAMrjC,KAAK,aACtB0D,EAAW2/B,EAAMrjC,KAAK,aAE5B,GAAIo7B,GAAyB,KAAb13B,QAAgCE,IAAbF,EAAwB,CACzD,MAAMiK,EAAU6G,IAAiBC,KACjC,GAAI9G,GAAWA,EAAQytB,GAAW,CAChC,MAAM3rB,EAAQ9B,EAAQytB,GAChBv5B,EAAU4N,EAAM3B,QAAU2B,EAAM3B,QAAQ,GAAK,GAC7ClM,EAAM6N,EAAM3B,QAAU2B,EAAM3B,QAAQ6R,SAASjc,EAAU,IAAM,GAAK,KACpE9B,GACFu5B,GAAgB1rB,EAAMlI,KAAc1F,EAASD,EAAK+d,SAASjc,EAAU,IAEzE,CACF,CACF,GAKJ,GAGAw7B,EAASzjB,GAAG,wBAAyB,SAAUza,GACzCoiC,IAA2Bt+B,EAAE9D,EAAEsQ,QAAQsK,QAAQ,mBAAmBlc,SACpEwjC,IACAE,EAAyB,KAE7B,EACF,MAGEpE,EAAYvjB,GAAG,uBAAwB,kBAAmB,WACxD,MAAM0iB,EAAWr5B,EAAE3F,MAAMa,KAAK,QAC1Bm+B,GACF2E,EAAc3E,EAElB,GAEAa,EAAYvjB,GAAG,uBAAwB,kBAAmB,WACxDynB,GACF,GAGAlE,EAAYvjB,GAAG,gBAAiB,kBAAmB,SAAUza,GAC3DA,EAAE0a,kBACF,MAAM2nB,EAAQv+B,EAAE3F,MACVi8B,EAAWiI,EAAMrjC,KAAK,aACtB0D,EAAW2/B,EAAMrjC,KAAK,aAE5B,GAAIo7B,GAAyB,KAAb13B,QAAgCE,IAAbF,EAAwB,CACzD,MAAMiK,EAAU6G,IAAiBC,KACjC,GAAI9G,GAAWA,EAAQytB,GAAW,CAChC,MAAM3rB,EAAQ9B,EAAQytB,GAChBv5B,EAAU4N,EAAM3B,QAAU2B,EAAM3B,QAAQ,GAAK,GAC7ClM,EAAM6N,EAAM3B,QAAU2B,EAAM3B,QAAQ6R,SAASjc,EAAU,IAAM,GAAK,KACpE9B,GACFu5B,GAAgB1rB,EAAMlI,KAAc1F,EAASD,EAAK+d,SAASjc,EAAU,IAEzE,CACF,CACF,GAcF,IAAIygC,GAAY,EACZC,EAAY,EACdC,EAAY,EACVC,EAAe,EACjBC,EAAe,EACbC,GAAgB,EAChBC,GAAkB,KAEtB,MAAMC,GAAYxF,EAAS,GACrByF,GAAQ9F,EAAK,GAGnB6F,GAAUE,cAAgB,SAAU5jC,GACjB,IAAbA,EAAE6jC,SAEF//B,EAAE9D,EAAEsQ,QAAQsK,QAAQ,mBAAmBlc,SAC3CsB,EAAEmc,iBACFunB,GAAUI,kBAAkB9jC,EAAE+jC,WAC9BN,GAAkBzjC,EAAE+jC,UACpBZ,GAAY,EACZC,EAAYpjC,EAAEuiC,QACdc,EAAYrjC,EAAEyiC,QACda,EAAe3F,EACf4F,EAAe3F,EACf+F,GAAMK,MAAMC,OAAS,YACvB,EAGAP,GAAUQ,cAAgB,SAAUlkC,GAClC,IAAKmjC,GAAanjC,EAAE+jC,YAAcN,GAAiB,OACnD,MAAM9E,EAAK3+B,EAAEuiC,QAAUa,EACjBxE,EAAK5+B,EAAEyiC,QAAUY,EACjBc,EAAOR,GAAMS,wBACnBzG,EAAO2F,EAAgB3E,EAAKwF,EAAKtS,MAAS,IAC1C+L,EAAO2F,EAAgB3E,EAAKuF,EAAKrS,OAAU,IAC3CqM,GACF,EAGAuF,GAAUW,YAAc,SAAUrkC,GAC5BA,EAAE+jC,YAAcN,KAClBC,GAAUY,sBAAsBtkC,EAAE+jC,WAClCZ,GAAY,EACZM,GAAkB,KAClBE,GAAMK,MAAMC,OAAS,OAEzB,EAGAP,GAAUa,gBAAkB,SAAUvkC,GAChCA,EAAE+jC,YAAcN,KAClBN,GAAY,EACZM,GAAkB,KAClBE,GAAMK,MAAMC,OAAS,OAEzB,EAGAP,GAAUc,QAAU,SAAUxkC,GAC5BA,EAAEmc,iBACF,MAAMsoB,EAAQzkC,EAAE0kC,OAAS,GAAK,IAAO,IACrCtG,EAAO9pB,EAAQmwB,EACjB,EAGAf,GAAUiB,iBACR,aACA,SAAU3kC,GACiB,IAArBA,EAAE4kC,QAAQlmC,SACZsB,EAAEmc,iBACFgnB,GAAY,EACZK,GAAgBzkB,KAAK8lB,MACnB7kC,EAAE4kC,QAAQ,GAAGrC,QAAUviC,EAAE4kC,QAAQ,GAAGrC,QACpCviC,EAAE4kC,QAAQ,GAAGnC,QAAUziC,EAAE4kC,QAAQ,GAAGnC,SAG1C,EACA,CAAEqC,SAAS,IAGbpB,GAAUiB,iBACR,YACA,SAAU3kC,GACR,GAAyB,IAArBA,EAAE4kC,QAAQlmC,OAAc,CAC1BsB,EAAEmc,iBACF,MAAM4oB,EAAUhmB,KAAK8lB,MACnB7kC,EAAE4kC,QAAQ,GAAGrC,QAAUviC,EAAE4kC,QAAQ,GAAGrC,QACpCviC,EAAE4kC,QAAQ,GAAGnC,QAAUziC,EAAE4kC,QAAQ,GAAGnC,SAElCe,GAAgB,GAClBpF,EAAO9pB,GAASywB,EAAUvB,KAE5BA,GAAgBuB,CAClB,CACF,EACA,CAAED,SAAS,IAGbpB,GAAUiB,iBAAiB,WAAY,SAAU3kC,GAC3CA,EAAE4kC,QAAQlmC,OAAS,IAAG8kC,GAAgB,EAC5C,GAYArQ,EAAQvqB,KAAK,kBAAkBspB,MAAM,IAAMkM,EAAO9pB,EAAQ,MAC1D6e,EAAQvqB,KAAK,mBAAmBspB,MAAM,IAAMkM,EAAO9pB,EAAQ,MAG3D6e,EAAQvqB,KAAK,qBAAqBspB,MAAM,KAEtC5d,EAAQ,EACRqpB,EAAO,EACPC,EAAO,EACPO,IAGA7B,EAAQ38B,QAAQ,CAAC+8B,EAAMl+B,KACrB,GAAIk+B,EAAK/nB,SACP+nB,EAAK1B,EAAIuB,EACTG,EAAKzB,EAAIuB,MACJ,CACL,MAAMe,EAAS,EAAIxe,KAAKye,GAAKh/B,EAAK89B,EAAQ59B,OAC1Cg+B,EAAK1B,EAAIuB,EAAUW,EAASne,KAAK0e,IAAIF,GACrCb,EAAKzB,EAAIuB,EAAUU,EAASne,KAAK2e,IAAIH,EACvC,IAEFiB,MAGFrL,EAAQvqB,KAAK,wBAAwBspB,MAAM,KACzC8S,GAAkB1I,EAAS,IAAMkC,OAGnC,MAAMyG,GAAa,KArCjBvB,GAAUE,cAAgB,KAC1BF,GAAUQ,cAAgB,KAC1BR,GAAUW,YAAc,KACxBX,GAAUa,gBAAkB,KAC5Bb,GAAUc,QAAU,KAmCpBrR,EAAQzd,UAEVyd,EAAQvqB,KAAK,oBAAoBspB,MAAM+S,IACvC9R,EAAQ1Y,GAAG,QAAS,SAAUza,GACxB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,+BAA+BmqB,IAC1D,IAMIC,GAAsB,CAACC,EAAa3Y,EAAe/Q,KACvD,MAAM,GAAQ6M,KACdxkB,EAAE,2BAA2B4R,SAE7B,MAAMhO,EAASiU,KACL4J,IAGV,IAAIjR,EAAQ,IACRF,EAAU,GACVC,EAAU,GAGd,MAAM+wB,EAAWnxB,EAAcnC,SAAS0a,GACpC4Y,IACF9wB,EAAQ8wB,EAAS9wB,OAAS,IAC1BF,EAAUgxB,EAAShxB,SAAW,GAC9BC,EAAU+wB,EAAS/wB,SAAW,IAGhC,MAAMgxB,EAAY,8DACqC39B,EAAOkU,0LAGatY,EAAWkpB,gXAMjC2Y,0DACN7wB,6DACIF,MAAYC,y2BAkBzDixB,EAASxhC,EAAEuhC,GACjBvhC,EAAE,QAAQgY,OAAOwpB,GAGjBA,EAAO/pB,IAAI,CACT8E,SAAU,QACVoK,IAAK,IACLiH,KAAM,IACNC,MAAO,IACPC,OAAQ,IACRC,MAAO,QACPC,OAAQ,QACRC,QAAS,OACT,cAAe,SACf,kBAAmB,SACnB,UAAW,eAGb,MAAMwT,EAASD,EAAO18B,KAAK,mBAErB48B,EADaF,EAAO18B,KAAK,uBACA,GACzB68B,EAAUF,EAAO,GAGjBG,EAAmB,KACvBD,EAAQzB,MAAM2B,eAAiB,GAAGrxB,KAClCmxB,EAAQzB,MAAM4B,mBAAqB,GAAGxxB,MAAYC,MAIpD,IAAIwxB,GAAa,EACbvD,EAAS,EACXE,EAAS,EACPsD,EAAe,EACjBC,EAAe,EACbtC,EAAkB,KAEtBgC,EAAQd,iBAAiB,cAAe3kC,IAEd,OAApByjC,IAEJzjC,EAAEmc,iBACFnc,EAAE0a,kBAEFmrB,GAAa,EACbpC,EAAkBzjC,EAAE+jC,UACpBzB,EAAStiC,EAAEuiC,QACXC,EAASxiC,EAAEyiC,QACXqD,EAAe1xB,EACf2xB,EAAe1xB,EAEfoxB,EAAQ3B,kBAAkB9jC,EAAE+jC,WAC5B0B,EAAQzB,MAAMC,OAAS,cAGzBwB,EAAQd,iBAAiB,cAAe3kC,IACtC,IAAK6lC,GAAc7lC,EAAE+jC,YAAcN,EAAiB,OAEpDzjC,EAAEmc,iBACFnc,EAAE0a,kBAEF,MAAMsrB,EAAShmC,EAAEuiC,QAAUD,EACrBoC,EAAS1kC,EAAEyiC,QAAUD,EAGrByD,EAAc,IAAM3xB,EAC1BF,EAAU2K,KAAKhX,IAAI,EAAGgX,KAAKjX,IAAI,IAAKg+B,EAAeE,EAASC,IAC5D5xB,EAAU0K,KAAKhX,IAAI,EAAGgX,KAAKjX,IAAI,IAAKi+B,EAAerB,EAASuB,IAC5DP,MAGFD,EAAQd,iBAAiB,YAAa3kC,IAChCA,EAAE+jC,YAAcN,IAEpBoC,GAAa,EACbpC,EAAkB,KAClBgC,EAAQnB,sBAAsBtkC,EAAE+jC,WAChC0B,EAAQzB,MAAMC,OAAS,UAGzBwB,EAAQd,iBAAiB,gBAAiB3kC,IACpCA,EAAE+jC,YAAcN,IAEpBoC,GAAa,EACbpC,EAAkB,KAClBgC,EAAQzB,MAAMC,OAAS,UAKzBuB,EAAYb,iBACV,QACA3kC,IACEA,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAM+pB,EAAQzkC,EAAE0kC,OAAS,GAAK,GAAK,GACnCpwB,EAAQyK,KAAKhX,IAAI,IAAKgX,KAAKjX,IAAI,IAAKwM,EAAQmwB,IAC5CiB,KAEF,CAAEZ,SAAS,IAIb,IAAItB,EAAgB,EAChB0C,EAAkB5xB,EAEtBkxB,EAAYb,iBACV,aACA3kC,IAC2B,IAArBA,EAAE4kC,QAAQlmC,SACZsB,EAAEmc,iBACFqnB,EAAgBzkB,KAAK8lB,MACnB7kC,EAAE4kC,QAAQ,GAAGrC,QAAUviC,EAAE4kC,QAAQ,GAAGrC,QACpCviC,EAAE4kC,QAAQ,GAAGnC,QAAUziC,EAAE4kC,QAAQ,GAAGnC,SAEtCyD,EAAkB5xB,IAGtB,CAAEwwB,SAAS,IAGbU,EAAYb,iBACV,YACA3kC,IACE,GAAyB,IAArBA,EAAE4kC,QAAQlmC,OAAc,CAC1BsB,EAAEmc,iBACF,MAAM4oB,EAAUhmB,KAAK8lB,MACnB7kC,EAAE4kC,QAAQ,GAAGrC,QAAUviC,EAAE4kC,QAAQ,GAAGrC,QACpCviC,EAAE4kC,QAAQ,GAAGnC,QAAUziC,EAAE4kC,QAAQ,GAAGnC,SAEtC,GAAIe,EAAgB,EAAG,CACrB,MAAM2C,EAAapB,EAAUvB,EAC7BlvB,EAAQyK,KAAKhX,IAAI,IAAKgX,KAAKjX,IAAI,IAAKo+B,EAAkBC,IACtDT,GACF,CACF,GAEF,CAAEZ,SAAS,IAGbU,EAAYb,iBAAiB,WAAY3kC,IACnCA,EAAE4kC,QAAQlmC,OAAS,IACrB8kC,EAAgB,EAChB0C,EAAkB5xB,KAMtBgxB,EAAO18B,KAAK,wBAAwB6R,GAAG,SAAUvF,eAAgBlV,GAC/D,MAAMomC,EAAOpmC,EAAEsQ,OAAO+1B,MAAM,GAC5B,GAAKD,EAEL,GAAKA,EAAK/0B,KAAKzS,WAAW,UAK1B,GAAIwnC,EAAKh1B,KAAO,QACVsB,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,oBAD3C,CAKA,IAGE,SADsBrX,EAAcqyB,gBAAgB9Z,EAAe4Z,GACtD,CAEX,MAAMG,QAAer3B,EAAc3G,IAAIikB,GACvC2Y,EAAcoB,EAGdjyB,EAAQ,IACRF,EAAU,GACVC,EAAU,GAGVkxB,EAAOhqB,IAAI,mBAAoB,QAAQgrB,OACvCb,GACF,CACF,CAAE,MAAOznB,GACPne,QAAQmK,MAAM,gBAAiBgU,GAC3BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,OACzC,CAEAnG,EAAE3F,MAAM6F,IAAI,GAxBZ,MAPM0O,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,UAgC7C,GACAga,EAAO18B,KAAK,qCAAqC6R,GAAG,QAAS,KAC3D6qB,EAAO5vB,WAGT4vB,EAAO18B,KAAK,qBAAqB6R,GAAG,QAAS,KAC3CgB,EAAO,CAAEnH,QAAOF,UAASC,YACzBixB,EAAO5vB,WAIT4vB,EAAO7qB,GAAG,QAASza,IACb8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,2BACvBwqB,EAAO5vB,YAKPsvB,GAAoB,CAAC1I,EAASkK,KAClC,MAAM,GAAQle,KACdxkB,EAAE,+BAA+B4R,SAEjC,MAAMhO,EAASiU,KACT8T,EAAIlK,IACJzP,EAAU7B,EAAcnC,SA6DxB20B,EAAc,kEACuC/+B,EAAOkU,02BAWK6T,EAAEpL,sTASnEqiB,EAAW5iC,EAAE2iC,GACnB3iC,EAAE,QAAQgY,OAAO4qB,GAhFCxxB,WAChB,IAAIyxB,EAAW,GAEf,IAAK,MAAMjK,KAAQJ,EAAS,CAC1B,MAAMt9B,EAAO8W,EAAQ4mB,EAAKn2B,OAAS,CAAC,EACpC,IAAIqgC,EAAa5nC,EAAKwS,KAAO,GAG7B,MAAMq1B,QAAiB5yB,EAAcgB,eAAeynB,EAAKn2B,MACzD,IAAIugC,EAAa,GACbC,EAAc,GAElB,GAAIF,EACFC,QAAmB53B,EAAc3G,IAAIm0B,EAAKn2B,MAC1CwgC,EAAc,kEACT,GAAIH,EACTE,EAAaF,EACbG,EAAc,gEACT,CACL,MAAMvyB,EAAajB,KACY,WAAdmpB,EAAKn2B,MAAmC,OAAdm2B,EAAKn2B,MAAkBiO,GAAckoB,EAAKn2B,OAASiO,KAE5FsyB,EAAat0B,KAAsB,GAC/Bs0B,IAAYC,EAAc,6DAElC,CAEA,MAAMxyB,GAAWvV,EAAKuV,SAAW,IAAIvP,KAAK,MACpCgiC,IAAcF,EAEpBH,GAAY,iEAC0CrjC,EAAWo5B,EAAKn2B,0BAA0BsgC,wBAA+BvjC,EAAWwjC,mIAErFE,EAAY,YAAc,cAAcA,EAAY,0BAA0BF,6BAAsC9nC,EAAKoV,SAAW,OAAOpV,EAAKqV,SAAW,yBAAyBrV,EAAKsV,OAAS,QAAU,yCACtO0yB,EAAyH,GAA7G,SAAS1jC,EAAWo5B,EAAKn2B,KAAKq7B,OAAO,0IAEtDmF,yNAIiCzjC,EAAWo5B,EAAKn2B,igBAMuBjD,EAAWsjC,sHACJtjC,EAAWiR,gOAKlH,CAEA,OAAOoyB,GA6BTM,GAAYpF,KAAK8E,IACfD,EAAS99B,KAAK,8BAA8B8S,KAAKirB,GACjDO,MAIF,MAAMC,EAAcjyB,MAAM3O,IACxB,MAAM6gC,EAAQV,EAAS99B,KAAK,+BAA+BrC,OAC3D,IAAK6gC,EAAM1oC,OAAQ,OAEnB,MAAMM,EAAOiV,EAAcnC,SAASvL,IAAS,CAAC,EACxCsgC,QAAiB5yB,EAAcgB,eAAe1O,GACpD,IAAIugC,EAAa,GACbC,EAAc,GAEdF,GACFC,QAAmB53B,EAAc3G,IAAIhC,GACrCwgC,EAAc,8DACL/nC,EAAKwS,MACds1B,EAAa9nC,EAAKwS,IAClBu1B,EAAc,6DAGhB,MAAMM,EAAWD,EAAMx+B,KAAK,uBAC5Bw+B,EAAMx+B,KAAK,sBAAsB8M,SAE7BoxB,GACFO,EACGrc,SAAS,aACTzP,IAAI,CACH,mBAAoB,QAAQurB,MAC5B,sBAAuB,GAAG9nC,EAAKoV,SAAW,OAAOpV,EAAKqV,SAAW,MACjE,kBAAmB,GAAGrV,EAAKsV,OAAS,SAErC1L,KAAK,QACL8M,SACH0xB,EAAMx+B,KAAK,4BAA4BkT,OAAOirB,IAE9CM,EACGrsB,YAAY,aACZO,IAAI,CAAE,mBAAoB,GAAI,sBAAuB,GAAI,kBAAmB,KAC5EG,KAAK,SAASpY,EAAWiD,EAAKq7B,OAAO,uEAG1CwF,EAAMr0B,KAAK,iBAAkB8zB,GAC7BO,EAAMr0B,KAAK,mBAAoB+zB,IAG3BI,EAAmB,KAEvBR,EAASjsB,GAAG,QAAS,sBAAuBvF,eAAgBlV,GAC1DA,EAAE0a,kBACF,MAAM0sB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,oBACxBrU,EAAO6gC,EAAMpoC,KAAK,QAClB8nC,EAAaM,EAAMr0B,KAAK,oBAE1B+zB,EAEF5B,GAAoB4B,EAAYvgC,EAAM2O,MAAMhF,IAC1C,MAAMlR,EAAOiV,EAAcnC,SAASvL,IAAS,CAAC,EAC9C0N,EAAclL,IAAIxC,EAAMvH,EAAKwS,KAAO,GAAItB,EAAOkE,QAASlE,EAAOmE,QAASnE,EAAOoE,MAAOtV,EAAKuV,SAAW,UAChG4yB,EAAY5gC,GAClBigC,GAAYA,MAIdY,EAAMx+B,KAAK,0BAA0BspB,OAEzC,GAGAwU,EAASjsB,GAAG,SAAU,yBAA0BvF,eAAgBlV,GAC9D,MAAMomC,EAAOpmC,EAAEsQ,OAAO+1B,MAAM,GAC5B,IAAKD,EAAM,OAEX,IAAKA,EAAK/0B,KAAKzS,WAAW,UAExB,YADI8T,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,YAI3C,GAAI8a,EAAKh1B,KAAO,QAEd,YADIsB,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,iBAI3C,MACM/kB,EADQzC,EAAE3F,MAAMyc,QAAQ,oBACX5b,KAAK,QAExB,IAEE,SADsBiV,EAAcqyB,gBAAgB//B,EAAM6/B,GAC7C,CACX,MAAMG,QAAer3B,EAAc3G,IAAIhC,SACjC4gC,EAAY5gC,GAGlB2+B,GAAoBqB,EAAQhgC,EAAM2O,MAAMhF,IACtC,MAAMlR,EAAOiV,EAAcnC,SAASvL,IAAS,CAAC,EAC9C0N,EAAclL,IAAIxC,EAAMvH,EAAKwS,KAAO,GAAItB,EAAOkE,QAASlE,EAAOmE,QAASnE,EAAOoE,MAAOtV,EAAKuV,SAAW,UAChG4yB,EAAY5gC,GAClBigC,GAAYA,KAEhB,CACF,CAAE,MAAOvoB,GACPne,QAAQmK,MAAM,gBAAiBgU,GAC3BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,OACzC,CAEAnG,EAAE3F,MAAM6F,IAAI,GACd,GAGA0iC,EAASjsB,GAAG,QAAS,uBAAwBvF,iBAC3C,MAAMkyB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,oBACxBrU,EAAO6gC,EAAMpoC,KAAK,QAClBwS,EAAM41B,EAAMx+B,KAAK,mBAAmB5E,MAAMC,OAC1CqjC,EAAaF,EAAMx+B,KAAK,uBAAuB5E,MAAMC,OACrDsQ,EAAU+yB,EACZA,EACG96B,MAAM,QACNzN,IAAIwE,GAAKA,EAAEU,QACX2F,OAAOrG,GAAKA,GAAKA,IAAMgD,GAC1B,GAEEvH,EAAOiV,EAAcnC,SAASvL,IAAS,CAAC,EAG9C0N,EAAclL,IAAIxC,EAAMiL,EAAKxS,EAAKoV,SAAW,GAAIpV,EAAKqV,SAAW,GAAIrV,EAAKsV,OAAS,IAAKC,GAGxF,MAAMsyB,EAA4C,SAAjCO,EAAMr0B,KAAK,kBACxBvB,IAAQq1B,SACJM,EAAY5gC,GAClB2+B,GAAoB1zB,EAAKjL,EAAM2O,MAAMhF,IACnC+D,EAAclL,IAAIxC,EAAMiL,EAAKtB,EAAOkE,QAASlE,EAAOmE,QAASnE,EAAOoE,MAAOC,SACrE4yB,EAAY5gC,GAClBigC,GAAYA,cAGRW,EAAY5gC,GAClBigC,GAAYA,IAEhB,GAGAE,EAASjsB,GAAG,QAAS,wBAAyBvF,iBAC5C,MAAMkyB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,oBACxBrU,EAAO6gC,EAAMpoC,KAAK,cAElBiV,EAAcszB,kBAAkBhhC,GACtC0N,EAAcyB,OAAOnP,GAErB6gC,EAAMx+B,KAAK,mBAAmB5E,IAAI,IAClCojC,EAAMx+B,KAAK,uBAAuB5E,IAAI,UAChCmjC,EAAY5gC,GAClBigC,GAAYA,GACd,GAGAE,EAASjsB,GAAG,QAAS,yBAA0B,WAC7C,MAAM9E,EAAa1B,EAAc0B,aAC3ByI,EAAUnf,KAAKwB,UAAUkV,EAAY,KAAM,GAC3C/E,EAAO,IAAI42B,KAAK,CAACppB,GAAU,CAAE/M,KAAM,qBACnCG,EAAMP,IAAIQ,gBAAgBb,GAC1BrR,EAAIia,SAASG,cAAc,KACjCpa,EAAEkoC,KAAOj2B,EACTjS,EAAEmoC,SAAW,kBAAiB,IAAIpnC,MAAOgJ,cAAc5J,MAAM,EAAG,WAChE8Z,SAASqC,KAAK/B,YAAYva,GAC1BA,EAAE2yB,QACF1Y,SAASqC,KAAK8rB,YAAYpoC,GAC1B0R,IAAIC,gBAAgBM,EACtB,GAGAk1B,EAASjsB,GAAG,QAAS,yBAA0B,WAC7CisB,EAAS99B,KAAK,0BAA0BspB,OAC1C,GAEAwU,EAASjsB,GAAG,SAAU,yBAA0B,SAAUza,GACxD,MAAMomC,EAAOpmC,EAAEsQ,OAAO+1B,MAAM,GAC5B,IAAKD,EAAM,OAEX,MAAMwB,EAAS,IAAIC,WACnBD,EAAOE,OAAS,SAAUC,GACxB,IACE,MAAM/xB,EAAW/W,KAAKC,MAAM6oC,EAAIz3B,OAAOJ,QACjC83B,EAAW/zB,EAAcwC,cAAcT,GAE7C,IAAKgyB,EAAStxB,MAEZ,YADIhE,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM+9B,EAAS/9B,QAIlDg+B,GAAwBjyB,EAAUgyB,EAAU,KAC1CtB,EAAShxB,SACTsvB,GAAkB1I,EAASkK,GAC3BA,GAAYA,KAEhB,CAAE,MAAOvoB,GACPne,QAAQmK,MAAM,gBAAiBgU,GAC3BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SACzC,CACF,EACA29B,EAAOM,WAAW9B,GAClBtiC,EAAE3F,MAAM6F,IAAI,GACd,IAIImkC,EAAe,IAAMzB,EAAShxB,SACpCgxB,EAASjsB,GAAG,QAAS,oBAAqB0tB,GAC1CzB,EAASjsB,GAAG,QAAS,SAAUza,GACzB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,+BAA+BqtB,GAC1D,IAIIF,GAA0B,CAACjyB,EAAUgyB,EAAUI,KACnD,MAAM,GAAQ9f,KACdxkB,EAAE,+BAA+B4R,SAEjC,MAAM+Z,EAAIlK,IACJ7d,EAASiU,KAET0sB,EAAeL,EAASnxB,UAAUnY,OAAS,EAC3C4pC,EACJN,EAASnxB,UAAUnY,OAAS,EACxB,gJAAgJ+wB,EAAEpL,aAAa2jB,EAASnxB,UAAU9X,IAAIsgB,GAAK/b,EAAW+b,IAAIra,KAAK,cAC/M,GAEAujC,EAAa,kEACwC7gC,EAAOkU,+cAQTosB,EAASrxB,gQAITqxB,EAASpxB,SAASlY,sQAIlBspC,EAASnxB,UAAUnY,wLAMtD2pC,EACI,8JAEsD5Y,EAAErL,gOAGpDkkB,2uBAaJ,kFACiD7Y,EAAE/K,yeAcvE8jB,EAAU1kC,EAAEykC,GAClBzkC,EAAE,QAAQgY,OAAO0sB,GAGCA,EAAQ,GAChBxE,MAAMyE,QAAU,ijBAiB1B,MAAMC,EAAc,IAAMF,EAAQ9yB,SAElC8yB,EAAQ5/B,KAAK,0BAA0BspB,MAAMwW,GAC7CF,EAAQ/tB,GAAG,QAAS,SAAUza,GACxB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,+BAA+B4tB,GAC1D,GAEAF,EAAQ5/B,KAAK,2BAA2BspB,MAAM,WAC5C,MAAMyW,EAA0E,SAA9DH,EAAQ5/B,KAAK,uCAAuC5E,MACtE,IACgBiQ,EAAc8B,WAAWC,EAAU2yB,GACjDD,IACAN,GAAcA,GAChB,CAAE,MAAOnqB,GACPne,QAAQmK,MAAM,cAAegU,GACzBvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,QAAUgU,EAAIpQ,QACvD,CACF,IAGI+6B,GAAoB,CAAChoC,EAAKC,EAASF,EAAW+B,EAAU03B,KAC5D,MAAM,GAAQ9R,KACR5gB,EAASiU,KACf,IAAIhP,EAAU6G,IAAiBC,MAAkB2U,KAE7CygB,EAAajoC,EAEb+L,GAAWA,EAAQytB,IAAaztB,EAAQytB,IAAWttB,UAAUpK,EAAW,KAC1EmmC,EAAal8B,EAAQytB,IAAWttB,UAAUpK,EAAW,IAGvD,MAAMomC,EAAaD,EAChB9pC,IAAI,CAACgqC,EAAM/nC,KACV,GAAY,IAARA,EAAW,MAAO,GACtB,MAAMwlB,EAAa3lB,EAAQG,IAAQ,KAAKA,IAClCgD,EAAM+kC,GAAQ,GAEpB,MAAO,iNAE+GzlC,EAAWkjB,qGACjDxlB,uJAC8BsC,EAAWU,0CAG1HgB,KAAK,IAEFgkC,EAASllC,EAAE,uGAEmC4D,EAAOkU,mEACNlZ,EAAW,OAAOY,EAAW3C,6IAE5DmoC,2aAStBhlC,EAAE,QAAQgY,OAAOktB,GAGjB,MAAMC,EAAeC,IAEnBA,EAAGlF,MAAMlS,OAAS,OAClB,MAAMqX,EAAgBD,EAAGE,aAAe,EAExCF,EAAGlF,MAAMlS,OAAS/S,KAAKjX,IAAIqhC,EADT,KACqC,KACvDD,EAAGlF,MAAMqF,UAAYF,EAFH,IAE+B,OAAS,UAI5DG,sBAAsB,KACpBN,EAAOpgC,KAAK,YAAY2nB,KAAK,WAC3B0Y,EAAa9qC,KACf,KAIF6qC,EAAOpgC,KAAK,YAAY6R,GAAG,QAAS,WAClCwuB,EAAa9qC,KACf,GAGA,MAAMuqC,EAAc,IAAMM,EAAOtzB,SACjCszB,EAAOpgC,KAAK,oBAAoBspB,MAAMwW,GAGtCM,EAAOpgC,KAAK,kBAAkBspB,MAAMhd,UAClC,IAAIvI,EAAU6G,IAAiBC,MAAkB2U,KACjD,GAAIzb,GAAWA,EAAQytB,GAAW,CAChC,MAAMmP,EAAa58B,EAAQytB,IAAWttB,UAAUpK,EAAW,GAC3D,IAAK6mC,EAEH,YADAb,IAGF,IAAIc,GAAa,EACjBR,EAAOpgC,KAAK,YAAY2nB,KAAK,WAC3B,MAAMttB,EAAS0b,SAAS7a,EAAE3F,MAAMa,KAAK,QAC/BqZ,EAASvU,EAAE3F,MAAM6F,MACnBR,OAAO+lC,EAAWtmC,MAAaO,OAAO6U,KACxCmxB,GAAa,EACbD,EAAWtmC,GAAUoV,EAEzB,GACImxB,UACIC,GAAmB98B,GAAS,GAAO,GACzCgc,KAEJ,CACA+f,MAEFM,EAAOvuB,GAAG,QAAS,SAAUza,IAEvB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,qBAKrBhX,EAAE9D,EAAEsQ,QAAQsK,QAAQ,4CAA4Clc,SAJlEgqC,GAOJ,IAIF,IAAIgB,GAAe,KACnB,MAAM/tB,GAAY,KACX+tB,KAAcA,GAAe,IAAKvgB,MAAmB7gB,GAAMC,IAAIlD,EAAuB,CAAC,KACrFqkC,IAEHC,GAAaxX,IACjBuX,GAAe,IAAK/tB,QAAgBwW,GACpC7pB,GAAMS,IAAI1D,EAAuBqkC,IACjCE,GAAkBF,KAGdG,GAAkBC,IACtB,MAAMC,EAAW3hB,KACX4hB,EAAU,IAAI3iB,IACpB,IAAK0iB,EAAU,OAAOC,EAEtB,IAAK,MAAMn9B,KAAWi9B,EAAa,CACjC,MAAMl8B,EAAWk8B,EAAYj9B,GACvBc,EAAWo8B,EAASl9B,GAC1B,IAAKe,IAAaA,EAASrH,KAAM,SACjC,MAAM5F,EAAYiN,EAASrH,KAC3B,IAAKoH,EAAU,CACTC,EAASd,SACXc,EAASd,QAAQnN,QAAQ,CAACiB,EAAKqpC,KACzBA,EAAO,GAAGD,EAAQ7c,IAAI,GAAGxsB,SAAiBspC,EAAO,OAGzD,QACF,CACA,MAAMC,EAAUt8B,EAASd,SAAW,GAC9Bq9B,EAAUx8B,EAASb,SAAW,GACpCo9B,EAAQvqC,QAAQ,CAACiB,EAAKqpC,KACpB,GAAa,IAATA,EAAY,OAChB,MAAMG,EAASD,EAAQF,GAClBG,EAGHxpC,EAAIjB,QAAQ,CAACopC,EAAMsB,KACjB,GAAa,IAATA,EAAY,OAChB,MAAMC,EAAUF,EAAOC,GACnB7mC,OAAOulC,KAAUvlC,OAAO8mC,IAAUN,EAAQ7c,IAAI,GAAGxsB,KAAaspC,EAAO,KAAKI,OALhFL,EAAQ7c,IAAI,GAAGxsB,SAAiBspC,EAAO,MAS7C,CACA,OAAOD,GAGHJ,GAAoBliC,IACxB,MAAM,GAAQ4gB,KACR4V,EAAWp6B,EAAE,gBACbymC,EAAUrgB,GAAMthB,KAAK4hC,GAAKA,EAAEtjC,KAAOQ,EAAO6hB,aAAavlB,KAAOkmB,GAAM,GAAGlmB,IAGvEymC,EAAY3mC,EAAE,qBAGpB,GAFsB2mC,EAAUzrC,KAAK,aAEf0I,EAAO6hB,WAAY,CACvCkhB,EAAU/0B,SACV,MAAMg1B,EAAa,uvBAWnB5mC,EAAE,QAAQgY,OAAO,gEACsCpU,EAAO6hB,qCAC9CmhB,kQAEiBH,+EAInC,CAGA,MAAMI,EAAU,CACd,mBAAoB,GAAGjjC,EAAO8hB,cAC9B,kBAAmB,GAAG9hB,EAAO+hB,aAC7B,sBAAuB,GAAG/hB,EAAOuiB,gBAAkB,OACnD,kBAAmBviB,EAAOmiB,aAGxBqU,EAASx/B,SACXw/B,EAASljB,YAAY,CAACha,EAAK4pC,KAASA,EAAIlmC,MAAM,yBAA2B,IAAIM,KAAK,MAClFk5B,EAASlT,SAAS,aAAatjB,EAAOkU,SACtCsiB,EAAS3iB,IAAIovB,IAGf,MAAME,EAAgB/mC,EAAE,mCACpB+mC,EAAcnsC,SAChBmsC,EAAc7vB,YAAY,CAACha,EAAK4pC,KAASA,EAAIlmC,MAAM,yBAA2B,IAAIM,KAAK,MACvF6lC,EAAc7f,SAAS,aAAatjB,EAAOkU,SAC3CivB,EAActvB,IAAIovB,KAIhBG,GAAY,KACIC,YAAYxqC,MAChC,GAAImS,OAAOs4B,oBAAsBlnC,EAAE,IAAIpG,YAAoBgB,OAAQ,OACnEgU,OAAOs4B,oBAAqB,EAC5B,MAAM,GAAQ1iB,KACdxkB,EAAE,SAASysB,KAAK,WACVpyB,KAAK+I,IAAM/I,KAAK+I,GAAGtI,WAAW,SAAWT,KAAK+I,GAAGoF,SAAS,YAAcnO,KAAK+I,KAAO,GAAGxJ,YACzFoG,EAAE3F,MAAMuX,QACZ,GACA5R,EAAE,IAAIpG,YAAoBgY,SAC1B,MAAMu1B,EAAS,wBACEvtC,414IAqjGjBoG,EAAE,QAAQgY,OAAOmvB,IAGbx3B,GAAe,KACnB,MAAM4U,EAAMC,KAAUC,QACtB,OAAOF,GAAOA,EAAI6iB,kBAAoB7iB,EAAI6iB,oBAAsB,MAG5DzB,GAAqBv0B,MAAOi2B,EAAWC,GAAa,EAAOC,GAAgB,KAC/E,GAAIpkB,GAAU,OACdA,IAAW,EACX,MAAM,GAAQqB,KACRgjB,EAAWxnC,EAAE,yBAGdsnC,GAAcE,EAAS5sC,SAC1B4sC,EAAS1iC,KAAK,KAAKoS,YAAY,WAAWgQ,SAAS,sBACnDsgB,EAAS7X,KAAK,YAAY,IAG5B,IAEE,MAAMpzB,EAAa,CAAC,EAYpB,GAVK8qC,EAAUI,KACVlrC,EAAWkrC,KAAOJ,EAAUI,KADZlrC,EAAWkrC,KAAO,CAAEl6B,KAAM,aAAcuE,QAAS,GAGtE7T,OAAOC,KAAKmpC,GAAWxrC,QAAQmY,IACzBA,EAAElZ,WAAW,YACfyB,EAAWyX,GAAKqzB,EAAUrzB,MAK1BuzB,EAAe,CACjB,MAAMxgB,EAAYC,KAClB/oB,OAAOC,KAAK6oB,GAAWlrB,QAAQhB,IACzB0B,EAAW1B,IAAQ0B,EAAW1B,GAAKmO,SACrC+d,EAAUlsB,GACPW,KAAK,CAACC,EAAGC,IAAMA,EAAID,GACnBI,QAAQqB,IACHX,EAAW1B,GAAKmO,QAAQ9L,EAAM,IAAIX,EAAW1B,GAAKmO,QAAQvB,OAAOvK,EAAM,EAAG,OAItFyqB,GAAqB,CAAC,EACxB,CAGA,MAAMpD,EAAMC,KAAUC,QAClBF,GAAOA,EAAImjB,yBACPnjB,EAAImjB,kBAAkBvsC,KAAKwB,UAAUJ,IAI7CmT,GAAgBnT,EAChB0rB,GAAa1rB,GACbmnB,IAAoB,EACpBJ,GAAiB,IAAIC,IACjB3U,OAAO+4B,gBAAgB/4B,OAAO+4B,eAAel5B,QAE5C64B,GACHziB,IAEJ,CAAE,MAAO3oB,GACPF,QAAQmK,MAAM,cAAejK,GACzB0S,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,OACzC,C,QACEgd,IAAW,GACNmkB,GAAcE,EAAS5sC,SAC1B4sC,EAAS1iC,KAAK,KAAKoS,YAAY,sBAAsBgQ,SAAS,WAC9DsgB,EAAS7X,KAAK,YAAY,GAE9B,GAII/E,GAAexZ,MAAMi2B,IACzB,IACE,MAAM9qC,EAAa,CAAC,EACf8qC,EAAUI,KACVlrC,EAAWkrC,KAAOJ,EAAUI,KADZlrC,EAAWkrC,KAAO,CAAEl6B,KAAM,aAAcuE,QAAS,GAGtE7T,OAAOC,KAAKmpC,GAAWxrC,QAAQmY,IACzBA,EAAElZ,WAAW,YACfyB,EAAWyX,GAAKqzB,EAAUrzB,MAI9B,MAAMuQ,EAAMC,KAAUC,QAClBF,GAAOA,EAAImjB,yBACPnjB,EAAImjB,kBAAkBvsC,KAAKwB,UAAUJ,IAG7CmT,GAAgBnT,CAElB,CAAE,MAAOL,GACPF,QAAQmK,MAAM,4BAA6BjK,EAC7C,GAEI0rC,GAAkB1hC,IACtB,MAAM2hC,EAAS,CAAC,EAChB,IAAK3hC,GAAwB,iBAATA,EAAmB,OAAO2hC,EAC9C,IAAK,MAAM9+B,KAAW7C,EACpB,GAAIA,EAAK6C,IAAUtG,KAAM,CACvB,MAAMkI,EAAQzE,EAAK6C,GACnB8+B,EAAOl9B,EAAMlI,MAAQ,CACnB5H,IAAKkO,EACLhM,QAAS4N,EAAM3B,SAAU2B,EAAM3B,QAAQ,IAAW,GAClD2V,KAAMhU,EAAM3B,QAAU2B,EAAM3B,QAAQpN,MAAM,GAAK,GAC/CksC,WAAYn9B,EAAM3B,SAAW,GAC7B++B,aAAcp9B,EAAMo9B,cAAgB,CAAC,EACrCC,aAAcr9B,EAAMq9B,cAAgB,CAAC,KAClCr9B,EAEP,CAEF,OAAOk9B,GA+GT,MAAMI,GAA6BC,IACjC,MAAM,GAAQ1jB,KAER2jB,EAAoB,aADXtwB,KAC+BC,QAGxCjP,EAAU6G,IAAiBC,KAC3Bk4B,EAASD,GAAgB/+B,GAAW,CAAC,GACrCu/B,EAAanqC,OAAOC,KAAK2pC,GAEzB3C,EAASllC,EAAE,iIAEsCmoC,61BAczCC,EAAWntC,IAAIwH,GAAQ,kBAAkBjD,EAAWiD,OAAUjD,EAAWiD,eAAkBvB,KAAK,w8IA2E9FknC,EAAWntC,IAAIwH,GAAQ,kBAAkBjD,EAAWiD,OAAUjD,EAAWiD,eAAkBvB,KAAK,owCA0BhHlB,EAAE,QAAQgY,OAAOktB,GAGjBA,EAAOpgC,KAAK,eAAe6R,GAAG,SAAU,WACtC,MAAM9Z,EAAYmD,EAAE3F,MAAM6F,MACpBmoC,EAAanD,EAAOpgC,KAAK,gBAE/B,IAAKjI,IAAcgrC,EAAOhrC,GAExB,YADAwrC,EAAWzwB,KAAK,uCAAuC+X,KAAK,YAAY,GAI1E,MACMlE,GADUoc,EAAOhrC,GAAWE,SAAW,IAE1C+I,OAAO,CAAChI,EAAGpD,IAAMA,EAAI,GAAKoD,GAC1B7C,IAAI6C,GAAK,kBAAkB0B,EAAW1B,OAAO0B,EAAW1B,eACxDoD,KAAK,IAERmnC,EAAWzwB,KAAK,mCAAqC6T,GAASkE,KAAK,YAAY,EACjF,GAGAuV,EAAOpgC,KAAK,kBAAkB6R,GAAG,SAAU,WACzC,MAAM2xB,EAAetoC,EAAE3F,MAAM6F,MACvBqoC,EAAgBrD,EAAOpgC,KAAK,mBAElC,IAAKwjC,IAAiBT,EAAOS,GAE3B,YADAC,EAAc3wB,KAAK,yCAAyC+X,KAAK,YAAY,GAI/E,MACMlE,GADUoc,EAAOS,GAAcvrC,SAAW,IAE7C+I,OAAO,CAAChI,EAAGpD,IAAMA,EAAI,GAAKoD,GAC1B7C,IAAI6C,GAAK,kBAAkB0B,EAAW1B,OAAO0B,EAAW1B,eACxDoD,KAAK,IAERqnC,EAAc3wB,KAAK6T,GAASkE,KAAK,YAAY,EAC/C,GAGAuV,EAAOpgC,KAAK,cAAc6R,GAAG,SAAU,WACrC,MAAMpJ,EAAOvN,EAAE3F,MAAM6F,MACf0J,EAAWrH,EAAegL,GAC1Bi7B,EAAkC,UAApB5+B,GAAUlH,MAG9BwiC,EAAOpgC,KAAK,4BAA4BogB,OACxCggB,EAAOpgC,KAAK,WAAayI,GAAM0X,OAG3BujB,GACFtD,EAAOpgC,KAAK,eAAeogB,OAC3BggB,EAAOpgC,KAAK,gBAAgB5E,IAAI,IAAIyvB,KAAK,YAAY,KAErDuV,EAAOpgC,KAAK,eAAemgB,OAEvBigB,EAAOpgC,KAAK,eAAe5E,OAC7BglC,EAAOpgC,KAAK,gBAAgB6qB,KAAK,YAAY,GAGnD,GAGA,MAAMiV,EAAc,IAAMM,EAAOtzB,SACjCszB,EAAOvuB,GAAG,QAAS,oCAAqCiuB,GACxDM,EAAOvuB,GAAG,QAAS,SAAUza,GACvB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,iCAAiC4tB,GAC5D,GAGAM,EAAOpgC,KAAK,kBAAkB6R,GAAG,QAAS,WACxC,MAAMlU,EAAOyiC,EAAOpgC,KAAK,cAAc5E,OAAOC,OACxCsD,EAAcyhC,EAAOpgC,KAAK,eAAe5E,MACzCwD,EAAewhC,EAAOpgC,KAAK,gBAAgB5E,MAC3CyD,EAAWuhC,EAAOpgC,KAAK,cAAc5E,MACrC4D,EAAeohC,EAAOpgC,KAAK,mBAAmB5E,OAAOC,OACrDyJ,EAAWrH,EAAeoB,GAC1B6kC,EAAkC,UAApB5+B,GAAUlH,MAG9B,IAAKD,EAEH,YADImM,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,YAG3C,IAAK/jB,EAEH,YADImL,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,YAI3C,IAAKghB,IAAgB9kC,EAEnB,YADIkL,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,WAK3C,MAAMihB,EAAa,CAAC,EACpB,GAAiB,kBAAb9kC,QAEG,GAAiB,aAAbA,EAAyB,CAClC,MAAMK,EAAMkhC,EAAOpgC,KAAK,gBAAgB5E,MAClC+D,EAAMihC,EAAOpgC,KAAK,gBAAgB5E,MAC5B,KAAR8D,IAAYykC,EAAWzkC,IAAM6W,SAAS7W,EAAK,KACnC,KAARC,IAAYwkC,EAAWxkC,IAAM4W,SAAS5W,EAAK,IACjD,MAAO,GAAiB,aAAbN,QAEJ,GAAiB,WAAbA,EAAuB,CAChC,MAAME,EAAUqhC,EAAOpgC,KAAK,gBAAgB5E,OAAOC,OACnD,IAAK0D,EAEH,YADI+K,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,aAI3C,IACE,IAAIzf,OAAOlE,EACb,CAAE,MAAO3H,GAEP,YADI0S,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,WAEzC,CACAsiC,EAAW5kC,QAAUA,CACvB,MAAO,GAAiB,SAAbF,EAAqB,CAC9B,MAAM+kC,EAAYxD,EAAOpgC,KAAK,eAAe5E,OAAOC,OACpD,IAAKuoC,EAEH,YADI95B,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,YAG3CihB,EAAW1kC,OAAS2kC,EACjBhgC,MAAM,KACNzN,IAAI2Z,GAAKA,EAAEzU,QACX2F,OAAO8O,GAAKA,EACjB,MAAO,GAAiB,YAAbjR,EAAwB,CACjC,MAAMK,EAAMkhC,EAAOpgC,KAAK,YAAY5E,MAC9B+D,EAAMihC,EAAOpgC,KAAK,YAAY5E,MACxB,KAAR8D,IAAYykC,EAAWzkC,IAAMyE,WAAWzE,IAChC,KAARC,IAAYwkC,EAAWxkC,IAAMwE,WAAWxE,GAC9C,MAAO,GAAiB,aAAbN,EAAyB,CAClC,MAAMO,EAAWghC,EAAOpgC,KAAK,kBAAkB5E,MACzCyoC,EAAazD,EAAOpgC,KAAK,mBAAmB5E,MAElD,IAAKgE,EAEH,YADI0K,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,YAI3C,MAAMohB,EAAkBxpC,MAAM+I,QAAQwgC,GAAcA,EAAaA,EAAa,CAACA,GAAc,GAC7F,GAA+B,IAA3BC,EAAgBhuC,QAA4C,IAA3BguC,EAAgBhuC,SAAiBguC,EAAgB,GAEpF,YADIh6B,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,iBAI3CihB,EAAWvkC,SAAWA,EAEtBukC,EAAWtkC,UAAuC,IAA3BykC,EAAgBhuC,OAAeguC,EAAgB,GAAKA,CAC7E,CAGA,MAAM7hC,EAAS,UAAYvK,KAAKC,MAAQ,IAAMwe,KAAKE,SAAS0Q,SAAS,IAAIC,OAAO,EAAG,GAG7EzkB,EAAU,CACdjE,GAAI2D,EACJtE,KAAMA,EACNY,YAAa,GACbI,YAAaA,EACbC,aAAc8kC,EAAc,GAAK9kC,EACjCC,SAAUA,EACVC,OAAQ6kC,EACR3kC,aAAcA,GAAgB8F,GAAUhH,MAAQ,SAChDY,WAAW,GAGb,GAAI0B,EAAsBiC,cAAcE,GAAU,CAChDu9B,IAGA,MAAMiE,EAAaX,EAAapjC,KAAK,0BAC/BgkC,EAAW,mEACuCtpC,EAAWuH,4DACtBvH,EAAWoK,GAAUnH,MAAQkB,KAAY6kC,EAAc,QAAU,0CACnF5+B,GAAUjH,MAAQ,8HAGVnD,EAAWiD,wDACTjD,EAAWiE,KAAe+kC,EAAc,QAAU,IAAMhpC,EAAWkE,2FAEpDlE,EAAWuH,qRAIXvH,EAAWuH,2FAG/D8hC,EAAW7wB,OAAO8wB,EAEpB,MACMl6B,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SAE3C,IAMI4iC,GAAoB5iC,IACxB,IAAKA,IAAUA,EAAMU,KAEnB,YADI+H,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,aAI3C,MAAM,GAAQhD,KAER2jB,EAAoB,aADXtwB,KAC+BC,QACxCjR,EAAOV,EAAMU,KACblD,EAAWwC,EAAMxC,UAAYkD,EAAKlD,SAClCiG,EAAWrH,EAAeoB,IAAa,CAAElB,KAAMkB,EAAUhB,KAAM,eAC/D6lC,EAAkC,UAApB5+B,GAAUlH,MAGxBmG,EAAU6G,IAAiBC,KAC3B9R,EAAWymB,KAGjB,IAAI0kB,EAAgB,GACpB,IAAKR,GAAe3qC,GAAYsI,EAAMtJ,gBAAkCiC,IAArBqH,EAAMgE,WACvD,IAAK,MAAMpB,KAAWlL,EACpB,GAAIA,EAASkL,IAAUtG,OAAS0D,EAAMtJ,UAAW,CAC/C,MACMsC,GADUtB,EAASkL,GAASC,UAAU,IAAM,IAC3B7L,QAAQgJ,EAAMgE,YAC/BF,EAAS9D,EAAMvH,SAAW,EAC5BO,GAAU,GAAKtB,EAASkL,GAASC,UAAUiB,KAC7C++B,EAAgBnrC,EAASkL,GAASC,QAAQiB,GAAQ9K,IAAW,IAE/D,KACF,CAIJ,MAAM8pC,EAAqC,KAAlBD,GAAwBtpC,OAAOspC,KAAmBtpC,OAAOyG,EAAMiE,cAAgB,IAKxG,GAAIo+B,EAEF,YADAU,GAAsB/iC,EAAOU,EAAMlD,EAAUkF,EAAShL,EAAUsqC,GASlE,IAAIgB,EAAY,GAGdA,GADe,SAAbxlC,GAAuBkD,EAAKjD,QAAQG,QAGhB,aAAbJ,GAA2BkD,EAAKjD,QAAQM,UAAY2C,EAAKjD,QAAQO,WAGpD,YAAbR,GAGa,WAAbA,GAAyBkD,EAAKjD,OAR3B,yJACyDpE,EAAW2G,EAAMiE,cAAgB,kBAiBxG,IAAIg/B,EAAmB,GAEvB,GAAiB,aAAbzlC,EAAyB,CAE3B,MAAM0lC,EA3bV,SAA2BxsC,EAAWsN,EAAYm/B,EAAiBzgC,EAAS0gC,EAAW,GACrF,MAAMF,EAAW,IAAI9lB,IACrB,IAAK1mB,IAAcsN,IAAetB,EAAS,MAAO,GAElD,IAAK,MAAME,KAAWF,EACpB,GAAIA,EAAQE,IAAUtG,OAAS5F,EAAW,CACxC,MAAME,EAAU8L,EAAQE,GAASC,UAAU,IAAM,GAC3C2V,EAAO9V,EAAQE,GAASC,SAASpN,MAAM,IAAM,GAC7CuD,EAASpC,EAAQI,QAAQgN,GAE3BhL,GAAU,GACZwf,EAAK9iB,QAAQ,CAACiB,EAAKI,KACjB,GAAIA,IAAQosC,EAAiB,CAC3B,MAAM/rC,EAAQT,IAAMqC,GAChB5B,SAAkE,KAAzBmC,OAAOnC,GAAO4C,QACzDkpC,EAAShgB,IAAI3pB,OAAOnC,GAAO4C,OAE/B,IAGJ,KACF,CAGF,OAAOf,MAAM4b,KAAKquB,GAAUztC,MAAM,EAAG2tC,EACvC,CAkaqBC,CAAkBrjC,EAAMtJ,UAAWsJ,EAAMgE,WAAYhE,EAAMvH,SAAUiK,EAAS,GAC3FwgC,EAASzuC,OAAS,IACpBwuC,EAAmB,kQAMXC,EACCpuC,IACCiF,GAAO,oEACwCV,EAAWU,wCACxDV,EAAWU,EAAItF,OAAS,GAAKsF,EAAIiwB,UAAU,EAAG,IAAM,MAAQjwB,+CAI/DgB,KAAK,sDAKlB,MAAO,GAAiB,SAAbyC,GAAuBkD,EAAKjD,QAAQG,OAAQ,CAGrDqlC,EAAmB,4RADCviC,EAAKjD,OAAOG,OAQvB9I,IACCiF,GAAO,qDAC2BiG,EAAMiE,eAAiBlK,EAAM,+BAAiC,wCAC9EV,EAAWU,cAAgBiG,EAAMiE,eAAiBlK,EAAM,UAAY,6BACpFV,EAAWU,2CAIdgB,KAAK,+CAIhB,MAAO,GAAiB,WAAbyC,GAAyBkD,EAAKjD,QAAQC,QAAS,CAExD,MAAM4lC,EAxiBV,SAA4B5lC,EAASjF,GACnC,IAAKiF,QAAwB/E,IAAbF,GAA0BA,EAAW,EAAG,OAAO,KAE/D,IAKE,MAAM8qC,EAAc7lC,EAAQjD,MAAM,mCAElC,GAAI8oC,EAAa,CACf,MAAMlvC,EAASkvC,EAAY,GACrBC,EAAS9uB,SAAS6uB,EAAY,GAAI,IAExC,OAAOlvC,EADSkF,OAAOd,EAAW,GAAGgrC,SAASD,EAAQ,IAExD,CAGA,MAAME,EAAehmC,EAAQjD,MAAM,wBACnC,GAAIipC,EAAc,CAChB,MAAMF,EAAS9uB,SAASgvB,EAAa,GAAI,IACzC,OAAOnqC,OAAOd,EAAW,GAAGgrC,SAASD,EAAQ,IAC/C,CACF,CAAE,MAAOztC,GACPF,QAAQmK,MAAM,gBAAiBjK,EACjC,CAEA,OAAO,IACT,CA4gB2B4tC,CAAmBjjC,EAAKjD,OAAOC,QAASsC,EAAMvH,UACrEwqC,EAAmB,gKAGkC5pC,EAAWqH,EAAKjD,OAAOC,gDAGtE4lC,EACI,sSAKkDjqC,EAAWiqC,2DACzBjqC,EAAWiqC,4DAI/C,4BAIZ,MAAO,GAAiB,YAAb9lC,EAAwB,CAEjC,MAAMK,EAAM6C,EAAKjD,QAAQI,IACnBC,EAAM4C,EAAKjD,QAAQK,IACnB8lC,EAAathC,WAAWtC,EAAMiE,cAC9B4/B,GACHrhC,MAAMohC,UAAyBjrC,IAARkF,GAAqB+lC,EAAa/lC,QAAiBlF,IAARmF,GAAqB8lC,EAAa9lC,GACjGgmC,EAAeD,EAzezB,SAA+B5/B,EAAcpG,EAAKC,GAChD,MAAMimC,EAAMzhC,WAAW2B,GACvB,OAAIzB,MAAMuhC,QAAqBprC,IAARkF,EAAoBA,EAAM,OACrClF,IAARkF,GAAqBkmC,EAAMlmC,EAAYA,OAC/BlF,IAARmF,GAAqBimC,EAAMjmC,EAAYA,EACpCimC,CACT,CAmewCC,CAAsBhkC,EAAMiE,aAAcpG,EAAKC,GAAO,KAE1FmlC,EAAmB,kKAGuCtqC,IAARkF,EAAoBA,EAAM,eAAkBlF,IAARmF,EAAoBA,EAAM,qCAG1G+lC,GAAiC,OAAjBC,EACZ,gHAEkDA,oEACJA,2DAI9C,4BAIZ,MAAO,GAAiB,aAAbtmC,GAA2BkD,EAAKjD,QAAQM,UAAY2C,EAAKjD,QAAQO,UAAW,CAErF,MAAMsnB,EA5jBV,SAA4BvnB,EAAUykC,EAAY9/B,GAChD,MAAM4iB,EAAU,IAAIlI,IACpB,IAAKrf,IAAaykC,IAAe9/B,EAAS,OAAOzJ,MAAM4b,KAAKyQ,GAE5D,MAAMxiB,EAAU7J,MAAM+I,QAAQwgC,GAAcA,EAAa,CAACA,GAG1D,IAAK,MAAM5/B,KAAWF,EACpB,GAAIA,EAAQE,IAAUtG,OAASyB,EAAU,CACvC,MAAMnH,EAAU8L,EAAQE,GAASC,UAAU,IAAM,GAC3C2V,EAAO9V,EAAQE,GAASC,SAASpN,MAAM,IAAM,GAGnDqN,EAAQpN,QAAQqN,IACd,MAAM/J,EAASpC,EAAQI,QAAQ+L,GAC3B/J,GAAU,GACZwf,EAAK9iB,QAAQiB,IACX,MAAMS,EAAQT,IAAMqC,GAChB5B,SAAkE,KAAzBmC,OAAOnC,GAAO4C,QACzDsrB,EAAQpC,IAAI3pB,OAAOnC,GAAO4C,YAMlC,KACF,CAGF,OAAOf,MAAM4b,KAAKyQ,GAASjwB,MAC7B,CA8hBoB4uC,CAAmBvjC,EAAKjD,OAAOM,SAAU2C,EAAKjD,OAAOO,UAAW0E,GAC5E4iB,EAAQ7wB,OAAS,IACnBwuC,EAAmB,+JAG2B5pC,EAAWqH,EAAKjD,OAAOM,mBAAmBunB,EAAQ7wB,+KAGxF6wB,EACCxwB,IACCiF,GAAO,uDAC2BiG,EAAMiE,eAAiBlK,EAAM,+BAAiC,0CAC9EV,EAAWU,cAAgBiG,EAAMiE,eAAiBlK,EAAM,UAAY,+BACpFV,EAAWU,+CAIdgB,KAAK,sDAKlB,CAGA,MAAMgkC,EAASllC,EAAE,iIAEsCmoC,6EACb3oC,EAAW2G,EAAMtJ,WAAa,SAAS2C,EAAW2G,EAAMgE,YAAc,yRAK/EP,EAASjH,qCACtBnD,EAAW2G,EAAMoE,UAAY1D,EAAKpE,MAAQ,wFAEbjD,EAAW2G,EAAMrC,cAAgB+C,EAAK/C,cAAgB8F,EAAShH,MAAQ,oFAK9GqmC,EACI,sQAK+BzpC,EAAWwpC,4IAI1C,yPAQFG,yEAKFC,EACI,gFAEAA,wCAGA,8LAKJH,EAAmB,6HAA+H,6LAO5JjpC,EAAE,QAAQgY,OAAOktB,GAGjBA,EAAOvuB,GAAG,QAAS,kDAAmD,WACpE,GAAI3W,EAAE3F,MAAM2c,SAAS,gCAAiC,OACtD,MAAMqzB,EAAcrqC,EAAE3F,MAAMa,KAAK,UAAY8E,EAAE3F,MAAM0V,OAAO5P,OAC5D+kC,EAAOpgC,KAAK,oBAAoB5E,IAAImqC,GAAa9pC,QAAQ,QAC3D,GAGA2kC,EAAOvuB,GAAG,QAAS,oBAAqB,WACtCuuB,EAAOpgC,KAAK,oBAAoB5E,IAAI8oC,EACtC,GAGA,MAAMpE,EAAc,IAAMM,EAAOtzB,SACjCszB,EAAOvuB,GAAG,QAAS,sCAAuCiuB,GAC1DM,EAAOvuB,GAAG,QAAS,SAAUza,GACvB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,iCAAiC4tB,GAC5D,GAGAM,EAAOpgC,KAAK,sBAAsB6R,GAAG,QAASvF,iBAC5C,MAAMiG,EAAW6tB,EAAOpgC,KAAK,oBAAoB5E,OAAOC,QAAU,GAElE,GAAiB,KAAbkX,GAAgC,aAAb1T,EAMvB,IACE,MAAMkF,EAAU6G,IAAiBC,KACjC,IAAI6C,GAAU,EAEd,IAAK,MAAMzJ,KAAWF,EACpB,GAAIA,EAAQE,IAAUtG,OAAS0D,EAAMtJ,UAAW,CAC9C,MAAM8N,EAAQ9B,EAAQE,GAChBhM,EAAU4N,EAAM3B,UAAU,IAAM,GAEtC,GAAI7C,EAAMvH,UAAY,GAAKuH,EAAMgE,WAAY,CAC3C,MAAMhL,EAASpC,EAAQI,QAAQgJ,EAAMgE,YAC/BF,EAAS9D,EAAMvH,SAAW,EAEhC,GAAIO,GAAU,GAAKwL,EAAM3B,SAAW2B,EAAM3B,QAAQiB,GAAS,CACzDU,EAAM3B,QAAQiB,GAAQ9K,GAAUkY,EAChC7E,GAAU,EACV,KACF,CACF,CACF,CAGEA,SACImzB,GAAmB98B,GAAS,GAAO,GACzC+7B,IACA/f,MAEIjW,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,YAE3C,CAAE,MAAOjK,GACPF,QAAQmK,MAAM,iBAAkBjK,GAC5B0S,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,UAAYjK,EAAE6N,SAAW,QAClE,MArCM6E,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,WAsC7C,IAMI0hB,GAAwB,CAAC/iC,EAAOU,EAAMlD,EAAUkF,EAAShL,EAAUsqC,KACvE,MAAM,GAAQ3jB,KAGd,IAAI8lB,EAAc,GACdC,EAAa,GAEjB,GAAiB,kBAAb5mC,EAA8B,CAEhC,IAAI6mC,EAAc,EACdC,EAAgB,GAEpB,GAAI5sC,GAAYgL,EACd,IAAK,MAAME,KAAWF,EACpB,GAAIA,EAAQE,IAAUtG,OAAS0D,EAAMtJ,WAAagB,EAASkL,GAAU,CACnE,MAAMq9B,EAAUv9B,EAAQE,GAASC,SAASpN,MAAM,IAAM,GAChDyqC,EAAUxoC,EAASkL,GAASC,SAASpN,MAAM,IAAM,GAoBvD,GAjBAwqC,EAAQvqC,QAAQ,CAACiB,EAAKI,KACpB,MAAMopC,EAASD,EAAQnpC,GACvB,GAAKopC,GAIH,IAAK,IAAIoE,EAAI,EAAGA,EAAI5tC,EAAIlC,OAAQ8vC,IAC9B,GAAIhrC,OAAO5C,EAAI4tC,IAAM,MAAQhrC,OAAO4mC,EAAOoE,IAAM,IAAK,CACpDD,EAAc1vC,KAAK,IAAImC,EAAM,WAC7BstC,IACA,KACF,OARFC,EAAc1vC,KAAK,IAAImC,EAAM,UAC7BstC,MAaAnE,EAAQzrC,OAASwrC,EAAQxrC,OAC3B,IAAK,IAAIF,EAAI0rC,EAAQxrC,OAAQF,EAAI2rC,EAAQzrC,OAAQF,IAC/C+vC,EAAc1vC,KAAK,IAAIL,EAAI,WAC3B8vC,IAGJ,KACF,CAIJF,EAAc,odAWME,+CAGdC,EAAc7vC,OAAS,EACnB,wEAEA6vC,EACC7uC,MAAM,EAAG,IACTX,IAAI0vC,GAAK,0CAA0CnrC,EAAWmrC,YAC9DzpC,KAAK,sBACNupC,EAAc7vC,OAAS,GAAK,iDAAiD6vC,EAAc7vC,OAAS,aAAe,qCAGnH,6BAIV2vC,EAAa,gQAIf,MAAO,GAAiB,aAAb5mC,EAAyB,CAElC,MAAMinC,EAAU/jC,EAAKjD,QAAQI,IACvB6mC,EAAUhkC,EAAKjD,QAAQK,IAC7B,IAAI6mC,EAAkB,EAClBC,EAAa,GAEjB,IAAK,MAAMhiC,KAAWF,EACpB,GAAIA,EAAQE,IAAUtG,OAAS0D,EAAMtJ,UAAW,CAC9CiuC,GAAmBjiC,EAAQE,GAASC,SAASpO,QAAU,GAAK,EAC5D,KACF,CAGF,MAAMowC,OAAwBlsC,IAAZ+rC,GAAyBC,EAAkBD,EACvDI,OAAuBnsC,IAAZ8rC,GAAyBE,EAAkBF,EAE5D,GAAII,EACF,IAAK,IAAItwC,EAAImwC,EAAU,EAAGnwC,GAAKowC,EAAiBpwC,IAC9CqwC,EAAWhwC,KAAKL,GAIpB4vC,EAAc,+PAM6B9qC,EAAW2G,EAAMrC,cAAgB+C,EAAK/C,cAAgB,uJAI3EgnC,kCACFhsC,IAAZ8rC,QAAqC9rC,IAAZ+rC,EAAwB,eAAsB/rC,IAAZ8rC,EAAwBA,EAAU,YAAmB9rC,IAAZ+rC,EAAwBA,EAAU,QAAU,mCAGlJG,GAAaD,EAAWnwC,OAAS,EAC7B,8KAG6CmwC,EAAW,2GAGtDA,EACCnvC,MAAM,EAAG,IACTX,IAAIoL,GAAK,4CAA4CA,aACrDnF,KAAK,wBACN6pC,EAAWnwC,OAAS,GAAK,gDAAgDmwC,EAAWnwC,iBAAmB,2DAIzG,iBAGJqwC,EACI,8GAE6CL,EAAUE,gDAGvD,6BAMRP,EADES,GAAaD,EAAWnwC,OAAS,EACtB,mNAE6EiwC,kBAAwBrrC,EAAW2G,EAAMtJ,qEACrFkuC,EAAWnwC,0CAI5C,oGAEjB,CAEA,MAAMsqC,EAASllC,EAAE,iIAEsCmoC,6EACb3oC,EAAW2G,EAAMtJ,WAAa,8HAE9DytC,6EAGAC,2DAMVvqC,EAAE,QAAQgY,OAAOktB,GAGjB,MAAMN,EAAc,IAAMM,EAAOtzB,SACjCszB,EAAOvuB,GAAG,QAAS,oBAAqBiuB,GACxCM,EAAOvuB,GAAG,QAAS,SAAUza,GACvB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,iCAAiC4tB,GAC5D,GAGAM,EAAOvuB,GAAG,QAAS,2BAA4BvF,iBAC7C,GAAKvT,EAKL,IAEE,IAAK,MAAMkL,KAAWF,EACpB,GAAIA,EAAQE,IAAUtG,OAAS0D,EAAMtJ,WAAagB,EAASkL,GAAU,CACnEF,EAAQE,GAAW5N,KAAKC,MAAMD,KAAKwB,UAAUkB,EAASkL,KACtD,KACF,OAGI48B,GAAmB98B,GAAS,GAAO,GACzC+7B,IACA/f,IACF,CAAE,MAAO3oB,GACPF,QAAQmK,MAAM,eAAgBjK,GAC1B0S,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,UAAYjK,EAAE6N,SAAW,QAClE,MAnBM6E,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,QAoB7C,GAGA0d,EAAOvuB,GAAG,QAAS,yBAA0BvF,iBAC3C,MAAM85B,EAAWrwB,SAAS7a,EAAE3F,MAAMa,KAAK,SAAU,IAC3C2B,EAAYmD,EAAE3F,MAAMa,KAAK,SAE/B,IACE,IAAK,MAAM6N,KAAWF,EACpB,GAAIA,EAAQE,IAAUtG,OAAS5F,EAAW,CAExCgM,EAAQE,GAASC,QAAUH,EAAQE,GAASC,QAAQpN,MAAM,EAAGsvC,EAAW,GACxE,KACF,OAGIvF,GAAmB98B,GAAS,GAAO,GACzC+7B,IACA/f,IACF,CAAE,MAAO3oB,GACPF,QAAQmK,MAAM,eAAgBjK,GAC1B0S,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,UAAYjK,EAAE6N,SAAW,QAClE,CACF,IAOIohC,GAA6B,KACjC,MAAM,GAAQ3mB,KACdxkB,EAAE,qBAAqB4R,SAEvB,MAAMhO,EAASiU,KACT8T,EAAIlK,IACJ7c,EAAUqV,EAAuB1V,gBACjCM,EAAWL,GAAMC,IAAItC,EAAgC,MAGrDipC,EAAcxmC,EACjB3J,IAAI2K,IACH,MAAMsQ,EAAWtQ,EAAOxC,KAAOyB,EACzBwmC,EAAYzlC,EAAOrC,QAEzB,MAAO,yCACuB2S,EAAW,SAAW,gBAAgBtQ,EAAOxC,2GAGnE5D,EAAWoG,EAAOnD,wBAClB4oC,EAAY,wCAAwC1f,EAAEpL,0CAA4C,uCAEpG3a,EAAOvC,YAAc,gCAAgC7D,EAAWoG,EAAOvC,qBAAuB,uEAEtFuC,EAAOgU,eAAehf,kBAAkBgL,EAAOoU,mBAAmBpf,QAAU,iRAKxBgL,EAAOxC,OAAO8S,EAAW,UAAY,iGAGhGm1B,EAA0I,GAA9H,2DAA2DzlC,EAAOxC,oIACrBwC,EAAOxC,6EAChEioC,EAAsK,GAA1J,6DAA6DzlC,EAAOxC,kIAKxFlC,KAAK,IAEFmuB,EAAUrvB,EAAE,yFAE0B4D,EAAOkU,8MACoF6T,EAAEtL,iFACxEsL,EAAErL,uUAQvD8qB,GAAe,yDAAyDzf,EAAEpL,8JAIAoL,EAAEtL,iGACPsL,EAAEjL,iQAGCiL,EAAEnL,4BAA4BmL,EAAEtL,sCAAsCsL,EAAErL,mNAG9EqL,EAAEnL,4BAA4BmL,EAAEtL,sCAAsCsL,EAAErL,2RAUtJtgB,EAAE,QAAQgY,OAAOqX,GAGjBA,EAAQvqB,KAAK,oCAAoC6R,GAAG,QAAS,KAC3D0Y,EAAQzd,SACR05B,OAIFjc,EAAQ1Y,GAAG,SAAU,qBAAsB,WACzC,MAAM40B,EAAUvrC,EAAE3F,MACZ+I,EAAKmoC,EAAQrwC,KAAK,MACNqwC,EAAQC,GAAG,aAI3BvxB,EAAuBjV,gBAAgB5B,GAGvCisB,EAAQvqB,KAAK,sBAAsB2nB,KAAK,WACtC,MAAMgf,EAAczrC,EAAE3F,MACPoxC,EAAYvwC,KAAK,QACjBkI,GACbqoC,EAAY9b,KAAK,WAAW,EAEhC,GAGAN,EAAQvqB,KAAK,oBAAoBoS,YAAY,UAC7CmY,EAAQvqB,KAAK,6BAA6B1B,OAAQ8jB,SAAS,YAG3DjN,EAAuBjV,gBAAgB,MAGvCqqB,EAAQvqB,KAAK,oBAAoBoS,YAAY,UAEjD,GAGAmY,EAAQ1Y,GAAG,QAAS,mBAAoB,WACtC,MAAMvT,EAAKpD,EAAE3F,MAAMa,KAAK,MACxBm0B,EAAQzd,SACR85B,GAA0BtoC,EAC5B,GAGAisB,EAAQ1Y,GAAG,QAAS,qBAAsB,WACxC,MAAMvT,EAAKpD,EAAE3F,MAAMa,KAAK,MAClBgL,EAAO+T,EAAuBjU,aAAa5C,GACjD,IAAK8C,EAEH,YADI0I,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SAIzC,MAAMP,EAAShB,EAAQE,KAAKC,GAAKA,EAAE3B,KAAOA,GACpCuoC,EAAW,cAAc/lC,GAAQnD,MAAQW,KAAM5G,KAAKC,aACpDqQ,EAAO,IAAI42B,KAAK,CAACx9B,GAAO,CAAEqH,KAAM,qBAChCG,EAAMP,IAAIQ,gBAAgBb,GAC1BrR,EAAIia,SAASG,cAAc,KACjCpa,EAAEkoC,KAAOj2B,EACTjS,EAAEmoC,SAAW+H,EACbj2B,SAASqC,KAAK/B,YAAYva,GAC1BA,EAAE2yB,QACF1Y,SAASqC,KAAK8rB,YAAYpoC,GAC1B0R,IAAIC,gBAAgBM,GAEhBkB,OAAO4I,QAAQ5I,OAAO4I,OAAOF,QAAQ,QAC3C,GAGA+X,EAAQ1Y,GAAG,QAAS,qBAAsB,WACxC,MAAMvT,EAAKpD,EAAE3F,MAAMa,KAAK,MAClB0K,EAAShB,EAAQE,KAAKC,GAAKA,EAAE3B,KAAOA,GAE1C,GAAI6sB,QAAQ,WAAWrqB,GAAQnD,WAAY,CACzBwX,EAAuBtU,aAAavC,IAE9CwL,OAAO4I,QAAQ5I,OAAO4I,OAAOF,QAAQ,SACzC+X,EAAQzd,SACRu5B,MAEIv8B,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,OAE3C,CACF,GAGAkpB,EAAQvqB,KAAK,mBAAmB6R,GAAG,QAAS,KAC1C0Y,EAAQzd,SACR85B,OAIFrc,EAAQvqB,KAAK,sBAAsB6R,GAAG,QAAS,KAC7C0Y,EAAQvqB,KAAK,0BAA0BspB,UAGzCiB,EAAQvqB,KAAK,0BAA0B6R,GAAG,SAAU,SAAUza,GAC5D,MAAMomC,EAAOpmC,EAAEsQ,OAAO+1B,MAAM,GAC5B,IAAKD,EAAM,OAEX,MAAMwB,EAAS,IAAIC,WACnBD,EAAOE,OAASC,IACd,IACE,MAAMvxB,EAAWuH,EAAuBhU,aAAag+B,EAAIz3B,OAAOJ,QAC5DsG,GACE9D,OAAO4I,QAAQ5I,OAAO4I,OAAOF,QAAQ,MAAM5E,EAASjQ,aACxD4sB,EAAQzd,SACRu5B,MAEIv8B,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,aAE3C,CAAE,MAAOgU,GACPne,QAAQmK,MAAM,gBAAiBgU,GAC3BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,OACzC,GAEF29B,EAAOM,WAAW9B,GAGlBtiC,EAAE3F,MAAM6F,IAAI,GACd,GAGAmvB,EAAQ1Y,GAAG,QAAS,SAAUza,GACxB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,sBACvBqY,EAAQzd,SACR05B,KAEJ,IAIII,GAA4B,CAACE,EAAW,QAC5C,MAAM,GAAQpnB,KACdxkB,EAAE,qBAAqB4R,SAEvB,MAAMhO,EAASiU,KACT8T,EAAIlK,IACJoqB,IAAWD,EACXE,EAAiBD,EAAS5xB,EAAuB1V,gBAAgBO,KAAKC,GAAKA,EAAE3B,KAAOwoC,GAAY,KAGhGG,EAAc,CAClBtpC,KAAMqpC,GAAgBrpC,MAAQ,QAC9BY,YAAayoC,GAAgBzoC,aAAe,GAC5CuW,eAAgBkyB,GAAgBlyB,gBAAkB,CAChD,CAAEnX,KAAM,KAAMoX,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAErX,KAAM,KAAMoX,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAErX,KAAM,KAAMoX,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAErX,KAAM,KAAMoX,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAErX,KAAM,KAAMoX,QAAS,MAAOC,MAAO,CAAC,EAAG,KACzC,CAAErX,KAAM,KAAMoX,QAAS,MAAOC,MAAO,CAAC,EAAG,MAE3CE,kBAAmB8xB,GAAgB9xB,mBAAqB,IAGpDqV,EAAUrvB,EAAE,yFAE0B4D,EAAOkU,8MACoF6T,EAAEtL,iFACxEsL,EAAErL,8DACvBurB,EAAS,KAAO,oUAOMlgB,EAAEpL,wGACb/gB,EAAWusC,EAAYtpC,8FAA8FkpB,EAAEtL,sDAAsDsL,EAAE7K,8BAA8B6K,EAAErL,+LAIpMqL,EAAEpL,sGACb/gB,EAAWusC,EAAY1oC,sHAAsHsoB,EAAEtL,sDAAsDsL,EAAE7K,8BAA8B6K,EAAErL,+LAI5NqL,EAAEpL,+FACVoL,EAAEpL,yMAEkFoL,EAAEtL,sDAAsDsL,EAAE7K,8BAA8B6K,EAAErL,gOAG1LqL,EAAEpL,+eAQsCoL,EAAEtL,8FACVsL,EAAEjL,2QAGJiL,EAAEnL,4BAA4BmL,EAAEtL,sCAAsCsL,EAAErL,kLAQpJtgB,EAAE,QAAQgY,OAAOqX,GAEjB,MAAM2c,EAAgB3c,EAAQvqB,KAAK,gBAGhB,MACjB,MAAM5J,EAAO,CACX0e,eAAgBmyB,EAAYnyB,eAC5BI,kBAAmB+xB,EAAY/xB,mBAEjCgyB,EAAc9rC,IAAI/E,KAAKwB,UAAUzB,EAAM,KAAM,KAE/C+wC,GAGA5c,EAAQvqB,KAAK,kCAAkC6R,GAAG,QAAS,KACzD0Y,EAAQzd,SACRu5B,OAIF9b,EAAQvqB,KAAK,gBAAgB6R,GAAG,QAAS,KACvC,IACE,MAAMlU,EAAO4sB,EAAQvqB,KAAK,gBAAgB5E,MAAMC,OAC1CkD,EAAcgsB,EAAQvqB,KAAK,gBAAgB5E,MAAMC,OACjDma,EAAU0xB,EAAc9rC,MAAMC,OAEpC,IAAKsC,EAEH,YADImM,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,YAK3C,MAAMtV,EAAW/W,KAAKC,MAAMkf,GAG5B,IACGpI,EAAS0H,iBACTxa,MAAM+I,QAAQ+J,EAAS0H,iBACW,IAAnC1H,EAAS0H,eAAehf,OAGxB,YADIgU,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,aAKzC,MAAMP,EAAS,CACb7C,OAAQ,qBACR+O,QAAS,EACT1O,GAAIwoC,GAAY,UAAUpvC,KAAKC,QAC/BgG,OACAY,cACAuW,eAAgB1H,EAAS0H,eACzBI,kBAAmB9H,EAAS8H,mBAAqB,IAI/C6xB,GACF5xB,EAAuBG,aAAawxB,EAAUhmC,GAC1CgJ,OAAO4I,QAAQ5I,OAAO4I,OAAOF,QAAQ,WAEzC2C,EAAuB7U,aAAaQ,GAChCgJ,OAAO4I,QAAQ5I,OAAO4I,OAAOF,QAAQ,UAG3C+X,EAAQzd,SACRu5B,IACF,CAAE,MAAOhxB,GACPne,QAAQmK,MAAM,gBAAiBgU,GAC3BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,SAAWgU,EAAIpQ,SAAW,YACnE,IAIFslB,EAAQ1Y,GAAG,QAAS,SAAUza,GACxB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,sBACvBqY,EAAQzd,SACRu5B,KAEJ,IAGIG,GAAoB,KACxB,MAAM,GAAQ9mB,KACdxkB,EAAE,qBAAqBksC,IAAI,8BAA8Bt6B,SACzDyR,IAAiB,EACjB,MAAMzf,EAASiU,KACTswB,EAAoB,aAAavkC,EAAOkU,QACxC6T,EAAIlK,IAGJ0qB,EAAiB3nC,GAAMC,IAAI,wBAAyB,CAAC,eAErD2nC,EAAkBC,GAAWF,EAAe/jC,SAASikC,GASrDC,EAAyB,CAC7B,CAAEzxC,IAAK,WAAY4H,KAAM,KAAME,KAAM,eACrC,CAAE9H,IAAK,cAAe4H,KAAM,OAAQE,KAAM,mBAC1C,CAAE9H,IAAK,UAAW4H,KAAM,QAASE,KAAM,mBAGnC4pC,EAAmB,MACvB,MAAM1jC,EAAU6G,IAAiBC,KAC3Bk4B,EAASD,GAAgB/+B,GAAW,CAAC,GACrC2jC,EAAa5kB,MAAwB,GACrC6kB,EAAapkB,KAGnB,IAAIqkB,EAAW,GAef,GAZAJ,EAAuBzwC,QAAQ8wC,KAEb,YAAZA,EAAI9xC,KAAsBmY,EAAUE,gBACxCw5B,EAAS3xC,KAAK,CAAEF,IAAK8xC,EAAI9xC,IAAK4H,KAAMkqC,EAAIlqC,KAAME,KAAMgqC,EAAIhqC,KAAMiqC,WAAW,MAI3E3uC,OAAOC,KAAK2pC,GAAQhsC,QAAQ4G,IAC1BiqC,EAAS3xC,KAAK,CAAEF,IAAK4H,EAAMA,KAAMA,EAAME,KAAMwkB,GAAoB1kB,GAAOmqC,WAAW,MAIjFJ,EAAW5xC,OAAS,EAAG,CACzB,MAAMiyC,EAAW,IAAInhC,IAAI8gC,EAAWvxC,IAAI,CAAC+Y,EAAGtZ,IAAM,CAACsZ,EAAGtZ,KACtDgyC,EAASlxC,KAAK,CAACC,EAAGC,KACHmxC,EAAS3/B,IAAIzR,EAAEZ,KAAOgyC,EAASpoC,IAAIhJ,EAAEZ,KAAO,OAC5CgyC,EAAS3/B,IAAIxR,EAAEb,KAAOgyC,EAASpoC,IAAI/I,EAAEb,KAAO,MAG7D,CAEA,OAAO6xC,EACJzxC,IAAIa,IACH,MAAMgxC,EAAWL,EAAWrkC,SAAStM,EAAKjB,KACpCkyC,EAAejxC,EAAK8wC,UAAY,oBAAsB,GACtD18B,EAAcpU,EAAK2G,KACzB,MACE,qCACAsqC,GACCD,EAAW,gBAAkB,IAC9B,sBACAttC,EAAW1D,EAAKjB,KAJhB,+FAQCiyC,EAAW,eAAiB,UAR7B,mEAYAhxC,EAAK6G,KAZL,gDAeAnD,EAAW0Q,GAhBN,gHAwBRhP,KAAK,GACT,EA7DwB,GA8DnB8rC,EAAUX,GAAYD,EAAgBC,GAAW,kBAAoB,mBAErEnH,EAASllC,EAAE,yGAEyCmoC,uaAQbiE,EAAgB,cAAgB,GAAK,+IACzCY,EAAQ,uhBASnB3mB,GAAOprB,IAAI0wB,GAAK,kBAAkBA,EAAEvoB,OAAOuoB,EAAEvoB,KAAOQ,EAAOkU,MAAQ,WAAa,MAAM6T,EAAElpB,iBAAiBvB,KAAK,yaAQ9GklB,GAAMnrB,IAAIyrC,GAAK,kBAAkBA,EAAEtjC,OAAOsjC,EAAEtjC,KAAOQ,EAAO6hB,WAAa,WAAa,MAAMihB,EAAEjkC,iBAAiBvB,KAAK,6mBASlF0C,EAAO+hB,kvBAUP/hB,EAAOuiB,gBAAkB,wkBASrBviB,EAAOgiB,aAAe,UAAY,ySAQnDwmB,EAAgB,UAAY,GAAK,qJAErCY,EAAQ,gwBAUappC,EAAO8hB,0mBASM,aAAlB9hB,EAAO0hB,OAAwB,WAAa,kFAC5B,aAAlB1hB,EAAO0hB,OAAwB,WAAa,ykBAS7B,GAAtB1hB,EAAOmiB,YAAmB,WAAa,yEACjB,GAAtBniB,EAAOmiB,YAAmB,WAAa,yEACjB,GAAtBniB,EAAOmiB,YAAmB,WAAa,4EACb,SAAvBniB,EAAOmiB,YAAyB,WAAa,0pBASlCniB,EAAOiiB,6XAQxBumB,EAAgB,aAAe,GAAK,wJAExCY,EAAQ,o7BAc2DrhB,EAAEjL,4dAQjE0rB,EAAgB,YAAc,GAAK,uJAEvCY,EAAQ,slBAS2B,aAAxBppC,EAAOoiB,aAA8B,WAAa,kFACvB,aAAxBpiB,EAAOoiB,aAA8B,WAAa,+fAQzB,QAA3BpiB,EAAOkiB,gBAA4B,WAAa,2EACxB,QAA3BliB,EAAOkiB,gBAA4B,WAAa,ufAQvB,QAAzBliB,EAAO2hB,cAA0B,WAAa,4EACpB,SAAzB3hB,EAAO2hB,cAA2B,WAAa,4EACtB,SAAzB3hB,EAAO2hB,cAA2B,WAAa,yfAQrB,SAAzB3hB,EAAO4hB,cAA2B,WAAa,4EACvB,SAAzB5hB,EAAO4hB,cAA2B,WAAa,4PAOrD4mB,EAAgB,WAAa,GAAK,sJAEtCY,EAAQ,qmBASiD,IAA3BppC,EAAOqiB,gBAA4B,UAAY,8QAIS,IAA3BriB,EAAOqiB,gBAA4B,GAAK,8VAKnC,IAAjCriB,EAAOsiB,sBAAkC,UAAY,yTAQhFkmB,EAAgB,UAAY,GAAK,qJAErCY,EAAQ,klBAQvBT,sMAMmBH,EAAgB,cAAgB,GAAK,yJAEzCY,EAAQ,6iBAQnB1oC,EAAcC,gBACbtJ,IACC8J,GACE,kBAAkBvF,EAAWuF,EAAE3B,QAAQ2B,EAAE3B,KAAOkB,EAAcK,mBAAmBvB,GAAK,WAAa,MAAM5D,EAAWuF,EAAEtC,QAAQsC,EAAExB,QAAU,QAAU,eAEvJrC,KAAK,usDAgBVgE,EAAsBuB,cACrBxL,IAAI4L,IACH,MAAM+C,EAAWrH,EAAesE,EAAKlD,WAAa,CAChDlB,KAAMoE,EAAKlD,SACXhB,KAAM,eAEF6lC,EAAiC,UAAnB5+B,EAASlH,MACvBuqC,EAAepmC,EAAKrD,UAC1B,MAAO,8EACgCqD,EAAKvD,QAAU,GAAK,6BAA6B9D,EAAWqH,EAAKzD,yFAC3D5D,EAAWoK,EAASnH,QAAQ+lC,EAAc,QAAU,wEACpE5+B,EAASjH,2MAGDnD,EAAWqH,EAAKpE,yFACdjD,EAAWqH,EAAKpD,eAAeoD,EAAKnD,aAAe,IAAMlE,EAAWqH,EAAKnD,cAAgB8kC,EAAc,QAAU,oIAEnHyE,EAAe,SAAW,qBAAqBztC,EAAWqH,EAAKzD,eAAe6pC,EAAe,SAAW,yIAC3GpmC,EAAKvD,QAAU,SAAW,0FAC/BuD,EAAKvD,QAAU,eAAiB,gKAET9D,EAAWqH,EAAKzD,gJAIrElC,KAAK,obAapClB,EAAE,QAAQgY,OAAOktB,GAGjBA,EAAOpgC,KAAK,6BAA6B6R,GAAG,QAAS,WACnD,MAAMu2B,EAASltC,EAAE3F,MAAMyc,QAAQ,uBACzBq2B,EAAQD,EAAOpoC,KAAK,4BAG1B,GAAIqoC,EAAMn2B,SAAS,iBAAkB,OAErC,MAAMq1B,EAAUa,EAAOhyC,KAAK,SACtBkyC,EAAWptC,EAAE3F,MAAMyK,KAAK,sBAC9B,IAAIuoC,EAAW7oC,GAAMC,IAAI,wBAAyB,CAAC,eAEnD,GAAIyoC,EAAOl2B,SAAS,aAAc,CAEhCk2B,EAAOh2B,YAAY,aACnBk2B,EAASl2B,YAAY,oBAAoBgQ,SAAS,mBAC7CmmB,EAASjlC,SAASikC,IAAUgB,EAAStyC,KAAKsxC,GAE/Cc,EAAMjmB,SAAS,iBAAiBjC,OAChC,MAAMqoB,EAAeH,EAAMxd,KAAK,gBAChCwd,EAAM11B,IAAI,SAAU,GAAG81B,QAAQ,CAAEvf,OAAQsf,GAAgB,IAAK,WAC5DttC,EAAE3F,MAAMod,IAAI,SAAU,IAAIP,YAAY,gBACxC,EACF,KAAO,CAELg2B,EAAOhmB,SAAS,aAChBkmB,EAASl2B,YAAY,mBAAmBgQ,SAAS,oBACjDmmB,EAAWA,EAASvnC,OAAO1C,GAAMA,IAAOipC,GAExC,MAAMmB,EAAgBL,EAAMM,cAC5BN,EACGjmB,SAAS,iBACTzP,IAAI,SAAU+1B,GACdD,QAAQ,CAAEvf,OAAQ,GAAK,IAAK,WAC3BhuB,EAAE3F,MAAM6qB,OAAOzN,IAAI,SAAU,IAAIP,YAAY,gBAC/C,EACJ,CAEA1S,GAAMS,IAAI,wBAAyBooC,EACrC,GAIAnI,EAAOpgC,KAAK,cAAc6R,GAAG,SAAU,WACrC,MAAM+2B,EAAW1tC,EAAE3F,MAAM6F,MACzB2lC,GAAW,CAAE/tB,MAAO41B,IACpBxI,EACGpgC,KAAK,oBACLoS,YAAYmP,GAAOprB,IAAI0wB,GAAK,aAAaA,EAAEvoB,MAAMlC,KAAK,MACtDgmB,SAAS,aAAawmB,IAC3B,GAGAxI,EAAOpgC,KAAK,oBAAoB6R,GAAG,SAAU,WAC3CkvB,GAAW,CAAEpgB,WAAYzlB,EAAE3F,MAAM6F,OACnC,GAGA,MACE,MAAMytC,EAAUzI,EAAOpgC,KAAK,oBACtBD,EAAWL,GAAMC,IAAItC,EAAgC,MAGrDyC,EAAUqV,EAAuB1V,gBACvCK,EAAQ/I,QAAQ+J,IACd,MAAMsQ,EAAWtQ,EAAOxC,KAAOyB,EAC/B8oC,EAAQ31B,OACN,kBAAkBpS,EAAOxC,OAAO8S,EAAW,WAAa,MAAMtQ,EAAOnD,OAAOmD,EAAOrC,QAAU,GAAK,uBAKtGoqC,EAAQh3B,GAAG,SAAU,WACnB,MAAMi3B,EAAa5tC,EAAE3F,MAAM6F,MAE3B,GADA+Z,EAAuBjV,gBAAgB4oC,GAAc,MACjDh/B,OAAO4I,OACT,GAAIo2B,EAAY,CACd,MAAMhoC,EAAShB,EAAQE,KAAKC,GAAKA,EAAE3B,KAAOwqC,GAC1Ch/B,OAAO4I,OAAOF,QAAQ,QAAQ1R,GAAQnD,MAAQ,SAChD,MACEmM,OAAO4I,OAAOq2B,KAAK,kBAGzB,GAGA3I,EAAOpgC,KAAK,2BAA2B6R,GAAG,QAAS,SAAUza,GAC3DA,EAAEmc,iBACFnc,EAAE0a,kBACFsuB,EAAOtzB,SACPyR,IAAiB,EACjB8nB,IACF,EACD,EAnCD,GAsCAjG,EAAOpgC,KAAK,eAAe6R,GAAG,SAAU,WACtCkvB,GAAW,CAAEvgB,OAAQtlB,EAAE3F,MAAM6F,QAC7B2kB,IACF,GACAqgB,EAAOpgC,KAAK,kBAAkB6R,GAAG,SAAU,WACzCkvB,GAAW,CAAE9f,YAAa/lB,EAAE3F,MAAM6F,OACpC,GAGAglC,EAAOpgC,KAAK,iBAAiB6R,GAAG,SAAU,WACxCkvB,GAAW,CAAE7f,aAAchmB,EAAE3F,MAAM6F,QACnC2kB,IACF,GACAqgB,EAAOpgC,KAAK,mBAAmB6R,GAAG,SAAU,WAC1CkvB,GAAW,CAAE/f,gBAAiB9lB,EAAE3F,MAAM6F,QACtC2kB,IACF,GACAqgB,EAAOpgC,KAAK,kBAAkB6R,GAAG,SAAU,WACzCkvB,GAAW,CAAEtgB,cAAevlB,EAAE3F,MAAM6F,QACpC2kB,IACF,GACAqgB,EAAOpgC,KAAK,kBAAkB6R,GAAG,SAAU,WACzCkvB,GAAW,CAAErgB,cAAexlB,EAAE3F,MAAM6F,QACpC2kB,IACF,GAGAqgB,EAAOpgC,KAAK,iBAAiB6R,GAAG,SAAU,WACxC,MAAMm3B,EAAU9tC,EAAE3F,MAAMmxC,GAAG,YAC3B3F,GAAW,CAAE5f,gBAAiB6nB,IACzBA,GAAStpC,GAAMS,IAAI,qBAAqB,GACzC6oC,EAAS5I,EAAOpgC,KAAK,kBAAkBipC,UAAU,KAChD7I,EAAOpgC,KAAK,kBAAkBkpC,QAAQ,KAC3CnpB,IACF,GACAqgB,EAAOpgC,KAAK,kBAAkB6R,GAAG,SAAU,WACzCkvB,GAAW,CAAE3f,sBAAuBlmB,EAAE3F,MAAMmxC,GAAG,aACjD,GACAtG,EAAOpgC,KAAK,YAAY6R,GAAG,SAAU,WACnCkvB,GAAW,CAAEjgB,aAAc5lB,EAAE3F,MAAMmxC,GAAG,cACtC3mB,IACF,GAGAqgB,EAAOpgC,KAAK,yBAAyB6R,GAAG,QAAS,SAAUza,GACzDA,EAAE0a,kBACF,MAAM0sB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,2BACxBja,EAAYymC,EAAMpoC,KAAK,cAC7B,IAAIuxC,EAAapkB,KACjB,MAAMvB,EAAQ9mB,EAAE3F,MAAMyK,KAAK,KA77TN8P,MA+7TjB63B,EAAWrkC,SAASvL,IAEtB4vC,EAAaA,EAAW3mC,OAAOyV,GAAKA,IAAM1e,GAC1CymC,EAAMpsB,YAAY,gBAClB4P,EAAM5P,YAAY,gBAAgBgQ,SAAS,YAG3CulB,EAAW1xC,KAAK8B,GAChBymC,EAAMpc,SAAS,gBACfJ,EAAM5P,YAAY,UAAUgQ,SAAS,iBAx8TlBtS,EA28TJ63B,EA38TSjoC,GAAMS,IAAIpD,EAA2B+S,GA48T/DiQ,IACF,GAGA,MAAMopB,EAAQ/I,EAAOpgC,KAAK,uBAC1B,IAAIopC,EAAY,CACdnM,YAAY,EACZoM,QAAS,KACTC,MAAO,KACP1P,OAAQ,GAGV,MAAM2P,EAAiB,KACjBH,EAAUE,QACZjP,aAAa+O,EAAUE,OACvBF,EAAUE,MAAQ,MAEhBF,EAAUC,SACZnuC,EAAEkuC,EAAUC,SAASj3B,YAAY,gBAEnC+2B,EAAMnpC,KAAK,oCAAoCoS,YAAY,iCAC3Dg3B,EAAUnM,YAAa,EACvBmM,EAAUC,QAAU,MAGhBG,EAAYhL,IAChB4K,EAAUnM,YAAa,EACvBmM,EAAUC,QAAU7K,EAAM,GAC1BA,EAAMpc,SAAS,iBA+BjB+mB,EAAM,GAAGpN,iBACP,cACA,SAAU3kC,GACR,MAAMqyC,EAASryC,EAAEsQ,OAAOsK,QAAQ,0BAChC,IAAKy3B,EAAQ,OAEbryC,EAAEmc,iBACF,MAAMirB,EAAQtjC,EAAEuuC,GAAQz3B,QAAQ,2BAChCo3B,EAAUxP,OAASxiC,EAAEyiC,QACrB2P,EAAUhL,GACViL,EAAOvO,kBAAkB9jC,EAAE+jC,UAC7B,EACA,CAAEe,SAAS,IAIbiN,EAAM,GAAGpN,iBAAiB,cAAe,SAAU3kC,GACjD,MAAMJ,EAAOI,EAAEsQ,OAAOsK,QAAQ,2BAC9B,IAAKhb,EAAM,OAEX,GAAII,EAAEsQ,OAAOsK,QAAQ,iDAAkD,OAEvEo3B,EAAUxP,OAASxiC,EAAEyiC,QACrB,MAAM2E,EAAQtjC,EAAElE,GAEhBoyC,EAAUE,MAAQ12B,WAAW,KAC3B42B,EAAUhL,IACT,IACL,GAGA2K,EAAM,GAAGpN,iBACP,cACA,SAAU3kC,GAOR,GALIgyC,EAAUE,OAASnzB,KAAKikB,IAAIhjC,EAAEyiC,QAAUuP,EAAUxP,QAAU,IAC9DS,aAAa+O,EAAUE,OACvBF,EAAUE,MAAQ,OAGfF,EAAUnM,aAAemM,EAAUC,QAAS,OACjDjyC,EAAEmc,iBAGF,MAAMpK,EAAQggC,EAAMnpC,KAAK,2BAA2BonC,IAAI,iBACxD,IAAIsC,EAAa,KACbC,GAAe,EAEnBxgC,EAAMwe,KAAK,WACT,MAAM4T,EAAOhmC,KAAKimC,wBACZ/D,EAAO8D,EAAK1Z,IAAM0Z,EAAKrS,OAAS,EAElC9xB,EAAEyiC,QAAUpC,IAASiS,GACvBA,EAAan0C,KACbo0C,GAAe,GACNvyC,EAAEyiC,SAAW0B,EAAK1Z,KAAOzqB,EAAEyiC,SAAW0B,EAAKvS,SACpD0gB,EAAan0C,KACbo0C,EAAevyC,EAAEyiC,QAAUpC,EAE/B,GAGA0R,EAAMnpC,KAAK,oCAAoCoS,YAAY,iCACvDs3B,GAAcA,IAAeN,EAAUC,SACzCnuC,EAAEwuC,GAAYtnB,SAASunB,EAAe,iBAAmB,iBAE7D,EACA,CAAEzN,SAAS,IAIbiN,EAAM,GAAGpN,iBAAiB,YAnGP,KACjB,IAAKqN,EAAUnM,aAAemM,EAAUC,QAEtC,YADAE,IAIF,MAAMK,EAAW1uC,EAAEkuC,EAAUC,SACvBQ,EAAUV,EAAMnpC,KAAK,oCAAoCkK,QAE/D,GAAI2/B,EAAQ/zC,QAAU+zC,EAAQ,KAAOT,EAAUC,QAAS,CAClDQ,EAAQ33B,SAAS,kBACnB03B,EAASD,aAAaE,GAEtBD,EAASE,YAAYD,GAIvB,MAAME,EAAW,GACjBZ,EAAMnpC,KAAK,2BAA2B2nB,KAAK,WACzCoiB,EAAS9zC,KAAKiF,EAAE3F,MAAMa,KAAK,cAC7B,GACA2sB,GAAegnB,EACjB,CAEAR,MA4EFJ,EAAM,GAAGpN,iBAAiB,gBAAiBwN,GAG3CJ,EAAM,GAAGpN,iBACP,YACA,SAAU3kC,GACJgyC,EAAUnM,YACZ7lC,EAAEmc,gBAEN,EACA,CAAE2oB,SAAS,IAIbkE,EAAOpgC,KAAK,gBAAgB2nB,KAAK,WAC/B,MAAMqiB,EAAW9uC,EAAE3F,MACb+I,EAAK0rC,EAAS5zC,KAAK,MACnB8I,EAAM6W,SAASi0B,EAAS5zC,KAAK,QAC7B+I,EAAM4W,SAASi0B,EAAS5zC,KAAK,QAC7B6zC,EAAOl0B,SAASi0B,EAAS5zC,KAAK,SAC9Bic,EAAS23B,EAAShqC,KAAK,sBAEvBkqC,EAAcz6B,IAClBA,EAAS0G,KAAKhX,IAAID,EAAKiX,KAAKjX,IAAIC,EAAKsQ,IACrC,MAAM06B,EAAc,iBAAP7rC,EAAwB,GAAK,KAC1C+T,EAAOpH,KAAKwE,EAAS06B,GAGV,cAAP7rC,GACFpD,EAAE,gBAAgByX,IAAI,mBAAoBlD,EAAS,MACnDsxB,GAAW,CAAEngB,UAAWnR,KACR,kBAAPnR,GACTpD,EAAE,gBAAgByX,IAAI,kBAAmBlD,EAAS,MAClDsxB,GAAW,CAAElgB,SAAUpR,KACP,iBAAPnR,GACTpD,EAAE,iDAAiDyX,IAAI,sBAAuBlD,EAAS,MACvFsxB,GAAW,CAAE1f,eAAgB5R,KACb,iBAAPnR,GACTyiC,GAAW,CAAEhgB,aAActR,KAIzB26B,EAAkB,KACtB,MAAMn/B,EAAOoH,EAAOpH,OAAOpQ,QAAQ,SAAU,IAC7C,OAAOkb,SAAS9K,IAAS/L,GAG3B8qC,EAAShqC,KAAK,oBAAoB6R,GAAG,QAAS,WAC5Cq4B,EAAYE,IAAoBH,EAClC,GAEAD,EAAShqC,KAAK,oBAAoB6R,GAAG,QAAS,WAC5Cq4B,EAAYE,IAAoBH,EAClC,EACF,GAGA7J,EAAOvuB,GAAG,QAAS,mBAAoB,SAAUza,GAC/CA,EAAE0a,kBACF,MAAM20B,EAAUvrC,EAAE3F,MACZipC,EAAQiI,EAAQz0B,QAAQ,6BACxB/P,EAASu8B,EAAMpoC,KAAK,WACpB4rB,EAAQykB,EAAQzmC,KAAK,KACrBqqC,EAAoB5D,EAAQv0B,SAAS,UAG3C9R,EAAsB4B,kBAAkBC,GAASooC,GAG7CA,GACF5D,EAAQr0B,YAAY,UACpB4P,EAAM5P,YAAY,gBAAgBgQ,SAAS,iBAC3Coc,EAAMpc,SAAS,cAEfqkB,EAAQrkB,SAAS,UACjBJ,EAAM5P,YAAY,iBAAiBgQ,SAAS,gBAC5Coc,EAAMpsB,YAAY,YAEtB,GAGAguB,EAAOvuB,GAAG,QAAS,mBAAoB,SAAUza,GAC/CA,EAAE0a,kBACF,MAAM7P,EAAS/G,EAAE3F,MAAMa,KAAK,WACtBooC,EAAQtjC,EAAE3F,MAAMyc,QAAQ,6BAE1BmZ,QAAQ,mBACN/qB,EAAsBoC,iBAAiBP,IACzCu8B,EAAM8L,QAAQ,IAAK,WACjBpvC,EAAE3F,MAAMuX,QACV,EAGN,GAGAszB,EAAOvuB,GAAG,QAAS,sBAAuB,SAAUza,GAClDA,EAAE0a,kBACF,MAAMiQ,EAAO7mB,EAAE3F,MACT0M,EAAS8f,EAAK3rB,KAAK,WACnBi0C,EAAoBtoB,EAAK7P,SAAS,UAEpC9R,EAAsB+B,oBAAoBF,GAASooC,KACjDA,EACFtoB,EAAK3P,YAAY,UAAUjI,KAAK,QAAS,iBAEzC4X,EAAKK,SAAS,UAAUjY,KAAK,QAAS,UAG5C,GAGA,MAAMogC,EAAkB,KACtBnqC,EAAsBC,aACtB,MAAMG,EAAQJ,EAAsBuB,cACpC,IAAImR,EAAO,GACXtS,EAAMzJ,QAAQgL,IACZ,MAAM+C,EAAWrH,EAAesE,EAAKlD,WAAa,CAAElB,KAAMoE,EAAKlD,SAAUhB,KAAM,eACzE6lC,EAAiC,UAAnB5+B,EAASlH,MACvBuqC,EAAepmC,EAAKrD,UAC1BoU,GAAQ,oDACiC/Q,EAAKvD,QAAU,GAAK,6BAA6B9D,EAAWqH,EAAKzD,6DAC7D5D,EAAWoK,EAASnH,QAAQ+lC,EAAc,QAAU,0CACtE5+B,EAASjH,qHAGDnD,EAAWqH,EAAKpE,2DACdjD,EAAWqH,EAAKpD,eAAeoD,EAAKnD,aAAe,IAAMlE,EAAWqH,EAAKnD,cAAgB8kC,EAAc,QAAU,4EAEjHyE,EAAe,SAAW,qBAAqBztC,EAAWqH,EAAKzD,eAAe6pC,EAAe,SAAW,6GAC3GpmC,EAAKvD,QAAU,SAAW,4DACjCuD,EAAKvD,QAAU,eAAiB,wGAEP9D,EAAWqH,EAAKzD,oFAGtE8hC,EAAOpgC,KAAK,0BAA0B8S,KAAKA,IAI7CstB,EAAOpgC,KAAK,kBAAkB6R,GAAG,SAAU,WACrCrS,EAAcU,gBAAgBhF,EAAE3F,MAAM6F,QACxCmvC,GAEJ,GAGAnK,EAAOpgC,KAAK,mBAAmB6R,GAAG,QAAS,WACzC,MAAM/Q,EAAStB,EAAcK,kBAC7B,IAAKiB,EAAQ,OACb,MAAMP,EAAYf,EAAcmB,gBAAgBG,EAAOxC,IACnDiC,IACF6/B,EACGpgC,KAAK,kBACLkT,OAAO,kBAAkBxY,EAAW6F,EAAUjC,QAAQ5D,EAAW6F,EAAU5C,kBAC9EyiC,EAAOpgC,KAAK,kBAAkB5E,IAAImF,EAAUjC,IAAI7C,QAAQ,UAE5D,GAGA2kC,EAAOpgC,KAAK,mBAAmB6R,GAAG,QAAS,WACzC,MAAMlU,EAAO6sC,OAAO,YAAa,QACjC,IAAK7sC,GAAMtC,OAAQ,OACnB,MAAMkF,EAAYf,EAAcc,aAAa3C,EAAKtC,QAC9CkF,IACF6/B,EACGpgC,KAAK,kBACLkT,OAAO,kBAAkBxY,EAAW6F,EAAUjC,QAAQ5D,EAAW6F,EAAU5C,kBAC9EyiC,EAAOpgC,KAAK,kBAAkB5E,IAAImF,EAAUjC,IAAI7C,QAAQ,UAE5D,GAGA2kC,EAAOpgC,KAAK,mBAAmB6R,GAAG,QAAS,WACzC,MAAM/Q,EAAStB,EAAcK,kBACxBiB,IACa,YAAdA,EAAOxC,GAIN6sB,QAAQ,UAAUrqB,EAAOnD,YAC1B6B,EAAcqB,aAAaC,EAAOxC,MACpC8hC,EAAOpgC,KAAK,gCAAgCc,EAAOxC,QAAQwO,SAC3DszB,EAAOpgC,KAAK,kBAAkB5E,IAAI,WAAWK,QAAQ,WANjDqO,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,YAQ7C,GAGA0d,EAAOpgC,KAAK,sBAAsB6R,GAAG,QAAS,WAC5C,MAAM/Q,EAAStB,EAAcK,kBAC7B,IAAKiB,EAAQ,OACb,MAAMM,EAAO5B,EAAc0B,aAAaJ,EAAOxC,IAC3C8C,GACFwgB,UAAUD,UACP8oB,UAAUrpC,GACV63B,KAAK,QACLyR,MAAM,KACLF,OAAO,UAAWppC,IAG1B,GAGAg/B,EAAOpgC,KAAK,sBAAsB6R,GAAG,QAAS,WAC5C,MAAMzQ,EAAOopC,OAAO,cACpB,IAAKppC,GAAM/F,OAAQ,OACnB,MAAMkF,EAAYf,EAAc2B,aAAaC,EAAK/F,QAC9CkF,GACF6/B,EACGpgC,KAAK,kBACLkT,OAAO,kBAAkBxY,EAAW6F,EAAUjC,QAAQ5D,EAAW6F,EAAU5C,kBAC9EyiC,EAAOpgC,KAAK,kBAAkB5E,IAAImF,EAAUjC,IAAI7C,QAAQ,WAEpDqO,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,aAE3C,GAGA++B,EAAOpgC,KAAK,qBAAqB6R,GAAG,QAAS,WACtCsZ,QAAQ,wCACT3rB,EAAciC,qBAE4B,YAAxCjC,EAAcK,mBAAmBvB,IACnCisC,IAGEzgC,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,QAE3C,GAGA++B,EAAOpgC,KAAK,4BAA4B6R,GAAG,QAAS,WAClDsxB,GAA2B/C,EAC7B,GAGA,MAAMN,EAAc,KAClBvhB,IAAiB,EACjB6hB,EAAOtzB,SACPiT,MAEFqgB,EAAOvuB,GAAG,QAAS,oDAAqDiuB,GACxEM,EAAOvuB,GAAG,QAAS,SAAUza,GACvB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,qBAAqB4tB,GAChD,IAGI/f,GAAkB,KAEtB,GAAIxB,GAAgB,OACC4jB,YAAYxqC,MAAjC,MACM,GAAQ+nB,KAGd,IAAKhB,IAAYxjB,EAAE,SAASpF,OAAQ,CAClC,MAAM60C,EAAQzvC,EAAE,SAChB,IAAI0vC,GAAe,EAqBnBlsB,GAAW,IAAImsB,iBApBQ,KACjBD,IACJA,GAAe,EACflK,sBAAsB,KAEpB,GAA4B,aADb3tB,KACJmO,aAET,YADA0pB,GAAe,GAGjB,MACME,EADWH,EAAMI,WACI1gC,OAAO,GAC5B2gC,EAAU9vC,EAAE,gBAAgB,GAC9B8vC,GAAWF,GAAaA,IAAcE,IACpC9vC,EAAE4vC,GAAW54B,SAAS,QAAUhX,EAAE4vC,GAAW54B,SAAS,kBACxDy4B,EAAMz3B,OAAO83B,GAGjBJ,GAAe,OAInBlsB,GAASusB,QAAQN,EAAM,GAAI,CAAEO,WAAW,GAC1C,CACA,IAAInnC,EACJ,GAAI6a,IAAqBhU,GACvB7G,EAAU6G,OACL,CAIL,GAHA7G,EAAU8G,KAGN9G,EAAS,CACX,IAAIonC,GAAiB,EACrB,IAAK,MAAMlnC,KAAWF,EAAS,CAC7B,IAAKE,EAAQjO,WAAW,UAAW,SACnC,MAAM6P,EAAQ9B,EAAQE,GACtB,IAAK4B,IAAUA,EAAMlI,OAASkI,EAAM3B,QAAS,SAE7C,MAAMoD,EAASvS,EAAY0E,WAAWoM,EAAMlI,KAAMkI,EAAM3B,SACpDoD,EAAO1N,WACTuxC,GAAiB,GAEf7jC,EAAOzN,SAAS/D,MAEtB,CAGF,CACA,GAAIiO,EAAS,CACX6G,GAC6B,mBAApBwgC,gBAAiCA,gBAAgBrnC,GAAW1N,KAAKC,MAAMD,KAAKwB,UAAUkM,IAE/F,MAAMsnC,EAAmB7rB,KACnByD,EAAaztB,KAGb81C,EACJD,GAAoBlyC,OAAOC,KAAKiyC,GAAkB/oC,KAAK4M,GAAKA,EAAElZ,WAAW,WAEtEq1C,GAAqBC,EAGdD,EAAiBnoB,WAGlBmoB,EAAiBnoB,aAAeD,IAEzCrY,GAAcsY,WAAaD,EAC3BE,GAAavY,KAJbuY,GAAa,IAAKkoB,EAAkBnoB,WAAYD,IAHhDE,GAAa,IAAKvY,GAAesY,WAAYD,GAUjD,CACF,CAEA,MAAMsoB,EAAerwC,EAAE,qBACvB,GAAIA,EAAE,gBAAgBpF,QAAUy1C,EAAa7E,GAAG,WAC1C3iC,EAAS,CACNsa,KAAUG,GAAiByiB,GAAgBl9B,IAChD,MAAMg/B,EAASD,GAAgB/+B,GACzBynC,EAAY7oB,KACZ8oB,EAAiBD,GAAazI,EAAOyI,GAAaA,EAAY,KAEpE,GAAIC,GAAkB1I,EAAO0I,GAAiB,CAC5C,MAAMC,EAAUC,GAAmB5I,EAAO0I,GAAiBA,GACrDG,EAAc1wC,EAAE,SAAS4X,KAAK44B,GAMpC,OALAxwC,EAAE,kBAAkB2wC,YAAYD,EAAY5rC,KAAK,mBACjD9E,EAAE,oBAAoB4X,KAAK84B,EAAY5rC,KAAK,oBAAoB8S,QAEhErB,GAAWsxB,QACX+I,IAEF,CACF,CAGF,IAAIC,EAAc,EACdC,EAAc,EAElB,MAAMC,EAAc/wC,EAAE,sBAClB+wC,EAAYn2C,SACdi2C,EAAcE,EAAYC,aAC1BF,EAAcC,EAAYE,aAG5BjxC,EAAE,gBAAgB4R,SAClB,MAAMi2B,EAASD,GAAgB/+B,GAAW,CAAC,GAGzCya,GADEH,GACe,IAAII,IAEJwiB,GAAgBl9B,GAGnC,MAAM2jC,EAAa5kB,KACnB,IAAIspB,EAAejzC,OAAOC,KAAK2pC,GAC3B2E,IACF0E,EAAe1E,EAAW1mC,OAAOyV,GAAKssB,EAAOtsB,IAAI41B,OAAOD,EAAaprC,OAAOyV,IAAMixB,EAAWpkC,SAASmT,MAExG,MAAMkxB,EAAapkB,KACnB6oB,EAAeA,EAAaprC,OAAOyV,IAAMkxB,EAAWrkC,SAASmT,IAE7D,MAAM+0B,EAAY7oB,KAClB,IAAI8oB,EAAiBD,GAAazI,EAAOyI,KAAe7D,EAAWrkC,SAASkoC,GAAaA,EAAY,KAErG,MAAM1sC,EAASiU,KACTu5B,EA3+UwB5sC,GAAMC,IAAIhD,GAA0B,GA6+U5D4vC,EAAgC,aAAlBztC,EAAO0hB,OAAwB,sBAAwB,GAErEV,EAAgB,YAAYhhB,EAAOoiB,cAAgB,UAGzD,IAAIsrB,EAAgB1tC,EAAOmiB,YAC3B,GAAsB,SAAlBurB,EAA0B,CAC5B,MAAM/1B,EAAI21B,EAAat2C,OAEvB,GAAI2gB,GAAK,EACP+1B,EAAgB/1B,EAAI,EAAI,EAAIA,MACvB,CACL,MAAMg2B,EAA4B,EAAnBt2B,KAAKu2B,KAAKj2B,EAAI,GAASA,EAEtC+1B,EADkC,EAAnBr2B,KAAKu2B,KAAKj2B,EAAI,GAASA,GACZg2B,EAAS,EAAI,CACzC,CACF,CAGA,IAAIE,EAAa,GACbC,EAAoB,KAExB,IAA+B,IAA3B9tC,EAAOqiB,gBAA2B,CACpC,MAAM0rB,EAAe,GAMrB,GALA1zC,OAAOC,KAAK2pC,GAAQhsC,QAAQmY,IACtBA,EAAE5L,SAAS,OAAOupC,EAAa52C,KAAK8sC,EAAO7zB,MAI7C29B,EAAa/2C,OAAS,EAAG,CAC3B,MAAMg3C,EAAcptC,GAAMC,IAAI,qBAAqB,GAInD,IAAIotC,EAAc,2JAHFD,EAAc,eAAiB,uMAC9BA,EAAc,QAAU,4CASrCE,GAAU,EAEVC,EAAe,GAEnBJ,EAAa91C,QAAQm2C,IACfA,EAAMrzB,MACRqzB,EAAMrzB,KAAK9iB,QAAQiB,IACjBA,EAAIjB,QAAQ,CAACopC,EAAM/nC,KACjB,GAAIA,EAAM,GAAK+nC,GAAQvlC,OAAOulC,GAAM9kC,OAAQ,CAC1C,MAAM8xC,EAAUvyC,OAAOulC,GAAM9kC,OAC7B0xC,GAAe,yCAAyCK,mBAAmBD,OAAazyC,EAAWyyC,cACnGF,EAAah3C,KAAKk3C,GAClBH,GAAU,CACZ,QAMJA,IACFL,EAAa,iCAAiCI,UAG9CH,EAAoBK,EAAa7wC,KAAK,QAAU0wC,EAAc,UAAY,SAE9E,CACF,CAGA,MAAMO,EAAgBT,IAAsB7tB,GACxCsuB,GAAuC,OAAtBT,IAEnB5tB,IAAqB,GAEvBD,GAAiB6tB,EAEjB,IAAI95B,EAAO,2BAA2BgN,eAA2BhhB,EAAOkU,SAASu5B,8BAAwCztC,EAAO8hB,gCAAgC9hB,EAAO+hB,mCAAmC/hB,EAAOuiB,gBAAkB,yBAAyBmrB,MAIhO,aAAxB1tC,EAAOoiB,cAA+ByrB,GAAc3tB,KACtDlM,GAAQ65B,GAIV,MAAMG,EAAcptC,GAAMC,IAAI,qBAAqB,GAC7C2tC,EAAYR,EAAc,2BAA6B,GAE7D,GAAIR,EAAa,CACf,MAAMiB,EAAgB,WAAWzuC,EAAO2hB,eAAiB,QAEnDA,EAAgBqsB,EAAc,2BAA6B,GAC3DU,EAAa,aAAa1uC,EAAO4hB,eAAiB,UACxD5N,GAAQ,oDACmCy6B,KAAiBC,iCAA0C/sB,2EACvCtnB,OAAOC,KAAK2pC,GAAQjtC,sDAGrF,KAAO,CAEL,MAAM23C,EAAchC,EAAiBroB,KAAkBqoB,GAAkB,KAEnEiC,EAAoBhuC,GAAMC,IAAI/C,GAA8B,GAC5D+wC,EAAuBjuC,GAAMC,IAAI,4BAA4B,GAGnEmT,GAAQ,kDAFgB46B,GAAqBC,GAAwBlC,EAGV,UAAY,MAAMgC,EAAc,kBAAoB,iCAAiCA,EAAc,UAAYA,EAAc,MAAQ,MAAMH,4BAEtLK,EACIC,GAAmB7pC,GACnB2pC,EACEG,GAAgB9K,GAChB0I,EACEE,GAAmB5I,EAAO0I,GAAiBA,GAC3C,+CAOxB,MAAMqC,EAAe,iCAAiCtB,WAEtD15B,GAAQ,mDAC6D,QAA3BhU,EAAOkiB,gBAA4B,cAAgB,+BAA+BssB,KAAaQ,2JAKzI,MAAMC,EAAkBruC,GAAMC,IAAI,4BAA4B,GACxDquC,EAAkBtuC,GAAMC,IAAInC,GAA6B,GAC/D,IAAIywC,EAAe,EACfC,EAAuB,EAC3B,GAAInqC,EAAS,CACX,MAAMhL,EAAWymB,KACjB,GAAIzmB,EAAU,CACZ,IAAK,MAAMkL,KAAWF,EAAS,CAC7B,IAAKE,EAAQjO,WAAW,UAAW,SACnC,MAAMgP,EAAWjB,EAAQE,GACnBc,EAAWhM,EAASkL,GAC1B,IAAKe,GAAUd,QAAS,SACxB,MAAMo9B,EAAUt8B,EAASd,QAAQpN,MAAM,GACjCyqC,EAAUx8B,GAAUb,SAASpN,MAAM,IAAM,GAC/CwqC,EAAQvqC,QAAQ,CAACiB,EAAKmN,KACpB,MAAMq8B,EAASD,EAAQp8B,GAClBq8B,EAILxpC,EAAIjB,QAAQ,CAACopC,EAAM9lC,KACF,IAAXA,GACAO,OAAOulC,GAAQ,MAAQvlC,OAAO4mC,EAAOnnC,IAAW,KAAK4zC,MALzDA,MAQA1M,EAAQzrC,OAASwrC,EAAQxrC,SAAQm4C,GAAgB1M,EAAQzrC,OAASwrC,EAAQxrC,OAChF,CACA,IAAK,MAAMmO,KAAWlL,EAChBkL,EAAQjO,WAAW,YAAc+N,EAAQE,IAAUgqC,GAE3D,CAEAC,EAAuBnrC,EAAiBsD,cAActC,EACxD,CAEA,MACMoqC,EADmBH,EACeE,EAAuBD,EAEzDG,EAHmBJ,GAGmBE,EAAuB,EAG7DG,EAAgB9qB,KAChB+qB,EAAgBxrB,MAAwB,GAGxCyrB,EAAoB,CACxB,CAAEx4C,IAAK,WAAY8H,KAAM,cAAeod,MAAO,KAAM3c,GAAI,mBAAoBkwC,WAAY,oBACzF,CACEz4C,IAAK,cACL8H,KAAM,kBACNod,MAAO,MAAKkzB,EAAe,EAAI,IAAMA,EAAe,IAAM,IAC1D7vC,GAAI,kBACJkwC,WAAY,mBAAkBJ,EAAkB,yBAA2B,IAC3Eh9B,SAAU28B,EACVU,YAAaL,GAEf,CACEr4C,IAAK,UACL8H,KAAM,iBACNod,MAAO,KACP3c,GAAI,cACJkwC,WAAY,cACZE,eAAgB,IAAMxgC,EAAUE,cAChCgD,SAAUuR,OAAwBzU,EAAUC,YAKhD,IAAIwgC,EAAc,GAqBlB,GAlBAJ,EAAkBx3C,QAAQC,IACpBA,EAAK03C,iBAAmB13C,EAAK03C,kBAC7BL,EAAc/qC,SAAStM,EAAKjB,MAChC44C,EAAY14C,KAAK,IAAKe,EAAM8wC,WAAW,MAIzCsE,EAAar1C,QAAQ4G,IACnBgxC,EAAY14C,KAAK,CACfF,IAAK4H,EACLE,KAAMwkB,GAAoB1kB,GAC1Bsd,MAAOtd,EACPmqC,WAAW,EACX12B,UAAWs8B,IAAsBK,GAAmBtC,IAAmB9tC,MAKvE2wC,EAAcx4C,OAAS,EAAG,CAC5B,MAAMiyC,EAAW,IAAInhC,IAAI0nC,EAAcn4C,IAAI,CAAC+Y,EAAGtZ,IAAM,CAACsZ,EAAGtZ,KACzD+4C,EAAYj4C,KAAK,CAACC,EAAGC,KACNmxC,EAAS3/B,IAAIzR,EAAEZ,KAAOgyC,EAASpoC,IAAIhJ,EAAEZ,KAAO,OAC5CgyC,EAAS3/B,IAAIxR,EAAEb,KAAOgyC,EAASpoC,IAAI/I,EAAEb,KAAO,MAG7D,CAIA+c,GAAQ,gDAAgD46B,EAAoB,SAAW,+IAKvFiB,EAAY53C,QAAQ,CAACC,EAAMoB,KACzB,MAAMw2C,EAAc53C,EAAKoa,SAAW,SAAW,GACzCo9B,EAAax3C,EAAKw3C,YAAc,GAChCK,EAAWz2C,EAAM,EAEvB,GAAIpB,EAAK8wC,UAAW,CAElB,MAAMgH,EAAkB93C,EAAKy3C,YACzB,wEACA,GACJ37B,GAAQ,8BAA8B07B,KAAcI,UAAoB53C,EAAKsH,qBAAqBuwC,oDAC/D73C,EAAK6G,mBAAmBnD,EAAW1D,EAAKikB,gBAAgB6zB,kCAE7F,MAEEh8B,GAAQ,8BAA8B87B,kBAA4Bl0C,EAAW1D,EAAKjB,uBAAuB84C,oDACtE73C,EAAK6G,mBAAmBnD,EAAW1D,EAAKikB,iDAK/EnI,GAAQ,+EACRoL,GAAennB,QAAQ8wC,IACrB/0B,GAAQ,sCAAsC+0B,EAAIvpC,cAAcupC,EAAI1pB,6BAA6B0pB,EAAIhqC,wBAEvGiV,GAAQ,SAERA,GAAQ,QACV,CAEAA,GAAQ,SAER,MAAMi8B,EAAY7zC,EAAE,gBAQpB,GAPI6zC,EAAUj5C,OACZi5C,EAAUlD,YAAY/4B,GAEtBk8B,GAAiBl8B,GAIS,aAAxBhU,EAAOoiB,cAA+ByrB,GAAc3tB,GACtD,GAAIquB,EAEF4B,GAAyBtC,OACpB,CAGoB,IADPzxC,EAAE,mCACNpF,QAEZm5C,GAAyBtC,EAG7B,MACS7tC,EAAOoiB,aAEhBhmB,EAAE,mCAAmC4R,SAMvC2E,GAAWsxB,GACX+I,KACAhqB,KAEIpiB,GAAMC,IAAI,4BAA4B,IACxCuvC,KAGFt8B,WAAW,KACT,MAAMu8B,EAAcj0C,EAAE,sBAChBswC,EAAY7oB,KACZysB,EAAalwB,GAAkBssB,GAEjC2D,EAAYr5C,SAGVs5C,GACFD,EAAYhD,UAAUiD,EAAWvtB,KACjCstB,EAAYjD,WAAWkD,EAAWtmB,QAE9BkjB,EAAc,GAAGmD,EAAYhD,UAAUH,GACvCD,EAAc,GAAGoD,EAAYjD,WAAWH,IAI1CqD,GAAcA,EAAWC,OAC3Bl2C,OAAOC,KAAKg2C,EAAWC,OAAOt4C,QAAQhB,IACpC,MAAMo2C,EAAYiD,EAAWC,MAAMt5C,GAE7Bu5C,EAAeH,EAAYnvC,KAAK,iCAAiCjK,OACvE,GAAIu5C,EAAax5C,OAAQ,CACvB,MAAMic,EAAQu9B,EAAat9B,QAAQ,kBAEnCD,EAAMo6B,UAAUA,GAEhBp6B,EAAM/R,KAAK,kBAAkBmsC,UAAUA,EACzC,MAIL,IAIC8C,GAA2BM,IAC/B,MAAM,GAAQ7vB,KACdxkB,EAAE,mCAAmC4R,SAGrC,MAqBM+8B,EArBqB,MACzB,MACM2F,EADUt0C,EAAE,cACK8F,OAAO,WAC5B,MAAMyuC,EAAQv0C,EAAE3F,MAChB,MAA8B,SAA1Bk6C,EAAMtlC,KAAK,YAAqD,SAA5BslC,EAAMtlC,KAAK,eAA2BslC,EAAMv9B,SAAS,aAG9C,WAA3Cu9B,EAAMzvC,KAAK,cAAciL,OAAO5P,QAAwD,SAAjCo0C,EAAMtlC,KAAK,oBAG/B,IAAnCslC,EAAMzvC,KAAK,aAAalK,QACC,SAAzB25C,EAAM98B,IAAI,YAEhB,GACA,GAAsB,IAAlB68B,EAAO15C,OAAc,OAAO,KAEhC,MAAM45C,EAAaF,EAAOnlC,OACpBslC,EAAeD,EAAW1vC,KAAK,cACrC,OAAO2vC,EAAa75C,OAAS65C,EAAeD,GAG9BE,GAChB,GAAI/F,GAAWA,EAAQ/zC,OAAQ,CAC7B,MAAM+5C,EAAY98B,KACZrB,EAAaxW,EACjB,wDAAwD20C,EAAU78B,qCAAqC68B,EAAUxuB,gBAAkB,iBAErI3P,EAAWoB,KAAKy8B,GAChB1F,EAAQ32B,OAAOxB,EACjB,GAIIo6B,GAAmB,KACvB,MAAM,GAAQpsB,KAEdxkB,EAAE,QACC0W,IAAI,iBACJC,GAAG,gBAAiB,eAAgBvF,eAAgBlV,GACnDA,EAAEmc,iBACFnc,EAAE0a,kBAEF,MAAMhT,EAASiU,KACT3X,EAAM00C,mBAAmB50C,EAAE3F,MAAMa,KAAK,QAG5C,IAAK0I,EAAOsiB,sBAGV,OAFAtmB,EAAsBM,EAAK,eAC3BF,EAAE,kBAAkBmY,QAMtB,GAAIvJ,OAAOimC,aACT,IAEE,GAAIjmC,OAAOimC,aAAaC,mBAkBtB,aAjBMlmC,OAAOimC,aAAaC,mBACxB,CACE,CACEC,KAAM,OACNhrC,QAAS7J,IAGb,CAEE+W,QAAS,kBAKTrI,OAAOimC,aAAaG,oBAChBpmC,OAAOimC,aAAaG,aAAa,YAI7C,CAAE,MAAO76B,GACPne,QAAQG,KAAK,iCAAkCge,EACjD,CAIF,MAAM/K,EAAKR,OAAOS,aAAeT,OAAOC,QAAQQ,YAChD,GAAID,GAAMA,EAAG6lC,gCACX,IAEE,MACMC,EAAM,mBADIh1C,EAAIP,QAAQ,MAAO,QAAQA,QAAQ,KAAM,UAGnDw1C,QAAmB/lC,EAAG6lC,gCAAgCC,GAE5D,IAAKC,EAAWC,UAAYD,EAAWE,UAErC,kBADMjmC,EAAG6lC,gCAAgC,YAG3Cj5C,QAAQG,KAAK,sBAAuBg5C,EACtC,CAAE,MAAOh7B,GACPne,QAAQG,KAAK,sBAAuBge,EACtC,CAIF,MAAMm7B,EAAKt1C,EAAE,kBACb,GAAIs1C,EAAG16C,OAAQ,CACb06C,EAAGp1C,IAAIA,GACPo1C,EAAG/0C,QAAQ,SAASA,QAAQ,gBAEtB,IAAIqL,QAAQvF,GAAKqR,WAAWrR,EAAG,KACrC,MAAMkvC,EAAUv1C,EAAE,aAAa8F,OAAO,YACtC,GAAIyvC,EAAQ36C,OACV26C,EAAQ,GAAGnnB,YACN,CAEL,MAAMonB,EAAax1C,EAAEy1C,MAAM,UAAW,CAAEC,QAAS,GAAIC,MAAO,GAAIC,SAAS,IACzEN,EAAG/0C,QAAQi1C,EACb,CACF,CACF,IAGE1B,GAAmBl8B,IACvB,MAAM,GAAQ4M,KAMd,GAA4B,aALb3M,KAKJmO,aAA6B,CACtChmB,EAAE,gBAAgB4R,SAElB,MA6BM+8B,EA7BqB,MACzB,MACM2F,EADUt0C,EAAE,cACK8F,OAAO,WAC5B,MAAMyuC,EAAQv0C,EAAE3F,MAChB,GAA8B,SAA1Bk6C,EAAMtlC,KAAK,WAAuB,OAAO,EAC7C,GAAgC,SAA5BslC,EAAMtlC,KAAK,aAAyB,OAAO,EAC/C,GAAIslC,EAAMv9B,SAAS,WAAY,OAAO,EAEtC,GAAa,WADAu9B,EAAMzvC,KAAK,cAAciL,OAAO5P,OACtB,OAAO,EAC9B,GAA6B,SAAzBo0C,EAAM98B,IAAI,WAAuB,OAAO,EAC5C,MAAMo+B,EAAWtB,EAAMzvC,KAAK,aAC5B,GAAwB,IAApB+wC,EAASj7C,OAAc,OAAO,EAClC,MAAMkb,EAAc+/B,EAAS9lC,OAAO5P,OAC9B21C,EAAWD,EAAS/wC,KAAK,OAAOlK,OAAS,EAC/C,QAA2B,IAAvBkb,EAAYlb,SAAiBk7C,EAEnC,GAEA,GAAsB,IAAlBxB,EAAO15C,OAAc,OAAOoF,EAAE,SAGbA,EAAE,aAAawrC,GAAG,YAAcxrC,EAAE,kBAAkBwrC,GAAG,YAE5E,IAAIuK,EAAczB,EAAO15C,OAAS,EAClC,MAAM45C,EAAaF,EAAO0B,GAAGD,GACvBtB,EAAeD,EAAW1vC,KAAK,cACrC,OAAO2vC,EAAa75C,OAAS65C,EAAeD,GAG9BE,GAiBhB,YAhBI/F,EAAQ/zC,OACN+zC,EAAQ33B,SAAS,cAAgB23B,EAAQ33B,SAAS,OACR,IAAxC23B,EAAQ7pC,KAAK,gBAAgBlK,OAC/B+zC,EAAQ32B,OAAOJ,GAEf+2B,EAAQ7pC,KAAK,gBAAgB6rC,YAAY/4B,GAII,IAA3C5X,EAAE,SAAS8E,KAAK,gBAAgBlK,QAClC+zC,EAAQ32B,OAAOJ,GAInB5X,EAAE,QAAQgY,OAAOJ,GAGrB,CAIA,MAAM63B,EAAQzvC,EAAE,SACVi2C,EAAcj2C,EAAE,gBAElBi2C,EAAYr7C,OACdq7C,EAAYtF,YAAY/4B,GAEpB63B,EAAM70C,OACR60C,EAAMz3B,OAAOJ,GAEb5X,EAAE,QAAQgY,OAAOJ,IAKjB86B,GAAqB7pC,IACzB,MAAMhL,EAAWymB,KACX1gB,EAASiU,KAGTq+B,EAAmBrtC,EAAUhB,EAAiB4C,gBAAgB5B,GAAW,GAE/E,KAAKhL,GAAagL,GAEgB,IAA5BqtC,EAAiBt7C,QACnB,MAAO,ivBAiBX,MAAMu7C,EAAU,GAEhB,IAAK,MAAMptC,KAAWF,EAAS,CAC7B,IAAKE,EAAQjO,WAAW,UAAW,SACnC,MAAMgP,EAAWjB,EAAQE,GACnBc,EAAWhM,EAASkL,GAC1B,IAAKe,GAAUrH,OAASqH,GAAUd,QAAS,SAE3C,MAAMnM,EAAYiN,EAASrH,KACrB1F,EAAU+M,EAASd,QAAQ,IAAM,GACjCo9B,EAAUt8B,EAASd,QAAQpN,MAAM,GACjCyqC,EAAUx8B,GAAUb,SAASpN,MAAM,IAAM,GAkE/C,GA/DAwqC,EAAQvqC,QAAQ,CAACiB,EAAKmN,KACpB,MAAMq8B,EAASD,EAAQp8B,GAEvB,GAAKq8B,EAWE,CAEL,MAAM8P,EAAa,GAenB,GAdAt5C,EAAIjB,QAAQ,CAACopC,EAAM9lC,KACjB,GAAe,IAAXA,EAAc,OAClB,MAAMmV,EAAS5U,OAAO4mC,EAAOnnC,IAAW,IAClCoV,EAAS7U,OAAOulC,GAAQ,IAC1B3wB,IAAWC,GACb6hC,EAAWr7C,KAAK,CACdiP,SAAU7K,EACV2jB,OAAQ/lB,EAAQoC,IAAW,IAAIA,IAC/Bk3C,SAAU/hC,EACV+C,SAAU9C,MAKU,IAAtB6hC,EAAWx7C,OAAc,CAE3B,MAAM8vC,EAAI0L,EAAW,GACrBD,EAAQp7C,KAAK,CACXwS,KAAM,gBACN1Q,YACAy5B,SAAUvtB,EACVnK,SAAUqL,EACVD,SAAU0gC,EAAE1gC,SACZ8Y,OAAQ4nB,EAAE5nB,OACVuzB,SAAU3L,EAAE2L,SACZh/B,SAAUqzB,EAAErzB,SACZi/B,SAAUx5C,EAAI,IAAM,KAAKmN,EAAS,KAEtC,MAAWmsC,EAAWx7C,OAAS,GAE7Bu7C,EAAQp7C,KAAK,CACXwS,KAAM,eACN1Q,YACAy5B,SAAUvtB,EACVnK,SAAUqL,EACVlN,UACAD,MACAwpC,SACAiQ,cAAeH,EACfE,SAAUx5C,EAAI,IAAM,KAAKmN,EAAS,KAGxC,MAtDEksC,EAAQp7C,KAAK,CACXwS,KAAM,YACN1Q,YACAy5B,SAAUvtB,EACVnK,SAAUqL,EACVlN,UACAD,MACAmmB,MAAOnmB,EAAI,IAAM,KAAKmN,EAAS,QAmDjCo8B,EAAQzrC,OAASwrC,EAAQxrC,OAC3B,IAAK,IAAIF,EAAI0rC,EAAQxrC,OAAQF,EAAI2rC,EAAQzrC,OAAQF,IAAK,CACpD,MAAM4rC,EAASD,EAAQ3rC,GACvBy7C,EAAQp7C,KAAK,CACXwS,KAAM,cACN1Q,YACAy5B,SAAUvtB,EACVnK,SAAUlE,EACVqC,UACAD,IAAKwpC,EACLrjB,MAAOqjB,EAAO,IAAM,KAAK5rC,EAAI,KAEjC,CAEJ,CAGA,IAAK,MAAMqO,KAAWlL,EACpB,GAAKkL,EAAQjO,WAAW,YACnB+N,EAAQE,GAAU,CACrB,MAAMc,EAAWhM,EAASkL,GAC1BotC,EAAQp7C,KAAK,CACXwS,KAAM,gBACN1Q,UAAWgN,GAAUpH,MAAQsG,EAC7ButB,SAAUvtB,GAEd,CAIF,MAAMytC,EAAmBhyC,GAAMC,IAAInC,GAA6B,GAQhE,IAAIsV,EAAO,mKAJO4+B,EAAmB,mBAAqB,wDADvCA,EAAmB,OAAS,sHAW5BA,EAA+I,GAA5H,gNAC0CA,EAAmB,OAAS,+IAC9BA,EAAmB,SAAW,cAXxFA,EAAmB,YAAc,6DAYZA,EAAmB,yBAA2B,oaAmBvF,GATIA,IACF5+B,GAAQ,2HAKVA,GAAQ,qDAAuE,eAAlBhU,EAAO0hB,OAA0B,yBAA2B,OAGrHkxB,EACF,GAAgC,IAA5BN,EAAiBt7C,OACnBgd,GAAQ,iWAIH,CAEL,MAAM6+B,EAAgB5uC,EAAiBoD,mBAAmBirC,GACpDQ,EAAkBlyC,GAAMC,IAAI,kCAAmC,IAErEmT,GAAQ,iCAER,IAAK,MAAM/a,KAAa45C,EAAe,CACrC,MAAME,EAAcF,EAAc55C,GAC5Bu0C,EAAcsF,EAAgBtuC,SAASvL,GAE7C+a,GAAQ,iCAAiCw5B,EAAc,YAAc,2GACqB5xC,EAAW3C,uFACvDu0C,EAAc,QAAU,2IACnCjqB,GAAoBtqB,YAAoB2C,EAAW3C,2FACV85C,EAAY/7C,6GAEjCw2C,EAAc,gBAAkB,OAEvFuF,EAAY96C,QAAQsK,IAClB,MAAMywC,EAAWzwC,EAAMU,KACnBrH,EACErE,KAAKwB,UAAU,CACboK,OAAQZ,EAAMY,OACdpD,SAAUwC,EAAMxC,SAChB9G,UAAWsJ,EAAMtJ,UACjB+B,SAAUuH,EAAMvH,SAChBuL,WAAYhE,EAAMgE,YAAc,GAChCC,aAAcjE,EAAMiE,cAAgB,GACpCvD,KAAMV,EAAMU,QAGhB,GAEJ+Q,GAAQ,gGACmBpY,EAAW2G,EAAMtJ,mDACnBsJ,EAAMvH,oDACHY,EAAW2G,EAAMgE,YAAc,gDAC9B3K,EAAW2G,EAAMY,QAAU,kDACzBvH,EAAW2G,EAAMxC,UAAY,kDAC7BizC,uMAEcp3C,EAAW2G,EAAMgE,YAAc,QAAQhE,EAAMiE,aAAe,KAAK5K,EAAW2G,EAAMiE,aAAaxP,OAAS,GAAKuL,EAAMiE,aAAa+lB,UAAU,EAAG,IAAM,MAAQhqB,EAAMiE,gBAAkB,6EAC3K5K,EAAW2G,EAAMrC,aAAalJ,OAAS,GAAKuL,EAAMrC,aAAaqsB,UAAU,EAAG,IAAM,MAAQhqB,EAAMrC,uaAQvJ8T,GAAQ,cACV,CAEAA,GAAQ,QACV,MAGA,GAAuB,IAAnBu+B,EAAQv7C,OACVgd,GAAQ,mWAIH,CAEL,MAAMi/B,EAAiB,CAAC,EACxBV,EAAQt6C,QAAQ6uC,IACd,MAAM7vC,EAAM6vC,EAAE7tC,UACTg6C,EAAeh8C,KAAMg8C,EAAeh8C,GAAO,IAChDg8C,EAAeh8C,GAAKE,KAAK2vC,KAG3B9yB,GAAQ,iCAER,MAAM8+B,EAAkBlyC,GAAMC,IAAI,+BAAgC,IAElE,IAAK,MAAM5H,KAAag6C,EAAgB,CACtC,MAAMC,EAAeD,EAAeh6C,GAC9Bu0C,EAAcsF,EAAgBtuC,SAASvL,GAC7C+a,GAAQ,iCAAiCw5B,EAAc,YAAc,+EACP5xC,EAAW3C,uFAC3Bu0C,EAAc,QAAU,2IACnCjqB,GAAoBtqB,YAAoB2C,EAAW3C,+DACtCi6C,EAAal8C,6GAENw2C,EAAc,gBAAkB,OAEvF0F,EAAaj7C,QAAQk7C,IACnB,GAAoB,cAAhBA,EAAOxpC,KACTqK,GAAQ,wJAEwBm/B,EAAOzgB,0DACPygB,EAAOn4C,+JAEQY,EAAWu3C,EAAO9zB,skBAO5D,GAAoB,gBAAhB8zB,EAAOxpC,KAChBqK,GAAQ,4JAEwBm/B,EAAOzgB,0DACPygB,EAAOn4C,mNAE0DY,EAAWu3C,EAAO9zB,ybAM9G,GAAoB,kBAAhB8zB,EAAOxpC,KAA0B,CAC1C,MAAMypC,EAAWD,EAAOV,SAASz7C,OAAS,GAAKm8C,EAAOV,SAASlmB,UAAU,EAAG,IAAM,MAAQ4mB,EAAOV,SAC3FY,EAAWF,EAAO1/B,SAASzc,OAAS,GAAKm8C,EAAO1/B,SAAS8Y,UAAU,EAAG,IAAM,MAAQ4mB,EAAO1/B,SAGjG,IAAI6/B,EAEFA,EAHoBH,EAAOl6C,WAAak6C,EAAOl6C,UAAUuL,SAAS,MAGnD,GAAG5I,EAAWu3C,EAAOl6C,cAAc2C,EAAWu3C,EAAOj0B,UAErD,GAAGtjB,EAAWu3C,EAAOT,aAAa92C,EAAWu3C,EAAOj0B,UAGrElL,GAAQ,+JAEwBm/B,EAAOzgB,0DACPygB,EAAOn4C,0DACPm4C,EAAO/sC,0DACPkoC,mBAAmB6E,EAAOV,mKAEXa,oIAEA13C,EAAWw3C,GAAY,oJAEvBx3C,EAAWy3C,GAAY,qmBAQxE,MAAO,GAAoB,iBAAhBF,EAAOxpC,KAAyB,CAEzC,MAAM4pC,EAAaJ,EAAOR,cAAc37C,OAClCw8C,EAAaL,EAAOR,cACvB36C,MAAM,EAAG,GACTX,IAAIyrC,GAAKA,EAAE5jB,QACX5hB,KAAK,KACFm2C,EAAWF,EAAa,EAAI,KAAKA,KAAgB,GAEvDv/B,GAAQ,8JAEwBm/B,EAAOzgB,0DACPygB,EAAOn4C,kKAEQY,EAAWu3C,EAAOT,sFACZ92C,EAAW43C,KAAcC,2jBAOhF,KAA2B,kBAAhBN,EAAOxpC,OAChBqK,GAAQ,8JAEwBm/B,EAAOzgB,ooBAW3C1e,GAAQ,cACV,CAEAA,GAAQ,QACV,CAIF,OADAA,GAAQ,SACDA,GAGHo8B,GAAoB,KACxB,MAAM,GAAQxvB,KAGdxkB,EAAE,wBACC8W,QAAQ,qBACRhS,KAAK,kBACL4R,IAAI,SACJC,GAAG,QAAS,WACXnS,GAAMS,IAAI,4BAA4B,GACtCjF,EAAE,kBAAkBkX,YAAY,WAChClX,EAAE,gBAAgBkX,YAAY,SAChC,GAMFlX,EAAE,iDACC0W,IAAI,SACJC,GAAG,QAASvF,eAAgBlV,GAC3BA,EAAE0a,kBACF,MAAM0sB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,8BACxBja,EAAYymC,EAAMpoC,KAAK,SACvB0D,EAAWic,SAASyoB,EAAMpoC,KAAK,OAAQ,IACvCiP,EAAam5B,EAAMpoC,KAAK,UAExB2C,EAAWymB,KACjB,GAAKzmB,EAKL,IACE,MAAMgL,EAAU6G,IAAiBC,KACjC,IAAK,MAAM5G,KAAWF,EACpB,GAAIA,EAAQE,IAAUtG,OAAS5F,GAAagB,EAASkL,GAAU,CAC7D,MACM5J,GADU0J,EAAQE,GAASC,UAAU,IAAM,IAC1B7L,QAAQgN,GAC/B,GAAIhL,GAAU,GAAKtB,EAASkL,GAASC,UAAUpK,EAAW,GAAI,CAC5D,MAAMoqC,EAAgBnrC,EAASkL,GAASC,QAAQpK,EAAW,GAAGO,GAI9D,OAHA0J,EAAQE,GAASC,QAAQpK,EAAW,GAAGO,GAAU6pC,QAC3CrD,GAAmB98B,GAAS,GAAO,QACzCgc,IAEF,CACA,KACF,CAEEjW,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,cAC3C,CAAE,MAAOrN,GACPne,QAAQmK,MAAM,iBAAkBgU,GAC5BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,OACzC,MAxBMyI,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,WAyB7C,GAGFxnB,EAAE,+CACC0W,IAAI,SACJC,GAAG,QAAS,SAAUza,GACrBA,EAAE0a,kBACF,MAAM0sB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,8BACxB8/B,EAAWtT,EAAMpoC,KAAK,aAC5B,GAAK07C,EAIL,IACE,MAAMU,EAA6B,iBAAbV,EAAwBz7C,KAAKC,MAAMw7C,GAAYA,EAC/DzwC,EAAQ,CACZY,OAAQuwC,EAAOvwC,OACfpD,SAAU2zC,EAAO3zC,SACjBkD,KAAMywC,EAAOzwC,KACbhK,UAAWymC,EAAMpoC,KAAK,UAAYo8C,EAAOz6C,WAAa,GACtD+B,SAAUic,SAASyoB,EAAMpoC,KAAK,OAAQ,KAAOo8C,EAAO14C,UAAY,EAChEuL,WAAYm5B,EAAMpoC,KAAK,WAAao8C,EAAOntC,YAAc,GACzDC,aAAcktC,EAAOltC,cAAgB,GACrCG,SAAU+sC,EAAO/sC,UAAY+sC,EAAOzwC,MAAMpE,MAAQ,GAClDqB,aAAcwzC,EAAOxzC,cAAgBwzC,EAAOzwC,MAAM/C,cAAgB,IAEpEilC,GAAkB5iC,EACpB,CAAE,MAAOgU,GACPne,QAAQmK,MAAM,kBAAmBgU,GAC7BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,WACzC,MApBMyI,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,WAqB7C,GAGF,IAAI+vB,EAA+D,KAEnEv3C,EAAE,8BACC0W,IAAI,uCACJC,GAAG,aAAc,SAAUza,GAC1B,MAAMs7C,EAASt7C,EAAEu7C,cAA6B3W,QAAQ,GACtDyW,EAA8B,CAAErgB,EAAGsgB,EAAM/Y,QAAStH,EAAGqgB,EAAM7Y,QAC7D,GACChoB,GAAG,YAAa,SAAUza,GACzB,IAAKq7C,EAA6B,OAClC,MAAMC,EAASt7C,EAAEu7C,cAA6B3W,QAAQ,GAChDoB,EAASjnB,KAAKikB,IAAIsY,EAAM/Y,QAAU8Y,EAA4BrgB,GAC9D0J,EAAS3lB,KAAKikB,IAAIsY,EAAM7Y,QAAU4Y,EAA4BpgB,IAEhE+K,EAvFqB,IAuFYtB,EAvFZ,MAwFvB2W,EAA8B,KAElC,GACC5gC,GAAG,WAAY,SAAUza,GAExB,IAAKq7C,EAA6B,OAIlC,GAHAA,EAA8B,KAG1Bv3C,EAAE9D,EAAEsQ,QAAQsK,QAAQ,+CAA+Clc,OACrE,OAKF,GADyB4J,GAAMC,IAAInC,GAA6B,GAG9D,OAGF,MAAMzF,EAAYmD,EAAE3F,MAAMa,KAAK,SACzB0D,EAAWoB,EAAE3F,MAAMa,KAAK,OAG9BsJ,GAAMS,IAAI,4BAA4B,GACtCyiB,GAAmB7qB,GACnBgoB,KAGAnN,WAAW,KACT,MAAMggC,EAAc13C,EAAE,kCAAkCpB,OACpD84C,EAAY98C,SACd88C,EAAY,GAAGC,eAAe,CAAEC,SAAU,SAAUC,MAAO,WAC3DH,EAAYxwB,SAAS,uBACrBxP,WAAW,IAAMggC,EAAYxgC,YAAY,uBAAwB,OAElE,IACL,GACCP,GAAG,QAAS,SAAUza,GAGrB,GAAI8D,EAAE9D,EAAEsQ,QAAQsK,QAAQ,+CAA+Clc,OACrE,OAIF,GAAI,iBAAkBgU,OAAQ,OAI9B,GADyBpK,GAAMC,IAAInC,GAA6B,GAG9D,OAGF,MAAMzF,EAAYmD,EAAE3F,MAAMa,KAAK,SACzB0D,EAAWoB,EAAE3F,MAAMa,KAAK,OAG9BsJ,GAAMS,IAAI,4BAA4B,GACtCyiB,GAAmB7qB,GACnBgoB,KAGAnN,WAAW,KACT,MAAMggC,EAAc13C,EAAE,kCAAkCpB,OACpD84C,EAAY98C,SACd88C,EAAY,GAAGC,eAAe,CAAEC,SAAU,SAAUC,MAAO,WAC3DH,EAAYxwB,SAAS,uBACrBxP,WAAW,IAAMggC,EAAYxgC,YAAY,uBAAwB,OAElE,IACL,GAGFlX,EAAE,6BACC0W,IAAI,SACJC,GAAG,QAAS,SAAUza,GACrB,GAAI8D,EAAE9D,EAAEsQ,QAAQsK,QAAQ,oBAAoBlc,OAAQ,OAEpD,MAAMiC,EAAYmD,EAAE3F,MAAMa,KAAK,SACzBgyC,EAASltC,EAAE3F,MAAMyc,QAAQ,sBACzBq2B,EAAQD,EAAOpoC,KAAK,2BACpBgiB,EAAQ9mB,EAAE3F,MAAMyK,KAAK,sBAIrBgzC,EADmB93C,EAAE3F,MAAM2c,SAAS,+BACJ,kCAAoC,+BAC1E,IAAI0/B,EAAkBlyC,GAAMC,IAAIqzC,EAAY,IAExC5K,EAAOl2B,SAAS,cAClBk2B,EAAOh2B,YAAY,aACnBi2B,EAAMY,UAAU,KAChBjnB,EAAM5P,YAAY,oBAAoBgQ,SAAS,mBAC/CwvB,EAAkBA,EAAgB5wC,OAAOyV,GAAKA,IAAM1e,KAEpDqwC,EAAOhmB,SAAS,aAChBimB,EAAMa,QAAQ,KACdlnB,EAAM5P,YAAY,mBAAmBgQ,SAAS,oBACzCwvB,EAAgBtuC,SAASvL,IAC5B65C,EAAgB37C,KAAK8B,IAIzB2H,GAAMS,IAAI6yC,EAAYpB,EACxB,GAGF12C,EAAE,uCACC0W,IAAI,SACJC,GAAG,QAASvF,eAAgBlV,GAC3BA,EAAE0a,kBACF,MAAM0sB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,oBACxBihC,EAAazU,EAAMpoC,KAAK,eACxBo7B,EAAWgN,EAAMpoC,KAAK,aACtB0D,EAAW0kC,EAAMpoC,KAAK,aACtB8O,EAAWs5B,EAAMpoC,KAAK,aAEtB2C,EAAWymB,KACXzb,EAAU6G,IAAiBC,KAC5B9R,GAAagL,IAEC,kBAAfkvC,EAEEl6C,EAASy4B,IAAWttB,UAAUpK,EAAW,IAAMiK,EAAQytB,IAAWttB,UAAUpK,EAAW,KACzFf,EAASy4B,GAAUttB,QAAQpK,EAAW,GAAGoL,GAAYnB,EAAQytB,GAAUttB,QAAQpK,EAAW,GAAGoL,IAEvE,iBAAf+tC,EAELl6C,EAASy4B,IAAWttB,SAAWH,EAAQytB,IAAWttB,UAAUpK,EAAW,KACzEf,EAASy4B,GAAUttB,QAAQpK,EAAW,GAAK,IAAIiK,EAAQytB,GAAUttB,QAAQpK,EAAW,KAE9D,cAAfm5C,EAELlvC,EAAQytB,IAAWttB,UAAUpK,EAAW,KACrCf,EAASy4B,GAGZz4B,EAASy4B,GAAUttB,QAAQpK,EAAW,GAAK,IAAIiK,EAAQytB,GAAUttB,QAAQpK,EAAW,IAFpFf,EAASy4B,GAAYn7B,KAAKC,MAAMD,KAAKwB,UAAUkM,EAAQytB,MAKnC,gBAAfyhB,EAELl6C,EAASy4B,IAAWttB,UAAUpK,EAAW,IAC3Cf,EAASy4B,GAAUttB,QAAQvB,OAAO7I,EAAW,EAAG,GAE1B,kBAAfm5C,UAEFl6C,EAASy4B,GAGlBrO,GAAapqB,GAGbylC,EAAM8L,QAAQ,IAAK,WACjBpvC,EAAE3F,MAAMuX,SACRomC,IACF,GACF,GAGFh4C,EAAE,uCACC0W,IAAI,SACJC,GAAG,QAASvF,eAAgBlV,GAC3BA,EAAE0a,kBACF,MAAM0sB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,oBACxBihC,EAAazU,EAAMpoC,KAAK,eACxBo7B,EAAWgN,EAAMpoC,KAAK,aACtB0D,EAAW0kC,EAAMpoC,KAAK,aACtB8O,EAAWs5B,EAAMpoC,KAAK,aACtBm7C,EAAWzB,mBAAmBtR,EAAMpoC,KAAK,cAAgB,IAEzD2C,EAAWymB,KACjB,IAAIzb,EAAU6G,IAAiBC,KAC1B9R,GAAagL,IAEC,kBAAfkvC,EAEElvC,EAAQytB,IAAWttB,UAAUpK,EAAW,KAC1CiK,EAAQytB,GAAUttB,QAAQpK,EAAW,GAAGoL,GAAYqsC,GAE9B,iBAAf0B,EAELl6C,EAASy4B,IAAWttB,UAAUpK,EAAW,IAAMiK,EAAQytB,IAAWttB,UACpEH,EAAQytB,GAAUttB,QAAQpK,EAAW,GAAK,IAAIf,EAASy4B,GAAUttB,QAAQpK,EAAW,KAE9D,cAAfm5C,GAELlvC,EAAQytB,IAAWttB,UAAUpK,EAAW,IAC1CiK,EAAQytB,GAAUttB,QAAQvB,OAAO7I,EAAW,EAAG,SAK7CgsB,GAAa/hB,GAGnBy6B,EAAM8L,QAAQ,IAAK,WACjBpvC,EAAE3F,MAAMuX,SACRomC,IACF,GACF,GAGFh4C,EAAE,uBACC0W,IAAI,SACJC,GAAG,QAASvF,eAAgBlV,GAC3BA,EAAE0a,kBACF,MAAM0sB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,oBACxBihC,EAAazU,EAAMpoC,KAAK,eACxBo7B,EAAWgN,EAAMpoC,KAAK,aACtB0D,EAAW0kC,EAAMpoC,KAAK,aAEtB2C,EAAWymB,KACjB,IAAIzb,EAAU6G,IAAiBC,KAC/B,GAAK9R,GAAagL,EAAlB,CAEA,GAAmB,gBAAfkvC,GAEF,GAAIl6C,EAASy4B,IAAWttB,UAAUpK,EAAW,GAAI,CAC/C,MAAMq5C,EAAc,IAAIp6C,EAASy4B,GAAUttB,QAAQpK,EAAW,IACzDiK,EAAQytB,KACXztB,EAAQytB,GAAYn7B,KAAKC,MAAMD,KAAKwB,UAAUkB,EAASy4B,KACvDztB,EAAQytB,GAAUttB,QAAU,CAACnL,EAASy4B,GAAUttB,QAAQ,KAG1DH,EAAQytB,GAAUttB,QAAQvB,OAAO7I,EAAW,EAAG,EAAGq5C,EACpD,MACwB,kBAAfF,GAELl6C,EAASy4B,KACXztB,EAAQytB,GAAYn7B,KAAKC,MAAMD,KAAKwB,UAAUkB,EAASy4B,YAKrD1L,GAAa/hB,GAGnBy6B,EAAM8L,QAAQ,IAAK,WACjBpvC,EAAE3F,MAAMuX,SACRomC,IACF,EA3BiC,CA4BnC,GAGFh4C,EAAE,qEACC0W,IAAI,SACJC,GAAG,QAAS,SAAUza,GACrBA,EAAE0a,kBACF,MAAM0sB,EAAQtjC,EAAE3F,MAAMyc,QAAQ,oBACxBwf,EAAWgN,EAAMpoC,KAAK,aACtB0D,EAAW0kC,EAAMpoC,KAAK,aACtB68C,EAAazU,EAAMpoC,KAAK,eAE9B,IAAKo7B,QAAyBx3B,IAAbF,EAAwB,OAEzC,MAAMiK,EAAU6G,IAAiBC,KACjC,IAAK9G,IAAYA,EAAQytB,GAAW,OAEpC,MAAM3rB,EAAQ9B,EAAQytB,GAChBv5B,EAAU4N,EAAM3B,QAAU2B,EAAM3B,QAAQ,GAAK,GAC7ClM,EAAM6N,EAAM3B,QAAU2B,EAAM3B,QAAQpK,EAAW,GAAK,KAE1D,GAAK9B,EAML,GAAmB,iBAAfi7C,EAEFG,GAAwBp7C,EAAKC,EAAS4N,EAAMlI,MAAQ,KAAM7D,EAAU03B,QAC/D,GAAmB,kBAAfyhB,EAAgC,CACzC,MAAM/tC,EAAWs5B,EAAMpoC,KAAK,aACtBwnB,EAAa3lB,EAAQiN,IAAa,IAAIA,IACtCusB,EAAYz5B,EAAIkN,IAAa,GACnCmuC,GAA2B5hB,EAAW7T,EAAY/X,EAAMlI,KAAM7D,EAAUoL,EAAUssB,EACpF,MACE8hB,GAAoBt7C,EAAKC,EAAS4N,EAAMlI,MAAQ,KAAM7D,EAAU03B,QAd5D1nB,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,WAgB7C,GAGFxnB,EAAE,qBACC0W,IAAI,SACJC,GAAG,QAASvF,iBACX,MAAMvI,EAAU6G,IAAiBC,KAC5B9G,IAGLof,GAAa9sB,KAAKC,MAAMD,KAAKwB,UAAUkM,KACvCya,GAAiB,IAAIC,IAGrBy0B,KACF,GAGFh4C,EAAE,qBACC0W,IAAI,SACJC,GAAG,QAASvF,iBACX,MAAMvT,EAAWymB,KACjB,IAAKzmB,EAEH,YADI+Q,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,UAK3C,MAAM6wB,EAAel9C,KAAKC,MAAMD,KAAKwB,UAAUkB,IAC/C6R,GAAgB2oC,QACV1S,GAAmB0S,GAAc,GAAO,EAChD,GAGFr4C,EAAE,2BACC0W,IAAI,SACJC,GAAG,QAAS,WACX,MACM2hC,GADc9zC,GAAMC,IAAInC,GAA6B,GAE3DkC,GAAMS,IAAI3C,EAA6Bg2C,GAGvC,MAAMzvC,EAAU6G,IAAiBC,KACjC3P,EAAE,kBAAkB4X,KAAK86B,GAAmB7pC,IAC5CmrC,KAGAuE,GAAmB1vC,EACrB,GAGF7I,EAAE,wBACC8W,QAAQ,qBACRhS,KAAK,2BACL4R,IAAI,eACJC,GAAG,cAAe,SAAUza,GAC3B,GAAiB,IAAbA,EAAE6jC,OAAc,OACpB7jC,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAM23B,EAASl0C,KACfk0C,EAAOvO,kBAAkB9jC,EAAE+jC,WAC3BjgC,EAAEuuC,GAAQrnB,SAAS,UACnB,MAAMzQ,EAASzW,EAAE,kBACXw4C,EAAc/hC,EAAOuX,SACrB0Q,EAASxiC,EAAEyiC,QACX9hC,EAAYmD,EAAEuuC,GAAQrzC,KAAK,SAEjCqzC,EAAOnO,cAAgB,SAAUnB,GAC/B,MAAMnE,EAAKmE,EAAMN,QAAUD,EAC3B,IAAI+Z,EAAYD,EAAc1d,EAC1B2d,EAAY12C,IAAkB02C,EAAY12C,GAC1C02C,EAAYz2C,IAAkBy2C,EAAYz2C,GAC9CyU,EAAOgB,IAAI,SAAUghC,EAAY,KACnC,EACAlK,EAAOhO,YAAc,SAAUmY,GAC7B14C,EAAEuuC,GAAQr3B,YAAY,UACtBq3B,EAAO/N,sBAAsBkY,EAAIzY,WACjCsO,EAAOnO,cAAgB,KACvBmO,EAAOhO,YAAc,KAErB,MAAMoY,EAAcliC,EAAOuX,SACrB4qB,EAAU1wB,KAChB0wB,EAAQ/7C,GAAa87C,EACrBxwB,GAAiBywB,EACnB,CACF,GACCliC,IAAI,YACJC,GAAG,WAAY,SAAUza,GACxBA,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAM/Z,EAAYmD,EAAE3F,MAAMa,KAAK,SAChB8E,EAAE,kBACVyX,IAAI,SAAU,IAErB,MAAMmhC,EAAU1wB,YACT0wB,EAAQ/7C,GACfsrB,GAAiBywB,EACnB,GAGF,MAAMC,EAAsB74C,EAAE,+CAC1B64C,EAAoBj+C,SACtBi+C,EAAoB,GAAGhY,iBACrB,aACA,SAAU3kC,GACR7B,KAAKy+C,aAAe58C,EAAE4kC,QAAQ,GAAGrC,QACjCpkC,KAAK0+C,aAAe78C,EAAE4kC,QAAQ,GAAGnC,QACjCtkC,KAAK2+C,iBAAmB,IAC1B,EACA,CAAEhY,SAAS,IAGb6X,EAAoB,GAAGhY,iBACrB,YACA,SAAU3kC,GACR,IAAK7B,KAAKy+C,aAAc,OAExB,MAAM5W,EAASjnB,KAAKikB,IAAIhjC,EAAE4kC,QAAQ,GAAGrC,QAAUpkC,KAAKy+C,cAC9ClY,EAAS3lB,KAAKikB,IAAIhjC,EAAE4kC,QAAQ,GAAGnC,QAAUtkC,KAAK0+C,eAG/C1+C,KAAK2+C,mBAAqB9W,EAAS,GAAKtB,EAAS,KACpDvmC,KAAK2+C,iBAAmB9W,EAAStB,EAAS,aAAe,YAK7B,eAA1BvmC,KAAK2+C,kBAAqC9W,EAAS,IACrDhmC,EAAE0a,iBAEN,EACA,CAAEoqB,SAAS,IAGb6X,EAAoB,GAAGhY,iBACrB,WACA,WACExmC,KAAKy+C,aAAe,KACpBz+C,KAAK0+C,aAAe,KACpB1+C,KAAK2+C,iBAAmB,IAC1B,EACA,CAAEhY,SAAS,MAMXgX,GAAsB,KAC1B,MAAM,GAAQxzB,KACR3b,EAAU6G,IAAiBC,KACjC2T,GAAiByiB,GAAgBl9B,GAEjC,MAAM4N,EAASzW,EAAE,kBACbyW,EAAO7b,QAAU4J,GAAMC,IAAI,4BAA4B,KACzDgS,EAAOmB,KAAK86B,GAAmB7pC,IAC/BmrC,KAGAuE,GAAmB1vC,KAKjB0vC,GAAqB1vC,IACzB,MAAM,GAAQ2b,KACR3mB,EAAWymB,KACjB,IAAIyuB,EAAe,EAEnB,GAAIl1C,GAAYgL,EAAS,CACvB,IAAK,MAAME,KAAWF,EAAS,CAC7B,IAAKE,EAAQjO,WAAW,UAAW,SACnC,MAAMgP,EAAWjB,EAAQE,GACnBc,EAAWhM,EAASkL,GAC1B,IAAKe,GAAUd,QAAS,SACxB,MAAMo9B,EAAUt8B,EAASd,QAAQpN,MAAM,GACjCyqC,EAAUx8B,GAAUb,SAASpN,MAAM,IAAM,GAC/CwqC,EAAQvqC,QAAQ,CAACiB,EAAKmN,KACpB,MAAMq8B,EAASD,EAAQp8B,GAClBq8B,EAILxpC,EAAIjB,QAAQ,CAACopC,EAAM9lC,KACF,IAAXA,GACAO,OAAOulC,GAAQ,MAAQvlC,OAAO4mC,EAAOnnC,IAAW,KAAK4zC,MALzDA,MAQA1M,EAAQzrC,OAASwrC,EAAQxrC,SAAQm4C,GAAgB1M,EAAQzrC,OAASwrC,EAAQxrC,OAChF,CACA,IAAK,MAAMmO,KAAWlL,EAChBkL,EAAQjO,WAAW,YAAc+N,EAAQE,IAAUgqC,GAE3D,CAGA,MAAMC,EAAuBnqC,EAAUhB,EAAiBsD,cAActC,GAAW,EAG3E2tC,EAAmBhyC,GAAMC,IAAInC,GAA6B,GAC1D2wC,EAAeuD,EAAmBxD,EAAuBD,EAEzDG,EAAkBsD,GAAoBxD,EAAuB,EAE7DnsB,EAAO7mB,EAAE,oBACTi5C,EAAQpyB,EAAK/hB,KAAK,QACxBm0C,EAAMrhC,KAAKq7B,EAAe,EAAI,MAAMA,KAAkB,MAGlDC,GACGrsB,EAAK/hB,KAAK,yBAAyBlK,QACtCq+C,EAAMjhC,OAAO,0EAEf6O,EAAKK,SAAS,2BAEdL,EAAK/hB,KAAK,yBAAyB8M,SACnCiV,EAAK3P,YAAY,2BAIfkhC,GAAsB,CAACt7C,EAAKC,EAASF,EAAW+B,EAAU03B,KAC9D,MAAM,GAAQ9R,KACR5gB,EAASiU,KAETmtB,EAAaloC,EAChB7B,IAAI,CAACgqC,EAAM/nC,KACV,GAAY,IAARA,EAAW,MAAO,GACtB,MAAMwlB,EAAa3lB,EAAQG,IAAQ,KAAKA,IAClCgD,EAAM+kC,GAAQ,GACpB,MAAO,iNAE+GzlC,EAAWkjB,qGACjDxlB,2LACkEsC,EAAWU,oDAE9JgB,KAAK,IAEFgkC,EAASllC,EAAE,uGAEmC4D,EAAOkU,mEACNlZ,EAAW,OAAOY,EAAW3C,6IAE5DmoC,ibAStBhlC,EAAE,QAAQgY,OAAOktB,GAGjB,MAAMC,EAAeC,IAEnBA,EAAGlF,MAAMlS,OAAS,OAClB,MAAMqX,EAAgBD,EAAGE,aAAe,EAExCF,EAAGlF,MAAMlS,OAAS/S,KAAKjX,IAAIqhC,EADT,KACqC,KACvDD,EAAGlF,MAAMqF,UAAYF,EAFH,IAE+B,OAAS,UAI5DG,sBAAsB,KACpBN,EAAOpgC,KAAK,YAAY2nB,KAAK,WAC3B0Y,EAAa9qC,KACf,KAIF6qC,EAAOpgC,KAAK,YAAY6R,GAAG,QAAS,WAClCwuB,EAAa9qC,KACf,GACA6qC,EAAOpgC,KAAK,YAAY6R,GAAG,QAAS,WAClCwuB,EAAa9qC,KACf,GAEA,MAAMuqC,EAAc,KAClBvhB,IAAiB,EACjB6hB,EAAOtzB,UAETszB,EAAOpgC,KAAK,sBAAsBspB,MAAMwW,GACxCM,EAAOvuB,GAAG,QAAS,SAAUza,GACvB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,qBAAqB4tB,GAChD,GAEAM,EAAOpgC,KAAK,oBAAoBspB,MAAMhd,UACpC,IAAIvI,EAAU6G,IAAiBC,KAC/B,GAAI9G,GAAWA,EAAQytB,GAAW,CAChC,MAAMmP,EAAa58B,EAAQytB,IAAWttB,UAAUpK,EAAW,GAC3D,IAAK6mC,EAEH,YADAb,IAIF,IAAIc,GAAa,EAUjB,GATAR,EAAOpgC,KAAK,YAAY2nB,KAAK,WAC3B,MAAMttB,EAAS0b,SAAS7a,EAAE3F,MAAMa,KAAK,QAC/BqZ,EAASvU,EAAE3F,MAAM6F,MACnBR,OAAO+lC,EAAWtmC,MAAaO,OAAO6U,KACxCmxB,GAAa,EACbD,EAAWtmC,GAAUoV,EAEzB,GAEImxB,EAAY,CAEd,MAAMnhB,EAAMC,KAAUC,QACtB,GAAIF,GAAOA,EAAImjB,kBAAmB,CAChC,MAAMnrC,EAAa,CAAEkrC,KAAM5+B,EAAQ4+B,MAAQ,CAAEl6B,KAAM,aAAcuE,QAAS,IAC1E7T,OAAOC,KAAK2K,GAAShN,QAAQmY,IACvBA,EAAElZ,WAAW,YAAWyB,EAAWyX,GAAKnL,EAAQmL,YAEhDuQ,EAAImjB,kBAAkBvsC,KAAKwB,UAAUJ,GAC7C,CACAmT,GAAgB7G,EAGhB,MAAMhL,EAAWymB,KACbzmB,GAAYA,EAASy4B,IAAaz4B,EAASy4B,GAAUttB,UACvDnL,EAASy4B,GAAUttB,QAAQpK,EAAW,GAAK,IAAI6mC,GAC/Cxd,GAAapqB,IAIfylB,GAAiByiB,GAAgBl9B,GAGlB7I,EAAE,kBACV4X,KAAK86B,GAAmB7pC,IAC/BmrC,IACF,CACF,CACApP,OAIEuT,GAA6B,CAAC56C,EAAOmlB,EAAY7lB,EAAW+B,EAAUoL,EAAUssB,KACpF,MAAM,GAAQ9R,KACR5gB,EAASiU,KAGTha,EAAWymB,KACX+xB,EAAWx4C,IAAWy4B,IAAWttB,UAAUpK,EAAW,KAAKoL,IAAa,GACxEkvC,EAA2B,KAAb7C,GAAmB32C,OAAO22C,KAAc32C,OAAOnC,GAE7D2nC,EAASllC,EAAE,uGAEmC4D,EAAOkU,yFACTtY,EAAW3C,QAAgB2C,EAAWkjB,4IAGlEw2B,EACI,kUAK+B15C,EAAW62C,oOAM1C,8MAIoC6C,EAAc,WAAa,uQAGmB15C,EAAWjC,sRAKjG27C,EAAc,6HAA+H,mOAMnKl5C,EAAE,QAAQgY,OAAOktB,GAGjB,MAAMiU,EAAYjU,EAAOpgC,KAAK,4BACxBqgC,EAAe,KACnBgU,EAAU,GAAGjZ,MAAMlS,OAAS,OAC5B,MAAMlwB,EAAImd,KAAKhX,IAAI,GAAIgX,KAAKjX,IAAIm1C,EAAU,GAAG7T,aAAe,EAAG,MAC/D6T,EAAU,GAAGjZ,MAAMlS,OAASlwB,EAAI,MAElC4Z,WAAWytB,EAAc,GACzBgU,EAAUxiC,GAAG,QAASwuB,GACtBgU,EAAUhhC,QAEV,MAAMysB,EAAc,IAAMM,EAAOtzB,SACjCszB,EAAOpgC,KAAK,sBAAsBspB,MAAMwW,GACxCM,EAAOvuB,GAAG,QAAS,SAAUza,GACvB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,qBAAqB4tB,GAChD,GAGAM,EAAOpgC,KAAK,sBAAsBspB,MAAM,WACtC+qB,EAAUj5C,IAAIm2C,GAAU91C,QAAQ,QAClC,GAEA2kC,EAAOpgC,KAAK,oBAAoBspB,MAAMhd,UACpC,MAAMmD,EAAS4kC,EAAUj5C,MACzB,IAAI2I,EAAU6G,IAAiBC,KAE/B,GAAI9G,GAAWA,EAAQytB,IAAaztB,EAAQytB,GAAUttB,QAAS,CAC7D,MAAMy8B,EAAa58B,EAAQytB,GAAUttB,QAAQpK,EAAW,GACxD,GAAI6mC,GAAc/lC,OAAO+lC,EAAWz7B,MAAetK,OAAO6U,GAAS,CACjEkxB,EAAWz7B,GAAYuK,QAGjBqW,GAAa/hB,GAGnB,MAAMhL,EAAWymB,KAEfzmB,GACAA,EAASy4B,IACTz4B,EAASy4B,GAAUttB,SACnBnL,EAASy4B,GAAUttB,QAAQpK,EAAW,KAEtCf,EAASy4B,GAAUttB,QAAQpK,EAAW,GAAGoL,GAAYuK,EACrD0T,GAAapqB,IAIfylB,GAAiByiB,GAAgBl9B,GACjCmvC,IACF,CACF,CACApT,OAKEsT,GAA0B,CAACp7C,EAAKC,EAASF,EAAW+B,EAAU03B,KAClE,MAAM,GAAQ9R,KACR5gB,EAASiU,KAGTha,EAAWymB,KACXgiB,EAASzoC,IAAWy4B,IAAWttB,UAAUpK,EAAW,IAAM,GAGhE,IAAIw6C,EAAa,GACjB,IAAK,IAAIl8C,EAAM,EAAGA,EAAMH,EAAQnC,OAAQsC,IAAO,CAC7C,MAAMwlB,EAAa3lB,EAAQG,IAAQ,KAAKA,IAClCoX,EAASgyB,EAAOppC,IAAQ,GACxBqX,EAASzX,EAAII,IAAQ,GACrBm8C,EAAY35C,OAAO4U,KAAY5U,OAAO6U,GAE5C6kC,GAAc,oDAC6BC,EAAY,oBAAsB,6DAC7B75C,EAAWkjB,MAAe22B,EAAY,4CAA8C,iCACpHA,EAAY,iCAAiC75C,EAAW8U,IAAW,iDAAmD,4FACrDpX,kCAAoCsC,EAAW+U,qDAGlI,CAEA,MAAM2wB,EAASllC,EAAE,uGAEmC4D,EAAOkU,2FACPtY,EAAW3C,QAAgB2C,EAAW1C,EAAI,IAAM,MAAQ8B,EAAW,8JAEjGw6C,0iBAUtBp5C,EAAE,QAAQgY,OAAOktB,GAGjB,MAAMC,EAAeC,IACnBA,EAAGlF,MAAMlS,OAAS,OAClBoX,EAAGlF,MAAMlS,OAAS/S,KAAKjX,IAAIohC,EAAGE,aAAe,EAAG,KAAO,MAEzDJ,EAAOpgC,KAAK,YAAY2nB,KAAK,WAC3B0Y,EAAa9qC,KACf,GACA6qC,EAAOpgC,KAAK,YAAY6R,GAAG,QAAS,WAClCwuB,EAAa9qC,KACf,GAEA,MAAMuqC,EAAc,IAAMM,EAAOtzB,SACjCszB,EAAOpgC,KAAK,mBAAmBspB,MAAMwW,GACrCM,EAAOvuB,GAAG,QAAS,SAAUza,GACvB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,qBAAqB4tB,GAChD,GAGAM,EAAOpgC,KAAK,mBAAmBspB,MAAM,WACnC8W,EAAOpgC,KAAK,YAAY2nB,KAAK,WAC3B,MAAMttB,EAAS0b,SAAS7a,EAAE3F,MAAMa,KAAK,QACrC8E,EAAE3F,MACC6F,IAAIomC,EAAOnnC,IAAW,IACtBoB,QAAQ,QACb,EACF,GAGA2kC,EAAOpgC,KAAK,iBAAiBspB,MAAMhd,UACjC,IAAIvI,EAAU6G,IAAiBC,KAC/B,IAAK9G,IAAUytB,IAAWttB,UAAUpK,EAAW,GAE7C,YADAgmC,IAIF,MAAMa,EAAa58B,EAAQytB,GAAUttB,QAAQpK,EAAW,GACxD,IAAI8mC,GAAa,EAWjB,GATAR,EAAOpgC,KAAK,YAAY2nB,KAAK,WAC3B,MAAMttB,EAAS0b,SAAS7a,EAAE3F,MAAMa,KAAK,QAC/BqZ,EAASvU,EAAE3F,MAAM6F,MACnBR,OAAO+lC,EAAWtmC,MAAaO,OAAO6U,KACxCmxB,GAAa,EACbD,EAAWtmC,GAAUoV,EAEzB,GAEImxB,EAAY,OACR9a,GAAa/hB,GAGnB,MAAMhL,EAAWymB,KACbzmB,IAAWy4B,IAAWttB,UACxBnL,EAASy4B,GAAUttB,QAAQpK,EAAW,GAAK,IAAI6mC,GAC/Cxd,GAAapqB,IAGfylB,GAAiByiB,GAAgBl9B,GACjCmvC,IACF,CACApT,OAGE+N,GAAkB70B,IACtB,MAAMla,EAASiU,KAaTyhC,EAAe17B,EAAoBC,UAAUC,EAAW,UACxDy7B,EAAe37B,EAAoBC,UAAUC,EAAW,UACxD07B,EAAiB57B,EAAoBC,UAAUC,EAAW,YAC1D27B,EAAY77B,EAAoBC,UAAUC,EAAW,OACrD47B,EAAc97B,EAAoBC,UAAUC,EAAW,SACvD67B,EAAY/7B,EAAoBC,UAAUC,EAAW,OACrD87B,EAAch8B,EAAoBC,UAAUC,EAAW,SACvD+7B,EAAcj8B,EAAoBC,UAAUC,EAAW,SAIvDg8B,EAAcP,GAAcr+C,KAQlC,IAAImhB,EAAS,CAAE5Z,KAAM,KAAM6Z,OAAQ,KAAMC,SAAU,GAAIC,MAAO,GAAIE,MAAO,KACzE,MAAMq9B,EAAen8B,EAAoBa,UAAU86B,EAAc,UAEjE,GAAIQ,EAAan/C,OAAS,EAAG,CAC3B,MAAMmK,EAAIg1C,EAAa,GAQvB,GAPA19B,EAAO5Z,KAAOsC,EAAEtC,MAAQ,KACxB4Z,EAAOC,OAASvX,EAAEuX,QAAU,KAC5BD,EAAOE,SAAWxX,EAAEwX,UAAY,GAChCF,EAAOK,MAAQ3X,EAAE2X,OAAS,GAC1BL,EAAOM,UAAY,GAGf48B,GAAcr+C,MAAM6B,SAAWw8C,GAAcr+C,MAAMyjB,OAAO,GAAI,CAChE,MAAM5hB,EAAUw8C,EAAar+C,KAAK6B,QAC5BD,EAAMy8C,EAAar+C,KAAKyjB,KAAK,GACnC,IAAIq7B,EAAc,GAClBj9C,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,GAAKA,EAAEsK,SAAS,MAAO,CACzB,MAAMlI,EAAMpD,EAAII,GACZgD,IAAK85C,IAAgBA,EAAc,KAAO,IAAM95C,EACtD,IAEFmc,EAAOG,MAAQw9B,EAGfj9C,EAAQlB,QAAQ,CAACiC,EAAGZ,KAClB,GAAIY,IAAMA,EAAEsK,SAAS,OAAStK,EAAEsK,SAAS,OAAQ,CAC/C,MAAMlI,EAAMpD,EAAII,GACZgD,IAAKmc,EAAOM,UAAYzc,EAC9B,GAEJ,CACF,CAGA,MAAM+5C,EAAaH,GAAan7B,MAAQ,GAClCu7B,EAAgBJ,GAAa/8C,SAAW,GAI9C,IAAIo9C,EAAuB,GACvBC,EAAiB,GAErB,GAAId,GAAcp+C,MAAMyjB,MAAM/jB,OAAS,EAAG,CACxC,MAAMmC,EAAUu8C,EAAap+C,KAAK6B,SAAW,GACvCD,EAAMw8C,EAAap+C,KAAKyjB,KAAK,GAG7B07B,EAAYz8B,EAAoBK,gBAAgBlhB,EAAS,iBAAkBu8C,EAAa11C,QAC1Fy2C,GAAa,GAAKv9C,EAAIu9C,KACxBF,EAAuBr9C,EAAIu9C,IAI7B,MAAMC,EAAS18B,EAAoBK,gBAAgBlhB,EAAS,kBAAmBu8C,EAAa11C,QAC5Fw2C,EAAiBE,GAAU,GAAKx9C,EAAIw9C,GAAUx9C,EAAIw9C,GAAUx9C,EAAI,IAAM,EACxE,CAGA,IAAIy9C,EACFJ,GACAC,IACC/9B,EAAOE,SAASnU,SAAS,KAAOiU,EAAOE,SAAS7T,MAAM,KAAK,GAAGvI,OAASkc,EAAOE,UAGjF,MAAMi+B,EAAef,GAAWh3C,MAAQ,QAClCm0B,EAAc6iB,GAAW5+C,KAAO,GAGhC4/C,EAAY78B,EAAoBa,UAAUg7B,EAAW,OAG3D,IAAIiB,EAAc,GACdC,EAAe,GACnBF,EAAU5+C,QAAQghB,IAChB,MAAM2a,EAAa93B,OAAOmd,EAAIC,SAAW,IAAIxB,cACvCs/B,EAAU,CACdn4C,KAAMoa,EAAIpa,MAAQ,KAClB6Z,OAAQO,EAAIP,QAAU,GACtBC,SAAUM,EAAIN,UAAY,GAC1BhV,MAAOsV,EAAIiC,WAEM,SAAf0Y,GAAwC,OAAfA,EAC3BkjB,EAAY3/C,KAAK6/C,GAEjBD,EAAa5/C,KAAK6/C,KAItB,IAAIC,EAAU,IAAIH,KAAgBC,GAGlC,MAAMG,EAAiBpB,GAAaj3C,MAAQ,OACtCs4C,EAAcn9B,EAAoBa,UAAUi7B,EAAa,SACzDsB,EAAoBp9B,EAAoBoB,YAAY+7B,EAAa,SAAU,SAG3EE,EAAiB1tC,IACrB,MAAMoe,EAAIjsB,OAAO6N,GAAQ,IAAI+N,cAC7B,OAAIqQ,EAAEvjB,SAAS,MAAc,EACzBujB,EAAEvjB,SAAS,MAAc,EACzBujB,EAAEvjB,SAAS,MAAc,EACtB,GAET,IAAI8yC,EAAcF,EACf//C,IAAIkgD,IAAK,CACR14C,KAAM04C,EAAE14C,MAAQ,KAChB8K,KAAM4tC,EAAE5tC,MAAQ,GAChByP,SAAUm+B,EAAEn+B,UAAY,GACxB8B,UAAWq8B,EAAEr8B,aAEdtjB,KAAK,CAACC,EAAGC,IAAMu/C,EAAex/C,EAAE8R,MAAQ0tC,EAAev/C,EAAE6R,OACzD3R,MAAM,EAAG,GAEZ,MAAMw/C,EAAezB,GAAWl3C,MAAQ,QAElC44C,EAAYz9B,EAAoBa,UAAUk7B,EAAW,OAC3D,IAAI2B,EAAWD,EAAUz/C,MAAM,EAAG,GAAGX,IAAIa,IAAQ,CAC/C2G,KAAM3G,EAAK2G,MAAQ,OACnB4L,MAAOvS,EAAKuS,OAAS,IACrBd,KAAMzR,EAAKyR,MAAQ,MAIrB,MAAMguC,EAAiB3B,GAAan3C,MAAQ,QAEtC+4C,EAAc59B,EAAoBa,UAAUm7B,EAAa,SAC/D,IAAI6B,EAASD,EAAY5/C,MAAM,EAAG,GAAGX,IAAIwE,IAAK,CAC5CgD,KAAMhD,EAAEgD,MAAQ,OAChB+a,MAAO/d,EAAE+d,OAAS,GAClBjQ,KAAM9N,EAAE8N,MAAQ,MAIlB,MAAMmuC,EAAiB7B,GAAap3C,MAAQ,MAEtCk5C,EAAc/9B,EAAoBa,UAAUo7B,EAAa,SAG/D,IAAI+B,EAFmBh+B,EAAoBoB,YAAY28B,EAAa,WAAY,SAE7C//C,MAAM,EAAG,GAAGX,IAAIiB,IAAK,CACtDuG,KAAMvG,EAAEuG,MAAQ,OAChB8K,KAAMrR,EAAEqR,MAAQ,GAChB8G,KAAMnY,EAAEmY,MAAQ,MAGlB,MAAMwnC,EAAoBrC,GAAgB/2C,MAAQ,QAC5Cq5C,EAAmBtC,GAAgB3+C,KAAO,GAE1CkhD,EAAiBn+B,EAAoBa,UAAU+6B,EAAgB,YAyRrE,MAtRW,kxBAc2C,eAAlB51C,EAAO0hB,OAA0B,sBAAwB,sNAIvDi0B,GAAc1+C,KAAO,8RAIS2E,EAAWyQ,EAAwBoM,EAAO5Z,wQACsIjD,EAAW6c,EAAOC,YAAY9c,EAAW6c,EAAOC,OAAO1hB,OAAS,EAAIyhB,EAAOC,OAAO6T,UAAU,EAAG,GAAK,KAAO9T,EAAOC,sJAGhV,MAEA,MAAM0/B,EAAe3/B,EAAOM,WAAaN,EAAOK,OAAS,GACnDu/B,EAAkBh6B,GAAqB+5B,GAC7C,OAAIC,EAAgBrhD,OAAS,EACpB,8NACGqhD,EACCrgD,MAAM,EAAG,GACTX,IACCihD,GAAO,yQAEiF18C,EAAW08C,EAAIz5C,UAAUjD,EAAW08C,EAAIz5C,KAAK0tB,UAAU,EAAG,wPAEjE+rB,EAAI3+C,gIACZ2+C,EAAI3+C,qBAAqBiC,EAAW08C,EAAIz5C,+FAA+Fy5C,EAAIz5C,QAAQy5C,EAAI3+C,8JAKjO2D,KAAK,8CAGX,EACR,EAvBC,eAwBhB,MAEA,IAAIkoB,EAAW,GACf,GAAI6wB,EAAWr/C,OAAS,GAAKs/C,EAAct/C,OAAS,EAAG,CACrD,MAAMkC,EAAMm9C,EAAW,GACvBC,EAAcr+C,QAAQ,CAACiC,EAAGZ,KACxB,GAAIY,GAAKA,EAAEsK,SAAS,MAAO,CACV6Z,GAAqBnlB,EAAII,IAAQ,IACzCrB,QAAQoT,IACRma,EAAShiB,KAAK3L,GAAKA,EAAEgH,OAASwM,EAAKxM,OACtC2mB,EAASruB,KAAKkU,IAGpB,GAEJ,CAEA,OAAIma,EAASxuB,OAAS,EAEb,sJACGwuB,EACCnuB,IACCgU,GAAQ,gSAEgFzP,EAAWyP,EAAKxM,UAAUjD,EAAWyP,EAAKxM,KAAK0tB,UAAU,EAAG,2NAEhElhB,EAAK1R,gHAChB0R,EAAK1R,qBAAqBiC,EAAWyP,EAAKxM,+FAA+FwM,EAAKxM,QAAQwM,EAAK1R,8GAKrO2D,KAAK,8BAGX,EACR,EApCC,qGAuCwD1B,EAAW+7C,gHAA6HC,EAAY5gD,wLAGhM6gD,EAAO7gD,OAAS,EACZ6gD,EACGxgD,IAAI,CAACsiB,EAAOrgB,KACX,MAAMi/C,EAAap6B,GAAoBxE,EAAMC,OACvC4+B,EAAaD,EAAa,EAC1BE,EAAgBb,EAAYh0C,UAAU/H,GAAKA,EAAEgD,OAAS8a,EAAM9a,MAClE,MAAO,yGACSm3C,GAAa/+C,KAAO,oDACpBwhD,GAAiB,EAAIA,EAAgBn/C,uWAG6BsC,EAAW+d,EAAM9a,UAAUjD,EAAW+d,EAAM9a,KAAK7H,OAAS,EAAI2iB,EAAM9a,KAAK0tB,UAAU,EAAG,GAAK,KAAO5S,EAAM9a,mJAGtL25C,EACI,6EAA6ED,4GAClBA,iBAA0B38C,EAAW+d,EAAM9a,+FAA+F8a,EAAM9a,QAAQ05C,eACnN,2DAA2D38C,EAAW+d,EAAMC,OAAS,sFAK9Ftc,KAAK,IACR,2UAOwC1B,EAAWq8C,2CAA2DE,EAAenhD,sMAGjImhD,EAAenhD,OAAS,EACpBmhD,EACG9gD,IAAI,CAACqhD,EAAKp/C,KACT,MAAMq/C,EAAWD,EAAI75C,MAAQ,KACvB+5C,EACJjC,IACCgC,EAASn0C,SAASmyC,IAAqBA,EAAiBnyC,SAASm0C,IACpE,MAAO,6EAA6EC,EAAY,uBAAyB,oDACzGh9C,EAAWs8C,oDACXQ,EAAIx9B,mTAIhB09B,EAAY,2CAA6C,0HAC5Ch9C,EAAW+8C,OAAc/8C,EAAW+8C,EAAS3hD,OAAS,EAAI2hD,EAASpsB,UAAU,EAAG,GAAK,KAAOosB,+EAE5GC,EAAiN,uDAArM,mEAAmEh9C,EAAW+8C,6FAAoGA,8CAGhMr7C,KAAK,IACR,6IAIwC1B,EAAWg7C,oKACPK,EAAQjgD,ksBAQxDigD,EAAQjgD,OAAS,EACbigD,EACGj/C,MAAM,EAAG,IACTX,IAAI,CAAC4hB,EAAK4/B,KACT,MAAMllB,EAAYmjB,EAAYtzC,KAAKmU,GAAKA,EAAE9Y,OAASoa,EAAIpa,MACjDi6C,EAAYD,IAAWxhC,KAAKjX,IAAI62C,EAAQjgD,OAAQ,IAAM,EACtD+hD,EAAYxsC,EAAc1L,IAAIoY,EAAIpa,MAClCm6C,EAAgBzsC,EAAckB,WAAWwL,EAAIpa,MAC7Co6C,EAAgB1sC,EAAcoB,WAAWsL,EAAIpa,MAC7Cq6C,EAAc3sC,EAAcqB,SAASqL,EAAIpa,MACzCs6C,EAAcJ,EAChB,yBAAyBA,uBAA+BG,0BAAoCF,MAAkBC,MAC9G,GACEG,EAAiBzlB,EACnB,GACA,qDACJ,MAAO,yGACS/3B,EAAWo3B,oDACX/Z,EAAItV,mHAEIm1C,EAA4D,GAAhD,ugBAG2KnlB,EAAY,oBAAsB,uBAAuBwlB,IAAcC,aAA0BzlB,EAAY,KAAO,oDACtTolB,EAAmJ,GAAvI,0EAA0EK,MAAmBx9C,EAAWqd,EAAIpa,KAAKq7B,OAAO,+GAE5Ht+B,EAAWqd,EAAIpa,iBAAiB80B,EAAY,GAAK,mBAAmB/3B,EAAWqd,EAAIpa,KAAK7H,OAAS,EAAIiiB,EAAIpa,KAAK0tB,UAAU,EAAG,GAAK,KAAOtT,EAAIpa,kPAGpFjD,EAAWqd,EAAIpa,+FAA+Foa,EAAIpa,iIAK/LvB,KAAK,IACR,mQAOwC1B,EAAW47C,oDAA+DC,EAAUzgD,mLAGhI0gD,EAAS1gD,OAAS,EACd0gD,EACGrgD,IAAI,CAACa,EAAMoB,KACV,MAAM+/C,EAAY//C,IAAQo+C,EAAS1gD,OAAS,EAC5C,MAAO,yGACS++C,GAAW9+C,KAAO,oDAClBqC,2MAEoG+/C,EAA4D,GAAhD,2JACrDz9C,EAAW1D,EAAK2G,UAAUjD,EAAW1D,EAAK2G,KAAK7H,OAAS,EAAIkB,EAAK2G,KAAK0tB,UAAU,EAAG,GAAK,KAAOr0B,EAAK2G,0MAEtGjD,EAAW1D,EAAK2G,gGAAgG3G,EAAK2G,uGAClIjD,EAAW1D,EAAKuS,sFAI7EnN,KAAK,IACR,2IAIwC1B,EAAWk8C,8EAA2FE,EAAchhD,mLAGhKghD,EAAchhD,OAAS,EACnBghD,EACG3gD,IAAI,CAACa,EAAMoB,KACV,MAAMggD,EAAShgD,IAAQ0+C,EAAchhD,OAAS,EAC9C,MAAO,yGACSi/C,GAAah/C,KAAO,oDACpB8gD,EAAYn0C,UAAUnB,GAAKA,EAAE5D,OAAS3G,EAAK2G,qNAEyDy6C,EAAyD,GAAhD,iIAC5E19C,EAAW1D,EAAK2G,UAAUjD,EAAW1D,EAAK2G,KAAK7H,OAAS,EAAIkB,EAAK2G,KAAK0tB,UAAU,EAAG,GAAK,KAAOr0B,EAAK2G,qGAC7FjD,EAAW1D,EAAKuY,MAAQvY,EAAKyR,iDAGtFrM,KAAK,IACR,0IAIwC1B,EAAWs7C,+EAA4FI,EAAYtgD,qCAE/JsgD,EAAYtgD,OAAS,EACjBsgD,EACGjgD,IAAI,CAAC0wB,EAAGzuB,KACP,MAAMigD,EAASz9C,OAAOisB,EAAEpe,MAAQ,IAAInF,SAAS,MAE7C,IAAIg1C,EAAkB,KACtB,MAAMC,EAAgB39C,OAAOisB,EAAE3O,UAAY,IAAIpc,MAAM,aACjDy8C,IACFD,EAAkBniC,KAAKjX,IAAI,IAAKiX,KAAKhX,IAAI,EAAG4W,SAASwiC,EAAc,GAAI,OAEzE,MAAMC,EACgB,OAApBF,EACI,wHAAwHA,6DACxH,GACN,MAAO,uHACS1D,GAAa7+C,KAAO,yDACJiE,IAAhB6sB,EAAE7M,UAA0B6M,EAAE7M,UAAYi8B,EAAYvzC,UAAU2zC,GAAKA,EAAE14C,OAASkpB,EAAElpB,qVAI7C06C,EAAS,mBAAqB,OAAO39C,EAAWmsB,EAAElpB,gDACnG66C,0EAILp8C,KAAK,IACR,gGAQlBuvC,GAAqB,CAACpJ,EAAWxqC,KACjBoqC,YAAYxqC,MAChC,IAAK4qC,IAAcA,EAAU1oB,KAAK/jB,OAChC,MAAO,+FAC+EusB,GAAoBtqB,YAAoBA,uOAGhI,MAAM+G,EAASiU,KACT0lC,EAAmBv2B,KAAsBqgB,EAAUxsC,MAAQ,GAC3DkC,GAAWsqC,EAAUtqC,SAAW,IAAInB,MAAM,GAI1C4hD,EAA8B,WADdp1B,MAAoB,CAAC,GAAGvrB,IAAc,QAG5D,IAAI4gD,EAAgB,EACpB,GAAiC,IAA7BpW,EAAUtqC,QAAQnC,OACpB6iD,EAAgB,OACX,GAAI5gD,EAAUuL,SAAS,OAASvL,EAAUuL,SAAS,MAAO,CAC/D,MAAMlL,EAAMmqC,EAAUtqC,QAAQyK,UAC5B1J,GAAKA,IAAMA,EAAEsK,SAAS,OAAStK,EAAEsK,SAAS,OAAStK,EAAEsK,SAAS,QAE5DlL,EAAM,IAAGugD,EAAgBvgD,EAC/B,CAGA,IAAIwgD,EAAgBrW,EAAU1oB,KAAK1jB,IAAI,CAAC6B,EAAKyK,KAAU,CAAGrM,KAAM4B,EAAK6gD,cAAep2C,KACpF,MAAMq2C,GAAch6B,GAAkB/mB,IAAc,IAAIye,cAAcnb,OAGhE09C,EAhuZgBhhD,IACfyrB,KAAmBlgB,SAASvL,GA+tZhBihD,CAAgBjhD,GAE/B+gD,GACFF,EAAgBA,EAAc53C,OAAOhK,GACnCA,EAAKZ,KAAKkM,KAAK69B,GAAQvlC,OAAOulC,GAAM3pB,cAAclT,SAASw1C,KAE7DF,EAAcliD,KAAK,CAACC,EAAGC,KACrB,MAAMqiD,EAASr+C,OAAOjE,EAAEP,KAAKuiD,IAAkB,IAAIniC,cAC7C0iC,EAASt+C,OAAOhE,EAAER,KAAKuiD,IAAkB,IAAIniC,cAC7C2iC,EAAYF,EAAO31C,SAASw1C,GAC5BM,EAAYF,EAAO51C,SAASw1C,GAClC,OAAIG,IAAWH,GAAcI,IAAWJ,GAAoB,EACxDG,IAAWH,GAAcI,IAAWJ,EAAmB,EACvDK,IAAcC,GAAmB,GAChCD,GAAaC,EAAkB,EAC7BziD,EAAEkiD,cAAgBjiD,EAAEiiD,iBAIzBE,EACFH,EAAcliD,KAAK,CAACC,EAAGC,IAAMA,EAAEiiD,cAAgBliD,EAAEkiD,eAEjDD,EAAcliD,KAAK,CAACC,EAAGC,IAAMD,EAAEkiD,cAAgBjiD,EAAEiiD,eAIrD,MAAM93B,EAAejiB,EAAOiiB,cAAgB,GACtCs4B,EAAaT,EAAc9iD,OAC3BwjD,EAAanjC,KAAKu2B,KAAK2M,EAAat4B,IAAiB,EAC3D,IAAIw4B,EAAc16B,GAAgB9mB,IAAc,EAC5CwhD,EAAcD,IAAYC,EAAcD,GACxCC,EAAc,IAAGA,EAAc,GACnC16B,GAAgB9mB,GAAawhD,EAE7B,MAAMC,GAAYD,EAAc,GAAKx4B,EAC/B04B,EAASD,EAAWz4B,EACpB24B,EAAed,EAAc9hD,MAAM0iD,EAAUC,GAG7CE,EA9wZwB5hD,MACzBA,GACY,CAAC,KAAM,KAAM,KAAM,KAAM,MAC1BuK,KAAKiX,GAAMxhB,EAAUuL,SAASiW,IA2wZvBqgC,CAAwB7hD,GACzC8hD,EAAiBF,EACnB,0EAC+Dj/C,EAAW3C,cAAsBghD,EAAa,qBAAuB,8DACvGA,EAAa,oBAAsB,+DAGhE,GAEJ,IAAIjmC,EAAO,mJAGsCuP,GAAoBtqB,yCAAiD2C,EAAW3C,oDACnGyhD,EAAW,KAAKrjC,KAAKjX,IAAIu6C,EAAQJ,SAAkBA,MAAeN,EAAa,qDAAuD,2FAGlJhhD,EAAUuL,SAAS,MAAQ,wEAAwE5I,EAAW3C,2EAAqF,2BACnM8hD,6FACmEn/C,EAAW3C,+BAAuC2gD,EAAa,OAAS,yDACpHA,EAAa,cAAgB,0MAGyBh+C,EAAW3C,wPAGoE+mB,GAAkB/mB,IAAc,IAAI8C,QAAQ,KAAM,mPAsThO,GAhTAiY,GAAQ4mC,EACLvjD,IAAIa,IACH,MAAM8iD,EAAa9iD,EAAK6hD,cAClB7gD,EAAMhB,EAAKZ,KACX2jD,EAAYtB,EAAiBn1C,SAASw2C,GACtCE,EAAYhiD,EAAI2gD,IAAkB,MAClCsB,EAAqC,IAAlBtB,EACnBuB,EAAc,GAAG3X,EAAUxsC,OAAO+jD,KAAcnB,IAChDwB,EAAkBrwC,OAAO+4B,gBAAkB/4B,OAAO+4B,eAAez6B,IAAI8xC,GACrEE,EAAW57B,GAAepW,IAAI,GAAGrQ,SAAiB+hD,KACxD,IAAIO,EAAW,GACXv7C,EAAOgiB,eACLq5B,EAAiBE,EAAW,uBACvBD,IAAUC,EAAW,uBAIhC,MAAMC,EAAkBtiD,EAAI7B,IAAI,CAACokD,EAAG3kD,IAAMA,GAAGoL,OAAOpL,GAAKA,EAAI,GAAKA,IAAM+iD,GAClE6B,EAAkBF,EAAgBxkD,OAAS,GAAM,EAEjD2kD,EAAWziD,EACd7B,IAAI,CAACgqC,EAAMsB,KACV,GAAIA,GAAQ,GAAKA,IAASkX,EAAe,MAAO,GAGhD,IADsB1gD,EAAQwpC,EAAO,IAAM,IACzBn+B,SAAS,MAAO,MAAO,GACzC,MACMo3C,EADiBjZ,IAAS6Y,EAAgBA,EAAgBxkD,OAAS,IACnC0kD,EAGhC58B,GADgB3lB,EAAQwpC,EAAO,IAAM,KAAOA,GACjB5mC,QAAQ,6BAA8B,IAAIQ,OACrEs/C,EAAU39B,GACdpiB,OAAOoiB,GACJniB,QAAQ,KAAM,SACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,UACb+/C,EAAiBhgD,OAAOulC,GAAM9kC,OAC9BgiB,EAASlS,EAAwByvC,GACjCC,EAAsB,CAAC,IAAK,KAAM,IAAK,OAAQ,OAAQ,IAAK,IAAK,MAAO,YAAa,IAAK,OAChG,GAAIA,EAAoBv3C,SAAS+Z,EAAO7G,eACtC,MAAO,GAGT,IAAIgvB,EAAc,GACdsV,GAAY,EAChB,MAAMC,EAAa,OAGbC,EAAc79B,GAAqBE,GAEzC,GAAIM,GAAmBN,EAAQO,GAAa,CAC1C,MAEMq9B,EAFY19B,GAAwBF,GAETrc,OAAO4xB,IACjCA,EAAIx0B,WACDy8C,EAAoBv3C,SAASsvB,EAAIx0B,SAASoY,gBAGpD,GAAIykC,EAAenlD,OAAS,EAAG,CAC7BglD,GAAY,EACZ,IAAII,EAAU,GACd,IAAK,IAAItlD,EAAI,EAAGA,EAAIqlD,EAAenlD,OAAQF,IAAK,CAC9C,MAAMg9B,EAAMqoB,EAAerlD,GAG3BslD,GACE,4FAFAtlD,EAAIqlD,EAAenlD,OAAS,EAAI,kDAAoD,IAIpF,KACFolD,GACE,6DAA+DP,EAAQ/nB,EAAIj1B,MAAQ,UACjFi1B,EAAIx0B,WACN88C,GACE,+HACAP,EAAQ/nB,EAAIx0B,UACZ,WAEJ88C,GAAW,QACb,CACA1V,EAAc,uCAAyC0V,EAAU,QACnE,MAAO,GAA8B,IAA1BD,EAAenlD,OAAc,CACtCglD,GAAY,EACZ,MAAMloB,EAAMqoB,EAAe,GAC3BzV,EACE,6FACFA,GACE,6DAA+DmV,EAAQ/nB,EAAIj1B,MAAQ,UACjFi1B,EAAIx0B,WACNonC,GACE,+HACAmV,EAAQ/nB,EAAIx0B,UACZ,WAEJonC,GAAe,QACjB,CACF,MAAO,GAAIwV,EAAYllD,OAAS,EAAG,CAEjCglD,GAAY,EACZ,IAAIK,EAAY,GAChB,IAAK,IAAIvlD,EAAI,EAAGA,EAAIolD,EAAYllD,OAAQF,IAAK,CAC3C,MAAMuU,EAAO6wC,EAAYplD,GACzBulD,GACE,6FACFA,GACE,sFACAR,EAAQxwC,EAAKxM,MACb,KACAg9C,EAAQxwC,EAAKxM,KAAK7H,OAAS,EAAIqU,EAAKxM,KAAK0tB,UAAU,EAAG,GAAKlhB,EAAKxM,MAChE,UACFw9C,GAAa,yDACbA,GACE,+EACAhxC,EAAK1R,MACL,UACF0iD,GACE,uEACAR,EAAQxwC,EAAKxM,MACb,sBACAwM,EAAK1R,MACL,+FACF0iD,GAAa,cACf,CACA3V,EAAc,yCAA2C2V,EAAY,QACvE,MAAO,GAA2B,IAAvBH,EAAYllD,OAAc,CAEnCglD,GAAY,EACZ,MAAM3wC,EAAO6wC,EAAY,GACzBxV,EAAc,+EACdA,GACE,6DAA+DmV,EAAQxwC,EAAKxM,MAAQ,UACtF6nC,GAAe,yDACfA,GAAe,8DAAgEr7B,EAAK1R,MAAQ,UAC5F+sC,GACE,uEACAmV,EAAQxwC,EAAKxM,MACb,sBACAwM,EAAK1R,MACL,+FACF+sC,GAAe,cACjB,MAAO,GAAInoB,EAAOvnB,OAAS,GAAKilD,EAAW73C,KAAKma,KAAYA,EAAO/Z,SAAS,QAAS,CAEnF,MAAM83C,EAAmB,CAAC,IAAK,KAAM,IAAK,OAAQ,OAAQ,IAAK,IAAK,MAAO,YAAa,IAAK,OACvFl/C,EAAQmhB,EACXzZ,MAAMm3C,GACN5kD,IAAIwE,GAAKA,EAAEU,QACX2F,OAAOrG,GAAKA,IAAMygD,EAAiB93C,SAAS3I,EAAE6b,gBAEjD,GADiBta,EAAMpG,OAAS,GAAKoG,EAAM8S,MAAM/O,GAAKA,EAAEnK,QAAU,GACpD,CAOZ0vC,EAAc,kCANGtpC,EACd/F,IAAIoZ,GAEI,2BADU+S,GAAc/S,IAAS,qBACM,KAAOorC,EAAQprC,GAAQ,WAEtEnT,KAAK,IACqD,QAC/D,MAEEopC,EAFStpC,EAAMpG,OAAS,EAEV6kD,EAAQz+C,EAAME,KAAK,OAGnB,EAElB,MAAO,IAAI2gB,GAAcM,IAAYA,EAAO/Z,SAAS,MAAS+Z,EAAO/Z,SAAS,KAYvE,CACL,MAAM+3C,EAAa/4B,GAAcjF,GAC3Bi+B,EAAkC,KAApBX,EAAQt9B,IAAmC,MAAjBziB,OAAOulC,GAAgB,SAAWwa,EAAQt9B,GACxFmoB,EAAc6V,EACV,0BAA4BA,EAAa,KAAOC,EAAc,UAC9DA,CACN,KAlBoF,CAElF,MAAM73C,EAASwZ,GAAoBI,GACnCmoB,EAAc,+EACdA,GAAe,SAAWmV,EAAQt9B,GAAU,UAC5CmoB,GACE,uEACAmV,EAAQ/8B,GACR,sBACAna,EACA,+GACF+hC,GAAe,QACjB,CAQA,MAAM+V,EAAgB/8B,GAAepW,IAAIrQ,EAAY,IAAM+hD,EAAa,IAAMrY,GACxE+Z,EAASjZ,EAAUxsC,IAAM,IAAM+jD,EAAa,IAAMrY,EAClDga,EAAiB3xC,OAAO+4B,gBAAkB/4B,OAAO+4B,eAAez6B,IAAIozC,GAC1E,IAAIE,EAAgB,GAChB58C,EAAOgiB,eACL26B,EAAgBC,EAAgB,uBAC3BH,IAAeG,EAAgB,uBAK1C,MAAMC,EAAa5mD,EAAY+C,UAAUC,EAAWC,EAAKuqC,EAAUtqC,SAE7D2jD,EADoBD,GAAc5mD,EAAYuE,cAAcvB,EAAW4jD,EAAY1jD,EAAQwpC,EAAO,IAEpG,2HACA,GAOJ,MACE,gBALA,yBACCiZ,EAAc,sBAAwB,KACtCI,EAAY,kBAAoB,KAKjC,eACApgD,EAAW6nC,EAAUxsC,KACrB,iBACA2E,EAAW3C,GACX,eACA+hD,EACA,eACArY,EACA,eACA2L,mBAAmBjN,GAAQ,IAC3B,iCACAviB,EACAg+B,EACA,oCACAF,EACA,KACAlW,EACA,iBAGHppC,KAAK,IAIR,IAAIy/C,EAAej/B,EAAmB7kB,GAClC+jD,EAAc,GAGlB,MAAMC,EAAiB9jD,EAAQyK,UAAU1J,GAAKA,GAAKA,EAAEsK,SAAS,OAC9D,GAAIy4C,GAAkB,GAAK/jD,EAAI+jD,EAAiB,GAAI,CAElD,MAAMC,EAAgB,CAAC,IAAK,OAAQ,OAAQ,IAAK,IAAK,MAAO,YAAa,KACpEC,EAAkBrhD,OAAO5C,EAAI+jD,EAAiB,IACjDn4C,MAAM,WACNzN,IAAIwE,GAAKA,EAAEU,QACX2F,OAAOrG,GAAKA,IAAMqhD,EAAc14C,SAAS3I,EAAE6b,gBAC9C,GAAIylC,EAAgBnmD,OAAS,EAAG,CAE9B,MAAMomD,EAAiBL,EAAa1lD,IAAIQ,GAAKA,EAAEskB,MAAMzE,eAE/C2lC,EAAU,CACd,GAAI,eACJ,GAAI,eACJ,GAAI,cACJ,GAAI,cACJ,GAAI,SACJ,GAAI,SACJ,GAAI,kBACJ,GAAI,UACJ,GAAI,UACJ,GAAI,WACJ,GAAI,mBACJ,GAAI,oBACJ,GAAI,UACJ,GAAI,WACJ,GAAI,YAGAC,EAAaH,EAChBj7C,OAAOumB,IAAQ20B,EAAe54C,SAASikB,EAAI/Q,gBAC3CrgB,IAAIoxB,IAAO,CACVtM,MAAOsM,EACP1pB,KAAMs+C,EAAQ50B,IAAQ,kBACtB9e,KAAM,SACNyS,SAAU,SAASqM,WACnBpM,WAAW,KAGf0gC,EAAe,IAAIA,KAAiBO,EACtC,CACF,CAEA,GAAIP,EAAa/lD,OAAS,EAAG,CACTkC,EAAI2gD,GAOtBmD,EAAc,iCANKD,EAChB1lD,IACC,CAACkmD,EAAKC,IACJ,kCAA+C,UAAbD,EAAI5zC,KAAmB,aAAe,wBAAwB6zC,gBAAqBxC,yBAAkCuC,EAAIx+C,MAAQ,mBAAmBnD,EAAW2hD,EAAIphC,mBAExM7e,KAAK,WAEV,CAGA,MAAMmgD,EAAiBxnD,EAAY+C,UAAUC,EAAWC,EAAKuqC,EAAUtqC,SAEjEukD,EADkBD,GAAkBxnD,EAAYyE,YAAYzB,EAAWwkD,GAEzE,8GACA,GAEJ,MAAO,6BAA6BxC,EAAY,mBAAqB,iEAAiEE,EAAmB,KAAOH,EAAa,GAAK,qDAAqDO,gBAAuB3/C,EAAW6nC,EAAUxsC,qBAAqB2E,EAAW3C,iBAAyB+hD,gBAAyBnB,gBAA4BvL,mBAAmB4M,GAAa,uBAAuBt/C,EAAWs/C,KAAawC,2CAAsD9D,EAAa,YAAc,gBAAgB+B,UAAiBqB,YAEnkB1/C,KAAK,IACR0W,GAAQ,eAEJwmC,EAAa,EAAG,CAClBxmC,GAAQ,6DAA6E,IAAhBymC,EAAoB,WAAa,kBAAkBA,EAAc,MAAsB,IAAhBA,EAAoB,WAAa,uDAC7K,MAAMvkC,EAAQ,GACd,GAAIskC,GAAc,EAChB,IAAK,IAAI1jD,EAAI,EAAGA,GAAK0jD,EAAY1jD,IAAKof,EAAM/e,KAAKL,QAE7C2jD,GAAe,EAAGvkC,EAAM/e,KAAK,EAAG,EAAG,EAAG,EAAG,EAAG,MAAOqjD,GAC9CC,GAAeD,EAAa,EACnCtkC,EAAM/e,KAAK,EAAG,MAAOqjD,EAAa,EAAGA,EAAa,EAAGA,EAAa,EAAGA,EAAa,EAAGA,GAClFtkC,EAAM/e,KAAK,EAAG,MAAOsjD,EAAc,EAAGA,EAAaA,EAAc,EAAG,MAAOD,GAElFtkC,EAAMje,QAAQkJ,IACK6S,GAAP,QAAN7S,EAAqB,yCACZ,+BAA+BA,IAAMs5C,EAAc,SAAW,kBAAkBt5C,MAAMA,eAErG6S,GAAQ,+BAA+BymC,IAAgBD,EAAa,WAAa,kBAAkBC,EAAc,MAAMA,IAAgBD,EAAa,WAAa,6DACnK,CACA,OAAOxmC,GAIH2pC,GAAsB,KAC1B,MAAM,GAAQ/8B,KACR8rB,EAAY7oB,KACZ+5B,EAAWxhD,EAAE,sBAEnB,GAAIswC,GAAakR,EAAS5mD,OAAQ,CAChC,MAAM6mD,EAAe,CAAC,EAEtBD,EAAS18C,KAAK,sDAAsD2nB,KAAK,WACvE,GAAIpyB,KAAK42C,UAAY,EAAG,CAEtB,MACM9K,EADQnmC,EAAE3F,MAAMyc,QAAQ,kBACXhS,KAAK,uBAAuB5J,KAAK,OAE9C2wC,EAAS7rC,EAAE3F,MAAM2c,SAAS,qBAEhC,QAAalY,IAATqnC,EAAoB,CAEtBsb,EADY5V,EAAS,QAAQ1F,IAASA,GAClB9rC,KAAK42C,SAC3B,CACF,CACF,GAGAjtB,GAAkBssB,GAAa,CAC7B1iB,KAAM4zB,EAASxQ,aACfrqB,IAAK66B,EAASvQ,YACdkD,MAAOsN,EACPC,UAAWllD,KAAKC,MAEpB,GAGI0xB,GAAa,KACjB,MAAM,GAAQ3J,KACd+8B,KAEAvhD,EAAE,kBAAkBkX,YAAY,WAChClX,EAAE,gBAAgBkX,YAAY,UAC9BwQ,GAAmB,OAKfnR,GAAasxB,IACjB,MAAM,GAAQrjB,KACR4V,EAAWp6B,EAAE,gBAEnBo6B,EAASzjB,GAAG,QAAS,+BAAgC,SAAUza,GAC7DA,EAAE0a,kBACF,MAAMkH,EAAY8pB,GAAgBl4B,IAAiBC,MAC7C8pC,EAAY77B,EAAoBC,UAAUC,EAAW,OACvD27B,GAAaA,EAAUv+C,KACzBs7B,GAAsBijB,EAAUv+C,MAE5B0T,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,UAE7C,GAGA4S,EAASzjB,GAAG,QAAS,+BAAgC,SAAUza,GAC7DA,EAAE0a,kBACF,MAAMkH,EAAY8pB,GAAgBl4B,IAAiBC,MAC7C8pC,EAAY77B,EAAoBC,UAAUC,EAAW,OACrDy7B,EAAe37B,EAAoBC,UAAUC,EAAW,UACxD0a,EAAU,GAEZ+gB,GAAcr+C,MAAMyjB,OAAO,IAC7B6Z,EAAQz9B,KAAK,CAAE0H,KAAM82C,EAAar+C,KAAKyjB,KAAK,GAAG,IAAM,KAAM9N,UAAU,IAGnE4oC,GAAWv+C,MAAMyjB,MACnB86B,EAAUv+C,KAAKyjB,KAAK9iB,QAAQ,CAACiB,EAAKI,KAC5BJ,EAAI,IAAI07B,EAAQz9B,KAAK,CAAE0H,KAAM3F,EAAI,GAAI+T,UAAU,EAAOjS,SAAU1B,MAGpEs7B,EAAQ59B,OAAS,EACnBsmC,GAAkB1I,EAAS,IAAM3T,MAE7BjW,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,UAE7C,GAEA4S,EAASzjB,GAAG,QAAS,uBAAwB,SAAUza,GACrDA,EAAE0a,kBACF,MAAM/Z,EAAYmD,EAAE3F,MAAMa,KAAK,SAC3B2B,IACF2H,GAAMS,IAAIvD,GAA8B,GACxCgmB,GAAmB7qB,GACnBgoB,KAEJ,GAGA7kB,EAAE,sBACC0W,IAAI,4CACJC,GAAG,uBAAwB,SAAUza,GACpC7B,KAAKy+C,aAAe58C,EAAEu7C,cAAc3W,QAAQ,GAAGrC,QAC/CpkC,KAAK0+C,aAAe78C,EAAEu7C,cAAc3W,QAAQ,GAAGnC,OACjD,GACChoB,GAAG,sBAAuB,SAAUza,GACnC,IAAK7B,KAAKy+C,aAAc,OACxB,MAAM5W,EAASjnB,KAAKikB,IAAIhjC,EAAEu7C,cAAc3W,QAAQ,GAAGrC,QAAUpkC,KAAKy+C,cAG9D5W,EAFWjnB,KAAKikB,IAAIhjC,EAAEu7C,cAAc3W,QAAQ,GAAGnC,QAAUtkC,KAAK0+C,eAE3C7W,EAAS,IAC9BhmC,EAAE0a,iBAEN,GAEF5W,EAAE,QACC0W,IAAI,wBACJC,GAAG,uBAAwB,sBAAuB,SAAUza,GAC3DA,EAAE0a,kBACF1a,EAAEmc,iBAGF,MACMspC,GADUn9C,GAAMC,IAAI,qBAAqB,GAE/CD,GAAMS,IAAI,oBAAqB08C,GAG/B,MAAM76B,EAAQ9mB,EAAE3F,MACZsnD,GACF76B,EAAM5P,YAAY,UAAUgQ,SAAS,gBACrCJ,EAAM7X,KAAK,QAAS,WAEpB6X,EAAM5P,YAAY,gBAAgBgQ,SAAS,UAC3CJ,EAAM7X,KAAK,QAAS,UAItB4V,IACF,GAEF,MAAMpO,EAASzW,EAAE,sBACjB,GAAIyW,EAAO7b,OAAQ,CAEjB,IAAIgnD,EAAc,KAClBnrC,EAAOC,IAAI,mBAAmBC,GAAG,kBAAmB,WAClD,MAAM49B,EAAQv0C,EAAE3F,MACZunD,GAAaziB,aAAayiB,GAC9BA,EAAclqC,WAAW,KACvB,MAAM44B,EAAY7oB,KACd6oB,IACGtsB,GAAkBssB,KAAYtsB,GAAkBssB,GAAa,CAAE3pB,IAAK,EAAGiH,KAAM,EAAGumB,MAAO,CAAC,IAC7FnwB,GAAkBssB,GAAW3pB,IAAM4tB,EAAMtD,YACzCjtB,GAAkBssB,GAAW1iB,KAAO2mB,EAAMvD,eAG3C,IACL,EACF,CAEAhxC,EAAE,QACC0W,IAAI,sBACJC,GAAG,qBAAsB,eAAgB,SAAUza,GAClD,GAAIknB,GAAgB,OACpB,MAAMurB,EAAU3uC,EAAE9D,EAAEsQ,QAIpB,GADqBmiC,EAAQ73B,QAAQ,qBACpBlc,OAIf,OAHAsB,EAAE0a,kBACF1a,EAAEmc,sBACFizB,KAIF,MAAMuW,EAAUlT,EAAQ73B,QAAQ,gBAChC,GAAI+qC,EAAQjnD,OAAQ,CAElB,GAA2B,sBAAvBinD,EAAQ5yC,KAAK,MAA+B,CAC9C/S,EAAEmc,iBACFnc,EAAE4lD,2BACF,MAAMtP,EAAoBhuC,GAAMC,IAAI/C,GAA8B,GAC5DqgD,EAAiB/hD,EAAE,kBAAkBgX,SAAS,WAEpD,GAAIw7B,GAAqBuP,EAEvBv9C,GAAMS,IAAIvD,GAA8B,GACxC1B,EAAE,kBAAkBkX,YAAY,WAChClX,EAAE,gBAAgBkX,YAAY,cACzB,CAEL1S,GAAMS,IAAIvD,GAA8B,GACxCgmB,GAAmB,MACnB1nB,EAAE,gBAAgBkX,YAAY,UAC9B2qC,EAAQ36B,SAAS,UAEjB,MAAMre,EAAU6G,IAAiBC,KAC3Bk4B,EAASD,GAAgB/+B,GAAW,CAAC,GAC3C7I,EAAE,kBAAkB4X,KAAK+6B,GAAgB9K,IAAS3gB,SAAS,WAE3D3Q,GAAWsxB,EACb,CACA,OAAO,CACT,CAEA,GAA2B,oBAAvBga,EAAQ5yC,KAAK,MAA6B,CAC5C/S,EAAEmc,iBACFnc,EAAE4lD,2BACF,MAAMjP,EAAkBruC,GAAMC,IAAI,4BAA4B,GACxDs9C,EAAiB/hD,EAAE,kBAAkBgX,SAAS,WAEpD,GAAI67B,GAAmBkP,EAErBv9C,GAAMS,IAAI,4BAA4B,GACtCjF,EAAE,kBAAkBkX,YAAY,WAChClX,EAAE,gBAAgBkX,YAAY,cACzB,CAEL1S,GAAMS,IAAI,4BAA4B,GACtCT,GAAMS,IAAIvD,GAA8B,GACxCgmB,GAAmB,MACnB1nB,EAAE,gBAAgBkX,YAAY,UAC9B2qC,EAAQ36B,SAAS,UAEjB,MAAMre,EAAU6G,IAAiBC,KACjC3P,EAAE,kBAAkB4X,KAAK86B,GAAmB7pC,IAAUqe,SAAS,WAE/D8sB,IACF,CACA,OAAO,CACT,CAEA,GAA2B,gBAAvB6N,EAAQ5yC,KAAK,MAAyB,CACxC/S,EAAEmc,iBACFnc,EAAE4lD,2BACF,MAAME,EAAcv6B,OAAwBzU,EAAUC,UAChD8uC,EAAiB/hD,EAAE,kBAAkBgX,SAAS,WAEpD,GAAIgrC,GAAeD,EAEjBr6B,GAAmB,MACnB1nB,EAAE,kBAAkBkX,YAAY,WAChClX,EAAE,gBAAgBkX,YAAY,cACzB,CAEL1S,GAAMS,IAAIvD,GAA8B,GACxC8C,GAAMS,IAAI,4BAA4B,GACtCyiB,GAAmB1U,EAAUC,WAC7BjT,EAAE,gBAAgBkX,YAAY,UAE9B,MAAMT,EAASzW,EAAE,kBACjByW,EAAOmB,KAAK5E,EAAUmD,eAAe+Q,SAAS,WAC9ClU,EAAUuD,WAAWE,EACvB,CACA,OAAO,CACT,CACAva,EAAE0a,kBAEFpS,GAAMS,IAAIvD,GAA8B,GACxC8C,GAAMS,IAAI,4BAA4B,GACtC,MAAMpI,EAAYglD,EAAQ3mD,KAAK,SACzB+mD,EAAmBx6B,KACzB,OAAIw6B,IAAqBplD,GAAamD,EAAE,kBAAkBgX,SAAS,gBACjEmX,MAGFnuB,EAAE,gBAAgBkX,YAAY,UAC9B2qC,EAAQ36B,SAAS,UACblnB,EAAE,sBAAsBpF,QAAUqnD,GACpCV,KAEF75B,GAAmB7qB,QACnB6a,WAAW,IAAMmN,KAAmB,GAEtC,CACA,MAAMq9B,EAAQvT,EAAQ73B,QAAQ,aAC9B,GAAIorC,EAAMtnD,OAGR,OAFAsB,EAAE0a,uBACFurC,GAAajmD,EAAGgmD,EAAM,IAGxB,MAAME,EAAWzT,EAAQ73B,QAAQ,iBACjC,GAAIsrC,EAASxnD,OAAQ,CAEnB,GADAsB,EAAE0a,kBACEwrC,EAASprC,SAAS,aAAeorC,EAASprC,SAAS,UAAW,OAClE,MAAMqrC,EAAUxnC,SAASunC,EAASlnD,KAAK,SACjCo1C,EAAY7oB,KAQlB,YAPI6oB,IACF3sB,GAAgB2sB,GAAa+R,EAC7Bx9B,KACA2gB,sBAAsB,KACpBxlC,EAAE,sBAAsBixC,UAAU,MAIxC,CAEF,GAEFjxC,EAAE,mBACC0W,IAAI,SACJC,GAAG,QAASza,IACXA,EAAE0a,kBACEwM,KACJ0E,IAAmB,GACnBjD,QAGJ7kB,EAAE,qBACC0W,IAAI,SACJC,GAAG,QAASza,IACXA,EAAE0a,kBACEwM,KACJ0E,IAAmB,GACnBjD,QAIJ7kB,EAAE,oBACC0W,IAAI,SACJC,GAAG,QAASvF,MAAMlV,IAIjB,GAHAA,EAAE0a,kBAGEwM,GAAgB,OAGpB,GAAID,GAEF,YADIvU,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,2BAI9BxnB,EAAE9D,EAAEu0B,eACE3rB,KAAK,KAKxB6iB,GAAqB,CAAC,GAGtBjY,GAAgB,KAGhBgU,IAAoB,EACpBJ,GAAe7U,QACXG,OAAO+4B,gBAAgB/4B,OAAO+4B,eAAel5B,QAGjD,MAAM+4B,EAAWxnC,EAAE,wBACnBwnC,EAAS1iC,KAAK,KAAKoS,YAAY,oBAC/BswB,EAASv4B,KAAK,QAAS,UAAUwI,IAAI,QAAS,IAM9C,MAAM5Z,EAAWymB,KACbzmB,IACF6R,GAAgB7R,GAKlBmC,EAAE,yDAAyD4R,SAG3DiT,OAMJ7kB,EAAE,yBACC0W,IAAI,SACJC,GAAG,QAASvF,MAAMlV,IAEjB,GADAA,EAAE0a,kBACEwM,GAAgB,OACpB,MAAMmB,EAAMC,KAAUC,QACtB,GAAIF,GAAmC,mBAArBA,EAAI+9B,aACpB,UACQ/9B,EAAI+9B,cACZ,CAAE,MAAOnoC,GACPne,QAAQmK,MAAM,gBAAiBgU,GAC3BvL,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,WACzC,MAEIyI,OAAO4I,QACT5I,OAAO4I,OAAOgQ,QAAQ,gDAG9BxnB,EAAE,QACC0W,IAAI,sBACJC,GAAG,qBAAsB,oBAAqB,SAAUza,GACvDA,EAAE0a,kBACF1a,EAAEmc,iBACE+K,IACJkoB,IACF,GAEFtrC,EAAE,qBACC0W,IAAI,SACJC,GAAG,QAASza,IACXA,EAAE0a,kBACEwM,IACJsL,GAAc,CACZK,YAAa,KACbC,WAAY,WAmBlBhvB,EAAE,mBACC0W,IAAI,SACJC,GAAG,QAASvF,MAAMlV,IAEjB,GADAA,EAAE0a,kBACEwM,GAAgB,OACpB,MAAMmB,EAAMC,KAAUC,QACtB,GAAIF,GAAmC,mBAArBA,EAAI+9B,aACpB,IACEtmD,QAAQC,IAAI,sBACNsoB,EAAI+9B,cACZ,CAAE,MAAOnoC,GACPne,QAAQmK,MAAM,gBAAiBgU,EACjC,MAEAne,QAAQG,KAAK,gCAGnB6D,EAAE,wBACC0W,IAAI,SACJC,GAAG,QAASvF,eAAgBlV,GAE3B,GADAA,EAAE0a,kBACEwM,GAAgB,OACpB,IAAI7mB,EAAa,KAOjB,GALEA,EADEmnB,IAAqBhU,GACVA,GAEAC,KAGXpT,EAAY,OAERopC,GAAmBppC,GAAY,GAAM,GAI3CyD,EAAE,yBAAyBkX,YAAY,wBAGnCtI,OAAO+4B,gBAAgB/4B,OAAO+4B,eAAel5B,QACjDiV,IAAoB,EAGpB,MAAMmD,EAAO7mB,EAAE3F,MACDwsB,EAAK/hB,KAAK,KAClBoS,YAAY,uCAAuCgQ,SAAS,WAClEL,EAAK5X,KAAK,QAAS,UAAUwI,IAAI,QAAS,IAC1CoP,EAAK8I,KAAK,YAAY,EAGxB,MACM/gB,OAAO4I,QAAQ5I,OAAO4I,OAAOrR,MAAM,gBAE3C,GAEF,MAAMkqC,EAAerwC,EAAE,qBACvB,GAAIqwC,EAAaz1C,OAAQ,CACvB,IAAI2nD,EACAC,GAAc,EAClBnS,EACG35B,IAAI,yCACJC,GAAG,mBAAoB,KACtB6rC,GAAc,IAEf7rC,GAAG,iBAAkB,WACpB6rC,GAAc,EACd,MAAMtiD,EAAMF,EAAE3F,MAAM6F,MACdowC,EAAY7oB,KACd6oB,IACF1sB,GAAkB0sB,GAAapwC,EAC/ByjB,GAAgB2sB,GAAa,EAC7BzrB,KACAnN,WAAW,KACT1X,EAAE,qBAAqBmY,SACtB,GAEP,GACCxB,GAAG,QAAS,WACX,GAAI6rC,EAAa,OACjB,MAAMtiD,EAAMF,EAAE3F,MAAM6F,MACduiD,EAAiBpoD,KAAKooD,eACtBC,EAAeroD,KAAKqoD,aAC1BvjB,aAAaojB,GACbA,EAAgB7qC,WAAW,KACzB,MAAM44B,EAAY7oB,KAClB,GAAI6oB,EAAW,CACb1sB,GAAkB0sB,GAAapwC,EAC/ByjB,GAAgB2sB,GAAa,EAC7B,MAAMqS,EAAUjtC,SAASktC,eAAiBltC,SAASktC,cAAcC,UAAUn2C,SAAS,oBAEpF,GADAmY,KACI89B,EAAS,CACX,MAAMG,EAAY9iD,EAAE,qBAEpB,GADA8iD,EAAU3qC,QACN2qC,EAAUloD,QAAUkoD,EAAU,GAAGC,kBACnC,IACED,EAAU,GAAGC,kBAAkBN,EAAgBC,EACjD,CAAE,MAAOxmD,GAAI,CAEjB,CACF,GACC,IACL,EACJ,CAEA8D,EAAE,2BACC0W,IAAI,SACJC,GAAG,QAAS,SAAUza,GACrBA,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAM/Z,EAAYmD,EAAE3F,MAAMa,KAAK,SACzB2N,EAAU6G,IAAiBC,KACjC,GAAI9G,EACF,IAAK,MAAMhO,KAAOgO,EAAS,CACzB,MAAM8B,EAAQ9B,EAAQhO,GACtB,GAAI8P,GAAOlI,OAAS5F,EAAW,CAC7B,MAAMwqC,EAAY,CAChBtqC,QAAS4N,EAAM3B,UAAU,IAAM,GAC/B2V,KAAMhU,EAAM3B,SAASpN,MAAM,IAAM,GACjCf,IAAKA,GAGP,YADA27B,GAAsB6Q,EAExB,CACF,CAEEz4B,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,WAC3C,GAIFxnB,EAAE,yBACC0W,IAAI,SACJC,GAAG,QAAS,SAAUza,GACrBA,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAM/Z,EAAYmD,EAAE3F,MAAMa,KAAK,SACzBisC,EAAS/e,KACT/V,EAAU80B,EAAOtqC,IAAc,OArqbnB+X,MAsqblBuyB,EAAOtqC,GAAyB,SAAZwV,EAAqB,OAAS,OAtqbhCuC,EAuqbFuyB,EAvqbO3iC,GAAMS,IAAIrD,EAA0BgT,GAwqb3DiQ,IACF,GAGF7kB,EAAE,2BACC0W,IAAI,eACJC,GAAG,cAAe,SAAUza,GAC3B,GAAiB,IAAbA,EAAE6jC,OAAc,OACpB7jC,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAM23B,EAASl0C,KACfk0C,EAAOvO,kBAAkB9jC,EAAE+jC,WAC3BjgC,EAAEuuC,GAAQrnB,SAAS,UACnB,MAAMzQ,EAASzW,EAAE,kBACXw4C,EAAc/hC,EAAOuX,SACrB0Q,EAASxiC,EAAEyiC,QACX9hC,EAAYmD,EAAEuuC,GAAQrzC,KAAK,SAEjCqzC,EAAOnO,cAAgB,SAAUnB,GAC/B,MAAMnE,EAAKmE,EAAMN,QAAUD,EAC3B,IAAI+Z,EAAYD,EAAc1d,EAC1B2d,EAAY12C,IAAkB02C,EAAY12C,GAC1C02C,EAAYz2C,IAAkBy2C,EAAYz2C,GAC9CyU,EAAOgB,IAAI,SAAUghC,EAAY,KACnC,EACAlK,EAAOhO,YAAc,SAAUmY,GAK7B,GAJA14C,EAAEuuC,GAAQr3B,YAAY,UACtBq3B,EAAO/N,sBAAsBkY,EAAIzY,WACjCsO,EAAOnO,cAAgB,KACvBmO,EAAOhO,YAAc,KACjB1jC,EAAW,CACb,MAAM+7C,EAAU1wB,KAChB0wB,EAAQ/7C,GAAage,SAASpE,EAAOgB,IAAI,WACzC0Q,GAAiBywB,GACjBniC,EAAOyQ,SAAS,kBAClB,CACF,CACF,GAGFlnB,EAAE,2BACC0W,IAAI,YACJC,GAAG,WAAY,SAAUza,GACxBA,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAM/Z,EAAYmD,EAAE3F,MAAMa,KAAK,SAC/B,GAAI2B,EAAW,CACb,MAAM+7C,EAAU1wB,YACT0wB,EAAQ/7C,GACfsrB,GAAiBywB,GACjB54C,EAAE,kBAAkByX,IAAI,SAAU,IAAIP,YAAY,kBACpD,CACF,GAGFkjB,EAASzjB,GAAG,QAAS,mBAAoB,SAAUza,GACjDA,EAAE0a,kBACF,MAAMosC,EAAQhjD,EAAE3F,MAAMa,KAAK,SACtB8nD,IAELz6B,GAAmBy6B,GAGnBn+B,KACF,GAEA7kB,EAAE,qBACC0W,IAAI,gBACJC,GAAG,eAAgB,SAAUza,GAC5B,GAAI8D,EAAE9D,EAAEsQ,QAAQsK,QAAQ,oDAAoDlc,OAAQ,OACpFsB,EAAEmc,iBACFnc,EAAE0a,kBACF,MAAM/Z,EAAY4qB,KAClB,GAAI5qB,EAAW,CACb,MAAM+7C,EAAU1wB,YACT0wB,EAAQ/7C,GACfsrB,GAAiBywB,GACjB54C,EAAE,kBAAkByX,IAAI,SAAU,IAAIP,YAAY,kBACpD,CACF,GAEFlX,EAAE,kBACC0W,IAAI,SACJC,GAAG,QAAS,SAAUza,GACrBA,EAAE0a,kBACF,MAAMsB,EAASlY,EAAE,qBAGjB,GAAIkY,EAAOtd,QAAUsd,EAAOhY,MAE1B,YADAgY,EAAOhY,IAAI,IAAIK,QAAQ,SAAS4X,QAMlC,GAD0B3T,GAAMC,IAAI/C,GAA8B,GAMhE,OAHA8C,GAAMS,IAAIvD,GAA8B,GACxCgmB,GAAmB,WACnB7C,KAKFsJ,IACF,GAEFnuB,EAAE,QACC0W,IAAI,oBACJC,GAAG,mBAAoB,mBAAoB,SAAUza,GACpDA,EAAE0a,kBACF1a,EAAEmc,iBAEF,MAAMwO,EAAO7mB,EAAE3F,MACT4P,EAAS4Q,SAASgM,EAAK3rB,KAAK,OAAQ,IACpC+nD,EAAYpoC,SAASgM,EAAK3rB,KAAK,cAAe,IAI9CgoD,EADQr8B,EAAK/P,QAAQ,kBACNhS,KAAK,uBACpBwxB,EAAW4sB,EAAOhoD,KAAK,OACvB2B,EAAYqmD,EAAOhoD,KAAK,UAAY,GAGpC2N,EAAU6G,IAAiBC,KACjC,IAAK9G,IAAYA,EAAQytB,GAAW,OAEpC,MAAMv5B,EAAU8L,EAAQytB,GAAUttB,QAAQ,IAAM,GAC1CpL,EAAUiL,EAAQytB,GAAUttB,QAAQiB,EAAS,IAAM,GAGnD62C,EAAgB,CAAC,IAAK,OAAQ,OAAQ,IAAK,IAAK,MAAO,YAAa,KAG1E,IAAIhhC,EAAU4B,EAAmB7kB,GAGjC,MAAMgkD,EAAiB9jD,EAAQyK,UAAU1J,GAAKA,GAAK4B,OAAO5B,GAAGsK,SAAS,OACtE,GAAIy4C,GAAkB,GAAKjjD,EAAQijD,GAAiB,CAClD,MAAMtqB,EAAY72B,OAAO9B,EAAQijD,IAAiB1gD,OAClD,GAAIo2B,IAAcuqB,EAAc14C,SAASmuB,EAAUjb,eAAgB,CACjE,MAAMylC,EAAkBxqB,EACrB7tB,MAAM,WACNzN,IAAIwE,GAAKA,EAAEU,QACX2F,OAAOrG,GAAKA,IAAMqhD,EAAc14C,SAAS3I,EAAE6b,gBAC9C,GAAIylC,EAAgBnmD,OAAS,EAAG,CAE9B,MAAMomD,EAAiBlhC,EAAQ7kB,IAAIQ,GAAKA,EAAEskB,MAAMzE,eAE1C4lC,EAAaH,EAChBj7C,OAAOumB,IAAQ20B,EAAe54C,SAASikB,EAAI/Q,gBAC3CrgB,IAAIoxB,IAAO,CACVtM,MAAOsM,EACP1pB,KAAM,kBACN4K,KAAM,SACNyS,SAAU,qBAAqBqM,KAC/BpM,WAAW,KAGfH,EAAU,IAAIA,KAAYohC,EAC5B,CACF,CACF,CAEA,MAAMiC,EAASrjC,EAAQmjC,GAGvB,GAAIE,GAA0B,gBAAhBA,EAAO51C,KAAwB,CAC3C,MAAM61C,EAAYxlD,EAAQ,IAAM,KAGhC,IAAIylD,EAAa,KACjB,MAAMC,EAAavmD,EAAQyK,UAAU1J,GAAKA,GAAKA,EAAEsK,SAAS,QACpDm7C,EAAUxmD,EAAQyK,UAAU1J,GAAKA,IAAMA,EAAEsK,SAAS,OAAStK,EAAEsK,SAAS,QAG5E,GAAIk7C,EAAa,GAAK1lD,EAAQ0lD,GAAa,CACzC,MAAMpjD,EAAM6hB,GAAoBnkB,EAAQ0lD,IACpCpjD,EAAM,IAAGmjD,EAAanjD,EAC5B,CAEA,GAAmB,OAAfmjD,GAAuBE,EAAU,GAAK3lD,EAAQ2lD,GAAU,CAC1D,MAAMrjD,EAAM6hB,GAAoBnkB,EAAQ2lD,IACpCrjD,EAAM,IAAGmjD,EAAanjD,EAC5B,CAGA,MAAMsjD,EAAa5gC,GAAgBugC,EAAOnjC,SAAUpiB,EAASb,GAa7D,OAZA6C,EAAsB4jD,EAAY,eAGf,OAAfH,GAAuBA,EAAa,EACtC30B,GAAc,CACZK,YAAas0B,EACbr0B,WAAYo0B,EACZh0B,cAAe,WAGjBpvB,EAAE,kBAAkBmY,QAGxB,CAEA,GAAIgrC,GAAUA,EAAOnjC,SAAU,CAE7B,MAAMnX,EAAU6G,IAAiBC,KACjC,GAAI9G,GAAWA,EAAQytB,GAAW,CAChC,MAAMv5B,EAAU8L,EAAQytB,GAAUttB,QAAQ,IAAM,GAC1CpL,EAAUiL,EAAQytB,GAAUttB,QAAQiB,EAAS,IAAM,GACnDqtB,EAAU15B,EAAQ,IAAM,KAG9B,GAAqB,OAAjBulD,EAAOpjC,MAAgB,CACVlI,KACf7X,EAAE,oBAAoB4R,SAEtB,MAAM+Z,EAAIlK,IAEJ4N,EAAUrvB,EAAE,0QAEqB2rB,EAAEvL,4BAA4BuL,EAAEtL,iMACDsL,EAAEjL,uJACNlhB,EAAW83B,4LAEoD3L,EAAE7K,uCAAuC6K,EAAEtL,kCAAkCsL,EAAErL,oQAEvHqL,EAAE7K,4BAA4B6K,EAAEtL,kCAAkCsL,EAAErL,6IACtEqL,EAAE1K,mDAAmD0K,EAAEzK,iMAM9IlhB,EAAE,QAAQgY,OAAOqX,GAEjB,MAAMo0B,EAAYp0B,EAAQ,GAC1Bo0B,EAAUvjB,MAAMwjB,YAAY,WAAY,QAAS,aACjDD,EAAUvjB,MAAMwjB,YAAY,MAAO,IAAK,aACxCD,EAAUvjB,MAAMwjB,YAAY,OAAQ,IAAK,aACzCD,EAAUvjB,MAAMwjB,YAAY,QAAS,IAAK,aAC1CD,EAAUvjB,MAAMwjB,YAAY,SAAU,IAAK,aAC3CD,EAAUvjB,MAAMwjB,YAAY,QAAS,QAAS,aAC9CD,EAAUvjB,MAAMwjB,YAAY,SAAU,QAAS,aAC/CD,EAAUvjB,MAAMwjB,YAAY,UAAW,OAAQ,aAC/CD,EAAUvjB,MAAMwjB,YAAY,kBAAmB,SAAU,aACzDD,EAAUvjB,MAAMwjB,YAAY,cAAe,SAAU,aACrDD,EAAUvjB,MAAMwjB,YAAY,UAAW,aAAc,aACrDhsC,WAAW,IAAM2X,EAAQvqB,KAAK,kBAAkBqT,QAAS,IAEzD,MAAMwrC,EAAc,KAClB,MAAMC,EAAMv0B,EAAQvqB,KAAK,kBAAkB5E,MAAMC,OACjD,GAAIyjD,EAAK,CAEPhkD,EADmB,UAAU03B,OAAassB,KACR,UAClC5jD,EAAE,kBAAkBmY,OACtB,CACAkX,EAAQzd,UAcV,OAXAyd,EAAQvqB,KAAK,iBAAiBspB,MAAMu1B,GACpCt0B,EAAQvqB,KAAK,kBAAkB6R,GAAG,UAAW,SAAUktC,GACtC,UAAXA,EAAGhpD,MACLgpD,EAAGxrC,iBACHsrC,IAEJ,GACAt0B,EAAQvqB,KAAK,mBAAmBspB,MAAM,IAAMiB,EAAQzd,eACpDyd,EAAQ1Y,GAAG,QAAS,SAAUktC,GACxB7jD,EAAE6jD,EAAGr3C,QAAQwK,SAAS,oBAAoBqY,EAAQzd,QACxD,EAEF,CAGA,MAAM4xC,EAAa5gC,GAAgBugC,EAAOnjC,SAAUpiB,EAASb,GAC7D6C,EAAsB4jD,EAAY,UAClCxjD,EAAE,kBAAkBmY,OACtB,CACF,CACF,GAGFnY,EAAE,QACC0W,IAAI,yBACJC,GAAG,wBAAyB,gBAAiB,SAAUza,GACtDA,EAAE0a,kBACF8X,GAAc,CACZK,YAAa,GACbC,WAAY,QACZC,SAAU,SAEd,GAGFjvB,EAAE,QACC0W,IAAI,6BACJC,GAAG,4BAA6B,uBAAwB,SAAUza,GACjEA,EAAE0a,kBACa5W,EAAE3F,MAAMyc,QAAQ,uBACxBC,YAAY,WACrB,GAGF/W,EAAE,QACC0W,IAAI,uBACJC,GAAG,sBAAuB,0CAA2C,SAAUza,GAC9EA,EAAE0a,kBACF,MAAM/Z,EAAYmD,EAAE3F,MAAMa,KAAK,SACzB0iD,EAAa59C,EAAE3F,MAAMa,KAAK,WAAa,GAEzC2B,IAEF2H,GAAMS,IAAIvD,GAA8B,GAGxCgmB,GAAmB7qB,GAGf+gD,IACFh6B,GAAkB/mB,GAAa+gD,EAC/Bj6B,GAAgB9mB,GAAa,GAI/BgoB,KAGI+4B,GACFlmC,WAAW,KACT,MAAMQ,EAASlY,EAAE,qBACbkY,EAAOtd,QAAQsd,EAAOC,SACzB,KAGT,GAGFnY,EAAE,QACC0W,IAAI,yBACJC,GAAG,wBAAyB,uBAAwB,SAAUza,GAC7DA,EAAE0a,kBACF1a,EAAEmc,iBAGF,MAAM0Q,EAAW/oB,EAAE3F,MAAM4U,KAAK,mBAAqB,KAC7CwgB,EAAY5U,SAAS7a,EAAE3F,MAAM4U,KAAK,mBAAoB,KAAO,GAG7D4H,EAAQ7W,EAAE3F,MAAMyc,QAAQ,kBACxBgoC,EAAYjoC,EAAM/R,KAAK,uBAAuBiL,OAAO5P,OAIrD2jD,GADYjtC,EAAM/R,KAAK,uBAAuB5J,KAAK,UAAY,IACrCkN,SAAS,MAGzCsmB,GAAc,CACZK,YAAaU,EACbT,WAAYjG,EACZqG,cALoB00B,EAAgB,SAAWhF,GAQnD,GAEF9+C,EAAE,QACC0W,IAAI,uBACJC,GAAG,sBAAuB,qBAAsB,SAAUza,GACzDA,EAAE0a,kBACF1a,EAAEmc,iBACF,MAAM0W,EAAclU,SAAS7a,EAAE3F,MAAMa,KAAK,UAAW,KAAO,GACtD8zB,EAAahvB,EAAE3F,MAAMa,KAAK,SAAW,KACrCo8B,EAAUt3B,EAAE3F,MAAMa,KAAK,QAAU,GAGvC,GAAIo8B,EAAS,CAEX,MAAMysB,EAAkBj7B,GAAkB,SAAUkG,IAAe,GACnEuE,GAAiB,CACfnE,cAAe,SACfoE,eAAgBuwB,EAChBrwB,aAAc4D,EACdxD,cAAe/E,GAEnB,MACEL,GAAc,CACZK,YAAaA,EACbC,WAAYA,EACZI,cAAe,UAGrB,GAEFpvB,EAAE,QACC0W,IAAI,uBACJC,GAAG,sBAAuB,qBAAsB,SAAUza,GACzDA,EAAE0a,kBACF1a,EAAEmc,iBACF,MAAM2rC,EAAehkD,EAAE3F,MAAMa,KAAK,aAAe,OAEjD0E,EADmB,WAAWokD,KACI,UAClChkD,EAAE,kBAAkBmY,OACtB,GAEFnY,EAAE,QACC0W,IAAI,2BACJC,GAAG,0BAA2B,yBAA0B,SAAUza,GACjEA,EAAE0a,kBACF1a,EAAEmc,iBACF,MAAM4rC,EAAWjkD,EAAE3F,MAAMa,KAAK,SAAW,KAEzC0E,EADmB,WAAWqkD,KACI,UAClCjkD,EAAE,kBAAkBmY,OACtB,GAEFnY,EAAE,QACC0W,IAAI,4BACJC,GAAG,2BAA4B,0BAA2B,SAAUza,GACnEA,EAAE0a,kBACF1a,EAAEmc,iBACF,MAAM+qC,EAAYpjD,EAAE3F,MAAMa,KAAK,UAAY,KAGrC2N,EAAU6G,IAAiBC,KACjC,IAAI0zC,EAAa,KAEjB,GAAIx6C,EAEF,IAAK,MAAMhO,KAAOgO,EAAS,CACzB,MAAM8B,EAAQ9B,EAAQhO,GACtB,GAAK8P,GAAUA,EAAMlI,MAASkI,EAAM3B,UAChC2B,EAAMlI,KAAK2F,SAAS,OAASuC,EAAMlI,KAAK2F,SAAS,OAAO,CAC1D,MAAMrL,EAAU4N,EAAM3B,QAAQ,IAAM,GAE9B0tB,EAAU35B,EAAQyK,UAAU1J,GAAKA,IAAMA,EAAEsK,SAAS,OAAStK,EAAEsK,SAAS,UAAY,EAClFk7C,EAAavmD,EAAQyK,UAAU1J,GAAKA,GAAKA,EAAEsK,SAAS,QACpDm7C,EAAUxmD,EAAQyK,UAAU1J,GAAKA,IAAMA,EAAEsK,SAAS,OAAStK,EAAEsK,SAAS,QAE5E,IAAK,IAAI1N,EAAI,EAAGA,EAAIiQ,EAAM3B,QAAQpO,OAAQF,IAAK,CAC7C,MAAMoC,EAAM6N,EAAM3B,QAAQtO,GAC1B,GAAIoC,GAAOA,GAAiB,IAAb45B,EAAiB,EAAIA,KAAa0sB,EAAW,CAE1D,GAAIE,EAAa,GAAKxmD,EAAIwmD,GAAa,CACrC,MAAMpjD,EAAM6hB,GAAoBjlB,EAAIwmD,IACpC,GAAIpjD,EAAM,EAAG,CACXmjD,EAAanjD,EACb,KACF,CACF,CAEA,GAAIqjD,EAAU,GAAKzmD,EAAIymD,GAAU,CAC/B,MAAMrjD,EAAM6hB,GAAoBjlB,EAAIymD,IACpC,GAAIrjD,EAAM,EAAG,CACXmjD,EAAanjD,EACb,KACF,CACF,CACA,KACF,CACF,CACA,GAAmB,OAAfmjD,EAAqB,KAC3B,CACF,CAKFzjD,EADmB,WAAWwjD,KACI,UAGf,OAAfC,GAAuBA,EAAa,EACtC30B,GAAc,CACZK,YAAas0B,EACbr0B,WAAYo0B,EACZh0B,cAAe,WAIjBpvB,EAAE,kBAAkBmY,OAExB,GAEFnY,EAAE,QACC0W,IAAI,6BACJC,GAAG,4BAA6B,2BAA4B,SAAUza,GACrEA,EAAE0a,kBACF1a,EAAEmc,iBACF,MAAM6rC,EAAWlkD,EAAE3F,MAAMa,KAAK,SAAW,KAEzC0E,EADmB,UAAUskD,aACK,UAClClkD,EAAE,kBAAkBmY,OACtB,GAEFnY,EAAE,QACC0W,IAAI,sBACJC,GAAG,qBAAsB,oBAAqB,SAAUza,GACvDA,EAAE0a,kBACF1a,EAAEmc,iBACF,MAAMif,EAAUt3B,EAAE3F,MAAMa,KAAK,QAAU,KACxB2c,KAGf7X,EAAE,oBAAoB4R,SAGtB,MAAM+Z,EAAIlK,IAEJ4N,EAAUrvB,EAAE,yQAEsC2rB,EAAEvL,4BAA4BuL,EAAEtL,qLACxBsL,EAAEjL,2IACNlhB,EAAW83B,oKAEoD3L,EAAE7K,uCAAuC6K,EAAEtL,kCAAkCsL,EAAErL,4OAEvHqL,EAAE7K,4BAA4B6K,EAAEtL,kCAAkCsL,EAAErL,iIACtEqL,EAAE1K,mDAAmD0K,EAAEzK,iJAMxIlhB,EAAE,QAAQgY,OAAOqX,GACjB,MAAMo0B,EAAYp0B,EAAQ,GAC1Bo0B,EAAUvjB,MAAMwjB,YAAY,WAAY,QAAS,aACjDD,EAAUvjB,MAAMwjB,YAAY,MAAO,IAAK,aACxCD,EAAUvjB,MAAMwjB,YAAY,OAAQ,IAAK,aACzCD,EAAUvjB,MAAMwjB,YAAY,QAAS,IAAK,aAC1CD,EAAUvjB,MAAMwjB,YAAY,SAAU,IAAK,aAC3CD,EAAUvjB,MAAMwjB,YAAY,QAAS,QAAS,aAC9CD,EAAUvjB,MAAMwjB,YAAY,SAAU,QAAS,aAC/CD,EAAUvjB,MAAMwjB,YAAY,UAAW,OAAQ,aAC/CD,EAAUvjB,MAAMwjB,YAAY,kBAAmB,SAAU,aACzDD,EAAUvjB,MAAMwjB,YAAY,cAAe,SAAU,aACrDD,EAAUvjB,MAAMwjB,YAAY,UAAW,aAAc,aACrDhsC,WAAW,IAAM2X,EAAQvqB,KAAK,kBAAkBqT,QAAS,IAEzD,MAAMwrC,EAAc,KAClB,MAAMC,EAAMv0B,EAAQvqB,KAAK,kBAAkB5E,MAAMC,OACjD,GAAIyjD,EAAK,CAEPhkD,EADmB,UAAU03B,OAAassB,KACR,UAClC5jD,EAAE,kBAAkBmY,OACtB,CACAkX,EAAQzd,UAIVyd,EAAQvqB,KAAK,iBAAiBspB,MAAMu1B,GAGpCt0B,EAAQvqB,KAAK,kBAAkB6R,GAAG,UAAW,SAAUktC,GACtC,UAAXA,EAAGhpD,MACLgpD,EAAGxrC,iBACHsrC,IAEJ,GAGAt0B,EAAQvqB,KAAK,mBAAmBspB,MAAM,IAAMiB,EAAQzd,UACpDyd,EAAQ1Y,GAAG,QAAS,SAAUktC,GACxB7jD,EAAE6jD,EAAGr3C,QAAQwK,SAAS,oBAAoBqY,EAAQzd,QACxD,EACF,GAEF5R,EAAE,QACC0W,IAAI,0BACJC,GAAG,yBAA0B,wBAAyB,SAAUza,GAC/DA,EAAE0a,kBACF1a,EAAEmc,iBACF,MAAMif,EAAUt3B,EAAE3F,MAAMa,KAAK,QAAU,GAEjC2N,EAAU6G,IAAiBC,KAEjC,IAAIo0C,EAAkB,GAClBI,EAAe,GAInB,GAAIt7C,EACF,IAAK,IAAIhO,KAAOgO,EAAS,CACvB,IAAI8B,EAAQ9B,EAAQhO,GACpB,GAAK8P,GAAUA,EAAMlI,MAASkI,EAAM3B,QAApC,CAGA,GAAmB,SAAf2B,EAAMlI,MACJkI,EAAM3B,QAAQ,GAGhB,IAFA,IACIhI,GADU2J,EAAM3B,QAAQ,GAAG,IAAM,IACjBN,MAAM,aACjBhO,EAAI,EAAGA,EAAIsG,EAAMpG,OAAQF,IAAK,CACrC,IAAIkG,EAAQI,EAAMtG,GAAGkG,MAAM,2CAC3B,GAAIA,EAAO,CACTmjD,EAAkBlpC,SAASja,EAAM,GAAI,IAErC,KACF,CACF,CAKJ,GAAmB,UAAf+J,EAAMlI,MAAoB60B,EAC5B,IAAK,IAAI8sB,EAAI,EAAGA,EAAIz5C,EAAM3B,QAAQpO,OAAQwpD,IAAK,CAC7C,IAAItnD,EAAM6N,EAAM3B,QAAQo7C,GACxB,GAAItnD,GAAOA,EAAI,KAAOw6B,EAAS,CAG7B,IAFA,IACI+sB,GADavnD,EAAI,IAAM,IACD4L,MAAM,aACvBsL,EAAI,EAAGA,EAAIqwC,EAASzpD,OAAQoZ,IAAK,CACxC,IAAIswC,EAAWD,EAASrwC,GAAGpT,MAAM,2CACjC,GAAI0jD,EAAU,CACZH,EAAetpC,SAASypC,EAAS,GAAI,IAErC,KACF,CACF,CACA,KACF,CACF,CAnCmD,CAqCvD,CAGF/wB,GAAiB,CACfnE,cAAe,SACfoE,eAAgBuwB,EAChBrwB,aAAc4D,EACdxD,cAAeqwB,EACfl1B,SAAU,SAEd,GAEFjvB,EAAE,QACC0W,IAAI,0BACJC,GAAG,yBAA0B,4BAA6B,SAAUza,GACnEA,EAAE0a,kBAEF,MAAM0f,EAAWt2B,EAAE3F,MAAMa,KAAK,aACxB0D,EAAWic,SAAS7a,EAAE3F,MAAMa,KAAK,aAAc,IAErD,IAAKo7B,GAAY3tB,MAAM/J,GAAW,OAElC,MAAMiK,EAAU6G,IAAiBC,KACjC,IAAK9G,IAAYA,EAAQytB,GAAW,OAEpC,MAAM0b,EAAQnpC,EAAQytB,GAChBz5B,EAAYm1C,EAAMvvC,MAAQ,KAC1B1F,EAAUi1C,EAAMhpC,QAAQ,IAAM,GAC9BpL,EAAUo0C,EAAMhpC,QAAQpK,EAAW,GAEzC,IAAKhB,EAAS,OAEd,MAAMgG,EAASiU,KACToL,EAAQrlB,EAAQ,IAAM,MAItBghD,EAAahgD,EAGnB,IAAI2gD,EAAW,GACf3hD,EAAQ/B,QAAQ,CAACopC,EAAMsB,KACrB,GAAIA,GAAQ,GANQ,IAMHA,EAAwB,OAEzC,IADsBxpC,EAAQwpC,IAAS,IACrBn+B,SAAS,MAAO,OAElC,MAAMsa,EAAa3lB,EAAQwpC,IAAS,KAAOA,EACrCpkB,EAASziB,OAAOulC,GAAQ,IAAI9kC,OAClC,IAAKgiB,EAAQ,OAEb,IAAImoB,EAAc,GACdsV,GAAY,EAEhB,MAAME,EAAc79B,GAAqBE,GAEzC,GAAIM,GAAmBN,EAAQO,GAAa,CAC1C,MAAM6hC,EAAYliC,GAAwBF,GAC1C,GAAIoiC,EAAU3pD,OAAS,EAAG,CACxBglD,GAAY,EACZ,IAAII,EAAU,GACduE,EAAU1oD,QAAQ,CAAC67B,EAAKh9B,KACtB,MAAM8pD,EAAc9pD,EAAI6pD,EAAU3pD,OAAS,EAAI,kDAAoD,GACnGolD,GAAW,2FAA2FwE,+FAC7BhlD,EAAWk4B,EAAIj1B,6CAC1Ei1B,EAAIx0B,SAAW,8HAA8H1D,EAAWk4B,EAAIx0B,mBAAqB,uCAGjMonC,EAAc,uCAAuC0V,SACvD,MAAO,GAAyB,IAArBuE,EAAU3pD,QAAgB2pD,EAAU,GAAGrhD,SAAU,CAC1D,MAAMw0B,EAAM6sB,EAAU,GACtBja,EAAc,mJACwC9qC,EAAWk4B,EAAIj1B,oKACkEjD,EAAWk4B,EAAIx0B,8CAExJ,CACF,MAAO,GAAI48C,EAAYllD,OAAS,EAAG,CACjCglD,GAAY,EACZ,IAAIK,EAAY,GAChBH,EAAYjkD,QAAQ,CAACoT,EAAMvU,KACzB,MAAM8pD,EAAc9pD,EAAIolD,EAAYllD,OAAS,EAAI,kDAAoD,GACrGqlD,GAAa,2FAA2FuE,0FAClChlD,EAAWyP,EAAKxM,wLAEXwM,EAAK1R,iHACIiC,EAAWyP,EAAKxM,2BAA2BwM,EAAK1R,4IAGtI+sC,EAAc,yCAAyC2V,SACzD,MAAO,GAA2B,IAAvBH,EAAYllD,OAAc,CACnCglD,GAAY,EACZ,MAAM3wC,EAAO6wC,EAAY,GACzBxV,EAAc,+JACsD9qC,EAAWyP,EAAKxM,gLAEXwM,EAAK1R,6GACIiC,EAAWyP,EAAKxM,2BAA2BwM,EAAK1R,qIAEpI,MAAO,IAAIskB,GAAcM,IAAYA,EAAO/Z,SAAS,MAAS+Z,EAAO/Z,SAAS,KAMvE,CACL,MAAM+3C,EAAa/4B,GAAcjF,GACjCmoB,EAAc6V,EACV,0BAA0BA,MAAe3gD,EAAW2iB,YACpD3iB,EAAW2iB,EACjB,KAXoF,CAClF,MAAM5Z,EAASwZ,GAAoBI,GACnCmoB,EAAc,2GACE9qC,EAAW2iB,sGACmD3iB,EAAWkjB,wBAAiCna,uIAE5H,CAQAg3C,GAAY,eADK,yBAA2BK,EAAY,kBAAoB,kBAC1BpgD,EAAW82B,mBAA0B92B,EAAW3C,iBAAyB+hD,gBAAyBrY,gBAAmB2L,mBAAmBjN,GAAQ,sDAC9JzlC,EAAWkjB,yDACX4nB,gCAKtC,IAAIsW,EAAc,GACdD,EAAej/B,EAAmB7kB,GACtC,MAAMgkD,EAAiB9jD,EAAQyK,UAAU1J,GAAKA,GAAK4B,OAAO5B,GAAGsK,SAAS,OACtE,GAAIy4C,EAAiB,GAAKjjD,EAAQijD,GAAiB,CACjD,MAAME,EAAkBrhD,OAAO9B,EAAQijD,IACpCn4C,MAAM,WACNzN,IAAIwE,GAAKA,EAAEU,QACX2F,OAAOrG,GAAKA,GACXshD,EAAgBnmD,OAAS,IAC3B+lD,EAAeI,EAAgB9lD,IAAIoxB,IAAO,CACxCtM,MAAOsM,EACP1pB,KAAM,kBACN4K,KAAM,SACNyS,SAAU,qBAAqBqM,KAC/BpM,WAAW,KAGjB,CACA,GAAI0gC,EAAa/lD,OAAS,EAAG,CAO3BgmD,EAAc,iCANKD,EAChB1lD,IACC,CAACkmD,EAAKC,IACJ,kCAA+C,UAAbD,EAAI5zC,KAAmB,aAAe,wBAAwB6zC,gBAAqBxC,yBAAkCuC,EAAIx+C,MAAQ,mBAAmBnD,EAAW2hD,EAAIphC,mBAExM7e,KAAK,WAEV,CAGA,MAAMujD,EAAW,2DAC+B7gD,EAAOkU,kCAAkClU,EAAO8hB,+BAA+B9hB,EAAO+hB,4OAGtFi5B,EAAa,yFACSp/C,EAAW82B,mBAA0B92B,EAAW3C,iBAAyB+hD,6BAAqD1M,mBAAmBjvB,OAAWzjB,EAAWyjB,mUAG1Ls8B,gCACrCqB,0DAKd5gD,EAAE,wBAAwB4R,SAC1B5R,EAAE,QAAQgY,OAAOysC,GAGjB,MAAMhB,EAAYzjD,EAAE,wBAAwB,GACxCyjD,IACFA,EAAUvjB,MAAMwjB,YAAY,WAAY,QAAS,aACjDD,EAAUvjB,MAAMwjB,YAAY,MAAO,IAAK,aACxCD,EAAUvjB,MAAMwjB,YAAY,OAAQ,IAAK,aACzCD,EAAUvjB,MAAMwjB,YAAY,QAAS,IAAK,aAC1CD,EAAUvjB,MAAMwjB,YAAY,SAAU,IAAK,aAC3CD,EAAUvjB,MAAMwjB,YAAY,QAAS,QAAS,aAC9CD,EAAUvjB,MAAMwjB,YAAY,SAAU,QAAS,aAC/CD,EAAUvjB,MAAMwjB,YAAY,UAAW,OAAQ,aAC/CD,EAAUvjB,MAAMwjB,YAAY,kBAAmB,SAAU,aACzDD,EAAUvjB,MAAMwjB,YAAY,cAAe,SAAU,aACrDD,EAAUvjB,MAAMwjB,YAAY,UAAW,aAAc,cAIvD1jD,EAAE,wBAAwB2W,GAAG,QAAS,SAAUktC,IAC1C7jD,EAAE6jD,EAAGr3C,QAAQwK,SAAS,wBAA0BhX,EAAE6jD,EAAGr3C,QAAQsK,QAAQ,sBAAsBlc,SAC7FoF,EAAE3F,MAAMuX,QAEZ,EACF,GAGF,WACE,MAAM8yC,EAAO1kD,EAAE0V,UACf,IAAIivC,EAAc,EACdC,EAAc,EAGlBF,EAAK/tC,GAAG,yBAA0B,iBAAkB,SAAUza,GACrB,IAAnCA,EAAEu7C,cAAc3W,QAAQlmC,SAC1B+pD,EAAczoD,EAAEu7C,cAAc3W,QAAQ,GAAGrC,QACzCmmB,EAAc1oD,EAAEu7C,cAAc3W,QAAQ,GAAGnC,QAE7C,GAEA+lB,EAAK/tC,GAAG,wBAAyB,iBAAkB,SAAUza,GAC3D,GAAuC,IAAnCA,EAAEu7C,cAAc3W,QAAQlmC,OAAc,OAE1C,MAAM48C,EAAQt7C,EAAEu7C,cAAc3W,QAAQ,GAChCoB,EAASjnB,KAAKikB,IAAIsY,EAAM/Y,QAAUkmB,GAIpCziB,EAAkB,IAHPjnB,KAAKikB,IAAIsY,EAAM7Y,QAAUimB,IAGX1iB,EAAS,KACpChmC,EAAE0a,kBACF5a,QAAQC,IAAI,8BAEhB,EACD,CA1BD,IA8BF,MAyUMkmD,GAAe,CAACjmD,EAAG+oC,KACvB,MAAM,GAAQzgB,KACdxkB,EAAE,sCAAsC4R,SACxC,MAAMizC,EAAW7kD,EAAE,yCACnBA,EAAE,QAAQgY,OAAO6sC,GAEjB,MAAM56C,EAAS4Q,SAAS7a,EAAEilC,GAAM/pC,KAAK,OAAQ,IACvCiE,EAAS0b,SAAS7a,EAAEilC,GAAM/pC,KAAK,OAAQ,IAC7C,GAAIyN,MAAMsB,IAAWtB,MAAMxJ,GAGzB,OAFAnD,QAAQG,KAAK,uBACb0oD,EAASjzC,SAGX,MAAM0kB,EAAWt2B,EAAEilC,GAAM/pC,KAAK,OAExB2B,EAAYmD,EAAEilC,GAAM/pC,KAAK,UAAY8E,EAAEilC,GAAMnuB,QAAQ,kBAAkBhS,KAAK,uBAAuBiL,OACnG/G,EAAU4rC,mBAAmB50C,EAAEilC,GAAM/pC,KAAK,QAC1C0I,EAASiU,KAGTyoC,EAAS,GAAGhqB,KAAYrsB,KAAU9K,IACnCyP,OAAO+4B,iBAAgB/4B,OAAO+4B,eAAiB,IAAIpkB,KAGxD,MAAMuhC,EAAal2C,OAAO+4B,eAAez6B,IAAIozC,GAKvCzB,GAFsB73B,KACesP,IAAa,IACvBluB,SAAS6B,GAGpClN,EAAU2S,KAAgB4mB,IAAWttB,UAAU,IAAM,GACrDpL,EAAU8R,KAAgB4mB,IAAWttB,UAAUiB,EAAS,IAAM,GAC9Dw2C,EAAa5mD,EAAY+C,UAAUC,EAAWe,EAASb,GACvDgoD,EAAgBhoD,EAAQoC,IAAW,GAEnCf,EAAgBqiD,GAAc5mD,EAAYuE,cAAcvB,EAAW4jD,EAAYsE,GAC/EzmD,EAAcmiD,GAAc5mD,EAAYyE,YAAYzB,EAAW4jD,GAGrE,IAAIuE,EAAe,GACfvE,IACFuE,EAAe,6EAEbA,GADE5mD,EAEA,+HAGA,2HAGF4mD,GADE1mD,EAEA,2HAGA,wHAIN,MAAM2mD,EAAOjlD,EAAE,qDAC+B4D,EAAOkU,6fAKvC+J,GAAc7Y,GAAW,4JAA8J+Y,GAAoB/Y,GAAW,UAAY,uBAClOg8C,sBACAF,EAAa,gJAAkJ,uBAC/JjG,EAAY,qHAAuH,mQAIjJ7+C,EAAE,QAAQgY,OAAOitC,GAGjB,MAAMC,EAAWllD,EAAE4O,QAAQmf,QACrBo3B,EAAYnlD,EAAE4O,QAAQof,SACtBo3B,EAASH,EAAKI,cAAgB,IAC9BC,EAAUL,EAAKxX,eAAiB,IACtC,IAAIhP,EAAUviC,EAAEuiC,QACZE,EAAUziC,EAAEyiC,SACXF,GAAWviC,EAAEu7C,eAAiBv7C,EAAEu7C,cAAc3W,SAAW5kC,EAAEu7C,cAAc3W,QAAQlmC,QACpF6jC,EAAUviC,EAAEu7C,cAAc3W,QAAQ,GAAGrC,QACrCE,EAAUziC,EAAEu7C,cAAc3W,QAAQ,GAAGnC,UAC3BF,GAAWviC,EAAEqpD,gBAAkBrpD,EAAEqpD,eAAe3qD,SAC1D6jC,EAAUviC,EAAEqpD,eAAe,GAAG9mB,QAC9BE,EAAUziC,EAAEqpD,eAAe,GAAG5mB,cAIhB7/B,IAAZ2/B,IAAuBA,EAAUymB,EAAW,QAChCpmD,IAAZ6/B,IAAuBA,EAAUwmB,EAAY,GAEjD,IAAIv3B,EAAO6Q,EAAU,EACjB9X,EAAMgY,EAAU,EAChB/Q,EAAOw3B,EAASF,IAAUt3B,EAAO6Q,EAAU2mB,EAAS,GACpDz+B,EAAM2+B,EAAUH,IAAWx+B,EAAMgY,EAAU2mB,EAAU,GAGrD13B,EAAO,IAAGA,EAAO,GACjBjH,EAAM,IAAGA,EAAM,GAEnBs+B,EAAKxtC,IAAI,CAAEkP,IAAKA,EAAM,KAAMiH,KAAMA,EAAO,OAEzC,MAAM43B,EAAW,KACfP,EAAKrzC,SACLizC,EAASjzC,UAEXizC,EAASluC,GAAG,QAAS6uC,GACrBP,EAAKngD,KAAK,cAAcspB,MAAMo3B,GAE9BP,EAAKngD,KAAK,mBAAmBspB,MAAM,KAC7BqyB,GAAcsE,IAChBlrD,EAAYuD,UAAUP,EAAW4jD,EAAYsE,EAAe/7C,GAC5D6b,MAEF2gC,MAIFP,EAAKngD,KAAK,qBAAqBspB,MAAM,KAC/BqyB,GAAcsE,IAChBlrD,EAAYkE,YAAYlB,EAAW4jD,EAAYsE,GAC/ClgC,MAEF2gC,MAIFP,EAAKngD,KAAK,iBAAiBspB,MAAM,KAC3BqyB,IACF5mD,EAAY8D,QAAQd,EAAW4jD,EAAY7iD,EAASb,GACpD8nB,MAEF2gC,MAIFP,EAAKngD,KAAK,mBAAmBspB,MAAM,KAC7BqyB,IACF5mD,EAAYsE,UAAUtB,EAAW4jD,GACjC57B,MAEF2gC,MAIFP,EAAKngD,KAAK,aAAaspB,MAAMhd,MAAMlV,IAKjC,GAJAA,EAAE0a,kBAIEhI,OAAOimC,cAAgBjmC,OAAOimC,aAAaG,aAC7C,IAEE,MAAMyQ,EAAcz8C,EACjBrJ,QAAQ,MAAO,QACfA,QAAQ,KAAM,OACdA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OAGlB,aAFMiP,OAAOimC,aAAaG,aAAa,mBAAmByQ,WAC1DD,GAEF,CAAE,MAAOrrC,GACPne,QAAQG,KAAK,qBAAsBge,EACrC,CAIF,MAeMurC,EAAe31C,IACnB,IACE,MAAM41C,EAAWjwC,SAASG,cAAc,YACxC8vC,EAASpoD,MAAQwS,EAGjB41C,EAASzlB,MAAM3jB,SAAW,QAC1BopC,EAASzlB,MAAMtS,KAAO,UACtB+3B,EAASzlB,MAAMvZ,IAAM,IACrBg/B,EAASC,aAAa,WAAY,IAElClwC,SAASqC,KAAK/B,YAAY2vC,GAE1BA,EAASvtC,SACTutC,EAAS5C,kBAAkB,EAAG,OAE9B,MAAM8C,EAAanwC,SAASowC,YAAY,QAGxC,GAFApwC,SAASqC,KAAK8rB,YAAY8hB,IAEtBE,EAEF,MAAM,IAAIzzC,MAAM,qBAEpB,CAAE,MAAO+H,GACPne,QAAQmK,MAAM,QAASgU,GACvBm1B,OAAO,oBAAqBv/B,EAC9B,GAzCaA,QA4CR/G,EA1CD0d,UAAUD,WAAa7X,OAAOm3C,gBAChCr/B,UAAUD,UACP8oB,UAAUx/B,GACVguB,KAAK,QACLyR,MAAM,KACLkW,EAAa31C,KAIjB21C,EAAa31C,GAkCjBy1C,MAIFP,EAAKngD,KAAK,aAAaspB,MAAM,KAC3B,MAAMvwB,EAAWymB,KACjB,IAAI0hC,EAAgB,KAKpB,GAJInoD,GAAYA,EAASy4B,IAAWttB,QAAQiB,EAAS,KACnD+7C,EAAgBnoD,EAASy4B,GAAUttB,QAAQiB,EAAS,GAAG9K,IAGnC,OAAlB6mD,EAAwB,CACrBt2C,KAAeA,GAAgBC,MAChCD,IAAiBA,GAAc4mB,IAAWttB,QAAQiB,EAAS,KAC7DyF,GAAc4mB,GAAUttB,QAAQiB,EAAS,GAAG9K,GAAU6mD,GAGxD,MAAM9D,EAAQliD,EAAEilC,GAChBid,EAAMjzC,KAAK,WAAYijC,mBAAmB8T,IAC1C9D,EAAMhnD,KAAK,MAAOg3C,mBAAmB8T,IAGrC,IAAIC,EAAiB/D,EACjBA,EAAMp9C,KAAK,mBAAmBlK,OAAS,EACzCqrD,EAAiB/D,EAAMp9C,KAAK,mBACnBo9C,EAAMlrC,SAAS,iBACxBivC,EAAiB/D,EAAMp9C,KAAK,mBACnBo9C,EAAMlrC,SAAS,mBACxBivC,EAAiB/D,EAAMp9C,KAAK,oBAG9B,MAAMq7C,EAAa/4B,GAAc4+B,GAC7B7F,IAAe+B,EAAMlrC,SAAS,sBAChCivC,EAAeruC,KAAK,0BAA0BuoC,MAAe6F,YAE7DC,EAAel2C,KAAKi2C,GAItBC,EAAe/uC,YAAY,2CACvBgrC,EAAMlrC,SAAS,uBAAuBkrC,EAAMhrC,YAAY,2CAE5DtI,OAAO+4B,eAAet6B,OAAOizC,GAEM,IAA/B1xC,OAAO+4B,eAAer6B,OACxBoW,IAAoB,EACpBkD,KAEJ,MACMhY,OAAO4I,QAAQ5I,OAAO4I,OAAOgQ,QAAQ,iBAE3Cg+B,MAIFP,EAAKngD,KAAK,eAAespB,MAAMhd,UAC7Bo0C,IAEA,IAAIU,EAAS1hD,GAAMC,IAAIrD,GAClB8kD,GAAW9mD,MAAM+I,QAAQ+9C,KAC5BA,EAAS,CAAC,sBAAuB,mBAAoB,kBAAmB,qBAG1E,IAFuBA,EAAO99C,SAAS,uBAEpB,CAEjB,MAAMyO,EAAQ7W,EAAEilC,GAAMnuB,QAAQ,kBAC9BD,EAAMY,IAAI,aAAc,iBAAiBA,IAAI,UAAW,KAAKA,IAAI,YAAa,cAC9EC,WAAW,IAAMb,EAAMm3B,QAAQ,IAAK,IAAMn3B,EAAMjF,UAAW,KAGtDlC,KAAeA,GAAgBC,MAAkB2U,MAClD5U,IAAiBA,GAAc4mB,IAAWttB,UAC5C0G,GAAc4mB,GAAUttB,QAAQvB,OAAOwC,EAAS,EAAG,GAGnDge,GAAavY,UACPi2B,GAAmBj2B,IAAe,GAAM,GAElD,KAAO,CAEL,MAAMy2C,EAAOn/B,KACRm/B,EAAK7vB,KAAW6vB,EAAK7vB,GAAY,IACjC6vB,EAAK7vB,GAAUluB,SAAS6B,KAC3Bk8C,EAAK7vB,GAAUv7B,KAAKkP,GACpB0d,GAAqBw+B,IAIvBnmD,EAAEilC,GAAMnuB,QAAQ,kBAAkBoQ,SAAS,oBAG3CN,IACF,IAIFq+B,EAAKngD,KAAK,gBAAgBspB,MAAM,KAC9B,MAAM+3B,EAAOn/B,KACTm/B,EAAK7vB,KACP6vB,EAAK7vB,GAAY6vB,EAAK7vB,GAAUxwB,OAAOpL,GAAKA,IAAMuP,GACpB,IAA1Bk8C,EAAK7vB,GAAU17B,eAAqBurD,EAAK7vB,GAC7C3O,GAAqBw+B,IAGvBnmD,EAAEilC,GAAMnuB,QAAQ,kBAAkBI,YAAY,oBAC9C0P,KACA4+B,MAIFP,EAAKngD,KAAK,eAAespB,MAAMhd,UAM7B,GALAo0C,IAEK91C,KAAeA,GAAgBC,MAC/BD,KAAeA,GAAgB4U,MAEhC5U,IAAiBA,GAAc4mB,IAAWttB,QAAS,CACrD,MAAM2B,EAAQ+E,GAAc4mB,GAEtB8vB,EAAWz7C,EAAM3B,QAAQ,GAAK2B,EAAM3B,QAAQ,GAAGpO,OAAS,EACxDmE,EAAS,IAAIK,MAAMgnD,GAAU/mD,KAAK,IAEpC+mD,EAAW,IAAGrnD,EAAO,GAAKW,OAAOiL,EAAM3B,QAAQpO,SAGnD+P,EAAM3B,QAAQvB,OAAOwC,EAAS,EAAG,EAAGlL,SAI9B4mC,GAAmBj2B,IAAe,GAAO,GAG/CmV,KAGAnN,WAAW,KACT,MAAMjB,EAASzW,EAAE,sBAEbyW,EAAO7b,QAAU6b,EAAO,GAAG6uB,aAAe7uB,EAAOuX,UACnDvX,EAAOw6B,UAAUx6B,EAAOw6B,YAAc,KAEvC,IACL,IAIFgU,EAAKngD,KAAK,kBAAkBspB,MAAM,KAChCo3B,IACA,MAAM38C,EAAU6G,IAAiBC,KACjC,GAAI9G,GAAWA,EAAQytB,GAAW,CAChC,MAAMv5B,EAAU8L,EAAQytB,GAAUttB,QAAQ,GACpClM,EAAM+L,EAAQytB,GAAUttB,QAAQiB,EAAS,GAC3CnN,GACFgoC,GAAkBhoC,EAAKC,EAASF,EAAWoN,EAAQqsB,EAEvD,IAIF2uB,EAAKngD,KAAK,aAAaspB,MAAM,KAC3Bo3B,IACA,MAAMz2B,EAAchN,GAAoB/Y,GAClC0Z,EAAa1iB,EAAEilC,GAAMngC,KAAK,mBAAmBiL,QAAU,KAC7D2e,GAAc,CACZK,YAAaA,EACbC,WAAYtM,EACZuM,SAAU,YAGdg2B,EAAKngD,KAAK,aAAaspB,MAAM,KAC3Bo3B,IACApuC,GAAepO,EAASoI,MAAMmD,IAI5B,GAFK7E,KAAeA,GAAgBC,MAAkB2U,OAElD5U,KAAiBA,GAAc4mB,IAAWttB,QAAQiB,EAAS,GAI7D,YADAo8C,MAAM,uBAFN32C,GAAc4mB,GAAUttB,QAAQiB,EAAS,GAAG9K,GAAUoV,EAOxD,MAAM2tC,EAAQliD,EAAEilC,GAChBid,EAAMjzC,KAAK,WAAYijC,mBAAmB39B,IAASrZ,KAAK,MAAOg3C,mBAAmB39B,IAElF,IAAI0xC,EAAiB/D,EACjBA,EAAMp9C,KAAK,mBAAmBlK,OAAQqrD,EAAiB/D,EAAMp9C,KAAK,mBAC7Do9C,EAAMlrC,SAAS,iBAAkBivC,EAAiB/D,EAAMp9C,KAAK,mBAC7Do9C,EAAMlrC,SAAS,wBAAuBivC,EAAiB/D,GAGhE,MAAM/B,EAAa/4B,GAAc7S,GAC7B4rC,IAAe+B,EAAMlrC,SAAS,sBAChCivC,EAAeruC,KAAK,0BAA0BuoC,MAAe3gD,EAAW+U,aAExE0xC,EAAel2C,KAAKwE,GAItB,IAAI2xC,EAAS1hD,GAAMC,IAAIrD,GAClB8kD,GAAW9mD,MAAM+I,QAAQ+9C,KAC5BA,EAAS,CAAC,sBAAuB,mBAAoB,kBAAmB,sBACnDA,EAAO99C,SAAS,wBAKrC69C,EAAe/uC,YAAY,2CACvBgrC,EAAMlrC,SAAS,uBAAuBkrC,EAAMhrC,YAAY,2CAG5D+Q,GAAavY,UACPi2B,GAAmBj2B,IAAe,GAAM,KAI9Cu2C,EAAe/uC,YAAY,sBAAsBgQ,SAAS,wBACtDg7B,EAAMlrC,SAAS,uBACjBkrC,EAAMhrC,YAAY,sBAAsBgQ,SAAS,wBAG9CtY,OAAO+4B,iBAAgB/4B,OAAO+4B,eAAiB,IAAIpkB,KACxD3U,OAAO+4B,eAAete,IAAIi3B,GAC1B58B,IAAoB,EACpBkD,WAMFxP,GAAiB,CAACpO,EAAS2O,KAC/B,MAAM,GAAQ6M,KACR5gB,EAASiU,KAETqtB,EAASllC,EAAE,iGAE0B4D,EAAOkU,uEACElU,EAAOkU,sJAEctY,EAAWwJ,gZAQpFhJ,EAAE,QAAQgY,OAAOktB,GAMjBA,EAAOpgC,KAAK,YAAY6R,GAAG,QAAS,WAJfyuB,SAKN/qC,MAJV6lC,MAAMlS,OAAS,OAClBoX,EAAGlF,MAAMlS,OAASoX,EAAGE,aAAe,EAAI,IAI1C,GAEAJ,EAAOpgC,KAAK,eAAespB,MAAM,IAAM8W,EAAOtzB,UAE9CszB,EAAOvuB,GAAG,QAAS,SAAUza,GACvB8D,EAAE9D,EAAEsQ,QAAQwK,SAAS,qBAAqBkuB,EAAOtzB,QACvD,GAEAszB,EAAOpgC,KAAK,aAAaspB,MAAM,KAC7BzW,EAAOutB,EAAOpgC,KAAK,YAAY5E,OAC/BglC,EAAOtzB,YAOLjG,GAAO,KACX,GAAIuX,GAAe,OAUnB,GATAlQ,EAAUwC,eAGNgO,KACFA,GAAS8iC,aACT9iC,GAAW,MAEbwjB,KAEIp4B,OAAOS,aAAeT,OAAOS,YAAYk3C,YAAa,CACxD,MAAMC,EAAS53C,OAAOS,YAAYo3C,WAC5B/gD,EAASkJ,OAAOS,YAAYk3C,YAC5BG,EAAW,CAACF,EAAOG,aAAcH,EAAOI,eAAgBJ,EAAOK,gBAAiBL,EAAOM,iBAGxFrjC,KACHA,GAAsB,KACfL,IAAgB1L,WAAWmN,GAAiB,OAKhDjW,OAAOm4C,6BACVn4C,OAAOm4C,2BAA6B,KAClCr3C,GAAgB,KAChBiU,GAAkB,CAAC,EACnBC,GAAoB,CAAC,EACrBI,GAAoB,CAAC,EACrBN,IAAoB,EACpBJ,GAAe7U,QACXG,OAAO+4B,gBAAgB/4B,OAAO+4B,eAAel5B,QACjDiJ,WAAWmN,GAAiB,OAGhC,MAAMmiC,EAA0Bp4C,OAAOm4C,2BAEvCL,EAAS7qD,QAAQooC,IACXA,IACFv+B,EAAOuhD,eAAehjB,EAAKxgB,IAC3B/d,EAAOuhD,eAAehjB,EAAK+iB,GACvB/iB,IAAQuiB,EAAOG,aACjBjhD,EAAOiR,GAAGstB,EAAK+iB,GAEfthD,EAAOiR,GAAGstB,EAAKxgB,MAIvB,CAGA,MAAMyjC,EAAO,KACX,MAAM3iC,EAAMC,KAAUC,QACtB,GAAIF,GAAK6iB,kBAAmB,CAC1BlkB,IAAgB,EAGhB,MAAMusB,EAAQzvC,EAAE,SAChB,GAAIyvC,EAAM70C,SAAW4oB,GAAU,CAC7B,IAAIksB,GAAe,EAuBnBlsB,GAAW,IAAImsB,iBAtBQ,KACjBD,IACJA,GAAe,EACflK,sBAAsB,KAEpB,GAA4B,aADb3tB,KACJmO,aAET,YADA0pB,GAAe,GAIjB,MACME,EADWH,EAAMI,WACI1gC,OAAO,GAC5B2gC,EAAU9vC,EAAE,gBAAgB,GAE9B8vC,GAAWF,GAAaA,IAAcE,IACpC9vC,EAAE4vC,GAAW54B,SAAS,QAAUhX,EAAE4vC,GAAW54B,SAAS,kBACxDy4B,EAAMz3B,OAAO83B,GAGjBJ,GAAe,OAInBlsB,GAASusB,QAAQN,EAAM,GAAI,CAAEO,WAAW,GAC1C,CAGAnrB,KAEIN,EAAI4iC,8BACN5iC,EAAI4iC,4BAA4BjjC,GAAiBG,cAG7CE,EAAI6iC,gCACN7iC,EAAI6iC,+BAA+B,KACjC,MAAM/0C,EAAUkS,EAAI6iB,oBAChB/0B,GAAS4V,GAAa5V,KAIlC,MAEO6Q,KACHtU,OAAOy4C,iBAAmBz4C,OAAOy4C,iBAAmB,GAAK,EACrDz4C,OAAOy4C,gBAAkB,GAC3B3vC,WAAWwvC,EAAM,KAEjBlrD,QAAQG,KAAK,6CAKrB+qD,IA+BAxvC,WA5BgC,KAC9B,MAAM4vC,EAAkB,KACtBxjC,IAAqB,EACrB9jB,EAAE,sDAAsDovC,QAAQ,IAAK,WACnEpvC,EAAE3F,MAAMuX,QACV,IAIIxC,EAAKR,OAAOS,aAAeT,OAAOC,QAAQQ,YAE1Ck4C,EACJn4C,GAAIq3C,YAAYe,eAAiB54C,OAAO64C,cAAgB74C,OAAO64C,cAAcD,aAAe,gBAG1Fp4C,GAAIm3C,YACNn3C,EAAGm3C,YAAY5vC,GAAG4wC,EAASD,GAKC,mBAAnB14C,OAAO84C,SAChB94C,OAAO84C,QAAQH,EAASD,IAMQ,KAGpCtnD,EAAE4O,QACC8H,IAAI,iCACJC,GAAG,gCAAiC,KACnC,IACEhc,aAAa+B,QAAQqnB,GAAoB5oB,KAAKwB,UAAUqnB,KACpDR,KACFA,GAAS8iC,aACT9iC,GAAW,KAEf,CAAE,MAAOtnB,GAAI,MAIb,GAAQsoB,KACVxkB,EAAGA,EAAE0V,UAAUiyC,MAAMh8C,IACpBiD,OAAOiyB,iBAAiB,OAAQl1B,GACtC,CA5zmBD","sources":["src://tavern_helper_template/src//index.ts"],"sourcesContent":["(function () {\n  'use strict';\n\n  const SCRIPT_ID = 'acu_visualizer_ui_v19_6_ai_overlay';\n  // ========================================\n  // LockManager - \n  // ========================================\n  const LockManager = {\n    STORAGE_KEY_PREFIX: 'acu_locked_fields_v2_',\n    MAX_CONTEXTS: 20, // \n\n    PRIMARY_KEYS: {\n      : null,\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n      : '',\n    },\n\n    _cache: null,\n    _currentContextId: null,\n\n    // \n    _getStorageKey(ctxId) {\n      return this.STORAGE_KEY_PREFIX + (ctxId || getCurrentContextFingerprint());\n    },\n\n    //  N \n    _cleanupOldContexts() {\n      try {\n        const prefix = this.STORAGE_KEY_PREFIX;\n        const allKeys = [];\n\n        for (let i = 0; i < localStorage.length; i++) {\n          const key = localStorage.key(i);\n          if (key && key.startsWith(prefix)) {\n            allKeys.push(key);\n          }\n        }\n\n        if (allKeys.length <= this.MAX_CONTEXTS) return;\n\n        //  _lastAccess \n        const keyWithTime = allKeys.map(key => {\n          try {\n            const data = JSON.parse(localStorage.getItem(key));\n            return { key, time: data?._lastAccess || 0 };\n          } catch {\n            return { key, time: 0 };\n          }\n        });\n\n        keyWithTime.sort((a, b) => b.time - a.time);\n\n        // \n        const toDelete = keyWithTime.slice(this.MAX_CONTEXTS);\n        toDelete.forEach(item => {\n          localStorage.removeItem(item.key);\n        });\n\n        if (toDelete.length > 0) {\n          console.log(`[LockManager]  ${toDelete.length} `);\n        }\n      } catch (e) {\n        console.warn('[LockManager] ', e);\n      }\n    },\n\n    _load() {\n      const ctxId = getCurrentContextFingerprint();\n\n      // \n      if (this._currentContextId !== ctxId) {\n        this._cache = null;\n        this._currentContextId = ctxId;\n      }\n\n      if (!this._cache) {\n        try {\n          const stored = localStorage.getItem(this._getStorageKey());\n          this._cache = stored ? JSON.parse(stored) : {};\n          // \n          delete this._cache._lastAccess;\n        } catch (e) {\n          this._cache = {};\n        }\n      }\n      return this._cache;\n    },\n\n    _save() {\n      try {\n        // \n        const dataToSave = { ...this._cache, _lastAccess: Date.now() };\n        localStorage.setItem(this._getStorageKey(), JSON.stringify(dataToSave));\n\n        // \n        this._cleanupOldContexts();\n      } catch (e) {\n        console.warn('[LockManager] ', e);\n      }\n    },\n\n    getRowKey(tableName, row, headers) {\n      const pkField = this.PRIMARY_KEYS[tableName];\n      if (pkField === null) return '_row_0';\n\n      let fieldIndex = 1;\n      if (pkField) {\n        const idx = headers.indexOf(pkField);\n        if (idx !== -1) fieldIndex = idx;\n      }\n\n      if (!row[fieldIndex]) return null;\n      return `${pkField || headers[fieldIndex]}=${row[fieldIndex]}`;\n    },\n\n    lockField(tableName, rowKey, fieldName, value) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n      if (!data[tableName][rowKey]) {\n        data[tableName][rowKey] = { _fullRow: false, _fields: {}, _snapshot: null };\n      }\n      data[tableName][rowKey]._fields[fieldName] = value;\n      this._save();\n    },\n\n    lockRow(tableName, rowKey, rowData, headers) {\n      const data = this._load();\n      if (!data[tableName]) data[tableName] = {};\n\n      const snapshot = {};\n      headers.forEach((h, i) => {\n        if (h && rowData[i] != null && rowData[i] !== '') {\n          snapshot[h] = rowData[i];\n        }\n      });\n\n      data[tableName][rowKey] = { _fullRow: true, _fields: {}, _snapshot: snapshot };\n      this._save();\n    },\n\n    unlockField(tableName, rowKey, fieldName) {\n      const data = this._load();\n      const lock = data[tableName]?.[rowKey];\n      if (!lock) return;\n\n      delete lock._fields[fieldName];\n      if (!lock._fullRow && Object.keys(lock._fields).length === 0) {\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n      }\n      this._save();\n    },\n\n    unlockRow(tableName, rowKey) {\n      const data = this._load();\n      if (data[tableName]) {\n        delete data[tableName][rowKey];\n        if (Object.keys(data[tableName]).length === 0) {\n          delete data[tableName];\n        }\n        this._save();\n      }\n    },\n\n    isFieldLocked(tableName, rowKey, fieldName) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return false;\n      if (lock._fullRow) return lock._snapshot?.hasOwnProperty(fieldName);\n      return lock._fields?.hasOwnProperty(fieldName);\n    },\n\n    isRowLocked(tableName, rowKey) {\n      return this._load()[tableName]?.[rowKey]?._fullRow === true;\n    },\n\n    applyLocks(tableName, tableContent) {\n      const tableLocks = this._load()[tableName];\n      if (!tableLocks || !tableContent || tableContent.length < 2) {\n        return { modified: false, restored: [] };\n      }\n\n      const headers = tableContent[0];\n      const restored = [];\n      let modified = false;\n\n      // \n      const rowIndex = {};\n      for (let i = 1; i < tableContent.length; i++) {\n        const key = this.getRowKey(tableName, tableContent[i], headers);\n        if (key) rowIndex[key] = i;\n      }\n\n      for (const [rowKey, lock] of Object.entries(tableLocks)) {\n        const idx = rowIndex[rowKey];\n\n        if (idx === undefined) {\n          // \n          const newRow = this._rebuildRow(headers, lock);\n          if (newRow) {\n            tableContent.push(newRow);\n            restored.push(rowKey);\n            modified = true;\n          }\n          continue;\n        }\n\n        const row = tableContent[idx];\n        const fields = lock._fullRow ? lock._snapshot : lock._fields;\n\n        if (fields) {\n          for (const [field, value] of Object.entries(fields)) {\n            const colIdx = headers.indexOf(field);\n            if (colIdx !== -1 && row[colIdx] !== value) {\n              row[colIdx] = value;\n              modified = true;\n            }\n          }\n        }\n      }\n\n      return { modified, restored };\n    },\n\n    _rebuildRow(headers, lock) {\n      const fields = lock._fullRow ? lock._snapshot : lock._fields;\n      if (!fields || Object.keys(fields).length === 0) return null;\n\n      const row = new Array(headers.length).fill(null);\n      for (const [field, value] of Object.entries(fields)) {\n        const idx = headers.indexOf(field);\n        if (idx !== -1) row[idx] = value;\n      }\n      return row;\n    },\n\n    getLockedFields(tableName, rowKey) {\n      const lock = this._load()[tableName]?.[rowKey];\n      if (!lock) return [];\n      if (lock._fullRow) return Object.keys(lock._snapshot || {});\n      return Object.keys(lock._fields || {});\n    },\n\n    // \n    clearCurrentContext() {\n      localStorage.removeItem(this._getStorageKey());\n      this._cache = null;\n    },\n  };\n  const escapeHtml = s =>\n    String(s ?? '')\n      .replace(/&/g, '&amp;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&#039;');\n  // [] \n  const smartInsertToTextarea = (newContent, contentType) => {\n    // contentType: 'action' ()  'dice' ()\n    const $ta = $('#send_textarea');\n    if (!$ta.length) return;\n\n    const currentVal = ($ta.val() || '').trim();\n\n    // \n    // : \"XX\"\n    const normalDiceRegex = /[\\u4e00-\\u9fa5a-zA-Z<>]+[^]+\\d+[^]*[^]+/g;\n\n    // \n    // : \"... vs ...... (...)  ......... (...)  .........\"\n    const contestDiceRegex =\n      /[^]+ vs [^]+.*?\\(\\d+\\)  \\d+[^]+.*?\\(\\d+\\)  \\d+[^]+[^]+/g;\n\n    // <user>\n    const actionRegex = /<user>(?:(?!<user>).)*?[]/g;\n\n    // \n    if (!currentVal) {\n      $ta.val(newContent).trigger('input').trigger('change');\n      return;\n    }\n\n    // \n    let workingText = currentVal;\n    let existingAction = '';\n    let existingDice = '';\n\n    // 1. \n    const contestMatches = workingText.match(contestDiceRegex);\n    if (contestMatches && contestMatches.length > 0) {\n      existingDice = contestMatches[contestMatches.length - 1];\n      workingText = workingText.replace(contestDiceRegex, '\\u0000').trim();\n      console.log('[ACU SmartInsert] Found and extracted contest roll:', existingDice);\n    }\n\n    // 2. \n    const normalMatches = workingText.match(normalDiceRegex);\n    if (normalMatches && normalMatches.length > 0) {\n      // \n      existingDice = normalMatches[normalMatches.length - 1];\n      workingText = workingText.replace(normalDiceRegex, '\\u0000').trim();\n      console.log('[ACU SmartInsert] Found and extracted normal roll:', existingDice);\n    }\n\n    // 3. \n    const actionMatches = workingText.match(actionRegex);\n    if (actionMatches && actionMatches.length > 0) {\n      existingAction = actionMatches[actionMatches.length - 1];\n      workingText = workingText.replace(actionRegex, '\\u0001').trim();\n      console.log('[ACU SmartInsert] Found and extracted action:', existingAction);\n    }\n\n    // 4. \n    let userInput = workingText\n      .replace(/[\\u0000\\u0001]/g, ' ')\n      .replace(/\\s+/g, ' ')\n      .trim();\n\n    // 5. \n    if (contentType === 'dice') {\n      existingDice = newContent;\n    } else if (contentType === 'action') {\n      existingAction = newContent;\n    }\n\n    // 6.  +  + \n    const parts = [];\n    if (userInput) parts.push(userInput);\n    if (existingAction) parts.push(existingAction);\n    if (existingDice) parts.push(existingDice);\n\n    const finalVal = parts.join(' ');\n    $ta.val(finalVal).trigger('input').trigger('change');\n  };\n  const STORAGE_KEY_TABLE_ORDER = 'acu_table_order';\n  const STORAGE_KEY_ACTION_ORDER = 'acu_action_order';\n  const STORAGE_KEY_PENDING_DELETIONS = 'acu_pending_deletions';\n  const STORAGE_KEY_ACTIVE_TAB = 'acu_active_tab';\n  const STORAGE_KEY_UI_CONFIG = 'acu_ui_config_v19';\n  const STORAGE_KEY_LAST_SNAPSHOT = 'acu_data_snapshot_v19';\n  const STORAGE_KEY_IS_COLLAPSED = 'acu_ui_collapsed_state';\n  const STORAGE_KEY_DASHBOARD_ACTIVE = 'acu_dashboard_active';\n  // [] \n  const STORAGE_KEY_TABLE_HEIGHTS = 'acu_table_heights_v19';\n  const STORAGE_KEY_TABLE_STYLES = 'acu_table_styles_v19';\n  const STORAGE_KEY_HIDDEN_TABLES = 'acu_hidden_tables_v19';\n  const STORAGE_KEY_GM_CONFIG = 'acu_gm_engine_config_v1';\n  const STORAGE_KEY_REVERSE_TABLES = 'acu_reverse_tables_v1';\n  const MAX_ACTION_BUTTONS = 6; // \n  const MIN_PANEL_HEIGHT = 200; // \n  const MAX_PANEL_HEIGHT = 1200; // \n\n  const STORAGE_KEY_DICE_CONFIG = 'acu_dice_config_v1';\n  const STORAGE_KEY_ATTRIBUTE_PRESETS = 'acu_attribute_presets_v1';\n  const STORAGE_KEY_ACTIVE_ATTR_PRESET = 'acu_active_attr_preset_v1';\n\n  const STORAGE_KEY_AVATAR_MAP = 'acu_avatar_map_v1';\n\n  // ========================================\n  // ValidationRuleManager - \n  // ========================================\n  const STORAGE_KEY_VALIDATION_RULES = 'acu_validation_rules_v1';\n  const STORAGE_KEY_VALIDATION_ENABLED = 'acu_validation_enabled_v1';\n  const STORAGE_KEY_VALIDATION_MODE = 'acu_validation_mode'; // \n\n  //  UI \n  const RULE_TYPE_INFO = {\n    // \n    tableReadonly: { name: '', scope: 'table', icon: 'fa-lock', desc: '' },\n    rowLimit: { name: '', scope: 'table', icon: 'fa-arrows-up-down', desc: '' },\n    // \n    required: { name: '', scope: 'field', icon: 'fa-asterisk', desc: '' },\n    format: { name: '', scope: 'field', icon: 'fa-font', desc: '' },\n    enum: { name: '', scope: 'field', icon: 'fa-list', desc: '' },\n    numeric: { name: '', scope: 'field', icon: 'fa-hashtag', desc: '' },\n    relation: { name: '', scope: 'field', icon: 'fa-link', desc: '' },\n  };\n\n  // \n  const BUILTIN_VALIDATION_RULES = [\n    // \n    {\n      id: 'summary_code_format',\n      name: '',\n      description: ' AM+ AM001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'format',\n      config: { pattern: '^AM\\\\d{3}$' },\n      errorMessage: ' AM+ AM001',\n    },\n    // \n    {\n      id: 'outline_code_format',\n      name: '',\n      description: ' AM+ AM001',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'format',\n      config: { pattern: '^AM\\\\d{3}$' },\n      errorMessage: ' AM+ AM001',\n    },\n    // \n    {\n      id: 'quest_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'quest_priority_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_status_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'equip_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'item_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_type_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_quality_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', '', '', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'skill_proficiency_range',\n      name: '',\n      description: ' 0-100 ',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'numeric',\n      config: { min: 0, max: 100 },\n      errorMessage: ' 0-100 ',\n    },\n    // \n    {\n      id: 'npc_presence_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_explore_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'map_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'intel_importance_enum',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'enum',\n      config: { values: ['', '', ''] },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'player_location_relation',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // NPC\n    {\n      id: 'npc_location_relation',\n      name: 'NPC',\n      description: 'NPC',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: '' },\n      errorMessage: '',\n    },\n    // \n    {\n      id: 'element_location_relation',\n      name: '',\n      description: '',\n      enabled: true,\n      builtin: true,\n      intercept: false,\n      targetTable: '',\n      targetColumn: '',\n      ruleType: 'relation',\n      config: { refTable: '', refColumn: ['', ''] },\n      errorMessage: '',\n    },\n  ];\n\n  // ========================================\n  // PresetManager - \n  // ========================================\n  const STORAGE_KEY_PRESETS = 'acu_validation_presets_v1';\n  const STORAGE_KEY_ACTIVE_PRESET = 'acu_active_preset_id';\n\n  const PresetManager = {\n    _cache: null,\n\n    // \n    getAllPresets() {\n      if (this._cache) return this._cache;\n      const stored = Store.get(STORAGE_KEY_PRESETS, null);\n      if (!stored) {\n        this._initDefaultPreset();\n        return this._cache;\n      }\n      this._cache = stored;\n      return stored;\n    },\n\n    // \n    getActivePreset() {\n      const presets = this.getAllPresets();\n      const activeId = Store.get(STORAGE_KEY_ACTIVE_PRESET, 'default');\n      return presets.find(p => p.id === activeId) || presets[0];\n    },\n\n    // \n    setActivePreset(id) {\n      if (!this.getAllPresets().find(p => p.id === id)) return false;\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, id);\n      ValidationRuleManager.clearCache();\n      console.log('[PresetManager] :', id);\n      return true;\n    },\n\n    // \n    createPreset(name) {\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: name || '',\n        builtin: false,\n        rules: [],\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      return newPreset;\n    },\n\n    // \n    duplicatePreset(id) {\n      const source = this.getAllPresets().find(p => p.id === id);\n      if (!source) return null;\n      const presets = this.getAllPresets();\n      const newPreset = {\n        id: 'preset_' + Date.now(),\n        name: source.name + ' ()',\n        builtin: false,\n        rules: JSON.parse(JSON.stringify(source.rules)),\n        createdAt: new Date().toISOString(),\n      };\n      presets.push(newPreset);\n      this._save(presets);\n      console.log('[PresetManager] :', source.name, '->', newPreset.name);\n      return newPreset;\n    },\n\n    //  id='default' \n    deletePreset(id) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset || preset.id === 'default') return false; // \n      const filtered = presets.filter(p => p.id !== id);\n      this._save(filtered);\n      if (Store.get(STORAGE_KEY_ACTIVE_PRESET) === id) {\n        Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n        ValidationRuleManager.clearCache();\n      }\n      console.log('[PresetManager] :', id);\n      return true;\n    },\n\n    // \n    updatePresetRules(id, rules) {\n      const presets = this.getAllPresets();\n      const preset = presets.find(p => p.id === id);\n      if (!preset) return false;\n      preset.rules = rules;\n      this._save(presets);\n      ValidationRuleManager.clearCache();\n      return true;\n    },\n\n    // \n    exportPreset(id) {\n      const preset = this.getAllPresets().find(p => p.id === id);\n      if (!preset) return null;\n      return JSON.stringify({ format: 'acu_preset_v1', preset: { name: preset.name, rules: preset.rules } }, null, 2);\n    },\n\n    // \n    importPreset(json) {\n      try {\n        const data = JSON.parse(json);\n        if (data.format !== 'acu_preset_v1' || !data.preset) return null;\n        const presets = this.getAllPresets();\n        const newPreset = {\n          id: 'imported_' + Date.now(),\n          name: data.preset.name || '',\n          builtin: false,\n          rules: data.preset.rules || [],\n          createdAt: new Date().toISOString(),\n        };\n        presets.push(newPreset);\n        this._save(presets);\n        console.log('[PresetManager] :', newPreset.name);\n        return newPreset;\n      } catch (e) {\n        console.error('[PresetManager] :', e);\n        return null;\n      }\n    },\n\n    // \n    _initDefaultPreset() {\n      const defaultPreset = {\n        id: 'default',\n        name: '',\n        builtin: true,\n        rules: BUILTIN_VALIDATION_RULES.map(r => ({ ...r })),\n        createdAt: new Date().toISOString(),\n      };\n      // \n      const oldCustom = Store.get(STORAGE_KEY_VALIDATION_RULES, []);\n      if (oldCustom.length > 0) {\n        defaultPreset.rules.push(...oldCustom.map(r => ({ ...r, builtin: false })));\n        console.log('[PresetManager] :', oldCustom.length, '');\n      }\n      this._cache = [defaultPreset];\n      this._save(this._cache);\n      Store.set(STORAGE_KEY_ACTIVE_PRESET, 'default');\n    },\n\n    // \n    resetDefaultPreset() {\n      const presets = this.getAllPresets();\n      const defaultPreset = presets.find(p => p.id === 'default');\n      if (defaultPreset) {\n        defaultPreset.rules = BUILTIN_VALIDATION_RULES.map(r => ({ ...r }));\n        this._save(presets);\n        ValidationRuleManager.clearCache();\n        console.log('[PresetManager] ');\n        return true;\n      }\n      return false;\n    },\n\n    _save(presets) {\n      Store.set(STORAGE_KEY_PRESETS, presets);\n      this._cache = presets;\n    },\n\n    clearCache() {\n      this._cache = null;\n    },\n  };\n\n  //  PresetManager \n  const ValidationRuleManager = {\n    _cache: null,\n    _enabledCache: null,\n\n    // \n    getAllRules() {\n      if (this._cache) return this._cache;\n\n      const preset = PresetManager.getActivePreset();\n      const enabledStates = this.getEnabledStates();\n\n      // \n      const allRules = (preset?.rules || []).map(rule => ({\n        ...rule,\n        enabled: enabledStates[rule.id] !== undefined ? enabledStates[rule.id] : rule.enabled,\n      }));\n\n      this._cache = allRules;\n      return allRules;\n    },\n\n    // \n    getEnabledStates() {\n      if (this._enabledCache) return this._enabledCache;\n      this._enabledCache = Store.get(STORAGE_KEY_VALIDATION_ENABLED, {});\n      return this._enabledCache;\n    },\n\n    // \n    toggleRuleEnabled(ruleId, enabled) {\n      const states = this.getEnabledStates();\n      states[ruleId] = enabled;\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n      this._cache = null; // \n      console.log(`[ValidationRuleManager]  ${ruleId} ${enabled ? '' : ''}`);\n    },\n\n    // \n    toggleRuleIntercept(ruleId, intercept) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const rule = preset.rules.find(r => r.id === ruleId);\n      if (!rule) return false;\n\n      rule.intercept = intercept;\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      console.log(`[ValidationRuleManager]  ${ruleId} ${intercept ? '' : ''}`);\n      return true;\n    },\n\n    // \n    getEnabledRules() {\n      return this.getAllRules().filter(rule => rule.enabled);\n    },\n\n    // \n    addCustomRule(rule) {\n      if (!rule.id || !rule.name || !rule.targetTable) {\n        console.error('[ValidationRuleManager] ');\n        return false;\n      }\n\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      //  ID \n      if (preset.rules.some(r => r.id === rule.id)) {\n        console.error('[ValidationRuleManager]  ID :', rule.id);\n        return false;\n      }\n\n      const newRule = { ...rule, builtin: false, enabled: true };\n      preset.rules.push(newRule);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      console.log('[ValidationRuleManager] :', newRule.name);\n      return true;\n    },\n\n    // \n    removeCustomRule(ruleId) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules.splice(index, 1);\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n\n      // \n      const states = this.getEnabledStates();\n      delete states[ruleId];\n      Store.set(STORAGE_KEY_VALIDATION_ENABLED, states);\n      this._enabledCache = states;\n\n      console.log('[ValidationRuleManager] :', ruleId);\n      return true;\n    },\n\n    // \n    updateCustomRule(ruleId, updates) {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return false;\n\n      const index = preset.rules.findIndex(r => r.id === ruleId);\n      if (index === -1) return false;\n\n      preset.rules[index] = { ...preset.rules[index], ...updates, id: ruleId };\n      PresetManager.updatePresetRules(preset.id, preset.rules);\n      return true;\n    },\n\n    // \n    clearCache() {\n      this._cache = null;\n      this._enabledCache = null;\n    },\n\n    // \n    getRulesByTable(tableName) {\n      return this.getEnabledRules().filter(rule => rule.targetTable === tableName);\n    },\n  };\n\n  // ========================================\n  // ValidationEngine - \n  // ========================================\n  const ValidationEngine = {\n    // \n    validateFormat(value, pattern) {\n      if (value === null || value === undefined || value === '') return true; // \n      try {\n        const regex = new RegExp(pattern);\n        return regex.test(String(value));\n      } catch (e) {\n        console.error('[ValidationEngine] :', pattern, e);\n        return true; // \n      }\n    },\n\n    // \n    validateEnum(value, allowedValues) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!Array.isArray(allowedValues) || allowedValues.length === 0) return true;\n      return allowedValues.includes(String(value));\n    },\n\n    // \n    validateNumeric(value, min, max) {\n      if (value === null || value === undefined || value === '') return true; // \n\n      //  \"50/100\"  \":80\" \n      const strVal = String(value);\n      let numVal;\n\n      //  \"50%\"\n      if (strVal.endsWith('%')) {\n        numVal = parseFloat(strVal);\n      }\n      //  \"50/100\"\n      else if (strVal.includes('/')) {\n        const parts = strVal.split('/');\n        numVal = parseFloat(parts[0]);\n      }\n      //  \":\" \n      else if (strVal.includes(':')) {\n        const parts = strVal.split(':');\n        numVal = parseFloat(parts[parts.length - 1]);\n      }\n      // \n      else {\n        numVal = parseFloat(strVal);\n      }\n\n      if (isNaN(numVal)) return true; // \n\n      if (min !== undefined && min !== null && numVal < min) return false;\n      if (max !== undefined && max !== null && numVal > max) return false;\n      return true;\n    },\n\n    //  OR \n    validateRelation(value, rawData, refTable, refColumn) {\n      if (value === null || value === undefined || value === '') return true; // \n      if (!rawData || !refTable || !refColumn) return true;\n\n      // \n      let refSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === refTable) {\n          refSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!refSheet || !refSheet.content || refSheet.content.length < 2) {\n        return true; // \n      }\n\n      const headers = refSheet.content[0];\n      const strVal = String(value);\n\n      //  refColumn \n      const columns = Array.isArray(refColumn) ? refColumn : [refColumn];\n\n      for (const col of columns) {\n        const refColIndex = headers.indexOf(col);\n        if (refColIndex === -1) continue; // \n\n        // \n        for (let i = 1; i < refSheet.content.length; i++) {\n          if (String(refSheet.content[i][refColIndex] || '') === strVal) {\n            return true; // \n          }\n        }\n      }\n\n      return columns.length === 0; //  true false\n    },\n\n    // \n    validateRequired(value) {\n      return value !== null && value !== undefined && String(value).trim() !== '';\n    },\n\n    // \n    validateTableReadonly(oldContent, newContent) {\n      if (!oldContent || !newContent) return true;\n      return JSON.stringify(oldContent) === JSON.stringify(newContent);\n    },\n\n    // \n    validateRowLimit(rowCount, min, max) {\n      if (min !== undefined && min !== null && rowCount < min) return false;\n      if (max !== undefined && max !== null && rowCount > max) return false;\n      return true;\n    },\n\n    //  intercept \n    checkTableRules(snapshot, newData, rules) {\n      const violations = [];\n      if (!snapshot || !newData || !rules) return violations;\n\n      for (const rule of rules) {\n        // \n        if (!rule.enabled || !rule.intercept) continue;\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n        if (!typeInfo) continue;\n\n        // \n        let oldSheet = null,\n          newSheet = null;\n        for (const sheetId in snapshot) {\n          if (snapshot[sheetId]?.name === rule.targetTable) {\n            oldSheet = snapshot[sheetId];\n            break;\n          }\n        }\n        for (const sheetId in newData) {\n          if (newData[sheetId]?.name === rule.targetTable) {\n            newSheet = newData[sheetId];\n            break;\n          }\n        }\n\n        if (!newSheet) continue;\n\n        // \n        if (typeInfo.scope === 'table') {\n          if (rule.ruleType === 'tableReadonly') {\n            if (!this.validateTableReadonly(oldSheet?.content, newSheet?.content)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message: rule.errorMessage || ` \"${rule.targetTable}\" `,\n              });\n            }\n          } else if (rule.ruleType === 'rowLimit') {\n            const rowCount = (newSheet.content?.length || 1) - 1; // \n            if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                message:\n                  rule.errorMessage ||\n                  ` \"${rule.targetTable}\"  ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n              });\n            }\n          }\n        }\n        // \n        else if (typeInfo.scope === 'field' && rule.targetColumn) {\n          const headers = newSheet.content?.[0] || [];\n          const colIndex = headers.indexOf(rule.targetColumn);\n          if (colIndex === -1) continue;\n\n          // \n          for (let rowIdx = 1; rowIdx < (newSheet.content?.length || 0); rowIdx++) {\n            const row = newSheet.content[rowIdx];\n            const value = row?.[colIndex];\n            const isValid = this.validateValue(value, rule, newData);\n\n            if (!isValid) {\n              violations.push({\n                rule,\n                tableName: rule.targetTable,\n                rowIndex: rowIdx,\n                columnName: rule.targetColumn,\n                currentValue: String(value ?? ''),\n                message: rule.errorMessage || ` \"${rule.targetColumn}\" `,\n              });\n              // \n              break;\n            }\n          }\n        }\n      }\n      return violations;\n    },\n\n    // \n    validateValue(value, rule, rawData) {\n      switch (rule.ruleType) {\n        case 'format':\n          return this.validateFormat(value, rule.config?.pattern);\n        case 'enum':\n          return this.validateEnum(value, rule.config?.values);\n        case 'numeric':\n          return this.validateNumeric(value, rule.config?.min, rule.config?.max);\n        case 'relation':\n          return this.validateRelation(value, rawData, rule.config?.refTable, rule.config?.refColumn);\n        case 'required':\n          return this.validateRequired(value);\n        default:\n          return true;\n      }\n    },\n\n    // \n    validateRow(row, headers, tableName, rowIndex, rules, rawData) {\n      const errors = [];\n\n      for (const rule of rules) {\n        if (rule.targetTable !== tableName) continue;\n        if (!rule.enabled) continue;\n\n        // \n        const colIndex = headers.indexOf(rule.targetColumn);\n        if (colIndex === -1) continue;\n\n        const value = row[colIndex];\n        const isValid = this.validateValue(value, rule, rawData);\n\n        if (!isValid) {\n          errors.push({\n            ruleId: rule.id,\n            ruleName: rule.name,\n            ruleType: rule.ruleType,\n            rule: rule, // \n            tableName: tableName,\n            rowIndex: rowIndex,\n            columnName: rule.targetColumn,\n            currentValue: String(value ?? ''),\n            errorMessage: rule.errorMessage,\n            severity: 'error',\n          });\n        }\n      }\n\n      return errors;\n    },\n\n    // \n    validateAllData(rawData) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getEnabledRules();\n      if (rules.length === 0) return [];\n\n      const allErrors = [];\n\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const sheet = rawData[sheetId];\n        if (!sheet?.name || !sheet?.content || sheet.content.length < 2) continue;\n\n        const tableName = sheet.name;\n        const headers = sheet.content[0];\n        const tableRules = rules.filter(r => r.targetTable === tableName);\n\n        if (tableRules.length === 0) continue;\n\n        // \n        for (const rule of tableRules) {\n          const typeInfo = RULE_TYPE_INFO[rule.ruleType];\n          if (typeInfo?.scope === 'table') {\n            if (rule.ruleType === 'rowLimit') {\n              const rowCount = sheet.content.length - 1;\n              if (!this.validateRowLimit(rowCount, rule.config?.min, rule.config?.max)) {\n                allErrors.push({\n                  ruleId: rule.id,\n                  ruleName: rule.name,\n                  ruleType: rule.ruleType,\n                  rule: rule, // \n                  tableName: tableName,\n                  rowIndex: -1, // \n                  columnName: '',\n                  currentValue: `${rowCount} `,\n                  errorMessage:\n                    rule.errorMessage ||\n                    ` ${rowCount}  (${rule.config?.min || 0}-${rule.config?.max || ''})`,\n                  severity: 'warning',\n                });\n              }\n            }\n            // tableReadonly \n          }\n        }\n\n        // \n        const fieldRules = tableRules.filter(r => RULE_TYPE_INFO[r.ruleType]?.scope !== 'table');\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          const rowErrors = this.validateRow(row, headers, tableName, i - 1, fieldRules, rawData);\n          allErrors.push(...rowErrors);\n        }\n      }\n\n      return allErrors;\n    },\n\n    // \n    validateTable(rawData, tableName) {\n      if (!rawData) return [];\n\n      const rules = ValidationRuleManager.getRulesByTable(tableName);\n      if (rules.length === 0) return [];\n\n      // \n      let targetSheet = null;\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === tableName) {\n          targetSheet = rawData[sheetId];\n          break;\n        }\n      }\n\n      if (!targetSheet || !targetSheet.content || targetSheet.content.length < 2) {\n        return [];\n      }\n\n      const headers = targetSheet.content[0];\n      const allErrors = [];\n\n      for (let i = 1; i < targetSheet.content.length; i++) {\n        const row = targetSheet.content[i];\n        const rowErrors = this.validateRow(row, headers, tableName, i - 1, rules, rawData);\n        allErrors.push(...rowErrors);\n      }\n\n      return allErrors;\n    },\n\n    // \n    groupErrorsByTable(errors) {\n      const grouped = {};\n      for (const error of errors) {\n        if (!grouped[error.tableName]) {\n          grouped[error.tableName] = [];\n        }\n        grouped[error.tableName].push(error);\n      }\n      return grouped;\n    },\n\n    // \n    getErrorCount(rawData) {\n      return this.validateAllData(rawData).length;\n    },\n  };\n\n  // ========================================\n  // LocalAvatarDB -  IndexedDB \n  // ========================================\n  const LocalAvatarDB = {\n    DB_NAME: 'acu_local_avatars',\n    STORE_NAME: 'avatars',\n    DB_VERSION: 1,\n    _db: null,\n    _urlCache: new Map(), //  ObjectURL \n\n    // \n    async init() {\n      if (this._db) return this._db;\n\n      return new Promise((resolve, reject) => {\n        const request = indexedDB.open(this.DB_NAME, this.DB_VERSION);\n\n        request.onerror = () => {\n          console.error('[LocalAvatarDB] :', request.error);\n          reject(request.error);\n        };\n\n        request.onsuccess = () => {\n          this._db = request.result;\n          resolve(this._db);\n        };\n\n        request.onupgradeneeded = event => {\n          const db = event.target.result;\n          if (!db.objectStoreNames.contains(this.STORE_NAME)) {\n            // \n            db.createObjectStore(this.STORE_NAME, { keyPath: 'name' });\n          }\n        };\n      });\n    },\n\n    //  name \n    async save(name, blob) {\n      if (!name || !blob) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise((resolve, reject) => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n\n          //  ObjectURL \n          if (this._urlCache.has(name)) {\n            URL.revokeObjectURL(this._urlCache.get(name));\n            this._urlCache.delete(name);\n          }\n\n          const data = {\n            name: name,\n            blob: blob,\n            size: blob.size,\n            type: blob.type,\n            updatedAt: Date.now(),\n          };\n\n          const request = store.put(data);\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => {\n            console.error('[LocalAvatarDB] :', request.error);\n            reject(request.error);\n          };\n        });\n      } catch (e) {\n        console.error('[LocalAvatarDB] save error:', e);\n        return false;\n      }\n    },\n\n    //  URL ObjectURL\n    async get(name) {\n      if (!name) return null;\n\n      // \n      if (this._urlCache.has(name)) {\n        return this._urlCache.get(name);\n      }\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.get(name);\n\n          request.onsuccess = () => {\n            const data = request.result;\n            if (data && data.blob) {\n              const url = URL.createObjectURL(data.blob);\n              this._urlCache.set(name, url);\n              resolve(url);\n            } else {\n              resolve(null);\n            }\n          };\n\n          request.onerror = () => resolve(null);\n        });\n      } catch (e) {\n        console.error('[LocalAvatarDB] get error:', e);\n        return null;\n      }\n    },\n\n    // \n    async has(name) {\n      if (!name) return false;\n\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getKey(name);\n\n          request.onsuccess = () => resolve(request.result !== undefined);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        return false;\n      }\n    },\n\n    // \n    async delete(name) {\n      if (!name) return false;\n\n      try {\n        //  ObjectURL \n        if (this._urlCache.has(name)) {\n          URL.revokeObjectURL(this._urlCache.get(name));\n          this._urlCache.delete(name);\n        }\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.delete(name);\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[LocalAvatarDB] delete error:', e);\n        return false;\n      }\n    },\n\n    // \n    async getAllNames() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAllKeys();\n\n          request.onsuccess = () => resolve(request.result || []);\n          request.onerror = () => resolve([]);\n        });\n      } catch (e) {\n        return [];\n      }\n    },\n\n    // \n    async getStats() {\n      try {\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readonly');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.getAll();\n\n          request.onsuccess = () => {\n            const items = request.result || [];\n            const totalSize = items.reduce((sum, item) => sum + (item.size || 0), 0);\n            resolve({\n              count: items.length,\n              totalSize: totalSize,\n              totalSizeMB: (totalSize / 1024 / 1024).toFixed(2),\n            });\n          };\n\n          request.onerror = () => resolve({ count: 0, totalSize: 0, totalSizeMB: '0' });\n        });\n      } catch (e) {\n        return { count: 0, totalSize: 0, totalSizeMB: '0' };\n      }\n    },\n\n    // \n    async clearAll() {\n      try {\n        //  ObjectURL \n        this._urlCache.forEach(url => URL.revokeObjectURL(url));\n        this._urlCache.clear();\n\n        const db = await this.init();\n        return new Promise(resolve => {\n          const tx = db.transaction(this.STORE_NAME, 'readwrite');\n          const store = tx.objectStore(this.STORE_NAME);\n          const request = store.clear();\n\n          request.onsuccess = () => resolve(true);\n          request.onerror = () => resolve(false);\n        });\n      } catch (e) {\n        console.error('[LocalAvatarDB] clearAll error:', e);\n        return false;\n      }\n    },\n  };\n\n  // []  SillyTavern  URL\n  const getUserAvatarUrl = () => {\n    try {\n      // 1:  DOM \n      const w = window.parent || window;\n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        // SillyTavern  #user_avatar_block img  .avatar[title=\"You\"] img\n        const $avatar = $('#user_avatar_block img').first();\n        if ($avatar.length && $avatar.attr('src')) {\n          return $avatar.attr('src');\n        }\n        // \n        const $userMes = $('.mes[is_user=\"true\"]').last().find('.avatar img');\n        if ($userMes.length && $userMes.attr('src')) {\n          return $userMes.attr('src');\n        }\n      }\n      // 2:  SillyTavern API \n      const ST = w.SillyTavern || window.SillyTavern;\n      if (ST && ST.getContext) {\n        const ctx = ST.getContext();\n        if (ctx && ctx.userAvatar) {\n          return ctx.userAvatar;\n        }\n      }\n    } catch (e) {\n      console.warn('[ACU] getUserAvatarUrl error:', e);\n    }\n    return null;\n  };\n\n  // [] \n  const getPlayerName = () => {\n    const rawData = cachedRawData || (typeof getTableData === 'function' ? getTableData() : null);\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]?.[1]) {\n          return sheet.content[1][1];\n        }\n      }\n    }\n    return null;\n  };\n\n  // []  SillyTavern Persona \n  const getPersonaName = () => {\n    try {\n      // 1: SillyTavern  API\n      const w = window.parent || window;\n      if (w.SillyTavern?.getContext) {\n        const ctx = w.SillyTavern.getContext();\n        if (ctx?.name1) return ctx.name1;\n      }\n      // 2: \n      if (typeof name1 !== 'undefined' && name1) return name1;\n      if (w.name1) return w.name1;\n      // 3:  DOM \n      const $ = w.jQuery || window.jQuery;\n      if ($) {\n        const $persona = $('#user_avatar_block .avatar-name, #persona_name_input').first();\n        if ($persona.length) {\n          const name = $persona.val?.() || $persona.text?.();\n          if (name && name.trim()) return name.trim();\n        }\n      }\n    } catch (e) {\n      console.warn('[ACU] getPersonaName error:', e);\n    }\n    return null;\n  };\n\n  // []  Persona\n  const getDisplayPlayerName = () => {\n    return getPersonaName() || getPlayerName() || '';\n  };\n\n  // []  Persona \n  const replaceUserPlaceholders = text => {\n    if (!text || typeof text !== 'string') return text;\n    const displayName = getDisplayPlayerName();\n    //  <user>{{user}}\n    let result = text.replace(/<user>/gi, displayName);\n    result = result.replace(/\\{\\{user\\}\\}/gi, displayName);\n    return result;\n  };\n  // \n  const AvatarManager = {\n    _cache: null,\n\n    load() {\n      if (!this._cache) {\n        const raw = Store.get(STORAGE_KEY_AVATAR_MAP, {});\n        this._cache = {};\n        for (const name in raw) {\n          if (typeof raw[name] === 'string') {\n            this._cache[name] = { url: raw[name], offsetX: 50, offsetY: 50, scale: 150, aliases: [] };\n          } else {\n            this._cache[name] = {\n              url: raw[name].url || '',\n              offsetX: raw[name].offsetX ?? 50,\n              offsetY: raw[name].offsetY ?? 50,\n              scale: raw[name].scale ?? 150,\n              aliases: raw[name].aliases || [],\n            };\n          }\n        }\n      }\n      return this._cache;\n    },\n\n    save() {\n      Store.set(STORAGE_KEY_AVATAR_MAP, this._cache || {});\n      this._cache = null;\n    },\n\n    //  URL  ST \n    get(name) {\n      const data = this.load()[name];\n      if (data && data.url) return data.url;\n\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          if (this._cache[key].url) return this._cache[key].url;\n        }\n      }\n\n      const playerName = getPlayerName();\n      if (name === '<user>' || name === '' || (playerName && name === playerName)) {\n        const stAvatar = getUserAvatarUrl();\n        if (stAvatar) return stAvatar;\n      }\n\n      return null;\n    },\n\n    //  > URL > ST\n    async getAsync(name) {\n      if (!name) return null;\n\n      // \n      const playerName = getPlayerName();\n      const isPlayer = name === '<user>' || name === '' || (playerName && name === playerName);\n\n      // 1.  IndexedDB\n      const localUrl = await LocalAvatarDB.get(name);\n      if (localUrl) return localUrl;\n\n      // 2.  <user> \n      if (isPlayer && name !== '<user>') {\n        const userLocalUrl = await LocalAvatarDB.get('<user>');\n        if (userLocalUrl) return userLocalUrl;\n      }\n\n      // 3. \n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        const aliasLocalUrl = await LocalAvatarDB.get(primaryName);\n        if (aliasLocalUrl) return aliasLocalUrl;\n      }\n\n      // 4. URL / ST\n      return this.get(name);\n    },\n\n    // \n    async hasLocalAvatar(name) {\n      if (!name) return false;\n      const has = await LocalAvatarDB.has(name);\n      if (has) return true;\n\n      const primaryName = this.getPrimaryName(name);\n      if (primaryName !== name) {\n        return await LocalAvatarDB.has(primaryName);\n      }\n      return false;\n    },\n\n    // \n    async saveLocalAvatar(name, blob) {\n      return await LocalAvatarDB.save(name, blob);\n    },\n\n    // \n    async deleteLocalAvatar(name) {\n      return await LocalAvatarDB.delete(name);\n    },\n\n    getOffsetX(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetX ?? 50) : 50;\n    },\n\n    getOffsetY(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.offsetY ?? 50) : 50;\n    },\n\n    getScale(name) {\n      const data = this._resolveByAlias(name);\n      return data ? (data.scale ?? 150) : 150;\n    },\n\n    // \n    _resolveByAlias(name) {\n      const data = this.load()[name];\n      if (data) return data;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return this._cache[key];\n        }\n      }\n      return null;\n    },\n\n    // \n    getPrimaryName(name) {\n      if (this.load()[name]) return name;\n      for (const key in this._cache) {\n        if (this._cache[key].aliases && this._cache[key].aliases.includes(name)) {\n          return key;\n        }\n      }\n      return name;\n    },\n\n    set(name, url, offsetX = 50, offsetY = 50, scale = 150, aliases = []) {\n      this.load()[name] = { url, offsetX, offsetY, scale, aliases };\n      this.save();\n    },\n\n    setPosition(name, offsetX, offsetY) {\n      const data = this.load()[name];\n      if (data) {\n        data.offsetX = offsetX;\n        data.offsetY = offsetY;\n        this.save();\n      }\n    },\n\n    setScale(name, scale) {\n      const data = this.load()[name];\n      if (data) {\n        data.scale = scale;\n        this.save();\n      }\n    },\n\n    setAliases(name, aliases) {\n      const data = this.load()[name];\n      if (data) {\n        data.aliases = aliases;\n        this.save();\n      }\n    },\n\n    remove(name) {\n      delete this.load()[name];\n      this.save();\n    },\n\n    getAll() {\n      return this.load();\n    },\n\n    // JSON\n    exportData() {\n      return {\n        version: 1,\n        exportTime: new Date().toISOString(),\n        avatars: this.load(),\n      };\n    },\n\n    // \n    importData(jsonData, overwriteConflicts = true) {\n      if (!jsonData || !jsonData.avatars) {\n        throw new Error('');\n      }\n\n      const current = this.load();\n      const stats = { added: 0, updated: 0, skipped: 0 };\n\n      for (const name in jsonData.avatars) {\n        const imported = jsonData.avatars[name];\n        if (!imported.url) continue;\n\n        if (current[name]) {\n          // \n          if (overwriteConflicts) {\n            current[name] = {\n              url: imported.url,\n              offsetX: imported.offsetX ?? 50,\n              offsetY: imported.offsetY ?? 50,\n              scale: imported.scale ?? 150,\n              aliases: imported.aliases || [],\n            };\n            stats.updated++;\n          } else {\n            stats.skipped++;\n          }\n        } else {\n          // \n          current[name] = {\n            url: imported.url,\n            offsetX: imported.offsetX ?? 50,\n            offsetY: imported.offsetY ?? 50,\n            scale: imported.scale ?? 150,\n            aliases: imported.aliases || [],\n          };\n          stats.added++;\n        }\n      }\n\n      this.save();\n      return stats;\n    },\n\n    // \n    analyzeImport(jsonData) {\n      if (!jsonData || !jsonData.avatars) {\n        return { valid: false, error: '' };\n      }\n\n      const current = this.load();\n      const result = { valid: true, total: 0, newItems: [], conflicts: [] };\n\n      for (const name in jsonData.avatars) {\n        if (!jsonData.avatars[name].url) continue;\n        result.total++;\n        if (current[name]) {\n          result.conflicts.push(name);\n        } else {\n          result.newItems.push(name);\n        }\n      }\n\n      return result;\n    },\n  };\n\n  // ========================================\n  // MVU  v2.0\n  //  -  UI\n  // ========================================\n  const MvuModule = (function () {\n    'use strict';\n\n    // =====  =====\n    const MODULE_ID = '__mvu__';\n\n    // =====  =====\n    const STYLES = `\n            /* MVU  */\n            .acu-mvu-panel {\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n            }\n            .acu-mvu-panel .acu-panel-header {\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                padding: 10px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                flex-shrink: 0;\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n            }\n            .acu-mvu-panel .acu-panel-header .acu-panel-title i {\n                color: var(--acu-accent);\n            }\n            .acu-mvu-panel .acu-header-actions {\n                display: flex;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 5px 10px;\n                font-size: 13px;\n                border-radius: 4px;\n                transition: all 0.2s;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-mvu-panel .mvu-header-btn:hover {\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n\n            /* MVU  */\n            .mvu-content {\n                flex: 1;\n                overflow-y: auto;\n                overflow-x: hidden;\n                padding: 12px;\n                scrollbar-width: none;\n            }\n            .mvu-content::-webkit-scrollbar {\n                display: none;\n            }\n\n            /* MVU  */\n            .mvu-card {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                overflow: hidden;\n            }\n            .mvu-card:last-child {\n                margin-bottom: 0;\n            }\n            .mvu-card-header {\n                background: var(--acu-table-head);\n                padding: 8px 12px;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.2s;\n            }\n            .mvu-card-header:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-card-title {\n                font-weight: 600;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .mvu-card-count {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: normal;\n            }\n            .mvu-card-toggle {\n                color: var(--acu-text-sub);\n                font-size: 10px;\n                transition: transform 0.2s;\n            }\n            .mvu-card.collapsed .mvu-card-toggle {\n                transform: rotate(-90deg);\n            }\n            .mvu-card-body {\n                padding: 8px 12px;\n                display: block;\n            }\n            .mvu-card.collapsed .mvu-card-body {\n                display: none;\n            }\n\n            /*  */\n            .mvu-card .mvu-card {\n                background: var(--acu-table-head);\n                margin: 6px 0;\n            }\n            .mvu-card .mvu-card .mvu-card-header {\n                background: rgba(128,128,128,0.1);\n                padding: 6px 10px;\n            }\n            .mvu-card .mvu-card .mvu-card-body {\n                padding: 6px 10px;\n            }\n\n            /*  */\n            .mvu-row {\n                display: flex;\n                align-items: flex-start;\n                padding: 5px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .mvu-row:last-child {\n                border-bottom: none;\n            }\n            .mvu-key {\n                color: var(--acu-text-sub);\n                min-width: 80px;\n                max-width: 120px;\n                flex-shrink: 0;\n                font-size: 12px;\n                padding-right: 8px;\n                word-break: break-all;\n            }\n            .mvu-value-wrap {\n                flex: 1;\n                display: flex;\n                align-items: flex-start;\n                gap: 6px;\n                min-width: 0;\n            }\n            .mvu-value {\n                color: var(--acu-text-main);\n                font-size: 13px;\n                cursor: pointer;\n                padding: 1px 6px;\n                border-radius: 4px;\n                transition: background 0.2s;\n                word-break: break-word;\n                flex: 1;\n            }\n            .mvu-value:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-value.mvu-array-value {\n                font-size: 12px;\n                color: var(--acu-text-sub);\n            }\n            .mvu-change-indicator {\n                color: var(--acu-success-text);\n                font-weight: bold;\n                font-size: 12px;\n                flex-shrink: 0;\n            }\n            .mvu-row.mvu-changed {\n                background: var(--acu-success-bg);\n                margin: 0 -12px;\n                padding: 5px 12px;\n                border-radius: 4px;\n            }\n            .mvu-card .mvu-card .mvu-row.mvu-changed {\n                margin: 0 -10px;\n                padding: 5px 10px;\n            }\n\n            /*  */\n            .mvu-empty {\n                text-align: center;\n                padding: 40px 20px;\n                color: var(--acu-text-sub);\n            }\n            .mvu-empty i {\n                font-size: 32px;\n                margin-bottom: 12px;\n                display: block;\n                opacity: 0.5;\n            }\n            .mvu-empty p {\n                margin: 0 0 6px 0;\n            }\n            .mvu-empty .mvu-empty-hint {\n                font-size: 12px;\n                opacity: 0.7;\n            }\n\n            /*  */\n            .mvu-edit-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(0,0,0,0.6);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 99999;\n                animation: mvuFadeIn 0.15s ease-out;\n            }\n            .mvu-edit-dialog {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                padding: 16px;\n                width: 90%;\n                max-width: 400px;\n                animation: mvuSlideIn 0.2s ease-out;\n            }\n            .mvu-edit-title {\n                font-weight: 600;\n                color: var(--acu-text-main);\n                margin-bottom: 12px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .mvu-edit-path {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                padding: 6px 10px;\n                border-radius: 4px;\n                margin-bottom: 12px;\n                word-break: break-all;\n                font-family: monospace;\n            }\n            .mvu-edit-textarea {\n                width: 100%;\n                min-height: 80px;\n                padding: 10px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-input-bg, var(--acu-bg-panel));\n                color: var(--acu-text-main);\n                font-size: 13px;\n                resize: vertical;\n                box-sizing: border-box;\n            }\n            .mvu-edit-textarea:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .mvu-edit-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-top: 8px;\n                opacity: 0.7;\n            }\n            .mvu-edit-btns {\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n                margin-top: 16px;\n            }\n            .mvu-edit-btn {\n                padding: 8px 16px;\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 13px;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                transition: all 0.2s;\n            }\n            .mvu-edit-btn.mvu-btn-cancel {\n                background: transparent;\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-sub);\n            }\n            .mvu-edit-btn.mvu-btn-cancel:hover {\n                background: var(--acu-table-hover);\n            }\n            .mvu-edit-btn.mvu-btn-save {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: #fff;\n            }\n            .mvu-edit-btn.mvu-btn-save:hover {\n                opacity: 0.9;\n            }\n\n            @keyframes mvuFadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes mvuSlideIn {\n                from { transform: translateY(-20px); opacity: 0; }\n                to { transform: translateY(0); opacity: 1; }\n            }\n\n            /*  */\n            .acu-nav-btn.acu-mvu-btn.active {\n                background: var(--acu-btn-active-bg);\n                color: var(--acu-btn-active-text);\n            }\n        `;\n\n    // =====  =====\n    function escapeHtml(s) {\n      return String(s ?? '')\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')\n        .replace(/\"/g, '&quot;')\n        .replace(/'/g, '&#039;');\n    }\n\n    function isAvailable() {\n      return typeof window.Mvu !== 'undefined' && typeof window.Mvu.getMvuData === 'function';\n    }\n\n    function getData() {\n      if (!isAvailable()) return null;\n      try {\n        const allVars = window.Mvu.getMvuData({ type: 'message', message_id: -1 });\n        if (!allVars) return null;\n        return {\n          stat_data: allVars.stat_data || null,\n          display_data: allVars.display_data || {},\n          delta_data: allVars.delta_data || {},\n          schema: allVars.schema || null,\n        };\n      } catch (e) {\n        console.warn('[MvuModule] getData error:', e);\n        return null;\n      }\n    }\n\n    //  ValueWithDescription  [, \"\"]\n    function isVWD(value) {\n      return (\n        Array.isArray(value) &&\n        value.length === 2 &&\n        typeof value[1] === 'string' &&\n        (typeof value[0] === 'number' || typeof value[0] === 'string' || typeof value[0] === 'boolean')\n      );\n    }\n\n    // \n    function isSimpleArray(value) {\n      if (!Array.isArray(value)) return false;\n      return value.every(\n        item => typeof item === 'string' || typeof item === 'number' || typeof item === 'boolean' || item === null,\n      );\n    }\n\n    // \n    function getChangeIndicator(path, deltaData) {\n      if (!deltaData || !path) return '';\n\n      const parts = path.split('.');\n      let current = deltaData;\n      for (const part of parts) {\n        if (current === null || current === undefined) return '';\n        current = current[part];\n      }\n\n      if (!current) return '';\n\n      if (typeof current === 'string' && current.includes('->')) {\n        const match = current.match(/^(-?[\\d.]+)->(-?[\\d.]+)/);\n        if (match) {\n          const oldVal = parseFloat(match[1]);\n          const newVal = parseFloat(match[2]);\n          if (!isNaN(oldVal) && !isNaN(newVal)) {\n            return newVal > oldVal ? '' : newVal < oldVal ? '' : '';\n          }\n        }\n        return '';\n      }\n      return '';\n    }\n\n    // /\n    function countChildren(value) {\n      if (Array.isArray(value)) {\n        if (isVWD(value)) return 0;\n        return value.length;\n      }\n      if (value && typeof value === 'object') {\n        return Object.keys(value).filter(k => !k.startsWith('$')).length;\n      }\n      return 0;\n    }\n\n    // =====  =====\n\n    // \n    function renderRow(key, value, path, deltaData) {\n      const changeIndicator = getChangeIndicator(path, deltaData);\n      const changedClass = changeIndicator ? 'mvu-changed' : '';\n\n      let displayValue;\n      let valueClass = 'mvu-value';\n\n      if (isVWD(value)) {\n        displayValue = String(value[0]);\n      } else if (isSimpleArray(value)) {\n        displayValue = value.map(v => String(v ?? '')).join(', ');\n        valueClass += ' mvu-array-value';\n      } else {\n        displayValue = String(value ?? '');\n      }\n\n      return `\n                <div class=\"mvu-row ${changedClass}\">\n                    <div class=\"mvu-key\">${escapeHtml(key)}</div>\n                    <div class=\"mvu-value-wrap\">\n                        <span class=\"${valueClass}\" data-path=\"${escapeHtml(path)}\">${escapeHtml(displayValue)}</span>\n                        ${changeIndicator ? `<span class=\"mvu-change-indicator\">${changeIndicator}</span>` : ''}\n                    </div>\n                </div>\n            `;\n    }\n\n    // \n    function renderCard(key, value, path, deltaData, depth, defaultExpanded) {\n      const childCount = countChildren(value);\n      const collapsedClass = defaultExpanded ? '' : 'collapsed';\n\n      let bodyHtml = '';\n\n      if (Array.isArray(value) && !isVWD(value) && !isSimpleArray(value)) {\n        // \n        value.forEach((item, index) => {\n          const itemPath = `${path}[${index}]`;\n\n          if (item && typeof item === 'object' && !isVWD(item) && !isSimpleArray(item)) {\n            bodyHtml += renderCard(`[${index}]`, item, itemPath, deltaData, depth + 1, false);\n          } else {\n            bodyHtml += renderRow(`[${index}]`, item, itemPath, deltaData);\n          }\n        });\n      } else if (value && typeof value === 'object' && !isVWD(value)) {\n        // \n        const entries = Object.entries(value).filter(([k]) => !k.startsWith('$'));\n\n        for (const [childKey, childValue] of entries) {\n          const childPath = path ? `${path}.${childKey}` : childKey;\n\n          if (childValue && typeof childValue === 'object' && !isVWD(childValue) && !isSimpleArray(childValue)) {\n            // /  \n            bodyHtml += renderCard(childKey, childValue, childPath, deltaData, depth + 1, false);\n          } else {\n            //   \n            bodyHtml += renderRow(childKey, childValue, childPath, deltaData);\n          }\n        }\n      }\n\n      const countText = Array.isArray(value) ? `[${childCount}]` : `(${childCount})`;\n\n      return `\n                <div class=\"mvu-card ${collapsedClass}\" data-path=\"${escapeHtml(path)}\" data-depth=\"${depth}\">\n                    <div class=\"mvu-card-header\">\n                        <div class=\"mvu-card-title\">\n                            <span>${escapeHtml(key)}</span>\n                            <span class=\"mvu-card-count\">${countText}</span>\n                        </div>\n                        <span class=\"mvu-card-toggle\"></span>\n                    </div>\n                    <div class=\"mvu-card-body\">\n                        ${bodyHtml}\n                    </div>\n                </div>\n            `;\n    }\n\n    // =====  API =====\n    return {\n      MODULE_ID: MODULE_ID,\n\n      isAvailable: isAvailable,\n      getData: getData,\n\n      injectStyles: function () {\n        //  document iframe \n        const targetDoc = window.parent?.document || document;\n        if (targetDoc.getElementById('mvu-module-styles')) return;\n        console.log('[MvuModule] Injecting styles to parent document');\n        const styleEl = targetDoc.createElement('style');\n        styleEl.id = 'mvu-module-styles';\n        styleEl.textContent = STYLES;\n        targetDoc.head.appendChild(styleEl);\n      },\n\n      renderNavButton: function (isActive) {\n        if (!isAvailable()) return '';\n        const activeClass = isActive ? 'active' : '';\n        return `<button class=\"acu-nav-btn acu-mvu-btn $${activeClass}\" id=\"acu-btn-mvu\" data-table=\"$${MODULE_ID}\" style=\"order:-1;\">\n                    <i class=\"fa-solid fa-code-branch\"></i><span></span>\n                </button>`;\n      },\n\n      renderPanel: function () {\n        console.log('[MvuModule] renderPanel called');\n        const mvuData = getData();\n\n        if (!mvuData || !mvuData.stat_data) {\n          console.log('[MvuModule] No data available');\n          return `\n                        <div class=\"acu-panel-header\">\n                            <div class=\"acu-panel-title\">\n                                <i class=\"fa-solid fa-code-branch\"></i>\n                                <span>MVU </span>\n                            </div>\n                            <div class=\"acu-header-actions\">\n                                <button class=\"mvu-header-btn mvu-btn-close\" title=\"\">\n                                    <i class=\"fa-solid fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class=\"mvu-content\">\n                            <div class=\"mvu-empty\">\n                                <i class=\"fa-solid fa-exclamation-circle\"></i>\n                                <p> MVU </p>\n                                <p class=\"mvu-empty-hint\"> [InitVar] </p>\n                            </div>\n                        </div>\n                    `;\n        }\n\n        // \n        const topKeys = Object.keys(mvuData.stat_data).filter(k => !k.startsWith('$'));\n        console.log('[MvuModule] Top level keys:', topKeys);\n\n        let cardsHtml = '';\n        for (const key of topKeys) {\n          const value = mvuData.stat_data[key];\n          const childCount = countChildren(value);\n\n          if (value && typeof value === 'object' && !isVWD(value) && !isSimpleArray(value)) {\n            // /  \n            cardsHtml += renderCard(key, value, key, mvuData.delta_data, 0, true);\n          } else {\n            //   \n            cardsHtml += `\n                            <div class=\"mvu-card\" data-path=\"${escapeHtml(key)}\" data-depth=\"0\">\n                                <div class=\"mvu-card-body\">\n                                    ${renderRow(key, value, key, mvuData.delta_data)}\n                                </div>\n                            </div>\n                        `;\n          }\n        }\n\n        return `\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-panel-title\">\n                            <i class=\"fa-solid fa-code-branch\"></i>\n                            <span>MVU </span>\n                            <span class=\"mvu-card-count\" style=\"margin-left:4px;\">(${topKeys.length})</span>\n                        </div>\n                        <div class=\"acu-header-actions\">\n                            <button class=\"mvu-header-btn mvu-btn-refresh\" title=\"\">\n                                <i class=\"fa-solid fa-sync-alt\"></i>\n                            </button>\n                            <button class=\"mvu-header-btn mvu-btn-close\" title=\"\">\n                                <i class=\"fa-solid fa-times\"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <div class=\"mvu-content\">\n                        ${cardsHtml}\n                    </div>\n                `;\n      },\n\n      bindEvents: function ($container) {\n        //  jQuery\n        const $ = window.parent?.jQuery || window.jQuery;\n        if (!$ || !$container || !$container.length) {\n          console.warn('[MvuModule] bindEvents: jQuery or container not available');\n          return;\n        }\n\n        console.log('[MvuModule] bindEvents called, container:', $container.attr('id') || $container.attr('class'));\n\n        //  jQuery \n        const $panel = $('#acu-data-area');\n        if (!$panel.length) {\n          console.warn('[MvuModule] bindEvents: #acu-data-area not found');\n          return;\n        }\n\n        // \n        $panel.off('.mvu');\n\n        // /\n        $panel.on('click.mvu', '.mvu-card-header', function (e) {\n          e.stopPropagation();\n          const $card = $(this).closest('.mvu-card');\n          $card.toggleClass('collapsed');\n          console.log('[MvuModule] Toggle card:', $card.data('path'), 'collapsed:', $card.hasClass('collapsed'));\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-btn-refresh', function (e) {\n          e.stopPropagation();\n          console.log('[MvuModule] Refresh clicked');\n          MvuModule.refresh($panel);\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-btn-close', function (e) {\n          e.stopPropagation();\n          console.log('[MvuModule] Close clicked');\n          if (typeof Store !== 'undefined' && typeof STORAGE_KEY_ACTIVE_TAB !== 'undefined') {\n            Store.set(STORAGE_KEY_ACTIVE_TAB, null);\n          }\n          $panel.removeClass('visible');\n          $('.acu-nav-btn').removeClass('active');\n        });\n\n        // \n        $panel.on('click.mvu', '.mvu-value', function (e) {\n          e.stopPropagation();\n          const $value = $(this);\n          const path = $value.data('path');\n          if (!path) {\n            console.warn('[MvuModule] No path on value element');\n            return;\n          }\n          const currentValue = $value\n            .text()\n            .replace(/\\s*\\$\\s*$/, '')\n            .trim(); //  $\n          console.log('[MvuModule] Edit value:', path, currentValue);\n\n          MvuModule.showEditDialog(path, currentValue, async function (newValue) {\n            if (newValue !== null && newValue !== currentValue) {\n              const success = await MvuModule.setValue(path, newValue);\n              const toastr = window.parent?.toastr || window.toastr;\n              if (success) {\n                $value.text(newValue);\n                $value.css('background', 'var(--acu-success-bg)');\n                setTimeout(() => $value.css('background', ''), 1500);\n              } else {\n                if (toastr) toastr.error('');\n              }\n            }\n          });\n        });\n\n        console.log(\n          '[MvuModule] Events bindbindEvents complete. Cards:',\n          $panel.find('.mvu-card').length,\n          'Values:',\n          $panel.find('.mvu-value').length,\n        );\n      },\n\n      showEditDialog: function (path, currentValue, onSave) {\n        //  jQuery  document\n        const $ = window.parent?.jQuery || window.jQuery;\n        const targetDoc = window.parent?.document || document;\n        if (!$) return;\n\n        // \n        $(targetDoc).find('.mvu-edit-overlay').remove();\n\n        const currentTheme = (typeof getConfig === 'function' ? getConfig().theme : null) || 'retro';\n\n        const html = `\n                    <div class=\"mvu-edit-overlay acu-edit-overlay acu-theme-${currentTheme}\">\n                        <div class=\"mvu-edit-dialog acu-edit-dialog\">\n                            <div class=\"acu-edit-title\">\n                                <i class=\"fa-solid fa-edit\" style=\"opacity:0.7;\"></i>\n                                <span></span>\n                            </div>\n                            <div class=\"mvu-edit-path\">${escapeHtml(path)}</div>\n                            <textarea class=\"mvu-edit-textarea acu-edit-textarea\">${escapeHtml(currentValue)}</textarea>\n                            <div class=\"mvu-edit-hint\">Ctrl+Enter  | Esc </div>\n                            <div class=\"acu-dialog-btns\">\n                                <button class=\"acu-dialog-btn mvu-btn-cancel\">\n                                    <i class=\"fa-solid fa-times\"></i> \n                                </button>\n                                <button class=\"acu-dialog-btn acu-btn-confirm mvu-btn-save\">\n                                    <i class=\"fa-solid fa-check\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                `;\n\n        $(targetDoc.body).append(html);\n        const $overlay = $(targetDoc).find('.mvu-edit-overlay');\n        const $input = $overlay.find('.mvu-edit-textarea');\n\n        setTimeout(() => $input.focus().select(), 50);\n\n        // \n        $overlay.on('click', '.mvu-btn-cancel', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          $overlay.remove();\n          onSave(null);\n        });\n\n        // \n        $overlay.on('click', '.mvu-btn-save', function (e) {\n          e.preventDefault();\n          e.stopPropagation();\n          const newValue = $input.val();\n          $overlay.remove();\n          onSave(newValue);\n        });\n\n        // \n        $overlay.on('click', function (e) {\n          if ($(e.target).hasClass('mvu-edit-overlay')) {\n            $overlay.remove();\n            onSave(null);\n          }\n        });\n\n        // \n        $input.on('keydown', function (e) {\n          if (e.key === 'Escape') {\n            e.preventDefault();\n            $overlay.remove();\n            onSave(null);\n          } else if (e.key === 'Enter' && e.ctrlKey) {\n            e.preventDefault();\n            const newValue = $input.val();\n            $overlay.remove();\n            onSave(newValue);\n          }\n        });\n      },\n\n      setValue: async function (path, newValue) {\n        if (!isAvailable()) return false;\n\n        try {\n          // \n          let parsedValue = newValue;\n          if (newValue === 'true') parsedValue = true;\n          else if (newValue === 'false') parsedValue = false;\n          else if (!isNaN(Number(newValue)) && String(newValue).trim() !== '') {\n            parsedValue = Number(newValue);\n          }\n\n          console.log('[MvuModule] setValue:', path, '', parsedValue);\n\n          const mvuData = window.Mvu.getMvuData({ type: 'message', message_id: -1 });\n          if (!mvuData) {\n            console.error('[MvuModule]  MVU ');\n            return false;\n          }\n\n          const success = await window.Mvu.setMvuVariable(mvuData, path, parsedValue, {\n            reason: '',\n            is_recursive: false,\n          });\n\n          if (success) {\n            await window.Mvu.replaceMvuData(mvuData, { type: 'message', message_id: -1 });\n            console.log('[MvuModule] ');\n          } else {\n            console.warn('[MvuModule] setMvuVariable  false');\n          }\n\n          return success;\n        } catch (e) {\n          console.error('[MvuModule] setValue error:', e);\n          return false;\n        }\n      },\n\n      isModuleTab: function (tableName) {\n        return tableName === MODULE_ID;\n      },\n\n      refresh: function ($container) {\n        if (!$container || !$container.length) return;\n        console.log('[MvuModule] refresh called');\n        const panelHtml = this.renderPanel();\n        $container.html('<div class=\"acu-mvu-panel\">' + panelHtml + '</div>');\n        this.bindEvents($container);\n      },\n    };\n  })();\n  // MVU \n  // COC\n  const DEFAULT_DICE_CONFIG = {\n    critSuccessMax: 5,\n    hardSuccessDiv: 5,\n    difficultSuccessDiv: 2,\n    critFailMin: 96,\n    ruleType: 'high_good',\n    lastDiceType: '1d100',\n    // DND \n    dndCritSuccess: 20,\n    dndCritFail: 1,\n    // : initiator_lose | tie | initiator_win\n    contestTieRule: 'initiator_lose',\n  };\n\n  const getDiceConfig = () => Store.get(STORAGE_KEY_DICE_CONFIG, DEFAULT_DICE_CONFIG);\n  const saveDiceConfig = cfg => Store.set(STORAGE_KEY_DICE_CONFIG, { ...getDiceConfig(), ...cfg });\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  const DiceFormulaRegex = /^(\\d+d\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?([+\\-*/]\\d+)?$/i;\n\n  // \n  const BUILTIN_ATTRIBUTE_PRESETS = [\n    {\n      format: 'acu_attr_preset_v1',\n      version: 1,\n      id: 'coc7',\n      name: 'COC',\n      builtin: true,\n      description: '7816',\n      baseAttributes: [\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '3d6*5', range: [15, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n        { name: '', formula: '2d6*5+30', range: [40, 90], modifier: '1d10-5' },\n      ],\n      specialAttributes: [\n        //  15-1109560\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        { name: '', formula: '10+5d20', range: [15, 95] },\n        //  9-8547\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        { name: '', formula: '5+4d20', range: [9, 85] },\n        //  8-6536\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        { name: '', formula: '5+3d20', range: [8, 65] },\n        //  3-4122\n        { name: '', formula: '1+2d20', range: [3, 41] },\n        // \n        { name: '', formula: '/2', range: [1, 99] },\n        // COC \n        { name: 'SAN', formula: '', range: [1, 99] },\n        { name: '', formula: '1d5', range: [1, 5] },\n      ],\n    },\n    {\n      format: 'acu_attr_preset_v1',\n      version: 1,\n      id: 'dnd5e',\n      name: 'DND',\n      builtin: true,\n      description: '568',\n      baseAttributes: [\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n        { name: '', formula: '4d6dl1', range: [3, 18], modifier: '1d4-2' },\n      ],\n      specialAttributes: [\n        //  10-2015\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        { name: '', formula: '8+2d6', range: [10, 20] },\n        //  7-1712\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        { name: '', formula: '5+2d6', range: [7, 17] },\n        //  4-149\n        { name: '', formula: '2+2d6', range: [4, 14] },\n        { name: '', formula: '2+2d6', range: [4, 14] },\n      ],\n    },\n  ];\n\n  // \n  const AttributePresetManager = (() => {\n    let _cache = null;\n\n    return {\n      //  + \n      getAllPresets() {\n        if (_cache) return _cache;\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        _cache = [...BUILTIN_ATTRIBUTE_PRESETS, ...stored];\n        return _cache;\n      },\n\n      // null = \n      getActivePreset() {\n        const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        if (!activeId) return null;\n        return this.getAllPresets().find(p => p.id === activeId) || null;\n      },\n\n      // \n      setActivePreset(id) {\n        try {\n          // idnull\n          const finalId = id === '' || id === undefined ? null : id;\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, finalId);\n          // \n          _cache = null;\n          console.log('[AttributePresetManager] :', finalId);\n          return true;\n        } catch (err) {\n          console.error('[AttributePresetManager] :', err);\n          return false;\n        }\n      },\n\n      // \n      createPreset(preset) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const newPreset = {\n          ...preset,\n          id: preset.id || 'custom_' + Date.now(),\n          builtin: false,\n          createdAt: new Date().toISOString(),\n        };\n        stored.push(newPreset);\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[AttributePresetManager] :', newPreset.name);\n        return newPreset;\n      },\n\n      // \n      updatePreset(id, updates) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const index = stored.findIndex(p => p.id === id);\n        if (index < 0) return false;\n        stored[index] = { ...stored[index], ...updates };\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, stored);\n        _cache = null;\n        console.log('[AttributePresetManager] :', id);\n        return true;\n      },\n\n      // \n      deletePreset(id) {\n        const stored = Store.get(STORAGE_KEY_ATTRIBUTE_PRESETS, []);\n        const filtered = stored.filter(p => p.id !== id);\n        if (filtered.length === stored.length) return false;\n        Store.set(STORAGE_KEY_ATTRIBUTE_PRESETS, filtered);\n        _cache = null;\n        // \n        if (Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET) === id) {\n          Store.set(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n        }\n        console.log('[AttributePresetManager] :', id);\n        return true;\n      },\n\n      //  JSON\n      exportPreset(id) {\n        const preset = this.getAllPresets().find(p => p.id === id);\n        if (!preset) return null;\n        const exported = {\n          format: 'acu_attr_preset_v1',\n          version: 1,\n          ...preset,\n        };\n        delete exported.builtin; // \n        return JSON.stringify(exported, null, 2);\n      },\n\n      //  JSON \n      importPreset(jsonStr) {\n        try {\n          const data = JSON.parse(jsonStr);\n\n          // \n          if (data.format !== 'acu_attr_preset_v1') {\n            throw new Error('');\n          }\n\n          // \n          if (!data.name || !data.baseAttributes || !Array.isArray(data.baseAttributes)) {\n            throw new Error('');\n          }\n\n          // ID\n          const imported = {\n            ...data,\n            id: 'imported_' + Date.now(),\n            builtin: false,\n            createdAt: new Date().toISOString(),\n          };\n\n          return this.createPreset(imported);\n        } catch (e) {\n          console.error('[AttributePresetManager] :', e);\n          return null;\n        }\n      },\n\n      // \n      clearCache() {\n        _cache = null;\n      },\n    };\n  })();\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   * : 3d6, 4d6kh3, 4d6dl1, 4d6dh1\n   * @returns  NaN\n   */\n  const rollDiceExpression = expr => {\n    const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n\n    const match = expr.match(/^(\\d+)d(\\d+)(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?$/i);\n    if (!match) return NaN;\n\n    const [, countStr, sidesStr, keepDrop] = match;\n    const count = parseInt(countStr, 10);\n    const sides = parseInt(sidesStr, 10);\n\n    let rolls = Array.from({ length: count }, () => rollDice(sides));\n\n    //  keep/drop\n    if (keepDrop) {\n      const kd = keepDrop.toLowerCase();\n      const n = parseInt(kd.slice(2), 10);\n      rolls.sort((a, b) => b - a); // \n\n      if (kd.startsWith('kh'))\n        rolls = rolls.slice(0, n); // n\n      else if (kd.startsWith('kl'))\n        rolls = rolls.slice(-n); // n\n      else if (kd.startsWith('dh'))\n        rolls = rolls.slice(n); // n\n      else if (kd.startsWith('dl')) rolls = rolls.slice(0, -n); // n\n    }\n\n    return rolls.reduce((a, b) => a + b, 0);\n  };\n\n  /**\n   * \n   * @param formula  \"/2+1d10\"  \"3d6*5\"\n   * @param context  { : 50, : 40 }\n   * @returns \n   */\n  const evaluateFormula = (formula, context = {}) => {\n    if (!formula) return 0;\n\n    let expr = String(formula).trim();\n\n    // 1. \n    const varNames = Object.keys(context).sort((a, b) => b.length - a.length);\n    for (const name of varNames) {\n      const value = context[name];\n      if (typeof value === 'number' && !isNaN(value)) {\n        // \n        expr = expr.split(name).join(`(${value})`);\n      }\n    }\n\n    // 2. \n    expr = expr.replace(/\\d+d\\d+(kh\\d+|kl\\d+|dh\\d+|dl\\d+)?/gi, match => {\n      const result = rollDiceExpression(match);\n      return isNaN(result) ? '0' : String(result);\n    });\n\n    // 3. \n    if (!/^[\\d\\s+\\-*/().]+$/.test(expr)) {\n      console.warn('[evaluateFormula] :', formula, '', expr);\n      return 0;\n    }\n\n    // 4. \n    try {\n      // eslint-disable-next-line no-new-func\n      const result = new Function(`return (${expr})`)();\n      return Math.round(result); // \n    } catch (e) {\n      console.error('[evaluateFormula] :', formula, '', expr, e);\n      return 0;\n    }\n  };\n\n  /**\n   * \n   * @param formula \n   * @param range  [min, max]\n   * @param context \n   * @returns \n   */\n  const generateAttributeValue = (formula, range, context) => {\n    let value = evaluateFormula(formula, context);\n\n    if (range && Array.isArray(range) && range.length === 2) {\n      value = Math.max(range[0], Math.min(range[1], value));\n    }\n\n    return value;\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const DASHBOARD_TABLE_CONFIG = {\n    global: {\n      tableKeywords: ['', '', ''],\n      columns: {\n        detailLocation: { keywords: ['', '', '', ''], fallbackIndex: null },\n        currentLocation: { keywords: ['', '', '', ''], fallbackIndex: 2 },\n      },\n    },\n    player: {\n      // : user, <user>\n      tableKeywords: ['', '', '', '', 'player', '', 'user', '<user>'],\n      columns: {\n        name: { keywords: ['', '', '', 'name'], fallbackIndex: 1 },\n        status: { keywords: ['', '', '', ''], fallbackIndex: null },\n        position: { keywords: ['', '', ''], fallbackIndex: null },\n        attrs: { keywords: ['', ''], fallbackIndex: null, isMultiple: true },\n        // : , , , \n        money: {\n          keywords: ['', '', '', '', '', '', '', '', ''],\n          fallbackIndex: null,\n        },\n        resources: { keywords: ['', '', 'resources'], fallbackIndex: null },\n      },\n    },\n    location: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: {\n          keywords: ['', '', '', '', '', '', '', ''],\n          fallbackIndex: 1,\n        },\n        description: { keywords: ['', '', '', '', ''], fallbackIndex: null },\n      },\n    },\n    npc: {\n      // : , , , , , \n      tableKeywords: [\n        '',\n        '',\n        'NPC',\n        '',\n        '',\n        '',\n        '',\n        'character',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', ''], fallbackIndex: 1 },\n        status: { keywords: ['', ''], fallbackIndex: null },\n        position: { keywords: ['', ''], fallbackIndex: null },\n        inScene: { keywords: ['', '', '', ''], fallbackIndex: null },\n      },\n    },\n    quest: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        progress: { keywords: ['', '', '/'], fallbackIndex: 5 },\n        status: { keywords: [''], fallbackIndex: 6 },\n      },\n      filters: {\n        active: { column: 'status', includes: ['', '', ''], excludeColumn: 'type', excludes: [''] },\n      },\n    },\n    bag: {\n      // : , \n      tableKeywords: ['', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', '', ''], fallbackIndex: 2 },\n        count: { keywords: ['', '', ''], fallbackIndex: 3 },\n      },\n    },\n    skill: {\n      // : , , , , , , , \n      tableKeywords: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        level: { keywords: ['', '', '', 'lv'], fallbackIndex: 3 },\n      },\n    },\n    equip: {\n      // : , , , , , \n      tableKeywords: ['', '', '', '', '', '', '', '', '', ''],\n      columns: {\n        name: { keywords: ['', '', ''], fallbackIndex: 1 },\n        type: { keywords: ['', ''], fallbackIndex: 2 },\n        part: { keywords: ['', '', ''], fallbackIndex: 3 },\n        isEquipped: { keywords: ['', '', '', ''], fallbackIndex: 4 },\n      },\n      filters: {\n        equipped: { column: 'isEquipped', includes: ['', '', 'true', '', 'yes', 'equipped'] },\n      },\n    },\n  };\n\n  // \n  const DashboardDataParser = {\n    // \n    findTable(allTables, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) return null;\n\n      for (const keyword of config.tableKeywords) {\n        for (const tableName in allTables) {\n          if (tableName.includes(keyword)) {\n            return {\n              data: allTables[tableName],\n              name: tableName,\n              key: allTables[tableName].key,\n              config: config,\n            };\n          }\n        }\n      }\n      return null;\n    },\n\n    // \n    findColumnIndex(headers, columnKey, moduleConfig) {\n      const colConfig = moduleConfig.columns[columnKey];\n      if (!colConfig) return -1;\n\n      // \n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (colConfig.keywords.some(kw => h.includes(kw.toLowerCase()))) {\n          return i;\n        }\n      }\n\n      // \n      return colConfig.fallbackIndex ?? -1;\n    },\n\n    // \n    getValue(row, headers, columnKey, moduleConfig) {\n      const idx = this.findColumnIndex(headers, columnKey, moduleConfig);\n      if (idx < 0 || idx >= row.length) return null;\n      return row[idx];\n    },\n\n    // \n    getColumnMap(headers, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config) return {};\n\n      const map = {};\n      for (const colKey in config.columns) {\n        map[colKey] = this.findColumnIndex(headers, colKey, config);\n      }\n      return map;\n    },\n\n    // \n    parseRows(tableResult, moduleKey) {\n      if (!tableResult || !tableResult.data) return [];\n\n      const { data, config } = tableResult;\n      const headers = data.headers || [];\n      const rows = data.rows || [];\n      const colMap = this.getColumnMap(headers, moduleKey);\n\n      return rows.map((row, idx) => {\n        const obj = { _rowIndex: idx, _raw: row };\n        for (const colKey in colMap) {\n          const colIdx = colMap[colKey];\n          obj[colKey] = colIdx >= 0 && colIdx < row.length ? row[colIdx] : null;\n        }\n        return obj;\n      });\n    },\n\n    // \n    applyFilter(parsedRows, filterKey, moduleKey) {\n      const config = DASHBOARD_TABLE_CONFIG[moduleKey];\n      if (!config || !config.filters || !config.filters[filterKey]) return parsedRows;\n\n      const filter = config.filters[filterKey];\n\n      // parsedRows\n      const hasFilterColumn = parsedRows.some(row => row[filter.column] !== null && row[filter.column] !== undefined);\n      if (!hasFilterColumn) {\n        // \n        return parsedRows;\n      }\n\n      return parsedRows.filter(row => {\n        const value = String(row[filter.column] || '').toLowerCase();\n        const matchInclude = filter.includes.some(inc => value.includes(inc.toLowerCase()));\n\n        if (filter.excludeColumn && filter.excludes) {\n          const excludeValue = String(row[filter.excludeColumn] || '').toLowerCase();\n          const matchExclude = filter.excludes.some(exc => excludeValue.includes(exc.toLowerCase()));\n          return matchInclude && !matchExclude;\n        }\n\n        return matchInclude;\n      });\n    },\n  };\n\n  const DEFAULT_GM_CONFIG = {\n    enabled: true,\n    diceSystem: '1d100',\n    showDiceIcon: true,\n    autoSendPrompt: true,\n    action_groups: [\n      {\n        table_keywords: ['', '', 'Location', 'Map', '', ''],\n        actions: [\n          { label: '', icon: 'fa-walking', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-search', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-clock', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', 'NPC', '', '', ''],\n        actions: [\n          { label: '', icon: 'fa-comments', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-hand-fist', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          { label: '', icon: 'fa-hand-pointer', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-eye', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-trash', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-shield-halved',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          { label: '', icon: 'fa-coins', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-wand-magic-sparkles',\n            type: 'skill_check',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-dumbbell', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-crosshairs',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          {\n            label: '',\n            icon: 'fa-list-check',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-circle-xmark', type: 'prompt', template: '<user>{Name}', auto_send: true },\n        ],\n      },\n      {\n        table_keywords: ['', '', ''],\n        actions: [\n          {\n            label: '',\n            icon: 'fa-ear-listen',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n          { label: '', icon: 'fa-user-plus', type: 'prompt', template: '<user>{Name}', auto_send: true },\n          {\n            label: '',\n            icon: 'fa-handshake',\n            type: 'prompt',\n            template: '<user>{Name}',\n            auto_send: true,\n          },\n        ],\n      },\n    ],\n  };\n  // [] \n  const THEME_COLORS = {\n    retro: {\n      bgPanel: '#e6e2d3',\n      border: '#dcd0c0',\n      textMain: '#5e4b35',\n      textSub: '#8a7a6a',\n      btnBg: '#dcd0c0',\n      btnHover: '#cbbba8',\n      accent: '#7a695f',\n      tableHead: '#efebe4',\n      successText: '#27ae60',\n      successBg: 'rgba(39, 174, 96, 0.15)',\n      inputBg: '#f5f2eb',\n      inputText: '#5e4b35',\n      placeholderText: '#a09080',\n      btnActiveBg: '#8d7b6f',\n      btnActiveText: '#fdfaf5',\n    },\n    dark: {\n      bgPanel: 'rgba(30, 30, 30, 0.98)',\n      border: '#444',\n      textMain: '#eee',\n      textSub: '#999',\n      btnBg: 'rgba(60, 60, 60, 0.9)',\n      btnHover: '#505050',\n      accent: '#9b8cd9',\n      tableHead: 'rgba(45, 45, 45, 0.95)',\n      successText: '#4cd964',\n      successBg: 'rgba(76, 217, 100, 0.2)',\n      inputBg: 'rgba(50, 50, 50, 0.95)',\n      inputText: '#eee',\n      placeholderText: '#777',\n      btnActiveBg: '#6a5acd',\n      btnActiveText: '#fff',\n    },\n    modern: {\n      bgPanel: '#f8f9fa',\n      border: '#e0e0e0',\n      textMain: '#333',\n      textSub: '#666',\n      btnBg: '#e9ecef',\n      btnHover: '#dee2e6',\n      accent: '#007bff',\n      tableHead: '#f1f3f5',\n      successText: '#28a745',\n      successBg: 'rgba(40, 167, 69, 0.15)',\n      inputBg: '#fff',\n      inputText: '#333',\n      placeholderText: '#999',\n      btnActiveBg: '#007bff',\n      btnActiveText: '#fff',\n    },\n    forest: {\n      bgPanel: '#e8f5e9',\n      border: '#a5d6a7',\n      textMain: '#2e7d32',\n      textSub: '#66bb6a',\n      btnBg: '#c8e6c9',\n      btnHover: '#a5d6a7',\n      accent: '#43a047',\n      tableHead: '#dcedc8',\n      successText: '#2e7d32',\n      successBg: 'rgba(46, 125, 50, 0.2)',\n      inputBg: '#f1f8e9',\n      inputText: '#2e7d32',\n      placeholderText: '#81c784',\n      btnActiveBg: '#43a047',\n      btnActiveText: '#fff',\n    },\n    ocean: {\n      bgPanel: '#e3f2fd',\n      border: '#90caf9',\n      textMain: '#1565c0',\n      textSub: '#42a5f5',\n      btnBg: '#bbdefb',\n      btnHover: '#90caf9',\n      accent: '#1976d2',\n      tableHead: '#bbdefb',\n      successText: '#0288d1',\n      successBg: 'rgba(2, 136, 209, 0.15)',\n      inputBg: '#e1f5fe',\n      inputText: '#1565c0',\n      placeholderText: '#64b5f6',\n      btnActiveBg: '#1976d2',\n      btnActiveText: '#fff',\n    },\n    cyber: {\n      bgPanel: '#0a0a0a',\n      border: '#00ffcc33',\n      textMain: '#00ffcc',\n      textSub: '#00cc99',\n      btnBg: 'rgba(0, 255, 204, 0.1)',\n      btnHover: 'rgba(0, 255, 204, 0.2)',\n      accent: '#00ffcc',\n      tableHead: 'rgba(0, 255, 204, 0.05)',\n      successText: '#0f0',\n      successBg: 'rgba(0, 255, 0, 0.15)',\n      inputBg: 'rgba(0, 0, 0, 0.6)',\n      inputText: '#00ffcc',\n      placeholderText: '#006655',\n      btnActiveBg: '#ff00ff',\n      btnActiveText: '#fff',\n    },\n    nightowl: {\n      bgPanel: '#011627',\n      border: '#132e45',\n      textMain: '#e0e6f2',\n      textSub: '#a6b8cc',\n      btnBg: '#1f3a52',\n      btnHover: '#2a4a68',\n      accent: '#7fdbca',\n      tableHead: '#0a2133',\n      successText: '#addb67',\n      successBg: 'rgba(173, 219, 103, 0.15)',\n      inputBg: '#00101c',\n      inputText: '#e0e6f2',\n      placeholderText: '#6a8090',\n      btnActiveBg: '#7fdbca',\n      btnActiveText: '#011627',\n    },\n  };\n  const getThemeColors = () => THEME_COLORS[getConfig().theme] || THEME_COLORS['retro'];\n  const getGMConfig = () => Store.get(STORAGE_KEY_GM_CONFIG, DEFAULT_GM_CONFIG);\n\n  const getActionsForTable = tableName => {\n    const config = getGMConfig();\n    if (!config.enabled || !config.action_groups) return [];\n    const lowerName = tableName.toLowerCase();\n    for (const group of config.action_groups) {\n      const matched = group.table_keywords.some(keyword => lowerName.includes(keyword.toLowerCase()));\n      if (matched) return group.actions || [];\n    }\n    return [];\n  };\n  const isNumericCell = value => {\n    if (value === null || value === undefined || value === '') return false;\n    const str = String(value).trim();\n    // : (50/100)/: \n    return (\n      /^-?\\d+(\\.\\d+)?%?$/.test(str) ||\n      /^\\d+\\/\\d+$/.test(str) ||\n      /^[\\u4e00-\\u9fa5a-zA-Z]+[:\\s]\\s*\\d+/i.test(str) ||\n      /\\d+/.test(str)\n    );\n  };\n\n  const extractNumericValue = value => {\n    if (!value) return 0;\n    const str = String(value).trim();\n    //  (50/100 -> )\n    if (/^\\d+\\/\\d+$/.test(str)) return parseInt(str.split('/')[0], 10);\n    // \n    if (str.endsWith('%')) return parseInt(str.replace('%', ''), 10);\n    //  \":\" \n    const matches = str.match(/\\d+/g);\n    if (matches && matches.length > 0) {\n      return parseInt(matches[matches.length - 1], 10);\n    }\n    return 0;\n  };\n\n  const parseAttributeString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    //  JSON  {\"\":, ...}\n    if (rawStr.startsWith('{') && rawStr.endsWith('}')) {\n      try {\n        const jsonObj = JSON.parse(rawStr);\n        for (const key in jsonObj) {\n          const val = jsonObj[key];\n          if (typeof val === 'number') {\n            results.push({ name: key, value: val });\n          } else if (typeof val === 'string' && /^\\d+$/.test(val)) {\n            results.push({ name: key, value: parseInt(val, 10) });\n          }\n        }\n        if (results.length > 0) return results;\n      } catch (e) {\n        // JSON \n      }\n    }\n\n    //  \":; :\" \n    const parts = rawStr.split(/[,;\\s]+/);\n    for (const part of parts) {\n      const match = part.match(/^\"?([\\u4e00-\\u9fa5a-zA-Z_]+)\"?[:\\s]\\s*\"?(-?\\d+)\"?/);\n      if (match) {\n        results.push({ name: match[1], value: parseInt(match[2], 10) });\n      }\n    }\n    return results;\n  };\n  // [] :\n  // 1: \"();()\"\n  // 2: \":;:\"\n  // 3: \":,;:\"\n  const parseRelationshipString = str => {\n    if (!str) return [];\n    const results = [];\n    const rawStr = String(str).trim();\n\n    // \n    const parts = rawStr.split(/[;]/);\n    for (const part of parts) {\n      const trimmed = part.trim();\n      if (!trimmed) continue;\n\n      // 2/3: \":\"  \"\"\n      const colonMatch = trimmed.match(/^?(.+?)[:\\](.+)$/);\n      if (colonMatch) {\n        const name = colonMatch[1].trim();\n        const relation = colonMatch[2].trim();\n        if (name && relation) {\n          results.push({ name: name, relation: relation });\n          continue;\n        }\n      }\n\n      // 1: \"()\"  \"\"\n      const parenMatch = trimmed.match(/^([^(]+)[(]([^)]+)[)]$/);\n      if (parenMatch) {\n        results.push({ name: parenMatch[1].trim(), relation: parenMatch[2].trim() });\n        continue;\n      }\n\n      // \n      if (trimmed.length > 0) {\n        results.push({ name: trimmed, relation: '' });\n      }\n    }\n    return results;\n  };\n\n  // [] \n  const isRelationshipCell = (value, headerName) => {\n    if (!value) return false;\n    const str = String(value).trim();\n    const lowerHeader = (headerName || '').toLowerCase();\n    // \"\"\n    if (lowerHeader.includes('') || lowerHeader.includes('')) {\n      return true;\n    }\n    //  \"();()\" \n    return /^[^(;]+[(][^)]+[)]([;][^(;]+[(][^)]+[)])*$/.test(str);\n  };\n\n  const processTemplate = (template, cardData, headers) => {\n    if (!template || !cardData) return template;\n    let result = template;\n    const name = cardData[1] || '';\n    result = result.replace(/\\{Name\\}/gi, name);\n    result = result.replace(/\\{RowIndex\\}/gi, cardData[0] || '0');\n    if (headers && headers.length > 0) {\n      headers.forEach((header, idx) => {\n        if (header && idx < cardData.length) {\n          const value = cardData[idx] || '';\n          const regex = new RegExp(`\\\\{${header}\\\\}`, 'gi');\n          result = result.replace(regex, value);\n        }\n      });\n    }\n    result = result.replace(/\\{[^}]+\\}/g, '');\n    return result;\n  };\n\n  // \n  const ACTION_BUTTONS = [\n    { id: 'acu-btn-save-global', icon: 'fa-save', title: '' },\n    { id: 'acu-btn-refresh', icon: 'fa-sync-alt', title: '' },\n    { id: 'acu-btn-collapse', icon: 'fa-chevron-down', title: '' },\n    // {id: 'acu-btn-open-editor', icon: 'fa-table-columns', title: ''},\n    { id: 'acu-btn-refill', icon: 'fa-bolt', title: '' },\n    { id: 'acu-btn-settings', icon: 'fa-cog', title: '' },\n  ];\n\n  let isInitialized = false;\n  let isSaving = false;\n  let isEditingOrder = false;\n  let isSettingsOpen = false;\n  let currentDiffMap = new Set();\n  let observer = null;\n  let _boundRenderHandler = null;\n\n  // ---  ---\n  let cachedRawData = null;\n  let hasUnsavedChanges = false;\n  let tablePageStates = {};\n  let tableSearchStates = {};\n  let lastOptionHash = null;\n  let optionPanelVisible = false; // [] \n  // [] \n  const STORAGE_KEY_SCROLL = 'acu_scroll_v19_fixed';\n  let tableScrollStates = {};\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY_SCROLL);\n    if (saved) tableScrollStates = JSON.parse(saved);\n  } catch (e) {\n    console.warn('[ACU] Error:', e);\n  }\n  // [] \n  const UpdateController = {\n    _lastValidationCount: 0,\n    _isRollingBack: false, // \n\n    handleUpdate: () => {\n      // \n      if (UpdateController._isRollingBack) return;\n\n      // ===  intercept  ===\n      try {\n        const snapshot = loadSnapshot();\n        const newData = getTableData();\n        if (snapshot && newData) {\n          const rules = ValidationRuleManager.getEnabledRules();\n          const violations = ValidationEngine.checkTableRules(snapshot, newData, rules);\n\n          if (violations.length > 0) {\n            console.warn('[ACU] :', violations);\n            UpdateController._isRollingBack = true;\n\n            //  API \n            const api = getCore().getDB();\n            if (api?.fillTable) {\n              api.fillTable(snapshot);\n              if (window.toastr) {\n                window.toastr.error(violations[0].message, '', {\n                  timeOut: 5000,\n                  positionClass: 'toast-bottom-right',\n                });\n              }\n            }\n\n            setTimeout(() => {\n              UpdateController._isRollingBack = false;\n            }, 500);\n            return;\n          }\n        }\n      } catch (e) {\n        console.error('[ACU] :', e);\n      }\n\n      //  renderInterface \n      // \n      renderInterface();\n\n      // \n      setTimeout(() => {\n        try {\n          const rawData = cachedRawData || getTableData();\n          if (rawData) {\n            const errors = ValidationEngine.validateAllData(rawData);\n            const newCount = errors.length;\n\n            // \n            if (newCount > UpdateController._lastValidationCount && newCount > 0) {\n              const newErrors = newCount - UpdateController._lastValidationCount;\n            }\n\n            UpdateController._lastValidationCount = newCount;\n\n            // \n            updateValidationIndicator(newCount);\n          }\n        } catch (e) {\n          console.error('[ACU] :', e);\n        }\n      }, 100);\n    },\n  };\n\n  // \n  const updateValidationIndicator = count => {\n    const { $ } = getCore();\n    const $indicator = $('.acu-validation-indicator');\n\n    if (count > 0) {\n      if ($indicator.length) {\n        $indicator.find('.acu-validation-count').text(count);\n        $indicator.show();\n      }\n    } else {\n      $indicator.hide();\n    }\n  };\n\n  // --- []  ---\n  const getCurrentContextFingerprint = () => {\n    try {\n      // 1:  API\n      if (typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId) {\n        return SillyTavern.getCurrentChatId();\n      }\n      // 2: \n      if (typeof SillyTavern !== 'undefined' && SillyTavern.chatId) {\n        return SillyTavern.chatId;\n      }\n      // 3:  (iframe )\n      if (window.parent?.SillyTavern?.getCurrentChatId) {\n        return window.parent.SillyTavern.getCurrentChatId();\n      }\n    } catch (e) {\n      console.warn('[ACU] getCurrentContextFingerprint error:', e);\n    }\n    return 'unknown_context';\n  };\n\n  //  ()\n\n  const DEFAULT_CONFIG = {\n    layout: 'horizontal',\n    collapseStyle: 'bar',\n    collapseAlign: 'right',\n    fontFamily: 'default',\n    theme: 'retro',\n    cardWidth: 260,\n    fontSize: 13,\n    highlightNew: true,\n    itemsPerPage: 50,\n    actionsPosition: 'bottom',\n    gridColumns: 'auto', // [] \n    positionMode: 'fixed', // fixed=, embedded=\n    showOptionPanel: true, // [] \n    clickOptionToAutoSend: true, // [] \n    optionFontSize: 12, // [] \n  };\n\n  const FONTS = [\n    { id: 'default', name: ' (Modern)', val: `'Segoe UI', 'Microsoft YaHei', sans-serif` },\n    { id: 'hanchan', name: '', val: `\"\", sans-serif` },\n    { id: 'maple', name: 'Maple Mono ()', val: `\"Maple Mono NF CN\", monospace` },\n    { id: 'huiwen', name: ' (Huiwen)', val: `\"Huiwen-mincho\", serif` },\n    { id: 'cooper', name: 'Cooper', val: `\"CooperZhengKai\", serif` },\n    { id: 'yffyt', name: 'YFFYT ()', val: `\"YFFYT\", sans-serif` },\n    { id: 'fusion', name: 'Fusion Pixel ()', val: `\"Fusion Pixel 12px M latin\", monospace` },\n    { id: 'wenkai', name: ' (WenKai)', val: `\"LXGW WenKai\", serif` },\n    { id: 'notosans', name: ' (Noto Sans)', val: `\"Noto Sans CJK\", sans-serif` },\n    { id: 'zhuque', name: ' (Zhuque)', val: `\"Zhuque Fangsong (technical preview)\", serif` },\n  ];\n\n  const THEMES = [\n    { id: 'retro', name: ' (Retro)', icon: 'fa-scroll' },\n    { id: 'dark', name: ' (Dark)', icon: 'fa-moon' },\n    { id: 'modern', name: ' (Modern)', icon: 'fa-sun' },\n    { id: 'forest', name: ' (Forest)', icon: 'fa-tree' },\n    { id: 'ocean', name: ' (Ocean)', icon: 'fa-water' },\n    { id: 'cyber', name: ' (Cyber)', icon: 'fa-bolt' },\n    { id: 'nightowl', name: ' (Night Owl)', icon: 'fa-feather' },\n  ];\n\n  // []  core  ( +  ST )\n  let _coreCache = null;\n  const getCore = () => {\n    const w = window.parent || window;\n    //  jQuery\n    const $ = window.jQuery || w.jQuery;\n\n    // ($)\n    if (_coreCache && _coreCache.$) return _coreCache;\n\n    const core = {\n      $: $,\n      getDB: () => w.AutoCardUpdaterAPI || window.AutoCardUpdaterAPI,\n      clipboard: w.navigator.clipboard,\n      //   ->  ->  ()\n      ST:\n        window.SillyTavern ||\n        w.SillyTavern ||\n        (() => {\n          try {\n            return window.top ? window.top.SillyTavern : null;\n          } catch (e) {\n            return null;\n          }\n        })(),\n    };\n\n    //  jQuery \n    if ($) _coreCache = core;\n    return core;\n  };\n\n  const updateSaveButtonState = () => {\n    const { $ } = getCore();\n    const $btn = $('#acu-btn-save-global');\n    const $icon = $btn.find('i');\n    const deletions = getPendingDeletions();\n    let hasDeletions = false;\n    if (deletions) {\n      for (const key in deletions) {\n        if (deletions[key] && deletions[key].length > 0) {\n          hasDeletions = true;\n          break;\n        }\n      }\n    }\n    if (hasUnsavedChanges || hasDeletions) {\n      $icon.addClass('acu-icon-breathe');\n      $btn.attr('title', '');\n    } else {\n      $icon.removeClass('acu-icon-breathe');\n      $btn.attr('title', '');\n      $btn.css('color', '');\n    }\n  };\n\n  const getIconForTableName = name => {\n    if (!name) return 'fa-table';\n    const n = name.toLowerCase();\n    if (n.includes('') || n.includes('')) return 'fa-user-circle';\n    if (n.includes('') || n.includes('')) return 'fa-globe-asia';\n    if (n.includes('') || n.includes('')) return 'fa-briefcase';\n    if (n.includes('') || n.includes('')) return 'fa-dragon';\n    if (n.includes('') || n.includes('')) return 'fa-user-friends';\n    if (n.includes('') || n.includes('')) return 'fa-scroll';\n    if (n.includes('') || n.includes('')) return 'fa-address-book';\n    if (n.includes('') || n.includes('')) return 'fa-book-reader';\n    if (n.includes('') || n.includes('')) return 'fa-map-location-dot';\n    if (n.includes('') || n.includes('') || n.includes('')) return 'fa-bullseye';\n    if (n.includes('') || n.includes('')) return 'fa-shield-halved';\n    if (n.includes('')) return 'fa-gem';\n    if (n.includes('') || n.includes('')) return 'fa-file-lines';\n    if (n.includes('')) return 'fa-list-check';\n    return 'fa-table';\n  };\n\n  const getBadgeStyle = text => {\n    if (!text) return '';\n    const str = String(text).trim();\n    if (/^[0-9]+%?$/.test(str) || /^Lv\\.\\d+$/.test(str)) return 'acu-badge-green';\n    if (str.length <= 6 && !str.includes('http')) return 'acu-badge-neutral';\n    if (['', '', '', '', '', ''].includes(str)) return 'acu-badge-neutral';\n    return '';\n  };\n\n  // []  ()\n  const Store = {\n    get: (key, def = null) => {\n      try {\n        return JSON.parse(localStorage.getItem(key)) ?? def;\n      } catch {\n        return def;\n      }\n    },\n    set: (key, val) => {\n      try {\n        localStorage.setItem(key, JSON.stringify(val));\n      } catch (e) {\n        // \n        if (e.name === 'QuotaExceededError' || e.message.includes('quota')) {\n          console.warn('[ACU] ...');\n          try {\n            // 1.  ()\n            localStorage.removeItem(STORAGE_KEY_LAST_SNAPSHOT);\n\n            // 2. \n            localStorage.setItem(key, JSON.stringify(val));\n          } catch (retryErr) {\n            // \n            console.error('[ACU Store] ', retryErr);\n            if (window.toastr && !window._acuQuotaAlerted) {\n              window.toastr.warning(' ');\n              window._acuQuotaAlerted = true;\n              setTimeout(() => (window._acuQuotaAlerted = false), 10000);\n            }\n          }\n        } else {\n          console.error('[ACU Store]', e);\n        }\n      }\n    },\n  };\n\n  const getActiveTabState = () => Store.get(STORAGE_KEY_ACTIVE_TAB);\n  const saveActiveTabState = v => Store.set(STORAGE_KEY_ACTIVE_TAB, v);\n  const getPendingDeletions = () => Store.get(STORAGE_KEY_PENDING_DELETIONS, {});\n  const savePendingDeletions = v => Store.set(STORAGE_KEY_PENDING_DELETIONS, v);\n  const getSavedTableOrder = () => Store.get(STORAGE_KEY_TABLE_ORDER);\n  const saveTableOrder = v => Store.set(STORAGE_KEY_TABLE_ORDER, v);\n  const getCollapsedState = () => Store.get(STORAGE_KEY_IS_COLLAPSED, false);\n  const saveCollapsedState = v => Store.set(STORAGE_KEY_IS_COLLAPSED, v);\n  // []  (Chat ID)\n  const loadSnapshot = () => {\n    const data = Store.get(STORAGE_KEY_LAST_SNAPSHOT);\n    if (!data) return null;\n    // \n    const currentCtx = getCurrentContextFingerprint();\n    // \n    if (data._contextId && data._contextId !== currentCtx) {\n      return null;\n    }\n    return data;\n  };\n\n  // [] \n  const saveSnapshot = v => {\n    if (!v) return;\n    //  ChatID\n    if (typeof v === 'object') {\n      v._contextId = getCurrentContextFingerprint();\n    }\n    Store.set(STORAGE_KEY_LAST_SNAPSHOT, v);\n  };\n\n  // --- []  ---\n  const getTableHeights = () => Store.get(STORAGE_KEY_TABLE_HEIGHTS, {});\n  const saveTableHeights = v => Store.set(STORAGE_KEY_TABLE_HEIGHTS, v);\n  const getTableStyles = () => Store.get(STORAGE_KEY_TABLE_STYLES, {});\n  const saveTableStyles = v => Store.set(STORAGE_KEY_TABLE_STYLES, v);\n  const getHiddenTables = () => Store.get(STORAGE_KEY_HIDDEN_TABLES, []);\n  const saveHiddenTables = v => Store.set(STORAGE_KEY_HIDDEN_TABLES, v);\n  const getReverseTables = () => Store.get(STORAGE_KEY_REVERSE_TABLES, []);\n  const saveReverseTables = v => Store.set(STORAGE_KEY_REVERSE_TABLES, v);\n\n  // \n  const shouldShowReverseButton = tableName => {\n    if (!tableName) return false;\n    const keywords = ['', '', '', '', ''];\n    return keywords.some(kw => tableName.includes(kw));\n  };\n\n  // \n  const isTableReversed = tableName => {\n    return getReverseTables().includes(tableName);\n  };\n\n  // \n  const toggleTableReverse = tableName => {\n    const list = getReverseTables();\n    const idx = list.indexOf(tableName);\n    if (idx >= 0) {\n      list.splice(idx, 1);\n    } else {\n      list.push(tableName);\n    }\n    saveReverseTables(list);\n    console.log('[ACU] toggleTableReverse:', tableName, 'reversed:', idx < 0);\n  };\n  // [] \n  const getAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          let attrs = [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.includes(attr.name)) attrs.push(attr.name);\n              });\n            }\n          });\n          if (attrs.length > 0) return attrs;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            let attrs = [];\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.includes(attr.name)) attrs.push(attr.name);\n                });\n              }\n            });\n            return attrs;\n          }\n        }\n      }\n    }\n\n    return [];\n  };\n  // [] \n  const getAttributeValue = (characterName, attrName) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData || !attrName) return null;\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          for (let idx = 0; idx < headers.length; idx++) {\n            const h = headers[idx];\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              const found = parsed.find(attr => attr.name === attrName);\n              if (found) return found.value;\n            }\n          }\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            for (let idx = 0; idx < headers.length; idx++) {\n              const h = headers[idx];\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                const found = parsed.find(attr => attr.name === attrName);\n                if (found) return found.value;\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return null;\n  };\n  // [] 6\n  const STANDARD_ATTRS = ['', '', '', '', '', ''];\n\n  /**\n   * \n   */\n  const getStandardAttrs = () => {\n    const preset = AttributePresetManager.getActivePreset();\n    if (preset && preset.baseAttributes) {\n      return preset.baseAttributes.map(attr => attr.name);\n    }\n    return STANDARD_ATTRS;\n  };\n\n  /**\n   * \n   * \n   *  + \n   */\n  const getRandomSkillPool = () => {\n    try {\n      const preset = AttributePresetManager.getActivePreset();\n      if (preset) {\n        //  + \n        const allAttrs = new Set();\n\n        // \n        if (preset.baseAttributes && Array.isArray(preset.baseAttributes)) {\n          preset.baseAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        // \n        if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n          preset.specialAttributes.forEach(attr => {\n            const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n            if (attrName) {\n              allAttrs.add(attrName);\n            }\n          });\n        }\n\n        return Array.from(allAttrs);\n      }\n\n      // \n      const allPresets = AttributePresetManager.getAllPresets() || [];\n      const allAttrs = new Set(RANDOM_SKILL_POOL || []); // \n\n      // \n      if (Array.isArray(allPresets)) {\n        allPresets.forEach(p => {\n          if (!p) return;\n\n          // \n          if (p.baseAttributes && Array.isArray(p.baseAttributes)) {\n            p.baseAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n\n          // \n          if (p.specialAttributes && Array.isArray(p.specialAttributes)) {\n            p.specialAttributes.forEach(attr => {\n              const attrName = typeof attr === 'string' ? attr : attr && attr.name;\n              if (attrName) {\n                allAttrs.add(attrName);\n              }\n            });\n          }\n        });\n      }\n\n      return Array.from(allAttrs);\n    } catch (err) {\n      console.error('[ACU] getRandomSkillPool :', err);\n      return RANDOM_SKILL_POOL || [];\n    }\n  };\n\n  // [] \n  const RANDOM_SKILL_POOL = [\n    // ---  (Physical & Movement) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Social & Psychological) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    // /\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Technical & Crafting) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Knowledge & Investigation) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n\n    // ---  (Combat & Special) ---\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  // []  COC/DND 6\n  /**\n   * \n   * @param isDNDOrPreset ()    null()\n   * @returns { base: {...}, special: {...} }  {...}\n   */\n  const generateRPGAttributes = (isDNDOrPreset = undefined) => {\n    // \n    if (typeof isDNDOrPreset === 'boolean') {\n      const isDND = isDNDOrPreset;\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n\n      const generateValue = () => {\n        if (isDND) {\n          const base = generate3d6();\n          const adjust = rollDice(4) - 2;\n          return Math.max(3, Math.min(18, base + adjust));\n        } else {\n          const base = generate3d6() * 5;\n          const adjust = rollDice(10) - 5;\n          return Math.max(5, Math.min(95, base + adjust));\n        }\n      };\n\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        result[attr] = generateValue();\n      });\n      return result; // \n    }\n\n    // \n    const preset = isDNDOrPreset || AttributePresetManager.getActivePreset();\n\n    // \n    if (!preset) {\n      const rollDice = sides => Math.floor(Math.random() * sides) + 1;\n      const generate3d6 = () => rollDice(6) + rollDice(6) + rollDice(6);\n      const result = {};\n      STANDARD_ATTRS.forEach(attr => {\n        const base = generate3d6() * 5;\n        const adjust = rollDice(10) - 5;\n        result[attr] = Math.max(5, Math.min(95, base + adjust));\n      });\n      return { base: result, special: {} };\n    }\n\n    // \n    const baseResult = {};\n    preset.baseAttributes.forEach(attr => {\n      const formula = attr.modifier ? `${attr.formula}+${attr.modifier}` : attr.formula;\n      baseResult[attr.name] = generateAttributeValue(formula, attr.range, {});\n    });\n\n    // \n    const specialResult = {};\n    if (preset.specialAttributes && Array.isArray(preset.specialAttributes)) {\n      preset.specialAttributes.forEach(attr => {\n        specialResult[attr.name] = generateAttributeValue(attr.formula, attr.range, baseResult);\n      });\n    }\n\n    return { base: baseResult, special: specialResult };\n  };\n\n  // [] \n  const clearPresetAttributesForCharacter = async charName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[ACU] clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // NPC//\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[ACU] clearPresetAttributesForCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[ACU] clearPresetAttributesForCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    const customAttrs = existingAttrs.filter(attr => !presetAttrNames.has(attr.name));\n    const newAttrString = customAttrs.map(attr => `${attr.name}:${attr.value}`).join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    return {\n      success: true,\n      attrString: newAttrString,\n    };\n  };\n\n  // [] \n  const writeAttributesToCharacter = async (charName, newAttrs, isDND = false) => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) {\n      console.error('[ACU] writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('');\n      return { success: false };\n    }\n\n    const isUser = !charName || charName === '<user>' || charName.trim() === '';\n    let targetSheet = null;\n    let targetRowIndex = -1;\n    let targetColIndex = -1;\n    let sheetKey = null;\n\n    // \n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n      const headers = sheet.content[0] || [];\n\n      // \n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          targetSheet = sheet;\n          targetRowIndex = 1;\n          sheetKey = key;\n\n          // \"\"\n          for (let h = 0; h < headers.length; h++) {\n            if (headers[h] && headers[h].includes('')) {\n              targetColIndex = h;\n              break;\n            }\n          }\n          if (targetColIndex < 0) {\n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n          }\n          break;\n        }\n      }\n\n      // \n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        // \n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === charName) {\n            targetSheet = sheet;\n            targetRowIndex = i;\n            sheetKey = key;\n\n            // \n            for (let h = 0; h < headers.length; h++) {\n              if (headers[h] && headers[h].includes('')) {\n                targetColIndex = h;\n                break;\n              }\n            }\n            if (targetColIndex < 0) {\n              for (let h = 0; h < headers.length; h++) {\n                if (headers[h] && headers[h].includes('')) {\n                  targetColIndex = h;\n                  break;\n                }\n              }\n            }\n            break;\n          }\n        }\n        if (targetRowIndex > 0) break;\n      }\n    }\n\n    // \n    if (!targetSheet || targetRowIndex < 0) {\n      console.error('[ACU] writeAttributesToCharacter: ', charName);\n      if (window.toastr) window.toastr.error(`${charName || '<user>'}`);\n      return { success: false };\n    }\n\n    if (targetColIndex < 0) {\n      console.error('[ACU] writeAttributesToCharacter: ');\n      if (window.toastr) window.toastr.error('\"\"');\n      return { success: false };\n    }\n\n    // \n    const existingStr = targetSheet.content[targetRowIndex][targetColIndex] || '';\n    const existingAttrs = parseAttributeString(existingStr);\n\n    // \n    const existingMap = {};\n    existingAttrs.forEach(attr => {\n      existingMap[attr.name] = attr.value;\n    });\n\n    // +\n    const standardAttrs = getStandardAttrs();\n    const preset = AttributePresetManager.getActivePreset();\n    const presetAttrNames = new Set(standardAttrs);\n    if (preset && preset.specialAttributes) {\n      preset.specialAttributes.forEach(attr => presetAttrNames.add(attr.name));\n    }\n\n    // \n    let standardCount = 0;\n    standardAttrs.forEach(attrName => {\n      if (existingMap[attrName] !== undefined) {\n        standardCount++;\n      }\n    });\n    const isComplete = standardCount === standardAttrs.length;\n\n    // \n    const customAttrs = [];\n    existingAttrs.forEach(attr => {\n      if (!presetAttrNames.has(attr.name)) {\n        customAttrs.push({ name: attr.name, value: attr.value });\n      }\n    });\n\n    // \n    const resultParts = [];\n\n    // 1. \n    standardAttrs.forEach(attrName => {\n      if (isComplete) {\n        //   \n        const newValue = newAttrs[attrName] !== undefined ? newAttrs[attrName] : existingMap[attrName];\n        if (newValue !== undefined) {\n          resultParts.push(`${attrName}:${newValue}`);\n        }\n      } else {\n        //   \n        if (existingMap[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        } else if (newAttrs[attrName] !== undefined) {\n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        }\n      }\n    });\n\n    // 2. \n    Object.keys(newAttrs).forEach(attrName => {\n      if (!standardAttrs.includes(attrName)) {\n        // \n        if (isComplete || !existingMap[attrName]) {\n          // \n          resultParts.push(`${attrName}:${newAttrs[attrName]}`);\n        } else {\n          // \n          resultParts.push(`${attrName}:${existingMap[attrName]}`);\n        }\n      }\n    });\n\n    // 3. \n    customAttrs.forEach(attr => {\n      resultParts.push(`${attr.name}:${attr.value}`);\n    });\n\n    const newAttrString = resultParts.join(';');\n\n    // \n    targetSheet.content[targetRowIndex][targetColIndex] = newAttrString;\n    cachedRawData = rawData;\n\n    // \n    await saveDataOnly(rawData);\n\n    // UI\n    const writtenAttrs = [];\n    standardAttrs.forEach(attrName => {\n      writtenAttrs.push({ name: attrName, value: newAttrs[attrName] });\n    });\n\n    return {\n      success: true,\n      attrs: writtenAttrs,\n      attrString: newAttrString,\n      wasComplete: isComplete,\n    };\n  };\n  // [] \"\"\n  const getFullAttributesForCharacter = characterName => {\n    const rawData = cachedRawData || getTableData();\n    if (!rawData) return [];\n\n    const isUser = !characterName || characterName === '<user>' || characterName.trim() === '';\n    let attrs = [];\n\n    for (const key in rawData) {\n      const sheet = rawData[key];\n      if (!sheet || !sheet.name || !sheet.content) continue;\n      const sheetName = sheet.name;\n\n      //  -> <user> ()\n      if (\n        isUser &&\n        (sheetName.includes('') || sheetName.includes('') || sheetName.toLowerCase().includes('player'))\n      ) {\n        if (sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!attrs.some(a => a.name === attr.name)) {\n                  attrs.push(attr);\n                }\n              });\n            }\n          });\n          if (attrs.length > 0) break;\n        }\n      }\n\n      //  ->  ()\n      if (\n        !isUser &&\n        (sheetName.includes('') ||\n          sheetName.includes('NPC') ||\n          sheetName.includes('') ||\n          sheetName.toLowerCase().includes('character'))\n      ) {\n        const headers = sheet.content[0] || [];\n        // \n        let nameColIdx = 1;\n        for (let h = 0; h < headers.length; h++) {\n          if (\n            headers[h] &&\n            (headers[h].includes('') || headers[h].includes('') || headers[h].toLowerCase().includes('name'))\n          ) {\n            nameColIdx = h;\n            break;\n          }\n        }\n\n        for (let i = 1; i < sheet.content.length; i++) {\n          const row = sheet.content[i];\n          if (row && row[nameColIdx] === characterName) {\n            headers.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!attrs.some(a => a.name === attr.name)) {\n                    attrs.push(attr);\n                  }\n                });\n              }\n            });\n            break;\n          }\n        }\n        if (attrs.length > 0) break;\n      }\n    }\n\n    return attrs;\n  };\n  // [] \n  const initCustomDropdown = ($input, options, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    const inputId = $input.attr('id') || 'dd_' + Math.random().toString(36).substr(2, 9);\n    $input.attr('id', inputId);\n\n    // \n    $input.parent().find('.acu-dropdown-list').remove();\n\n    //  wrapper\n    if (!$input.parent().hasClass('acu-dropdown-wrapper')) {\n      $input.wrap('<div class=\"acu-dropdown-wrapper\"></div>');\n    }\n\n    // \n    const $dropdown = $(`<div class=\"acu-dropdown-list\" data-for=\"${inputId}\"></div>`);\n    $dropdown.css({\n      background: t.bgPanel || '#fff',\n      'border-color': t.border || '#ccc',\n    });\n    $input.after($dropdown);\n\n    const renderItems = (filter = '') => {\n      const lowerFilter = filter.toLowerCase();\n      const filtered = options.filter(opt => opt.toLowerCase().includes(lowerFilter));\n\n      if (filtered.length === 0) {\n        $dropdown.html(`<div class=\"acu-dropdown-empty\" style=\"color:${t.textSub || '#999'};\"></div>`);\n      } else {\n        $dropdown.html(\n          filtered\n            .map(\n              opt =>\n                `<div class=\"acu-dropdown-item\" data-value=\"${escapeHtml(opt)}\" style=\"color:${t.textMain || '#333'};\">${escapeHtml(opt)}</div>`,\n            )\n            .join(''),\n        );\n      }\n    };\n\n    const showDropdown = () => {\n      $('.acu-dropdown-list').removeClass('visible');\n      renderItems($input.val());\n      $dropdown.addClass('visible');\n    };\n\n    const hideDropdown = () => {\n      $dropdown.removeClass('visible');\n    };\n\n    // \n    $input.off('.acudd').on('focus.acudd click.acudd', function (e) {\n      e.stopPropagation();\n      showDropdown();\n    });\n\n    // \n    $input.on('input.acudd', function () {\n      renderItems($(this).val());\n    });\n\n    // hover \n    $dropdown\n      .on('mouseenter', '.acu-dropdown-item', function () {\n        $(this).css('background', t.tableHead || 'rgba(128,128,128,0.15)');\n      })\n      .on('mouseleave', '.acu-dropdown-item', function () {\n        $(this).css('background', 'transparent');\n      });\n\n    // \n    $dropdown.on('click', '.acu-dropdown-item', function (e) {\n      e.stopPropagation();\n      e.preventDefault();\n      const val = $(this).data('value');\n      $input.val(val).trigger('change');\n      hideDropdown();\n    });\n\n    // \n    $dropdown.on('click', function (e) {\n      e.stopPropagation();\n    });\n\n    // \n    $input\n      .closest('.acu-dice-panel, .acu-contest-panel')\n      .off('click.acudd_' + inputId)\n      .on('click.acudd_' + inputId, function (e) {\n        if (!$(e.target).closest('.acu-dropdown-wrapper').length) {\n          hideDropdown();\n        }\n      });\n  };\n  // [] \n  const addClearButton = ($panel, inputSelector, themeColors) => {\n    const { $ } = getCore();\n    const t = themeColors || {};\n    $panel.find(inputSelector).each(function () {\n      const $input = $(this);\n      // \n      if ($input.parent().hasClass('acu-input-wrapper')) return;\n      // \n      $input.wrap('<div class=\"acu-input-wrapper\"></div>');\n      //  - \n      const $clearBtn = $(\n        `<button type=\"button\" class=\"acu-clear-btn\" title=\"\" style=\"color:${t.textSub || '#999'};\"><i class=\"fa-solid fa-times\"></i></button>`,\n      );\n      $input.after($clearBtn);\n      // \n      $clearBtn.on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $input.val('').trigger('input').trigger('change').focus();\n      });\n      //  - \n      $clearBtn\n        .on('mouseenter', function () {\n          $(this).css({ color: t.accent || '#7a695f', opacity: '1' });\n        })\n        .on('mouseleave', function () {\n          $(this).css({ color: t.textSub || '#999', opacity: '0.5' });\n        });\n    });\n  };\n  // [] \n  const showDiceSettingsPanel = (isDND = false) => {\n    const { $ } = getCore();\n    $('.acu-dice-config-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    const ruleTitle = isDND ? 'DND ' : 'COC ';\n    const resetText = isDND ? ' DND ' : ' COC ';\n\n    // \n    const defaults = isDND\n      ? { critSuccess: 20, critFail: 1 }\n      : { critSuccess: 5, critFail: 96, hardDiv: 2, extremeDiv: 5 };\n\n    //  placeholder\n    const currentCritSuccess = isDND\n      ? diceCfg.dndCritSuccess !== undefined && diceCfg.dndCritSuccess !== defaults.critSuccess\n        ? diceCfg.dndCritSuccess\n        : ''\n      : diceCfg.critSuccessMax !== undefined && diceCfg.critSuccessMax !== defaults.critSuccess\n        ? diceCfg.critSuccessMax\n        : '';\n    const currentCritFail = isDND\n      ? diceCfg.dndCritFail !== undefined && diceCfg.dndCritFail !== defaults.critFail\n        ? diceCfg.dndCritFail\n        : ''\n      : diceCfg.critFailMin !== undefined && diceCfg.critFailMin !== defaults.critFail\n        ? diceCfg.critFailMin\n        : '';\n    const currentHardDiv =\n      !isDND && diceCfg.difficultSuccessDiv !== undefined && diceCfg.difficultSuccessDiv !== defaults.hardDiv\n        ? diceCfg.difficultSuccessDiv\n        : '';\n    const currentExtremeDiv =\n      !isDND && diceCfg.hardSuccessDiv !== undefined && diceCfg.hardSuccessDiv !== defaults.extremeDiv\n        ? diceCfg.hardSuccessDiv\n        : '';\n\n    const tieRule = diceCfg.contestTieRule || 'initiator_lose';\n\n    const cocExtraHtml = isDND\n      ? ''\n      : `\n            <div class=\"acu-dice-cfg-row\">\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <input type=\"number\" id=\"cfg-hard-div\" value=\"${currentHardDiv}\" placeholder=\"${defaults.hardDiv}\" min=\"2\" max=\"5\">\n                </div>\n                <div class=\"acu-dice-cfg-item\">\n                    <label> ()</label>\n                    <input type=\"number\" id=\"cfg-extreme-div\" value=\"${currentExtremeDiv}\" placeholder=\"${defaults.extremeDiv}\" min=\"3\" max=\"10\">\n                </div>\n            </div>\n        `;\n\n    const panelHtml = `\n            <div class=\"acu-dice-config-overlay\">\n                <div class=\"acu-dice-config-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-dice-cfg-header\">\n                        <span><i class=\"fa-solid fa-cog\"></i> ${ruleTitle}</span>\n                        <button class=\"acu-config-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-dice-cfg-body\">\n                        <div class=\"acu-dice-cfg-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <input type=\"number\" id=\"cfg-crit-success\" value=\"${currentCritSuccess}\" placeholder=\"${defaults.critSuccess}\" min=\"1\" max=\"100\">\n                            </div>\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <input type=\"number\" id=\"cfg-crit-fail\" value=\"${currentCritFail}\" placeholder=\"${defaults.critFail}\" min=\"1\" max=\"100\">\n                            </div>\n                        </div>\n                        ${cocExtraHtml}\n                        <div class=\"acu-dice-cfg-row acu-cfg-full-row\">\n                            <div class=\"acu-dice-cfg-item\">\n                                <label></label>\n                                <select id=\"cfg-tie-rule\">\n                                    <option value=\"initiator_lose\" ${tieRule === 'initiator_lose' ? 'selected' : ''}> ()</option>\n                                    <option value=\"tie\" ${tieRule === 'tie' ? 'selected' : ''}></option>\n                                    <option value=\"initiator_win\" ${tieRule === 'initiator_win' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class=\"acu-dice-cfg-actions\">\n                            <button id=\"cfg-reset-dice\">${resetText}</button>\n                            <button id=\"cfg-save-dice\" class=\"primary\"><i class=\"fa-solid fa-check\"></i> </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $panel = $(panelHtml);\n    $('body').append($panel);\n\n    $panel.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      background: 'rgba(0,0,0,0.6)',\n      'z-index': '2147483655',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      padding: '20px',\n      'box-sizing': 'border-box',\n    });\n\n    const closePanel = () => $panel.remove();\n    $panel.find('.acu-config-close').click(closePanel);\n    $panel.on('click', e => {\n      if ($(e.target).hasClass('acu-dice-config-overlay')) closePanel();\n    });\n\n    $panel.find('#cfg-save-dice').click(function () {\n      const newCfg = { contestTieRule: $('#cfg-tie-rule').val() };\n\n      // \n      const critSuccessVal = $('#cfg-crit-success').val().trim();\n      const critFailVal = $('#cfg-crit-fail').val().trim();\n\n      if (isDND) {\n        newCfg.dndCritSuccess = critSuccessVal !== '' ? parseInt(critSuccessVal, 10) : defaults.critSuccess;\n        newCfg.dndCritFail = critFailVal !== '' ? parseInt(critFailVal, 10) : defaults.critFail;\n      } else {\n        newCfg.critSuccessMax = critSuccessVal !== '' ? parseInt(critSuccessVal, 10) : defaults.critSuccess;\n        newCfg.critFailMin = critFailVal !== '' ? parseInt(critFailVal, 10) : defaults.critFail;\n\n        const hardDivVal = $('#cfg-hard-div').val().trim();\n        const extremeDivVal = $('#cfg-extreme-div').val().trim();\n        newCfg.difficultSuccessDiv = hardDivVal !== '' ? parseInt(hardDivVal, 10) : defaults.hardDiv;\n        newCfg.hardSuccessDiv = extremeDivVal !== '' ? parseInt(extremeDivVal, 10) : defaults.extremeDiv;\n      }\n\n      saveDiceConfig(newCfg);\n      closePanel();\n    });\n\n    $panel.find('#cfg-reset-dice').click(function () {\n      //  placeholder \n      $panel.find('#cfg-crit-success').val('');\n      $panel.find('#cfg-crit-fail').val('');\n      if (!isDND) {\n        $panel.find('#cfg-hard-div').val('');\n        $panel.find('#cfg-extreme-div').val('');\n      }\n    });\n  };\n  // [] \n  const showDicePanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n    // 1d100\n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    // 1d100\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n    // [] \n    const rawDataForList = cachedRawData || getTableData();\n    let diceCharacterList = ['<user>'];\n    let diceAttrList = [];\n\n    if (rawDataForList) {\n      for (const key in rawDataForList) {\n        const sheet = rawDataForList[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '') {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) diceCharacterList.push(row[1]);\n          }\n        }\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const row = sheet.content[1];\n          const headers = sheet.content[0] || [];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!diceAttrList.includes(attr.name)) diceAttrList.push(attr.name);\n              });\n            }\n          });\n        }\n      }\n    }\n    const {\n      targetValue = null, // []  null\n      targetName = '',\n      diceType = savedDiceType, // \n      successCriteria = 'lte', // [] COC\n      onResult = null,\n      initiatorName = '', // [] \n    } = options;\n\n    const t = getThemeColors();\n\n    const overlay = $(\n      `<div class=\"acu-dice-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;\"></div>`,\n    );\n\n    // []  COC  DND\n    const successCriteriaOptions = [\n      { id: 'lte', name: ' (COC)' },\n      { id: 'gte', name: ' (DND)' },\n    ];\n\n    // [] \n    let defaultCriteria = successCriteria;\n    if (diceType === '1d100') defaultCriteria = 'lte';\n    else if (diceType === '1d20') defaultCriteria = 'gte';\n\n    const panel = $(`\n            <div class=\"acu-dice-panel acu-theme-${config.theme}\" style=\"\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 340px;\n                max-width: 90vw;\n                background: ${t.bgPanel};\n                border: 1px solid ${t.border};\n                border-radius: 12px;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.4);\n                z-index: 2147483648;\n                overflow: hidden;\n                font-family: 'Microsoft YaHei', sans-serif;\n            \">\n                <div style=\"padding: 12px 15px; background: ${t.tableHead}; border-bottom: 1px solid ${t.border}; display: flex; justify-content: space-between; align-items: center;\">\n                    <div style=\"font-size: 15px; font-weight: bold; color: ${t.accent}; display: flex; align-items: center; gap: 8px;\">\n                        <i class=\"fa-solid fa-dice-d20\"></i> \n                    </div>\n                    <div style=\"display: flex; align-items: center; gap: 8px;\">\n                        <button id=\"dice-switch-contest-top\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\"><i class=\"fa-solid fa-people-arrows\"></i></button>\n                        <button class=\"acu-dice-config-btn\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 14px; padding: 4px; transition: all 0.2s;\" title=\"\">\n                            <i class=\"fa-solid fa-cog\"></i>\n                        </button>\n                        <button class=\"acu-dice-close\" style=\"background: none; border: none; color: ${t.textSub}; cursor: pointer; font-size: 16px; padding: 4px;\">\n                            <i class=\"fa-solid fa-times\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div style=\"padding: 15px; max-height: 70vh; overflow-y: auto;\">\n                    <div style=\"display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 12px; align-items: center;\" class=\"acu-dice-presets\">\n                        <button class=\"acu-dice-preset ${diceType === '1d20' ? 'active' : ''}\" data-dice=\"1d20\" data-criteria=\"gte\" style=\"padding: 4px 10px; background: ${diceType === '1d20' ? t.accent : t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d20' ? '#fff' : t.textMain}; font-size: 11px; cursor: pointer;\">1d20</button>\n                        <button class=\"acu-dice-preset ${diceType === '1d100' ? 'active' : ''}\" data-dice=\"1d100\" data-criteria=\"lte\" style=\"padding: 4px 10px; background: ${diceType === '1d100' ? t.accent : t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${diceType === '1d100' ? '#fff' : t.textMain}; font-size: 11px; cursor: pointer;\">1d100</button>\n                        <button class=\"acu-dice-preset acu-dice-custom-btn\" data-dice=\"custom\" style=\"padding: 4px 10px; background: ${!['1d20', '1d100'].includes(diceType) ? t.accent : t.btnBg}; border: 1px solid ${t.border}; border-radius: 4px; color: ${!['1d20', '1d100'].includes(diceType) ? '#fff' : t.textMain}; font-size: 11px; cursor: pointer;\"></button>\n                        <input type=\"text\" id=\"dice-custom-input\" placeholder=\"2d6\" value=\"${!['1d20', '1d100'].includes(diceType) ? diceType : ''}\" style=\"width:60px;\">\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 11px; color: ${t.accent}; font-weight: bold; margin-bottom: 4px; display: flex; align-items: center; gap: 6px;\"><i class=\"fa-solid fa-user\"></i> </div>\n                        <div id=\"dice-char-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 60px; overflow-y: auto;\"></div>\n                    </div>\n\n                    <!-- 1 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px;\"></div>\n                            <input type=\"text\" id=\"dice-initiator-name\" value=\"${escapeHtml(initiatorName)}\" placeholder=\"<user>\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px; display: flex; align-items: center; gap: 6px;\">\n                                \n                                <button type=\"button\" class=\"acu-random-skill-btn\" id=\"dice-random-skill\" title=\"\" style=\"width: 20px; height: 20px; padding: 0; background: transparent; border: 1px dashed ${t.accent}; border-radius: 4px; color: ${t.accent}; font-size: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center;\">\n                                    <i class=\"fa-solid fa-dice\"></i>\n                                </button>\n                            </div>\n                            <input type=\"text\" id=\"dice-attr-name\" value=\"${escapeHtml(targetName || '')}\" placeholder=\"\">\n                        </div>\n                    </div>\n\n                    <!-- 2 +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px;\"></div>\n                            <input type=\"number\" id=\"dice-attr-value\" value=\"\" placeholder=\"=50%\">\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px;\" id=\"dice-target-label\"></div>\n                            <input type=\"text\" id=\"dice-target\" value=\"${targetValue !== null ? targetValue : ''}\" placeholder=\"=\" class=\"acu-dice-input\">\n                        </div>\n                    </div>\n\n                    <!-- 3 +  +  -->\n                    <div style=\"display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 8px;\" id=\"dice-row-3\">\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px;\"></div>\n                            <select id=\"dice-success-criteria\" class=\"acu-dice-select\">\n                                ${successCriteriaOptions\n                                  .map(\n                                    opt =>\n                                      `<option value=\"${opt.id}\" ${opt.id === defaultCriteria ? 'selected' : ''}>${opt.name}</option>`,\n                                  )\n                                  .join('')}\n                            </select>\n                        </div>\n                        <div id=\"dice-difficulty-wrapper\">\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px;\"></div>\n                            <select id=\"dice-difficulty\" class=\"acu-dice-select\">\n                                <option value=\"normal\" selected></option>\n                                <option value=\"hard\"></option>\n                                <option value=\"extreme\"></option>\n                                <option value=\"critical\"></option>\n                            </select>\n                        </div>\n                        <div>\n                            <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 2px;\"></div>\n                            <input type=\"number\" id=\"dice-modifier\" value=\"0\" style=\"text-align: center;\">\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div style=\"margin-bottom: 10px;\">\n                        <div style=\"font-size: 10px; color: ${t.textSub}; margin-bottom: 4px;\"><i class=\"fa-solid fa-sliders\"></i> </div>\n                        <div id=\"dice-attr-buttons\" style=\"display: flex; flex-wrap: wrap; gap: 4px; max-height: 80px; overflow-y: auto;\"></div>\n                    </div>\n                    <!--  -->\n                    <input type=\"hidden\" id=\"dice-formula\" value=\"${diceType}\">\n\n                    <button id=\"dice-roll-btn\" style=\"width: 100%; padding: 12px; background: ${t.accent}; border: none; border-radius: 8px; color: #fff; font-size: 15px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;\">\n                        <i class=\"fa-solid fa-dice\"></i> \n                    </button>\n                    <div id=\"dice-result-area\"></div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay).append(panel);\n\n    // [] \n    const buildCharButtons = () => {\n      const $container = panel.find('#dice-char-buttons');\n      let html = '';\n      diceCharacterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html += `<button class=\"acu-dice-char-btn\" data-char=\"${escapeHtml(name)}\" style=\"padding:3px 8px;background:${t.btnBg};border:1px solid ${t.border};border-radius:4px;color:${t.textMain};font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"${escapeHtml(displayName)}\">${escapeHtml(shortName)}</button>`;\n      });\n      $container.html(html || `<div style=\"font-size:11px;color:${t.textSub};\"></div>`);\n      // \n      $container.find('.acu-dice-char-btn').click(function () {\n        const charName = $(this).data('char');\n        panel.find('#dice-initiator-name').val(charName).trigger('change');\n      });\n    };\n\n    // [] \n    const buildAttrButtons = charName => {\n      const $container = panel.find('#dice-attr-buttons');\n      const attrs = getFullAttributesForCharacter(charName);\n\n      let html = '';\n\n      // \n      if (attrs.length > 0) {\n        attrs.forEach(attr => {\n          html += `<button class=\"acu-dice-attr-btn\" data-name=\"${escapeHtml(attr.name)}\" data-value=\"${attr.value}\" style=\"padding:3px 8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:4px;color:${t.inputText};font-size:11px;cursor:pointer;\">${escapeHtml(attr.name)}:${attr.value}</button>`;\n        });\n      }\n\n      // \n      html += `<button class=\"acu-dice-gen-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed ${t.accent};border-radius:4px;color:${t.accent};font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;\" title=\"\"><i class=\"fa-solid fa-dice\"></i></button>`;\n\n      // \n      html += `<button class=\"acu-dice-clear-attr-btn\" style=\"padding:3px 8px;background:transparent;border:1px dashed #e74c3c;border-radius:4px;color:#e74c3c;font-size:11px;cursor:pointer;display:inline-flex;align-items:center;gap:4px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\"></i></button>`;\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-dice-attr-btn').click(function () {\n        const attrName = $(this).data('name');\n        const attrValue = $(this).data('value');\n        panel.find('#dice-attr-name').val(attrName);\n        panel.find('#dice-attr-value').val(attrValue);\n\n        // \n        const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n        const isDND = criteria === 'gte';\n        const numValue = parseInt(attrValue, 10) || 0;\n\n        if (isDND) {\n          // DND = 20 - \n          const targetValue = Math.max(1, 20 - numValue);\n          panel.find('#dice-target').val(targetValue);\n        } else {\n          // COC = \n          panel.find('#dice-target').val(attrValue);\n        }\n\n        // changeUI\n        panel.find('#dice-attr-value').trigger('change');\n      });\n\n      // \n      $container.find('.acu-dice-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[ACU] ');\n        };\n\n        try {\n          const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n          console.log('[ACU]  for:', charName);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[ACU] :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-dice-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[ACU] ');\n        };\n\n        try {\n          console.log('[ACU]  for:', charName);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            buildAttrButtons(charName);\n          }\n        } catch (err) {\n          console.error('[ACU] :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharButtons();\n    // <user>\n    buildAttrButtons('<user>');\n    // [] \n    panel.find('#dice-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      const randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#dice-attr-name').val(randomSkill).trigger('change');\n    });\n\n    // \n    initCustomDropdown(panel.find('#dice-initiator-name'), diceCharacterList, t);\n    initCustomDropdown(panel.find('#dice-attr-name'), diceAttrList, t);\n    // [] \n    addClearButton(panel, '#dice-initiator-name, #dice-attr-name, #dice-attr-value, #dice-target', t);\n\n    // [] \n    panel.find('#dice-initiator-name').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#dice-attr-name'), newAttrList.length > 0 ? newAttrList : diceAttrList, t);\n\n      // [] \n      buildAttrButtons(charName);\n    });\n\n    // [] \n    panel.find('#dice-attr-name').on('change.acuval', function () {\n      const charName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#dice-attr-value').val(attrValue);\n        panel.find('#dice-target').val(attrValue);\n      }\n    });\n\n    // [] \n    const convertTargetForDice = (currentTarget, fromDice, toDice) => {\n      if (!currentTarget || currentTarget === '') return '';\n      const val = parseInt(currentTarget, 10);\n      if (isNaN(val)) return currentTarget;\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n\n      const fromMax = getMaxRoll(fromDice);\n      const toMax = getMaxRoll(toDice);\n\n      // \n      const ratio = val / fromMax;\n      const newVal = Math.round(ratio * toMax);\n      return Math.max(1, Math.min(newVal, toMax));\n    };\n\n    // []  UICOC/DND \n    const updateRuleMode = () => {\n      const criteria = panel.find('#dice-success-criteria').val();\n      const isDND = criteria === 'gte';\n      const $targetInput = panel.find('#dice-target');\n      const $difficultyWrapper = panel.find('#dice-difficulty-wrapper');\n      const $row3 = panel.find('#dice-row-3');\n\n      if (isDND) {\n        // DND \n        $targetInput.attr('placeholder', '=20-');\n        panel.find('#dice-target-label').text('DC');\n        $difficultyWrapper.hide();\n        $row3.css('grid-template-columns', '1fr 1fr');\n      } else {\n        // COC \n        $targetInput.attr('placeholder', '=');\n        panel.find('#dice-target-label').text('');\n        $difficultyWrapper.show();\n        $row3.css('grid-template-columns', '1fr 1fr 1fr');\n      }\n    };\n\n    panel.find('#dice-success-criteria').on('change', updateRuleMode);\n\n    // \n    updateRuleMode();\n\n    // \n    let currentDiceType = diceType;\n\n    //  - [] \n    panel.find('.acu-dice-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-dice-preset').css({ background: t.btnBg, color: t.textMain });\n      $(this).css({ background: t.accent, color: '#fff' });\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n      const suggestedCriteria = $(this).data('criteria') || 'lte';\n\n      // [] \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, newDice);\n        $targetInput.val(convertedVal);\n      }\n\n      // \n      const getMaxRoll = dice => {\n        const match = dice.match(/(\\d+)d(\\d+)/i);\n        if (!match) return 100;\n        return parseInt(match[1], 10) * parseInt(match[2], 10);\n      };\n      const newMax = getMaxRoll(newDice);\n      panel.find('#dice-target-auto').text(`(: 1~${newMax})`);\n\n      currentDiceType = newDice;\n      panel.find('#dice-formula').val(newDice);\n\n      // [] \n      panel.find('#dice-success-criteria').val(suggestedCriteria).trigger('change');\n    });\n    // \n    panel.find('.acu-dice-custom-btn').click(function () {\n      // \n      panel.find('.acu-dice-preset').css({ background: t.btnBg, color: t.textMain });\n      $(this).css({ background: t.accent, color: '#fff' });\n\n      const customDice = panel.find('#dice-custom-input').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#dice-custom-input').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      // \n      const $targetInput = panel.find('#dice-target');\n      const currentTargetVal = $targetInput.val().trim();\n      if (currentTargetVal !== '') {\n        const convertedVal = convertTargetForDice(currentTargetVal, currentDiceType, customDice);\n        $targetInput.val(convertedVal);\n      }\n\n      panel.find('#dice-formula').val(customDice);\n      currentDiceType = customDice;\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n\n      panel.find('#dice-success-criteria').val('gte').trigger('change');\n    });\n\n    // \n    panel.find('#dice-custom-input').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-dice-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = formula => {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], formula };\n\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      const total = rolls.reduce((a, b) => a + b, 0) + modifier;\n\n      return { total, rolls, sides, count, modifier, formula };\n    };\n\n    // [] \n    const checkSuccess = (value, target, criteria) => {\n      switch (criteria) {\n        case 'lt':\n          return value < target; // \n        case 'lte':\n          return value <= target; //  (COC)\n        case 'eq':\n          return value === target; // \n        case 'gte':\n          return value >= target; //  (DND)\n        case 'gt':\n          return value > target; // \n        default:\n          return value <= target; // COC\n      }\n    };\n\n    // [] / - \n    const getCriticalBounds = (sides, criteria) => {\n      const isLowerBetter = ['lte', 'lt'].includes(criteria);\n      const diceCfg = getDiceConfig();\n\n      if (sides === 100) {\n        return isLowerBetter\n          ? { critSuccess: diceCfg.critSuccessMax, critFailure: diceCfg.critFailMin }\n          : { critSuccess: diceCfg.critFailMin, critFailure: diceCfg.critSuccessMax };\n      } else if (sides === 20) {\n        return isLowerBetter ? { critSuccess: 1, critFailure: 20 } : { critSuccess: 20, critFailure: 1 };\n      } else {\n        const maxVal = sides;\n        const minVal = 1;\n        return isLowerBetter\n          ? { critSuccess: minVal, critFailure: maxVal }\n          : { critSuccess: maxVal, critFailure: minVal };\n      }\n    };\n\n    // \n    panel.find('#dice-roll-btn').click(function () {\n      const formula = panel.find('#dice-formula').val().trim() || '1d100';\n      const mod = parseInt(panel.find('#dice-modifier').val(), 10) || 0;\n      const attrName = panel.find('#dice-attr-name').val().trim() || '';\n      const criteria = panel.find('#dice-success-criteria').val() || 'lte';\n      const difficulty = panel.find('#dice-difficulty').val() || 'normal';\n\n      // \n      const isDND = criteria === 'gte';\n\n      // \n      const diceCfg = getDiceConfig();\n      const hardDiv = diceCfg.difficultSuccessDiv || 2;\n      const extremeDiv = diceCfg.hardSuccessDiv || 5;\n      // COC:   critSuccessMax,   critFailMin\n      // DND:   dndCritSuccess,   dndCritFail\n      const critSuccessMax = isDND ? diceCfg.dndCritFail || 1 : diceCfg.critSuccessMax || 5;\n      const critFailMin = isDND ? diceCfg.dndCritSuccess || 20 : diceCfg.critFailMin || 96;\n\n      // COC  DND \n      let targetInputVal = panel.find('#dice-target').val().trim();\n      let attrInputVal = panel.find('#dice-attr-value').val().trim();\n      let attrValue = attrInputVal !== '' ? parseInt(attrInputVal, 10) : 0;\n      let target;\n      let isAutoTarget = false;\n\n      // \n      const getDefaultTarget = formulaStr => {\n        const match = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (match) {\n          const maxRoll = parseInt(match[1], 10) * parseInt(match[2], 10);\n          return Math.round(maxRoll / 2);\n        }\n        return 50;\n      };\n\n      if (targetInputVal !== '') {\n        // /DC\n        target = parseInt(targetInputVal, 10) || getDefaultTarget(formula);\n      } else if (isDND) {\n        // DND  DC = 20 - DC=10\n        if (attrValue > 0) {\n          target = Math.max(1, 20 - attrValue);\n          isAutoTarget = true;\n        } else {\n          target = 10; // \n          isAutoTarget = true;\n        }\n      } else {\n        // COC  = \n        if (attrValue > 0) {\n          target = attrValue;\n          isAutoTarget = true;\n        } else {\n          target = getDefaultTarget(formula);\n          isAutoTarget = true;\n        }\n      }\n\n      const result = rollDice(formula);\n      const finalValue = result.total + mod;\n\n      // \n      let requiredTarget = target;\n      let difficultyLabel = '';\n      let difficultyDiv = 1;\n\n      // DND \n      if (!isDND) {\n        switch (difficulty) {\n          case 'hard':\n            requiredTarget = Math.floor(target / hardDiv);\n            difficultyLabel = '';\n            difficultyDiv = hardDiv;\n            break;\n          case 'extreme':\n            requiredTarget = Math.floor(target / extremeDiv);\n            difficultyLabel = '';\n            difficultyDiv = extremeDiv;\n            break;\n          case 'critical':\n            requiredTarget = critSuccessMax;\n            difficultyLabel = '';\n            break;\n          default:\n            difficultyLabel = '';\n            break;\n        }\n      }\n\n      // \n      let isCritSuccess = false;\n      let isCritFailure = false;\n      let isSuccess = false;\n      let outcomeText = '';\n      let outcomeClass = '';\n\n      // /\n      if (isDND) {\n        // DND:   20  1\n        isCritSuccess = finalValue >= critFailMin; //  critFailMin  DND \n        isCritFailure = finalValue <= critSuccessMax; //  critSuccessMax  DND \n      } else {\n        // COC:   5  96\n        isCritSuccess = finalValue <= critSuccessMax;\n        isCritFailure = finalValue >= critFailMin;\n      }\n\n      // /\n      if (isDND) {\n        isSuccess = finalValue >= requiredTarget;\n      } else {\n        isSuccess = finalValue <= requiredTarget;\n      }\n\n      // \n      if (isCritSuccess) {\n        outcomeText = '';\n        outcomeClass = 'success';\n        isSuccess = true;\n      } else if (isCritFailure) {\n        outcomeText = '';\n        outcomeClass = 'failure';\n        isSuccess = false;\n      } else if (isSuccess) {\n        if (isDND) {\n          outcomeText = '';\n        } else if (difficulty === 'hard') {\n          outcomeText = '';\n        } else if (difficulty === 'extreme') {\n          outcomeText = '';\n        } else {\n          // \n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            outcomeText = '';\n          } else if (finalValue <= hardTarget) {\n            outcomeText = '';\n          } else {\n            outcomeText = '';\n          }\n        }\n        outcomeClass = 'success';\n      } else {\n        outcomeText = '';\n        outcomeClass = 'failure';\n      }\n\n      const successColor = t.successText;\n      const failureColor = '#e74c3c';\n      const criteriaSymbol = isDND ? '' : '';\n\n      // \n      panel.find('#dice-result-area').html(`\n                <div style=\"display:flex; align-items:center; justify-content:space-between; padding:8px 12px; background:${t.tableHead}; border-radius:6px; margin-top:8px; gap:8px;\">\n                    <div style=\"display:flex; align-items:center; gap:8px;\">\n                        <span style=\"font-size:22px; font-weight:bold; color:${t.accent};\">${finalValue}</span>\n                        <span style=\"font-size:11px; color:${t.textSub};\">${criteriaSymbol}${requiredTarget}${difficultyLabel ? '(' + difficultyLabel + ')' : ''}</span>\n                    </div>\n                    <span style=\"padding:4px 12px; border-radius:12px; font-size:12px; font-weight:bold; white-space:nowrap; background:${outcomeClass === 'success' ? t.successBg : 'rgba(231, 76, 60, 0.15)'}; color:${outcomeClass === 'success' ? successColor : failureColor};\">${outcomeText}</span>\n                </div>\n            `);\n\n      //  Prompt \n      const initiatorName = panel.find('#dice-initiator-name').val().trim() || '<user>';\n      let judgeExpr = '';\n\n      if (isCritSuccess) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        } else {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        }\n      } else if (isCritFailure) {\n        if (isDND) {\n          judgeExpr = `${finalValue}${critSuccessMax}`;\n        } else {\n          judgeExpr = `${finalValue}${critFailMin}`;\n        }\n      } else if (isDND) {\n        // DND \n        if (isSuccess) {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${criteriaSymbol}${requiredTarget}${finalValue}<${requiredTarget}`;\n        }\n      } else if (difficulty === 'critical') {\n        // COC \n        judgeExpr = `${critSuccessMax}${finalValue}>${critSuccessMax}`;\n      } else if (difficulty !== 'normal') {\n        // COC \n        if (isSuccess) {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}${requiredTarget}`;\n        } else {\n          judgeExpr = `${target}/${difficultyDiv}${finalValue}>${requiredTarget}`;\n        }\n      } else {\n        // COC \n        if (isSuccess) {\n          const extremeTarget = Math.floor(target / extremeDiv);\n          const hardTarget = Math.floor(target / hardDiv);\n          if (finalValue <= extremeTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${extremeDiv}`;\n          } else if (finalValue <= hardTarget) {\n            judgeExpr = `${target}${finalValue}${target}/${hardDiv}`;\n          } else {\n            judgeExpr = `${target}${finalValue}${target}`;\n          }\n        } else {\n          judgeExpr = `${target}${finalValue}>${target}`;\n        }\n      }\n\n      const diceResultText = `${initiatorName}${attrName}${finalValue}${judgeExpr}${outcomeText}`;\n      smartInsertToTextarea(diceResultText, 'dice');\n      if (onResult) {\n        onResult({\n          success: isSuccess,\n          total: finalValue,\n          target,\n          outcomeText,\n          attrName,\n          criteria,\n          isAutoTarget,\n          formula: formulaText,\n        });\n      }\n    });\n\n    // \n    panel.find('#dice-switch-contest-top').click(function () {\n      const targetInput = panel.find('#dice-target').val().trim();\n      const attrValueInput = panel.find('#dice-attr-value').val().trim();\n      const currentName = panel.find('#dice-attr-name').val() || '';\n      const currentDice = panel.find('#dice-formula').val() || '1d100';\n      const initiatorNameVal = panel.find('#dice-initiator-name').val().trim();\n      closePanel();\n      showContestPanel({\n        //  placeholder \n        initiatorName: initiatorNameVal && initiatorNameVal !== '<user>' ? initiatorNameVal : '',\n        initiatorValue: attrValueInput !== '' ? parseInt(attrValueInput, 10) : undefined,\n        diceType: currentDice,\n      });\n    });\n    // \n    const closePanel = () => {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-dice-close').click(closePanel);\n    //  - \n    panel.find('.acu-dice-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentCriteria = panel.find('#dice-success-criteria').val();\n      const isDND = currentCriteria === 'gte';\n      showDiceSettingsPanel(isDND);\n    });\n  };\n\n  // [] \n  const showContestPanel = (options = {}) => {\n    const { $ } = getCore();\n    $('.acu-dice-panel, .acu-dice-overlay, .acu-contest-panel, .acu-contest-overlay').remove();\n\n    const config = getConfig();\n    const diceCfg = getDiceConfig();\n\n    // \n    let savedDiceType = diceCfg.lastDiceType || '1d100';\n    if (!/^\\d+d\\d+$/i.test(savedDiceType)) {\n      savedDiceType = '1d100';\n    }\n\n    // \n    const opponentName = options.opponentName || '';\n    const diceType = options.diceType || savedDiceType;\n    const passedInitiatorName = options.initiatorName || '';\n    const passedInitiatorValue = options.initiatorValue;\n    const passedOpponentValue = options.opponentValue;\n\n    const rawData = cachedRawData || getTableData();\n    let playerAttrs = [];\n    let opponentAttrs = [];\n\n    // [] <user> + \n    let characterList = ['<user>'];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1]) characterList.push(row[1]);\n          }\n          break;\n        }\n      }\n    }\n    // [] \n    let contestAttrList = [];\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet && sheet.name === '' && sheet.content && sheet.content[1]) {\n          const headers = sheet.content[0] || [];\n          const row = sheet.content[1];\n          headers.forEach((h, idx) => {\n            if (h && h.includes('')) {\n              const parsed = parseAttributeString(row[idx] || '');\n              parsed.forEach(attr => {\n                if (!contestAttrList.includes(attr.name)) contestAttrList.push(attr.name);\n              });\n            }\n          });\n          break;\n        }\n      }\n    }\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (!sheet || !sheet.name || !sheet.content) continue;\n\n        if (sheet.name === '' && sheet.content[1]) {\n          const attrStr = sheet.content[1][7] || '';\n          playerAttrs = parseAttributeString(attrStr);\n        }\n\n        if (sheet.name === '' && opponentName) {\n          for (let i = 1; i < sheet.content.length; i++) {\n            const row = sheet.content[i];\n            if (row && row[1] === opponentName) {\n              const attrStr = row[9] || '';\n              opponentAttrs = parseAttributeString(attrStr);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    const t = getThemeColors();\n\n    const buildAttrButtons = (attrs, targetType) => {\n      if (attrs.length === 0)\n        return '<div style=\"font-size:11px;color:' + t.textSub + ';text-align:center;padding:4px;\"></div>';\n      let html = '';\n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        html +=\n          '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n          attr.value +\n          '\" data-aname=\"' +\n          escapeHtml(attr.name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.inputBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.inputText +\n          ';font-size:11px;cursor:pointer;margin:2px;\">' +\n          escapeHtml(attr.name) +\n          ': ' +\n          attr.value +\n          '</button>';\n      }\n      return html;\n    };\n\n    const overlay = $(\n      '<div class=\"acu-contest-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:2147483647;\"></div>',\n    );\n    const panelHtml =\n      '<div class=\"acu-contest-panel\" style=\"position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:360px;max-width:92vw;background:' +\n      t.bgPanel +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,0.4);z-index:2147483648;font-family:Microsoft YaHei,sans-serif;overflow:hidden;\">' +\n      '<div style=\"padding:12px 15px;background:' +\n      t.tableHead +\n      ';border-bottom:1px solid ' +\n      t.border +\n      ';display:flex;justify-content:space-between;align-items:center;\">' +\n      '<div style=\"font-size:15px;font-weight:bold;color:' +\n      t.accent +\n      ';display:flex;align-items:center;gap:8px;\"><i class=\"fa-solid fa-people-arrows\"></i> </div>' +\n      '<div style=\"display:flex;align-items:center;gap:8px;\">' +\n      '<button id=\"contest-switch-normal\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-dice-d20\"></i></button>' +\n      '<button class=\"acu-contest-config-btn\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:14px;padding:4px;transition:all 0.2s;\" title=\"\"><i class=\"fa-solid fa-cog\"></i></button>' +\n      '<button class=\"acu-contest-close\" style=\"background:none;border:none;color:' +\n      t.textSub +\n      ';cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>' +\n      '</div>' +\n      '</div>' +\n      '<div style=\"padding:15px;max-height:70vh;overflow-y:auto;\">' +\n      '<div style=\"display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;align-items:center;\">' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d20' ? ' active' : '') +\n      '\" data-dice=\"1d20\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d20' ? t.accent : t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d20' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d20</button>' +\n      '<button class=\"acu-contest-preset' +\n      (diceType === '1d100' ? ' active' : '') +\n      '\" data-dice=\"1d100\" style=\"padding:4px 10px;background:' +\n      (diceType === '1d100' ? t.accent : t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (diceType === '1d100' ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\">1d100</button>' +\n      '<button class=\"acu-contest-preset acu-contest-custom-btn\" data-dice=\"custom\" style=\"padding:4px 10px;background:' +\n      (!['1d20', '1d100'].includes(diceType) ? t.accent : t.btnBg) +\n      ';border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      (!['1d20', '1d100'].includes(diceType) ? '#fff' : t.textMain) +\n      ';font-size:11px;cursor:pointer;\"></button>' +\n      '<input type=\"text\" id=\"contest-custom-dice\" placeholder=\"2d6\" value=\"' +\n      (!['1d20', '1d100'].includes(diceType) ? diceType : '') +\n      '\" style=\"width:60px;padding:4px 6px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      t.inputText +\n      ' !important;font-size:11px;text-align:center;box-sizing:border-box;\" />' +\n      '</div>' +\n      '<input type=\"hidden\" id=\"contest-dice-type\" value=\"' +\n      diceType +\n      '\">' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user\"></i> </span><div id=\"contest-init-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;\"></div><input type=\"text\" id=\"contest-init-display\" value=\"\" placeholder=\"<user>\" style=\"width:100%;padding:5px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      t.inputText +\n      ' !important;font-size:12px;text-align:center;box-sizing:border-box;\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-init-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-init-name\" value=\"\" placeholder=\"\" style=\"width:100%;padding:5px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      t.inputText +\n      ' !important;font-size:12px;text-align:center;box-sizing:border-box;\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;\"></div><input type=\"number\" id=\"contest-init-value\" value=\"' +\n      (passedInitiatorValue !== undefined ? passedInitiatorValue : '') +\n      '\" placeholder=\"=50%\" style=\"width:100%;padding:5px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      t.inputText +\n      ' !important;font-size:12px;text-align:center;box-sizing:border-box;\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;\"></div><input type=\"number\" id=\"contest-init-target\" value=\"\" placeholder=\"\" style=\"width:100%;padding:5px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      t.inputText +\n      ' !important;font-size:12px;text-align:center;box-sizing:border-box;\"></div>' +\n      '</div>' +\n      '<div id=\"init-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:8px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(playerAttrs, 'init') +\n      '</div>' +\n      '<div style=\"font-size:11px;color:' +\n      t.accent +\n      ';font-weight:bold;margin-bottom:4px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;\"><span><i class=\"fa-solid fa-user-slash\"></i> </span><div id=\"contest-opp-char-buttons\" style=\"display:flex;flex-wrap:wrap;gap:3px;\"></div></div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;\"></div><input type=\"text\" id=\"contest-opponent-display\" value=\"' +\n      escapeHtml(opponentName) +\n      '\" placeholder=\"\" style=\"width:100%;padding:5px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      t.inputText +\n      ' !important;font-size:12px;text-align:center;box-sizing:border-box;\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;display:flex;align-items:center;gap:6px;\"><button type=\"button\" class=\"acu-random-skill-btn\" id=\"contest-opp-random-skill\" title=\"\" style=\"width:18px;height:18px;padding:0;background:transparent;border:1px dashed ' +\n      t.accent +\n      ';border-radius:4px;color:' +\n      t.accent +\n      ';font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;\"><i class=\"fa-solid fa-dice\"></i></button></div><input type=\"text\" id=\"contest-opp-name\" value=\"\" placeholder=\"\" style=\"width:100%;padding:5px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      t.inputText +\n      ' !important;font-size:12px;text-align:center;box-sizing:border-box;\"></div>' +\n      '</div>' +\n      '<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px;\">' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;\"></div><input type=\"number\" id=\"contest-opp-value\" value=\"' +\n      (passedOpponentValue !== undefined ? passedOpponentValue : '') +\n      '\" placeholder=\"=50%\" style=\"width:100%;padding:5px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      t.inputText +\n      ' !important;font-size:12px;text-align:center;box-sizing:border-box;\"></div>' +\n      '<div><div style=\"font-size:10px;color:' +\n      t.textSub +\n      ';margin-bottom:2px;\"></div><input type=\"number\" id=\"contest-opp-target\" value=\"\" placeholder=\"\" style=\"width:100%;padding:5px;background:' +\n      t.inputBg +\n      ' !important;border:1px solid ' +\n      t.border +\n      ';border-radius:4px;color:' +\n      t.inputText +\n      ' !important;font-size:12px;text-align:center;box-sizing:border-box;\"></div>' +\n      '</div>' +\n      '<div id=\"opp-attr-buttons\" style=\"display:flex;flex-wrap:wrap;gap:2px;margin-bottom:10px;max-height:50px;overflow-y:auto;\">' +\n      buildAttrButtons(opponentAttrs, 'opp') +\n      '</div>' +\n      '<button id=\"contest-roll-btn\" style=\"width:100%;padding:12px;background:' +\n      t.accent +\n      ';border:none;border-radius:8px;color:#fff;font-size:15px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;\"><i class=\"fa-solid fa-dice\"></i> </button>' +\n      '<div id=\"contest-result-area\"></div>' +\n      '</div>' +\n      '</div>';\n\n    const panel = $(panelHtml);\n    $('body').append(overlay).append(panel);\n    // []  - \n    const buildCharBtns = targetType => {\n      const containerId = targetType === 'init' ? '#contest-init-char-buttons' : '#contest-opp-char-buttons';\n      const $container = panel.find(containerId);\n      let html = '';\n      characterList.forEach(name => {\n        const displayName = name === '<user>' ? getDisplayPlayerName() : replaceUserPlaceholders(name);\n        const shortName = displayName.length > 4 ? displayName.substring(0, 4) + '..' : displayName;\n        html +=\n          '<button class=\"acu-contest-char-btn\" data-char=\"' +\n          escapeHtml(name) +\n          '\" data-type=\"' +\n          targetType +\n          '\" style=\"padding:3px 8px;background:' +\n          t.btnBg +\n          ';border:1px solid ' +\n          t.border +\n          ';border-radius:4px;color:' +\n          t.textMain +\n          ';font-size:11px;cursor:pointer;white-space:nowrap;\" title=\"' +\n          escapeHtml(displayName) +\n          '\">' +\n          escapeHtml(shortName) +\n          '</button>';\n      });\n      $container.html(html);\n      $container.find('.acu-contest-char-btn').click(function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const charName = $(this).data('char');\n        const type = $(this).data('type');\n        if (type === 'init') {\n          panel.find('#contest-init-display').val(charName).trigger('change');\n        } else {\n          panel.find('#contest-opponent-display').val(charName).trigger('change');\n        }\n      });\n    };\n\n    // [] \n    const rebuildAttrBtns = (attrs, targetType) => {\n      const containerId = targetType === 'init' ? '#init-attr-buttons' : '#opp-attr-buttons';\n      const $container = panel.find(containerId);\n\n      let html = '';\n\n      // \n      if (attrs.length > 0) {\n        attrs.forEach(attr => {\n          html +=\n            '<button class=\"acu-contest-attr-btn\" data-val=\"' +\n            attr.value +\n            '\" data-aname=\"' +\n            escapeHtml(attr.name) +\n            '\" data-type=\"' +\n            targetType +\n            '\" style=\"padding:2px 6px;background:' +\n            t.inputBg +\n            ';border:1px solid ' +\n            t.border +\n            ';border-radius:3px;color:' +\n            t.inputText +\n            ';font-size:10px;cursor:pointer;\">' +\n            escapeHtml(attr.name) +\n            ':' +\n            attr.value +\n            '</button>';\n        });\n      }\n\n      // \n      html +=\n        '<button class=\"acu-contest-gen-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed ' +\n        t.accent +\n        ';border-radius:3px;color:' +\n        t.accent +\n        ';font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;\" title=\"\"><i class=\"fa-solid fa-dice\" style=\"font-size:9px;\"></i></button>';\n\n      // \n      html +=\n        '<button class=\"acu-contest-clear-attr-btn\" data-type=\"' +\n        targetType +\n        '\" style=\"padding:2px 6px;background:transparent;border:1px dashed #e74c3c;border-radius:3px;color:#e74c3c;font-size:10px;cursor:pointer;display:inline-flex;align-items:center;gap:3px;margin-left:4px;\" title=\"\"><i class=\"fa-solid fa-trash-alt\" style=\"font-size:9px;\"></i></button>';\n\n      $container.html(html);\n\n      // \n      $container.find('.acu-contest-attr-btn').click(function () {\n        const val = $(this).attr('data-val');\n        const aname = $(this).attr('data-aname');\n        const type = $(this).attr('data-type');\n        if (type === 'init') {\n          panel.find('#contest-init-value').val(val);\n          panel.find('#contest-init-name').val(aname);\n        } else {\n          panel.find('#contest-opp-value').val(val);\n          panel.find('#contest-opp-name').val(aname);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-gen-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // [] \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[ACU] ');\n        };\n\n        try {\n          // \n          let charName;\n          if (type === 'init') {\n            charName = panel.find('#contest-init-display').val().trim() || '<user>';\n          } else {\n            charName = panel.find('#contest-opponent-display').val().trim();\n          }\n\n          if (!charName) {\n            if (window.toastr) window.toastr.warning('');\n            return;\n          }\n\n          console.log('[ACU]  for:', charName, 'type:', type);\n\n          // \n          const generated = generateRPGAttributes();\n\n          // \n          const baseAttrs = generated.base || generated;\n          const specialAttrs = generated.special || {};\n\n          // \n          const allAttrs = { ...baseAttrs, ...specialAttrs };\n\n          // \n          const result = await writeAttributesToCharacter(charName, allAttrs);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[ACU] :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // [] \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n\n      // \n      $container.find('.acu-contest-clear-attr-btn').click(async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const $btn = $(this);\n        if ($btn.prop('disabled')) return;\n\n        const type = $btn.attr('data-type');\n\n        // \n        let charName;\n        if (type === 'init') {\n          charName = panel.find('#contest-init-display').val().trim() || '<user>';\n        } else {\n          charName = panel.find('#contest-opponent-display').val().trim();\n        }\n\n        if (!charName) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        if (!confirm(`${charName}\\n\\n`)) {\n          return;\n        }\n\n        // \n        $btn.prop('disabled', true).css('opacity', '0.5');\n        const originalHtml = $btn.html();\n        $btn.html('<i class=\"fa-solid fa-spinner fa-spin\"></i>');\n\n        // \n        const originalHandler = UpdateController.handleUpdate;\n        UpdateController.handleUpdate = () => {\n          console.log('[ACU] ');\n        };\n\n        try {\n          console.log('[ACU]  for:', charName, 'type:', type);\n\n          const result = await clearPresetAttributesForCharacter(charName);\n\n          if (result.success) {\n            // \n            const refreshedAttrs = getFullAttributesForCharacter(charName);\n            rebuildAttrBtns(refreshedAttrs, type);\n          }\n        } catch (err) {\n          console.error('[ACU] :', err);\n          if (window.toastr) window.toastr.error('');\n        } finally {\n          // \n          UpdateController.handleUpdate = originalHandler;\n          $btn.prop('disabled', false).css('opacity', '1').html(originalHtml);\n        }\n      });\n    };\n\n    // \n    buildCharBtns('init');\n    buildCharBtns('opp');\n    // [] \n    panel.find('#contest-init-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-init-name').val(randomSkill).trigger('change');\n    });\n\n    // [] \n    panel.find('#contest-opp-random-skill').click(function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      const skillPool = getRandomSkillPool();\n      var randomSkill = skillPool[Math.floor(Math.random() * skillPool.length)];\n      panel.find('#contest-opp-name').val(randomSkill).trigger('change');\n    });\n    // \n    if (passedInitiatorName) {\n      const initAttrs = getFullAttributesForCharacter(passedInitiatorName);\n      rebuildAttrBtns(initAttrs, 'init');\n    }\n    if (opponentName) {\n      const oppAttrs = getFullAttributesForCharacter(opponentName);\n      rebuildAttrBtns(oppAttrs, 'opp');\n    }\n\n    // \n    initCustomDropdown(panel.find('#contest-init-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-opponent-display'), characterList, t);\n    initCustomDropdown(panel.find('#contest-init-name'), contestAttrList, t);\n    initCustomDropdown(panel.find('#contest-opp-name'), contestAttrList, t);\n    addClearButton(\n      panel,\n      '#contest-init-display, #contest-init-name, #contest-init-value, #contest-init-target, #contest-opponent-display, #contest-opp-name, #contest-opp-value, #contest-opp-target',\n      t,\n    );\n\n    // \n    panel.find('#contest-init-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim() || '<user>';\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-init-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'init');\n    });\n\n    // \n    panel.find('#contest-opponent-display').on('change.acuattr input.acuattr', function () {\n      const charName = $(this).val().trim();\n      const newAttrList = getAttributesForCharacter(charName);\n      initCustomDropdown(panel.find('#contest-opp-name'), newAttrList.length > 0 ? newAttrList : contestAttrList, t);\n      const fullAttrs = getFullAttributesForCharacter(charName);\n      rebuildAttrBtns(fullAttrs, 'opp');\n    });\n\n    // \n    panel.find('#contest-init-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-init-display').val().trim() || '<user>';\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-init-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('#contest-opp-name').on('change.acuval', function () {\n      const charName = panel.find('#contest-opponent-display').val().trim();\n      const attrName = $(this).val().trim();\n      const attrValue = getAttributeValue(charName, attrName);\n      if (attrValue !== null) {\n        panel.find('#contest-opp-value').val(attrValue);\n      }\n    });\n\n    // \n    panel.find('.acu-contest-preset').click(function () {\n      const newDice = $(this).data('dice');\n      // \n      if (newDice === 'custom') return;\n\n      panel.find('.acu-contest-preset').css({ background: t.btnBg, color: t.textMain });\n      $(this).css({ background: t.accent, color: '#fff' });\n      panel.find('#contest-dice-type').val(newDice);\n\n      // \n      saveDiceConfig({ lastDiceType: newDice });\n    });\n\n    // \n    panel.find('.acu-contest-custom-btn').click(function () {\n      // \n      panel.find('.acu-contest-preset').css({ background: t.btnBg, color: t.textMain });\n      $(this).css({ background: t.accent, color: '#fff' });\n\n      var customDice = panel.find('#contest-custom-dice').val().trim();\n      // \n      if (!customDice) {\n        panel.find('#contest-custom-dice').focus();\n        return;\n      }\n      if (!/^\\d+d\\d+$/i.test(customDice)) {\n        if (window.toastr) window.toastr.warning(' 4d6');\n        return;\n      }\n\n      panel.find('#contest-dice-type').val(customDice);\n\n      // \n      saveDiceConfig({ lastDiceType: customDice });\n    });\n\n    // \n    panel.find('#contest-custom-dice').on('keydown', function (e) {\n      if (e.key === 'Enter') {\n        e.preventDefault();\n        panel.find('.acu-contest-custom-btn').click();\n      }\n    });\n    // \n    const rollDice = function (formula) {\n      const match = formula.match(/(\\d+)d(\\d+)([+-]\\d+)?/i);\n      if (!match) return { total: 0, rolls: [], sides: 100 };\n      const count = parseInt(match[1], 10);\n      const sides = parseInt(match[2], 10);\n      const modifier = match[3] ? parseInt(match[3], 10) : 0;\n      const rolls = [];\n      for (let i = 0; i < count; i++) {\n        rolls.push(Math.floor(Math.random() * sides) + 1);\n      }\n      return {\n        total:\n          rolls.reduce(function (a, b) {\n            return a + b;\n          }, 0) + modifier,\n        rolls: rolls,\n        sides: sides,\n      };\n    };\n\n    const getSuccessLevel = function (roll, target, sides) {\n      if (sides === 100) {\n        if (roll <= 5) return { level: 3, name: '', color: '#9b59b6' };\n        if (roll >= 96) return { level: -1, name: '', color: '#c0392b' };\n        if (roll <= Math.floor(target / 5)) return { level: 2, name: '', color: '#2980b9' };\n        if (roll <= Math.floor(target / 2)) return { level: 1, name: '', color: '#27ae60' };\n        if (roll <= target) return { level: 0, name: '', color: '#f39c12' };\n        return { level: -1, name: '', color: '#e74c3c' };\n      } else {\n        if (roll === 20) return { level: 3, name: '', color: '#9b59b6' };\n        if (roll === 1) return { level: -1, name: '', color: '#c0392b' };\n        if (roll >= target) return { level: 0, name: '', color: '#27ae60' };\n        return { level: -1, name: '', color: '#e74c3c' };\n      }\n    };\n\n    panel.find('#contest-roll-btn').click(function () {\n      var formula = panel.find('#contest-dice-type').val() || '1d100';\n\n      var initName = panel.find('#contest-init-display').val().trim() || '<user>';\n      var initAttrName = panel.find('#contest-init-name').val().trim() || '';\n      // \n      var getHalfMax = function (formulaStr) {\n        var m = formulaStr.match(/(\\d+)d(\\d+)/i);\n        if (m) return Math.round((parseInt(m[1], 10) * parseInt(m[2], 10)) / 2);\n        return 50;\n      };\n\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var initValue;\n      if (initValueInput === '') {\n        // \n        initValue = getHalfMax(formula);\n      } else {\n        initValue = parseInt(initValueInput, 10) || getHalfMax(formula);\n      }\n      var initTargetInput = panel.find('#contest-init-target').val().trim();\n      var initTarget;\n      if (initTargetInput !== '') {\n        initTarget = parseInt(initTargetInput, 10);\n      } else {\n        // \n        initTarget = initValue;\n      }\n\n      var oppName = panel.find('#contest-opponent-display').val().trim() || '';\n      var oppAttrName = panel.find('#contest-opp-name').val().trim() || initAttrName;\n      var oppValueInput = panel.find('#contest-opp-value').val().trim();\n      var oppValue;\n      if (oppValueInput === '') {\n        // \n        oppValue = getHalfMax(formula);\n      } else {\n        oppValue = parseInt(oppValueInput, 10) || getHalfMax(formula);\n      }\n      var oppTargetInput = panel.find('#contest-opp-target').val().trim();\n      var oppTarget;\n      if (oppTargetInput !== '') {\n        oppTarget = parseInt(oppTargetInput, 10);\n      } else {\n        // \n        oppTarget = oppValue;\n      }\n\n      var initResult = rollDice(formula);\n      var oppResult = rollDice(formula);\n      var initSuccess = getSuccessLevel(initResult.total, initTarget, initResult.sides);\n      var oppSuccess = getSuccessLevel(oppResult.total, oppTarget, oppResult.sides);\n\n      var winner, winnerColor, resultDesc;\n      var diceCfg = getDiceConfig();\n      var tieRule = diceCfg.contestTieRule || 'initiator_lose';\n\n      if (initSuccess.level > oppSuccess.level) {\n        winner = initName + ' ';\n        winnerColor = '#27ae60';\n        resultDesc = initSuccess.name + '  ' + oppSuccess.name;\n      } else if (initSuccess.level < oppSuccess.level) {\n        winner = oppName + ' ';\n        winnerColor = '#e74c3c';\n        resultDesc = oppSuccess.name + '  ' + initSuccess.name;\n      } else {\n        // \n        resultDesc = ' ' + initSuccess.name;\n        if (tieRule === 'initiator_win') {\n          winner = '' + initName + ' ';\n          winnerColor = '#27ae60';\n        } else if (tieRule === 'tie') {\n          winner = '';\n          winnerColor = '#f39c12';\n        } else {\n          // : initiator_lose\n          winner = '' + initName + ' ';\n          winnerColor = '#e74c3c';\n        }\n      }\n\n      panel\n        .find('#contest-result-area')\n        .html(\n          '<div style=\"padding:8px 10px;background:' +\n            t.tableHead +\n            ';border-radius:6px;margin-top:8px;\">' +\n            '<div style=\"display:flex;align-items:center;justify-content:space-between;gap:4px;margin-bottom:6px;flex-wrap:wrap;\">' +\n            '<div style=\"display:flex;align-items:center;gap:4px;min-width:0;\">' +\n            '<span style=\"font-size:11px;color:' +\n            t.textSub +\n            ';white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n            escapeHtml(initName) +\n            '</span>' +\n            '<span style=\"font-size:18px;font-weight:bold;color:' +\n            t.accent +\n            ';\">' +\n            initResult.total +\n            '</span>' +\n            '<span style=\"padding:2px 5px;background:' +\n            initSuccess.color +\n            ';color:#fff;border-radius:8px;font-size:9px;white-space:nowrap;\">' +\n            initSuccess.name +\n            '</span>' +\n            '</div>' +\n            '<span style=\"color:' +\n            t.textSub +\n            ';font-size:11px;font-weight:bold;\">VS</span>' +\n            '<div style=\"display:flex;align-items:center;gap:4px;min-width:0;\">' +\n            '<span style=\"padding:2px 5px;background:' +\n            oppSuccess.color +\n            ';color:#fff;border-radius:8px;font-size:9px;white-space:nowrap;\">' +\n            oppSuccess.name +\n            '</span>' +\n            '<span style=\"font-size:18px;font-weight:bold;color:' +\n            t.accent +\n            ';\">' +\n            oppResult.total +\n            '</span>' +\n            '<span style=\"font-size:11px;color:' +\n            t.textSub +\n            ';white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60px;\">' +\n            escapeHtml(oppName) +\n            '</span>' +\n            '</div>' +\n            '</div>' +\n            '<div style=\"text-align:center;padding:5px 8px;background:' +\n            winnerColor +\n            ';border-radius:4px;\">' +\n            '<span style=\"font-size:12px;font-weight:bold;color:#fff;\">' +\n            winner +\n            '</span>' +\n            '</div>' +\n            '</div>',\n        );\n\n      const contestResultText =\n        `${initAttrName} vs ${oppAttrName}` +\n        `${initName} (${initTarget})  ${initResult.total}${initSuccess.name}` +\n        `${oppName} (${oppTarget})  ${oppResult.total}${oppSuccess.name}` +\n        `${winner}`;\n      smartInsertToTextarea(contestResultText, 'dice');\n    });\n    // [] \n    panel.find('#contest-switch-normal').click(function () {\n      var initValueInput = panel.find('#contest-init-value').val().trim();\n      var currentInitName = panel.find('#contest-init-name').val() || '';\n      var currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      var initiatorNameVal = panel.find('#contest-init-display').val().trim();\n      closePanel();\n      showDicePanel({\n        //  null  placeholder\n        targetValue: initValueInput !== '' ? parseInt(initValueInput, 10) : null,\n        targetName: currentInitName,\n        diceType: currentDice,\n        initiatorName: initiatorNameVal,\n      });\n    });\n    //  - \n    // 1d20 -> DND,  -> COC\n    panel.find('.acu-contest-config-btn').click(function (e) {\n      e.stopPropagation();\n      const currentDice = panel.find('#contest-dice-type').val() || '1d100';\n      const isDND = currentDice === '1d20';\n      showDiceSettingsPanel(isDND);\n    });\n    var closePanel = function () {\n      overlay.remove();\n      panel.remove();\n    };\n    overlay.click(closePanel);\n    panel.find('.acu-contest-close').click(closePanel);\n  };\n  // [] \n  const showPreviewCard = (tableName, headers, row, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    $('.acu-preview-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // 1\n    const title = row[1] || '';\n\n    // \n    let bodyHtml = '';\n    for (let i = 1; i < headers.length; i++) {\n      const headerName = headers[i];\n      const cellValue = row[i];\n      if (!headerName || cellValue === null || cellValue === undefined || cellValue === '') continue;\n\n      bodyHtml += `\n                <div class=\"acu-preview-row\">\n                    <div class=\"acu-preview-label\">${escapeHtml(headerName)}</div>\n                    <div class=\"acu-preview-value\">${escapeHtml(String(cellValue))}</div>\n                </div>\n            `;\n    }\n\n    // \n    const overlay = $(`\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-preview-card\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-preview-title\">\n                            <i class=\"fa-solid fa-id-card\"></i>\n                            <span>${escapeHtml(title)}</span>\n                        </div>\n                        <button class=\"acu-close-btn acu-preview-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-preview-body\">\n                        ${bodyHtml || '<div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div>'}\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-preview-close').click(() => overlay.remove());\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-preview-overlay')) overlay.remove();\n    });\n  };\n\n  // \n  const showRelationshipGraph = npcTable => {\n    const { $ } = getCore();\n    $('.acu-relation-graph-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    const headers = npcTable.headers || [];\n    const rows = npcTable.rows || [];\n\n    const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n    const relationIdx = headers.findIndex(h => h && h.includes(''));\n    const npcTableKey = npcTable.key || '';\n\n    if (relationIdx < 0) {\n      if (window.toastr) window.toastr.warning('\"\"');\n      return;\n    }\n\n    const nodes = new Map();\n    const edges = [];\n\n    const resolveName = name => AvatarManager.getPrimaryName(name);\n\n    const rawData = cachedRawData || getTableData();\n    let playerName = '';\n    if (rawData) {\n      for (const key in rawData) {\n        const sheet = rawData[key];\n        if (sheet?.name?.includes('') && sheet.content?.[1]) {\n          playerName = sheet.content[1][1] || '';\n          break;\n        }\n      }\n    }\n    const resolvedPlayerName = resolveName(playerName);\n    const playerTableKey = (() => {\n      for (const k in rawData) {\n        if (rawData[k]?.name?.includes('')) return k;\n      }\n      return '';\n    })();\n    nodes.set(resolvedPlayerName, {\n      name: resolvedPlayerName,\n      isPlayer: true,\n      x: 0,\n      y: 0,\n      tableKey: playerTableKey,\n      rowIndex: 0,\n    });\n\n    // \"\"\n    const inSceneColIdx = headers.findIndex(h => h && h.includes(''));\n\n    rows.forEach((row, idx) => {\n      const rawNpcName = row[nameIdx];\n      if (!rawNpcName) return;\n\n      const npcName = resolveName(rawNpcName);\n\n      // \n      let isInScene = false;\n      if (inSceneColIdx > 0) {\n        const inSceneVal = String(row[inSceneColIdx] || '')\n          .trim()\n          .toLowerCase();\n        const header = String(headers[inSceneColIdx] || '').toLowerCase();\n\n        if (header.includes('')) {\n          isInScene = inSceneVal === '' || inSceneVal === 'false' || inSceneVal === 'no';\n        } else {\n          isInScene =\n            inSceneVal.startsWith('') || inSceneVal === 'true' || inSceneVal === '' || inSceneVal === 'yes';\n        }\n      }\n\n      if (!nodes.has(npcName)) {\n        nodes.set(npcName, {\n          name: npcName,\n          isPlayer: false,\n          x: 0,\n          y: 0,\n          tableKey: npcTableKey,\n          rowIndex: idx,\n          isInScene: isInScene,\n        });\n      }\n\n      const relationStr = row[relationIdx] || '';\n      const relations = parseRelationshipString(relationStr);\n\n      relations.forEach(rel => {\n        if (!rel.name) return;\n        const resolvedRelName = resolveName(rel.name);\n\n        if (resolvedRelName === npcName) return;\n\n        if (!nodes.has(resolvedRelName)) {\n          // NPC\n          let relRowIndex = -1;\n          for (let ri = 0; ri < rows.length; ri++) {\n            if (resolveName(rows[ri][nameIdx]) === resolvedRelName) {\n              relRowIndex = ri;\n              break;\n            }\n          }\n          nodes.set(resolvedRelName, {\n            name: resolvedRelName,\n            isPlayer: resolvedRelName === resolvedPlayerName,\n            x: 0,\n            y: 0,\n            tableKey: relRowIndex >= 0 ? npcTableKey : '',\n            rowIndex: relRowIndex >= 0 ? relRowIndex : undefined,\n          });\n        }\n\n        // /\n        const cleanRelation = rawRel => {\n          if (!rawRel) return [];\n          const parts = String(rawRel)\n            .split(/[,;\\/\\|]+|\\s*[&]\\s*|\\s{2,}|\\n/)\n            .map(s => s.trim())\n            .filter(s => s && s.length < 30); // \n\n          // \n          const commonRelations = [\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n            '',\n          ];\n\n          return parts\n            .map(p => {\n              // [] \n              p = p.replace(/[(][^)]*[)]/g, '').trim();\n              // === XX/  XX ===\n              const specialSuffixMatch = p.match(/^(.+)(|)$/);\n              if (specialSuffixMatch) {\n                p = specialSuffixMatch[1]; // \"\"  \"\"\n              } else {\n                // === XXYY  YY ===\n                p = p.replace(/^[\\u4e00-\\u9fa5]{2,4}(?=[\\u4e00-\\u9fa5]{1,4}$)/, '');\n              }\n\n              // ===  ===\n              p = p.replace(/^(?:|||?|?|)/, '');\n              p = p.replace(/^(?:?|?|?|)/, '');\n              p = p.replace(/^(?:|?|?)/, '');\n\n              // ===  ===\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n              p = p.replace(/$/, '');\n\n              // ===  ===\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^$/, '');\n              p = p.replace(/^(?:||?)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n              p = p.replace(/^(?:|)$/, '');\n              p = p.replace(/^(?:||)$/, '');\n\n              p = p.trim();\n\n              // === []  ===\n              if (p.length > 8) {\n                // \n                for (const rel of commonRelations) {\n                  if (p.endsWith(rel)) {\n                    return rel;\n                  }\n                }\n                // 2-4\n                const lastChars = p.slice(-4);\n                for (const rel of commonRelations) {\n                  if (lastChars.includes(rel)) {\n                    return rel;\n                  }\n                }\n                // 3\n                return p.slice(-3);\n              }\n\n              return p;\n            })\n            .filter(s => s && s.length > 0 && s.length <= 8);\n        };\n\n        const cleanedLabels = cleanRelation(rel.relation);\n        if (cleanedLabels.length === 0) cleanedLabels.push('');\n\n        // \n        let existingEdge = edges.find(\n          e =>\n            (e.source === npcName && e.target === resolvedRelName) ||\n            (e.source === resolvedRelName && e.target === npcName),\n        );\n\n        if (!existingEdge) {\n          // \n          edges.push({\n            source: npcName,\n            target: resolvedRelName,\n            // \n            labelsFromSource: cleanedLabels.slice(0, 2), // sourcetarget 2\n            labelsFromTarget: [], // targetsource \n          });\n        } else {\n          // \n          if (existingEdge.source === npcName) {\n            // npcsource labelsFromSource\n            const combined = [...(existingEdge.labelsFromSource || []), ...cleanedLabels];\n            // 2\n            existingEdge.labelsFromSource = [...new Set(combined)].slice(0, 2);\n          } else {\n            // npctarget labelsFromTarget\n            const combined = [...(existingEdge.labelsFromTarget || []), ...cleanedLabels];\n            existingEdge.labelsFromTarget = [...new Set(combined)].slice(0, 2);\n          }\n        }\n      });\n    });\n\n    const nodeArr = Array.from(nodes.values());\n    const centerX = 400,\n      centerY = 300;\n\n    // [] \n    const connectionCount = new Map();\n    nodeArr.forEach(node => connectionCount.set(node.name, 0));\n    edges.forEach(edge => {\n      connectionCount.set(edge.source, (connectionCount.get(edge.source) || 0) + 1);\n      connectionCount.set(edge.target, (connectionCount.get(edge.target) || 0) + 1);\n    });\n\n    // [] \n    const isMobileView = window.innerWidth <= 768;\n    const baseRadius = isMobileView ? 22 : 28;\n    const maxRadius = isMobileView ? 38 : 50;\n    const playerBaseRadius = isMobileView ? 28 : 35;\n    const radiusPerConnection = isMobileView ? 2.5 : 3.5;\n\n    const getNodeRadius = (nodeName, isPlayer) => {\n      if (isPlayer) {\n        const count = connectionCount.get(nodeName) || 0;\n        return Math.min(maxRadius, playerBaseRadius + Math.sqrt(count) * radiusPerConnection);\n      }\n      const count = connectionCount.get(nodeName) || 0;\n      return Math.min(maxRadius, baseRadius + Math.sqrt(count) * radiusPerConnection);\n    };\n\n    // \n    nodeArr.forEach(node => {\n      node.radius = getNodeRadius(node.name, node.isPlayer);\n    });\n\n    // \n    const maxNodeRadius = Math.max(...nodeArr.map(n => n.radius));\n    const radius = Math.min(280, Math.max(180, nodeArr.length * 30 + maxNodeRadius));\n    nodeArr.forEach((node, i) => {\n      if (node.isPlayer) {\n        node.x = centerX;\n        node.y = centerY;\n      } else {\n        const angle = (2 * Math.PI * i) / nodeArr.length;\n        node.x = centerX + radius * Math.cos(angle);\n        node.y = centerY + radius * Math.sin(angle);\n      }\n    });\n\n    // \n    let scale = 1;\n    let panX = 0;\n    let panY = 0;\n    const minScale = 0.3;\n    const maxScale = 4;\n\n    const overlay = $(`\n            <div class=\"acu-relation-graph-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-relation-graph-container\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-graph-title\"><i class=\"fa-solid fa-project-diagram\"></i> </div>\n                        <div class=\"acu-graph-actions\">\n                            <button class=\"acu-graph-btn\" id=\"graph-zoom-in\" title=\"\"><i class=\"fa-solid fa-plus\"></i></button>\n                            <button class=\"acu-graph-btn\" id=\"graph-zoom-out\" title=\"\"><i class=\"fa-solid fa-minus\"></i></button>\n                            <button class=\"acu-graph-btn\" id=\"graph-manage-avatar\" title=\"\"><i class=\"fa-solid fa-user-circle\"></i></button>\n                            <button class=\"acu-graph-btn acu-graph-close\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-graph-canvas-wrapper\">\n                        <svg class=\"acu-graph-svg\" viewBox=\"0 0 800 600\">\n                            <defs>\n                                <marker id=\"arrowhead-end\" markerWidth=\"6\" markerHeight=\"5\" refX=\"5\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 6 2.5, 0 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start\" markerWidth=\"6\" markerHeight=\"5\" refX=\"1\" refY=\"2.5\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"6 0, 0 2.5, 6 5\" fill=\"${t.textSub}\" />\n                                </marker>\n                                <marker id=\"arrowhead-end-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"6\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"0 0, 7 3, 0 6\" fill=\"${t.accent}\" />\n                                </marker>\n                                <marker id=\"arrowhead-start-hl\" markerWidth=\"7\" markerHeight=\"6\" refX=\"1\" refY=\"3\" orient=\"auto\" markerUnits=\"strokeWidth\">\n                                    <polygon points=\"7 0, 0 3, 7 6\" fill=\"${t.accent}\" />\n                                </marker>\n                            </defs>\n                            <g class=\"acu-graph-transform\">\n                                <g class=\"acu-graph-edges\"></g>\n                                <g class=\"acu-graph-nodes\"></g>\n                            </g>\n                        </svg>\n                    </div>\n                    <div class=\"acu-graph-legend\">\n                        <button class=\"acu-graph-btn\" id=\"graph-zoom-reset\" title=\"\" style=\"width:auto;height:auto;padding:4px 10px;font-size:11px;display:flex;align-items:center;gap:4px;\"><i class=\"fa-solid fa-compress-arrows-alt\"></i><span></span></button>\n                        <span class=\"acu-zoom-display\">${Math.round(scale * 100)}%</span>\n                    </div>\n                </div>\n            </div>\n        `);\n\n    $('body').append(overlay);\n\n    const $svg = overlay.find('.acu-graph-svg');\n    const $transform = overlay.find('.acu-graph-transform');\n    const $edgesGroup = overlay.find('.acu-graph-edges');\n    const $nodesGroup = overlay.find('.acu-graph-nodes');\n    const $zoomDisplay = overlay.find('.acu-zoom-display');\n    const $wrapper = overlay.find('.acu-graph-canvas-wrapper');\n\n    const updateTransform = () => {\n      $transform.attr('transform', `translate(${panX}, ${panY}) scale(${scale})`);\n      $zoomDisplay.text(`${Math.round(scale * 100)}%`);\n    };\n\n    const zoomTo = (newScale, centerX = 400, centerY = 300) => {\n      const oldScale = scale;\n      scale = Math.max(minScale, Math.min(maxScale, newScale));\n      const scaleChange = scale / oldScale;\n      panX = centerX - (centerX - panX) * scaleChange;\n      panY = centerY - (centerY - panY) * scaleChange;\n      updateTransform();\n    };\n\n    const render = async () => {\n      let edgesHtml = '';\n      edges.forEach((edge, edgeIdx) => {\n        const source = nodes.get(edge.source);\n        const target = nodes.get(edge.target);\n        if (!source || !target) return;\n\n        // \n        const dx = target.x - source.x;\n        const dy = target.y - source.y;\n        const len = Math.sqrt(dx * dx + dy * dy) || 1;\n        const nx = dx / len; // \n        const ny = dy / len;\n\n        // \n        const px = -ny;\n        const py = nx;\n\n        // \n        const hasFromSource =\n          edge.labelsFromSource && edge.labelsFromSource.length > 0 && edge.labelsFromSource.some(l => l);\n        const hasFromTarget =\n          edge.labelsFromTarget && edge.labelsFromTarget.length > 0 && edge.labelsFromTarget.some(l => l);\n\n        // \n        const sourceRadius = source.radius || 28;\n        const targetRadius = target.radius || 28;\n        const arrowGap = 10; // \n        const x1 = source.x + nx * (sourceRadius + arrowGap);\n        const y1 = source.y + ny * (sourceRadius + arrowGap);\n        const x2 = target.x - nx * (targetRadius + arrowGap);\n        const y2 = target.y - ny * (targetRadius + arrowGap);\n\n        // \n        let srcLabels = (edge.labelsFromSource || []).filter(l => l);\n        let tgtLabels = (edge.labelsFromTarget || []).filter(l => l);\n\n        // \n        const srcSet = new Set(srcLabels);\n        const tgtSet = new Set(tgtLabels);\n        const commonLabels = [...srcSet].filter(l => tgtSet.has(l));\n\n        // \n        const srcUnique = srcLabels.filter(l => !commonLabels.includes(l));\n        const tgtUnique = tgtLabels.filter(l => !commonLabels.includes(l));\n\n        // \n        let markerStart = '';\n        let markerEnd = '';\n        if (hasFromSource) markerEnd = 'url(#arrowhead-end)';\n        if (hasFromTarget) markerStart = 'url(#arrowhead-start)';\n\n        edgesHtml += `<line class=\"acu-graph-edge\" x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\"\n                    ${markerEnd ? `marker-end=\"${markerEnd}\"` : ''}\n                    ${markerStart ? `marker-start=\"${markerStart}\"` : ''}\n                    data-edge-idx=\"${edgeIdx}\" />`;\n\n        // \n        const midX = (source.x + target.x) / 2;\n        const midY = (source.y + target.y) / 2;\n\n        // \n        const lineLen = Math.sqrt(dx * dx + dy * dy);\n\n        // \"\"\n        const isBidirectional = hasFromSource && hasFromTarget;\n        const isBidirectionalSame =\n          isBidirectional && commonLabels.length > 0 && srcUnique.length === 0 && tgtUnique.length === 0;\n\n        // \n        if (isBidirectionalSame) {\n          // \n          commonLabels.slice(0, 2).forEach((lbl, i) => {\n            if (!lbl) return;\n            const offsetDir = i === 0 ? 1 : -1;\n            const offsetDist = 6 + i * 10;\n            const lx = midX + px * offsetDir * offsetDist;\n            const ly = midY + py * offsetDir * offsetDist;\n            edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(lbl)}</text>`;\n          });\n        } else {\n          // \n          // source/target\n          // 25%\n          const safeOffset = Math.max(30, Math.min(lineLen * 0.25, 60));\n\n          // Emoji\n          const relationEmojiMap = [\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            {\n              emoji: '',\n              keywords: [\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n                '',\n              ],\n            },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', '', '', '', ''] },\n            { emoji: '', keywords: ['', '', '', '', ''] },\n          ];\n\n          // Emoji\n          const addRelationEmoji = lbl => {\n            if (!lbl) return '';\n            for (const group of relationEmojiMap) {\n              for (const kw of group.keywords) {\n                if (lbl.includes(kw)) {\n                  return lbl + group.emoji;\n                }\n              }\n            }\n            return lbl;\n          };\n\n          // emoji\n          const truncateLabel = (lbl, maxLen = 4) => {\n            if (!lbl) return '';\n            const truncated = lbl.length > maxLen ? lbl.substring(0, maxLen) + '..' : lbl;\n            return addRelationEmoji(truncated);\n          };\n\n          // 1. \n          if (commonLabels.length > 0) {\n            commonLabels.slice(0, 1).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const lx = midX + px * 8;\n              const ly = midY + py * 8 - 3;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 2. Sourcesource\n          if (srcUnique.length > 0 || (hasFromSource && !hasFromTarget && commonLabels.length === 0)) {\n            const labelsToShow = srcUnique.length > 0 ? srcUnique : srcLabels;\n            // source\n            const labelBaseX = midX - nx * safeOffset;\n            const labelBaseY = midY - ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? 1 : -1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n\n          // 3. Targettarget\n          if (tgtUnique.length > 0 || (hasFromTarget && !hasFromSource && commonLabels.length === 0)) {\n            const labelsToShow = tgtUnique.length > 0 ? tgtUnique : tgtLabels;\n            // target\n            const labelBaseX = midX + nx * safeOffset;\n            const labelBaseY = midY + ny * safeOffset;\n\n            labelsToShow.slice(0, 2).forEach((lbl, i) => {\n              if (!lbl) return;\n              // \n              const perpOffset = (i === 0 ? -1 : 1) * 10;\n              const lx = labelBaseX + px * perpOffset;\n              const ly = labelBaseY + py * perpOffset;\n              edgesHtml += `<text class=\"acu-graph-edge-label\" x=\"${lx}\" y=\"${ly}\" data-edge-idx=\"${edgeIdx}\">${escapeHtml(truncateLabel(lbl, 5))}</text>`;\n            });\n          }\n        }\n      });\n      $edgesGroup.html(edgesHtml);\n\n      // [] \n      let nodesHtml = '';\n      for (const node of nodeArr) {\n        //  > URL > ST\n        const nodeAvatar = await AvatarManager.getAsync(node.name);\n        const isPlayer = node.isPlayer;\n\n        // \n        const indicatorRadius = Math.max(8, node.radius * 0.28);\n        const indicatorOffset = node.radius * 0.65;\n        const inSceneIndicator = node.isInScene\n          ? `<circle class=\"acu-node-inscene-indicator\" cx=\"${-indicatorOffset}\" cy=\"${-indicatorOffset}\" r=\"${indicatorRadius}\" style=\"fill:var(--acu-accent);stroke:var(--acu-bg-panel);stroke-width:2;\" />`\n          : '';\n\n        const nodeDisplayName = replaceUserPlaceholders(node.name);\n        nodesHtml += `\n                <g class=\"acu-graph-node acu-dash-preview-trigger\" data-name=\"${escapeHtml(node.name)}\" data-table-key=\"${node.tableKey || ''}\" data-row-index=\"${node.rowIndex !== undefined ? node.rowIndex : ''}\" transform=\"translate(${node.x}, ${node.y})\">\n                    <circle class=\"acu-node-bg ${isPlayer ? 'player' : ''}\" r=\"${node.radius}\" />\n                    ${\n                      nodeAvatar\n                        ? (() => {\n                            const offsetX = AvatarManager.getOffsetX(node.name);\n                            const offsetY = AvatarManager.getOffsetY(node.name);\n                            const scaleVal = AvatarManager.getScale(node.name);\n                            const size = (node.radius - 2) * 2;\n                            return `<foreignObject x=\"${-size / 2}\" y=\"${-size / 2}\" width=\"${size}\" height=\"${size}\">\n                            <div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"\n                                width: ${size}px;\n                                height: ${size}px;\n                                border-radius: 50%;\n                                background-image: url('${nodeAvatar}');\n                                background-size: ${scaleVal}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                                background-repeat: no-repeat;\n                            \"></div>\n                        </foreignObject>`;\n                          })()\n                        : `<text class=\"acu-node-char\" dy=\"0.35em\">${escapeHtml(nodeDisplayName.charAt(0))}</text>`\n                    }\n                    ${inSceneIndicator}\n                    <text class=\"acu-node-label\" dy=\"${node.radius + 14}\">${escapeHtml(nodeDisplayName)}</text>\n                </g>\n            `;\n      }\n      $nodesGroup.html(nodesHtml);\n    };\n\n    render().then(() => {\n      updateTransform();\n    });\n\n    // [] \n    const highlightNode = nodeName => {\n      $svg.addClass('highlighting');\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if ($(this).data('name') === nodeName) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedNodes = new Set([nodeName]);\n\n      edges.forEach(edge => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          const otherNode = edge.source === nodeName ? edge.target : edge.source;\n          connectedNodes.add(otherNode);\n        }\n      });\n\n      // \n      $nodesGroup.find('.acu-graph-node').each(function () {\n        if (connectedNodes.has($(this).data('name'))) {\n          $(this).addClass('highlighted');\n        }\n      });\n\n      // \n      const connectedEdgeIndices = new Set();\n      edges.forEach((edge, idx) => {\n        if (edge.source === nodeName || edge.target === nodeName) {\n          connectedEdgeIndices.add(idx);\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n          if ($(this).attr('marker-end')) {\n            $(this).attr('marker-end', 'url(#arrowhead-end-hl)');\n          }\n          if ($(this).attr('marker-start')) {\n            $(this).attr('marker-start', 'url(#arrowhead-start-hl)');\n          }\n        }\n      });\n\n      $edgesGroup.find('.acu-graph-edge-label').each(function () {\n        const edgeIdx = parseInt($(this).attr('data-edge-idx'), 10);\n        if (connectedEdgeIndices.has(edgeIdx)) {\n          $(this).addClass('highlighted');\n        }\n      });\n    };\n\n    const clearHighlight = () => {\n      $svg.removeClass('highlighting');\n      $nodesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.highlighted').removeClass('highlighted');\n      $edgesGroup.find('.acu-graph-edge').each(function () {\n        if ($(this).attr('marker-end')) {\n          $(this).attr('marker-end', 'url(#arrowhead-end)');\n        }\n        if ($(this).attr('marker-start')) {\n          $(this).attr('marker-start', 'url(#arrowhead-start)');\n        }\n      });\n    };\n\n    // []  - PC +  + \n    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n    // \n    let currentHighlightedNode = null; // \n    let longPressTimer = null;\n    let tapBlocked = false; // \n\n    if (isTouchDevice) {\n      // ==========  ==========\n      let currentHighlightedNode = null;\n\n      $nodesGroup.on('pointerdown', '.acu-graph-node', function (e) {\n        const $node = $(this);\n        const nodeName = $node.data('name');\n        const startX = e.clientX;\n        const startY = e.clientY;\n        const startTime = Date.now();\n        let hasMoved = false;\n        let longPressTriggered = false;\n\n        // \n        if (currentHighlightedNode) {\n          clearHighlight();\n          currentHighlightedNode = null;\n          // return\n          e.preventDefault();\n          e.stopPropagation();\n          return;\n        }\n\n        // \n        const longPressTimer = setTimeout(() => {\n          if (!hasMoved && nodeName) {\n            longPressTriggered = true;\n            currentHighlightedNode = nodeName;\n            highlightNode(nodeName);\n            if (navigator.vibrate) navigator.vibrate(30);\n          }\n        }, 300);\n\n        const onMove = moveE => {\n          const dx = Math.abs(moveE.clientX - startX);\n          const dy = Math.abs(moveE.clientY - startY);\n          if (dx > 8 || dy > 8) {\n            hasMoved = true;\n            clearTimeout(longPressTimer);\n          }\n        };\n\n        const onUp = () => {\n          $(document).off('pointermove.mobilenode pointerup.mobilenode pointercancel.mobilenode');\n          clearTimeout(longPressTimer);\n\n          const elapsed = Date.now() - startTime;\n\n          //   \n          if (longPressTriggered) {\n            return;\n          }\n\n          //   \n          if (hasMoved) {\n            return;\n          }\n\n          // <300ms  \n          if (elapsed < 300) {\n            const tableKey = $node.data('table-key');\n            const rowIndex = $node.data('row-index');\n\n            if (tableKey && rowIndex !== '' && rowIndex !== undefined) {\n              const rawData = cachedRawData || getTableData();\n              if (rawData && rawData[tableKey]) {\n                const sheet = rawData[tableKey];\n                const headers = sheet.content ? sheet.content[0] : [];\n                const row = sheet.content ? sheet.content[parseInt(rowIndex, 10) + 1] : null;\n                if (row) {\n                  showPreviewCard(sheet.name || '', headers, row, parseInt(rowIndex, 10), tableKey);\n                }\n              }\n            }\n          }\n        };\n\n        $(document).on('pointermove.mobilenode', onMove);\n        $(document).on('pointerup.mobilenode pointercancel.mobilenode', onUp);\n      });\n\n      // \n      $wrapper.on('pointerup.mobileclear', function (e) {\n        if (currentHighlightedNode && !$(e.target).closest('.acu-graph-node').length) {\n          clearHighlight();\n          currentHighlightedNode = null;\n        }\n      });\n    } else {\n      // ========== PC ==========\n\n      $nodesGroup.on('pointerenter.pchover', '.acu-graph-node', function () {\n        const nodeName = $(this).data('name');\n        if (nodeName) {\n          highlightNode(nodeName);\n        }\n      });\n\n      $nodesGroup.on('pointerleave.pchover', '.acu-graph-node', function () {\n        clearHighlight();\n      });\n\n      // PC\n      $nodesGroup.on('click.pcclick', '.acu-graph-node', function (e) {\n        e.stopPropagation();\n        const $node = $(this);\n        const tableKey = $node.data('table-key');\n        const rowIndex = $node.data('row-index');\n\n        if (tableKey && rowIndex !== '' && rowIndex !== undefined) {\n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const sheet = rawData[tableKey];\n            const headers = sheet.content ? sheet.content[0] : [];\n            const row = sheet.content ? sheet.content[parseInt(rowIndex, 10) + 1] : null;\n            if (row) {\n              showPreviewCard(sheet.name || '', headers, row, parseInt(rowIndex, 10), tableKey);\n            }\n          }\n        }\n      });\n    }\n\n    //  -  Pointer Events API\n\n    const getSvgPoint = (clientX, clientY) => {\n      const svg = $svg[0];\n      const pt = svg.createSVGPoint();\n      pt.x = clientX;\n      pt.y = clientY;\n      return pt.matrixTransform(svg.getScreenCTM().inverse());\n    };\n\n    //  -  Pointer Events API\n    let isPanning = false;\n    let panStartX = 0,\n      panStartY = 0;\n    let panStartPanX = 0,\n      panStartPanY = 0;\n    let lastPinchDist = 0;\n    let activePointerId = null;\n\n    const wrapperEl = $wrapper[0];\n    const svgEl = $svg[0];\n\n    // Pointer Down - \n    wrapperEl.onpointerdown = function (e) {\n      if (e.button !== 0) return;\n      // [] \n      if ($(e.target).closest('.acu-graph-node').length) return;\n      e.preventDefault();\n      wrapperEl.setPointerCapture(e.pointerId);\n      activePointerId = e.pointerId;\n      isPanning = true;\n      panStartX = e.clientX;\n      panStartY = e.clientY;\n      panStartPanX = panX;\n      panStartPanY = panY;\n      svgEl.style.cursor = 'grabbing';\n    };\n\n    // Pointer Move - \n    wrapperEl.onpointermove = function (e) {\n      if (!isPanning || e.pointerId !== activePointerId) return;\n      const dx = e.clientX - panStartX;\n      const dy = e.clientY - panStartY;\n      const rect = svgEl.getBoundingClientRect();\n      panX = panStartPanX + (dx / rect.width) * 800;\n      panY = panStartPanY + (dy / rect.height) * 600;\n      updateTransform();\n    };\n\n    // Pointer Up - \n    wrapperEl.onpointerup = function (e) {\n      if (e.pointerId === activePointerId) {\n        wrapperEl.releasePointerCapture(e.pointerId);\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // Pointer Cancel - \n    wrapperEl.onpointercancel = function (e) {\n      if (e.pointerId === activePointerId) {\n        isPanning = false;\n        activePointerId = null;\n        svgEl.style.cursor = 'grab';\n      }\n    };\n\n    // \n    wrapperEl.onwheel = function (e) {\n      e.preventDefault();\n      const delta = e.deltaY > 0 ? -0.15 : 0.15;\n      zoomTo(scale + delta);\n    };\n\n    // \n    wrapperEl.addEventListener(\n      'touchstart',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          isPanning = false;\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener(\n      'touchmove',\n      function (e) {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            zoomTo(scale * (newDist / lastPinchDist));\n          }\n          lastPinchDist = newDist;\n        }\n      },\n      { passive: false },\n    );\n\n    wrapperEl.addEventListener('touchend', function (e) {\n      if (e.touches.length < 2) lastPinchDist = 0;\n    });\n\n    // \n    const cleanupEvents = () => {\n      wrapperEl.onpointerdown = null;\n      wrapperEl.onpointermove = null;\n      wrapperEl.onpointerup = null;\n      wrapperEl.onpointercancel = null;\n      wrapperEl.onwheel = null;\n    };\n\n    // \n    overlay.find('#graph-zoom-in').click(() => zoomTo(scale + 0.25));\n    overlay.find('#graph-zoom-out').click(() => zoomTo(scale - 0.25));\n\n    //  + \n    overlay.find('#graph-zoom-reset').click(() => {\n      // \n      scale = 1;\n      panX = 0;\n      panY = 0;\n      updateTransform();\n\n      // \n      nodeArr.forEach((node, i) => {\n        if (node.isPlayer) {\n          node.x = centerX;\n          node.y = centerY;\n        } else {\n          const angle = (2 * Math.PI * i) / nodeArr.length;\n          node.x = centerX + radius * Math.cos(angle);\n          node.y = centerY + radius * Math.sin(angle);\n        }\n      });\n      render();\n    });\n\n    overlay.find('#graph-manage-avatar').click(() => {\n      showAvatarManager(nodeArr, () => render());\n    });\n\n    const closeGraph = () => {\n      cleanupEvents();\n      overlay.remove();\n    };\n    overlay.find('.acu-graph-close').click(closeGraph);\n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-relation-graph-overlay')) closeGraph();\n    });\n  };\n  // ========================================\n  //  - PC/\n  // ========================================\n\n  const showAvatarCropModal = (imageSource, characterName, onSave) => {\n    const { $ } = getCore();\n    $('.acu-crop-modal-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n\n    // \n    let scale = 150;\n    let offsetX = 50;\n    let offsetY = 50;\n\n    // \n    const existing = AvatarManager.getAll()[characterName];\n    if (existing) {\n      scale = existing.scale ?? 150;\n      offsetX = existing.offsetX ?? 50;\n      offsetY = existing.offsetY ?? 50;\n    }\n\n    const modalHtml = `\n            <div class=\"acu-crop-modal-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-crop-modal\">\n                    <div class=\"acu-crop-header\">\n                        <span><i class=\"fa-solid fa-crop-simple\"></i>  - ${escapeHtml(characterName)}</span>\n                        <button class=\"acu-crop-close\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-crop-body\">\n                        <div class=\"acu-crop-container\">\n                            <div class=\"acu-crop-image\" style=\"\n                                background-image: url('${imageSource}');\n                                background-size: ${scale}%;\n                                background-position: ${offsetX}% ${offsetY}%;\n                            \"></div>\n                            <div class=\"acu-crop-mask\"></div>\n                        </div>\n                        <div class=\"acu-crop-hint\">  /</div>\n                    </div>\n                    <div class=\"acu-crop-footer\">\n                        <label class=\"acu-crop-btn acu-crop-reupload\" title=\"\">\n                            <i class=\"fa-solid fa-camera\"></i>\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-crop-file-input\" style=\"display:none;\" />\n                        </label>\n                        <button class=\"acu-crop-btn acu-crop-cancel\"></button>\n                        <button class=\"acu-crop-btn acu-crop-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $modal = $(modalHtml);\n    $('body').append($modal);\n\n    // \n    $modal.css({\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      right: '0',\n      bottom: '0',\n      width: '100vw',\n      height: '100vh',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      'z-index': '2147483658',\n    });\n\n    const $image = $modal.find('.acu-crop-image');\n    const $container = $modal.find('.acu-crop-container');\n    const containerEl = $container[0];\n    const imageEl = $image[0];\n\n    // \n    const updateImageStyle = () => {\n      imageEl.style.backgroundSize = `${scale}%`;\n      imageEl.style.backgroundPosition = `${offsetX}% ${offsetY}%`;\n    };\n\n    // ===  Pointer Events  ===\n    let isDragging = false;\n    let startX = 0,\n      startY = 0;\n    let startOffsetX = 0,\n      startOffsetY = 0;\n    let activePointerId = null;\n\n    imageEl.addEventListener('pointerdown', e => {\n      // \n      if (activePointerId !== null) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      isDragging = true;\n      activePointerId = e.pointerId;\n      startX = e.clientX;\n      startY = e.clientY;\n      startOffsetX = offsetX;\n      startOffsetY = offsetY;\n\n      imageEl.setPointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grabbing';\n    });\n\n    imageEl.addEventListener('pointermove', e => {\n      if (!isDragging || e.pointerId !== activePointerId) return;\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      const deltaX = e.clientX - startX;\n      const deltaY = e.clientY - startY;\n\n      // \n      const sensitivity = 100 / scale;\n      offsetX = Math.max(0, Math.min(100, startOffsetX - deltaX * sensitivity));\n      offsetY = Math.max(0, Math.min(100, startOffsetY - deltaY * sensitivity));\n      updateImageStyle();\n    });\n\n    imageEl.addEventListener('pointerup', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.releasePointerCapture(e.pointerId);\n      imageEl.style.cursor = 'grab';\n    });\n\n    imageEl.addEventListener('pointercancel', e => {\n      if (e.pointerId !== activePointerId) return;\n\n      isDragging = false;\n      activePointerId = null;\n      imageEl.style.cursor = 'grab';\n    });\n\n    // ===  ===\n    // \n    containerEl.addEventListener(\n      'wheel',\n      e => {\n        e.preventDefault();\n        e.stopPropagation();\n        const delta = e.deltaY > 0 ? -10 : 10;\n        scale = Math.max(100, Math.min(300, scale + delta));\n        updateImageStyle();\n      },\n      { passive: false },\n    );\n\n    // \n    let lastPinchDist = 0;\n    let pinchStartScale = scale;\n\n    containerEl.addEventListener(\n      'touchstart',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          lastPinchDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          pinchStartScale = scale;\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener(\n      'touchmove',\n      e => {\n        if (e.touches.length === 2) {\n          e.preventDefault();\n          const newDist = Math.hypot(\n            e.touches[1].clientX - e.touches[0].clientX,\n            e.touches[1].clientY - e.touches[0].clientY,\n          );\n          if (lastPinchDist > 0) {\n            const pinchRatio = newDist / lastPinchDist;\n            scale = Math.max(100, Math.min(300, pinchStartScale * pinchRatio));\n            updateImageStyle();\n          }\n        }\n      },\n      { passive: false },\n    );\n\n    containerEl.addEventListener('touchend', e => {\n      if (e.touches.length < 2) {\n        lastPinchDist = 0;\n        pinchStartScale = scale;\n      }\n    });\n\n    // ===  ===\n    // \n    $modal.find('.acu-crop-file-input').on('change', async function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      if (!file.type.startsWith('image/')) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        if (window.toastr) window.toastr.warning(' 5MB');\n        return;\n      }\n\n      try {\n        // \n        const success = await AvatarManager.saveLocalAvatar(characterName, file);\n        if (success) {\n          //  URL \n          const newUrl = await LocalAvatarDB.get(characterName);\n          imageSource = newUrl;\n\n          // \n          scale = 150;\n          offsetX = 50;\n          offsetY = 50;\n\n          // \n          $image.css('background-image', `url('${newUrl}')`);\n          updateImageStyle();\n        }\n      } catch (err) {\n        console.error('[ACU] :', err);\n        if (window.toastr) window.toastr.error('');\n      }\n\n      $(this).val('');\n    });\n    $modal.find('.acu-crop-close, .acu-crop-cancel').on('click', () => {\n      $modal.remove();\n    });\n\n    $modal.find('.acu-crop-confirm').on('click', () => {\n      onSave({ scale, offsetX, offsetY });\n      $modal.remove();\n    });\n\n    // \n    $modal.on('click', e => {\n      if ($(e.target).hasClass('acu-crop-modal-overlay')) {\n        $modal.remove();\n      }\n    });\n  };\n  //  - \n  const showAvatarManager = (nodeArr, onUpdate) => {\n    const { $ } = getCore();\n    $('.acu-avatar-manager-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const avatars = AvatarManager.getAll();\n\n    // \n    const buildList = async () => {\n      let listHtml = '';\n\n      for (const node of nodeArr) {\n        const data = avatars[node.name] || {};\n        let currentUrl = data.url || '';\n\n        // \n        const hasLocal = await AvatarManager.hasLocalAvatar(node.name);\n        let displayUrl = '';\n        let sourceLabel = '';\n\n        if (hasLocal) {\n          displayUrl = await LocalAvatarDB.get(node.name);\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n        } else if (currentUrl) {\n          displayUrl = currentUrl;\n          sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n        } else {\n          const playerName = getPlayerName();\n          const isPlayer = node.name === '<user>' || node.name === '' || (playerName && node.name === playerName);\n          if (isPlayer) {\n            displayUrl = getUserAvatarUrl() || '';\n            if (displayUrl) sourceLabel = '<span class=\"acu-avatar-source acu-source-auto\"></span>';\n          }\n        }\n\n        const aliases = (data.aliases || []).join(', ');\n        const hasAvatar = !!displayUrl;\n\n        listHtml += `\n                    <div class=\"acu-avatar-item\" data-name=\"${escapeHtml(node.name)}\" data-has-local=\"${hasLocal}\" data-display-url=\"${escapeHtml(displayUrl)}\">\n                        <div class=\"acu-avatar-preview-wrap\">\n                            <div class=\"acu-avatar-preview ${hasAvatar ? 'has-image' : ''}\" style=\"${hasAvatar ? `background-image: url('${displayUrl}'); background-position: ${data.offsetX ?? 50}% ${data.offsetY ?? 50}%; background-size: ${data.scale ?? 150}%;` : ''}\">\n                                ${!hasAvatar ? `<span>${escapeHtml(node.name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>` : ''}\n                            </div>\n                            ${sourceLabel}\n                        </div>\n                        <div class=\"acu-avatar-info\">\n                            <div class=\"acu-avatar-name-row\">\n                                <div class=\"acu-avatar-name\">${escapeHtml(node.name)}</div>\n                                <div class=\"acu-avatar-actions\">\n                                    <button class=\"acu-avatar-save-btn\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                    <button class=\"acu-avatar-clear-btn\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                </div>\n                            </div>\n                            <input type=\"text\" class=\"acu-avatar-url\" placeholder=\"URL...\" value=\"${escapeHtml(currentUrl)}\" />\n                            <input type=\"text\" class=\"acu-avatar-aliases\" placeholder=\"...\" value=\"${escapeHtml(aliases)}\" title=\": , \" />\n                            <input type=\"file\" accept=\"image/*\" class=\"acu-avatar-file-input\" style=\"display:none;\" />\n                        </div>\n                    </div>\n                `;\n      }\n\n      return listHtml;\n    };\n\n    // \n    const managerHtml = `\n            <div class=\"acu-avatar-manager-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-avatar-manager\">\n                    <div class=\"acu-panel-header\">\n                        <div class=\"acu-avatar-title\"><i class=\"fa-solid fa-user-circle\"></i> </div>\n                        <div style=\"display:flex;gap:4px;align-items:center;\">\n                            <button class=\"acu-avatar-import-btn\" title=\"\"><i class=\"fa-solid fa-file-import\"></i></button>\n                            <button class=\"acu-avatar-export-btn\" title=\"\"><i class=\"fa-solid fa-file-export\"></i></button>\n                            <button class=\"acu-avatar-close\"><i class=\"fa-solid fa-times\"></i></button>\n                        </div>\n                    </div>\n                    <div class=\"acu-avatar-list\" id=\"acu-avatar-list-container\">\n                        <div style=\"text-align:center;padding:20px;color:${t.textSub};\">\n                            <i class=\"fa-solid fa-spinner fa-spin\"></i> ...\n                        </div>\n                    </div>\n                </div>\n                <input type=\"file\" id=\"acu-avatar-file-input\" accept=\".json\" style=\"display:none;\" />\n            </div>\n        `;\n\n    const $manager = $(managerHtml);\n    $('body').append($manager);\n\n    // \n    buildList().then(listHtml => {\n      $manager.find('#acu-avatar-list-container').html(listHtml);\n      bindAvatarEvents();\n    });\n\n    // \n    const refreshItem = async name => {\n      const $item = $manager.find(`.acu-avatar-item[data-name=\"${name}\"]`);\n      if (!$item.length) return;\n\n      const data = AvatarManager.getAll()[name] || {};\n      const hasLocal = await AvatarManager.hasLocalAvatar(name);\n      let displayUrl = '';\n      let sourceLabel = '';\n\n      if (hasLocal) {\n        displayUrl = await LocalAvatarDB.get(name);\n        sourceLabel = '<span class=\"acu-avatar-source acu-source-local\"></span>';\n      } else if (data.url) {\n        displayUrl = data.url;\n        sourceLabel = '<span class=\"acu-avatar-source acu-source-url\">URL</span>';\n      }\n\n      const $preview = $item.find('.acu-avatar-preview');\n      $item.find('.acu-avatar-source').remove();\n\n      if (displayUrl) {\n        $preview\n          .addClass('has-image')\n          .css({\n            'background-image': `url('${displayUrl}')`,\n            'background-position': `${data.offsetX ?? 50}% ${data.offsetY ?? 50}%`,\n            'background-size': `${data.scale ?? 150}%`,\n          })\n          .find('span')\n          .remove();\n        $item.find('.acu-avatar-preview-wrap').append(sourceLabel);\n      } else {\n        $preview\n          .removeClass('has-image')\n          .css({ 'background-image': '', 'background-position': '', 'background-size': '' })\n          .html(`<span>${escapeHtml(name.charAt(0))}</span><i class=\"fa-solid fa-camera acu-avatar-camera-hint\"></i>`);\n      }\n\n      $item.attr('data-has-local', hasLocal);\n      $item.attr('data-display-url', displayUrl);\n    };\n\n    const bindAvatarEvents = () => {\n      // \n      $manager.on('click', '.acu-avatar-preview', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-avatar-item');\n        const name = $item.data('name');\n        const displayUrl = $item.attr('data-display-url');\n\n        if (displayUrl) {\n          //   \n          showAvatarCropModal(displayUrl, name, async result => {\n            const data = AvatarManager.getAll()[name] || {};\n            AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          });\n        } else {\n          //   \n          $item.find('.acu-avatar-file-input').click();\n        }\n      });\n\n      // \n      $manager.on('change', '.acu-avatar-file-input', async function (e) {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        if (!file.type.startsWith('image/')) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        if (file.size > 5 * 1024 * 1024) {\n          if (window.toastr) window.toastr.warning(' 5MB');\n          return;\n        }\n\n        const $item = $(this).closest('.acu-avatar-item');\n        const name = $item.data('name');\n\n        try {\n          const success = await AvatarManager.saveLocalAvatar(name, file);\n          if (success) {\n            const newUrl = await LocalAvatarDB.get(name);\n            await refreshItem(name);\n\n            // \n            showAvatarCropModal(newUrl, name, async result => {\n              const data = AvatarManager.getAll()[name] || {};\n              AvatarManager.set(name, data.url || '', result.offsetX, result.offsetY, result.scale, data.aliases || []);\n              await refreshItem(name);\n              onUpdate && onUpdate();\n            });\n          }\n        } catch (err) {\n          console.error('[ACU] :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n\n        $(this).val('');\n      });\n\n      // URL  \n      $manager.on('click', '.acu-avatar-save-btn', async function () {\n        const $item = $(this).closest('.acu-avatar-item');\n        const name = $item.data('name');\n        const url = $item.find('.acu-avatar-url').val().trim();\n        const aliasesStr = $item.find('.acu-avatar-aliases').val().trim();\n        const aliases = aliasesStr\n          ? aliasesStr\n              .split(/[,]/)\n              .map(s => s.trim())\n              .filter(s => s && s !== name)\n          : [];\n\n        const data = AvatarManager.getAll()[name] || {};\n\n        // \n        AvatarManager.set(name, url, data.offsetX ?? 50, data.offsetY ?? 50, data.scale ?? 150, aliases);\n\n        // URL\n        const hasLocal = $item.attr('data-has-local') === 'true';\n        if (url && !hasLocal) {\n          await refreshItem(name);\n          showAvatarCropModal(url, name, async result => {\n            AvatarManager.set(name, url, result.offsetX, result.offsetY, result.scale, aliases);\n            await refreshItem(name);\n            onUpdate && onUpdate();\n          });\n        } else {\n          await refreshItem(name);\n          onUpdate && onUpdate();\n        }\n      });\n\n      // \n      $manager.on('click', '.acu-avatar-clear-btn', async function () {\n        const $item = $(this).closest('.acu-avatar-item');\n        const name = $item.data('name');\n\n        await AvatarManager.deleteLocalAvatar(name);\n        AvatarManager.remove(name);\n\n        $item.find('.acu-avatar-url').val('');\n        $item.find('.acu-avatar-aliases').val('');\n        await refreshItem(name);\n        onUpdate && onUpdate();\n      });\n\n      // \n      $manager.on('click', '.acu-avatar-export-btn', function () {\n        const exportData = AvatarManager.exportData();\n        const jsonStr = JSON.stringify(exportData, null, 2);\n        const blob = new Blob([jsonStr], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `avatar-config-${new Date().toISOString().slice(0, 10)}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n      });\n\n      // \n      $manager.on('click', '.acu-avatar-import-btn', function () {\n        $manager.find('#acu-avatar-file-input').click();\n      });\n\n      $manager.on('change', '#acu-avatar-file-input', function (e) {\n        const file = e.target.files[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = function (evt) {\n          try {\n            const jsonData = JSON.parse(evt.target.result);\n            const analysis = AvatarManager.analyzeImport(jsonData);\n\n            if (!analysis.valid) {\n              if (window.toastr) window.toastr.error(analysis.error);\n              return;\n            }\n\n            showImportConfirmDialog(jsonData, analysis, () => {\n              $manager.remove();\n              showAvatarManager(nodeArr, onUpdate);\n              onUpdate && onUpdate();\n            });\n          } catch (err) {\n            console.error('[ACU] :', err);\n            if (window.toastr) window.toastr.error('');\n          }\n        };\n        reader.readAsText(file);\n        $(this).val('');\n      });\n    };\n\n    // \n    const closeManager = () => $manager.remove();\n    $manager.on('click', '.acu-avatar-close', closeManager);\n    $manager.on('click', function (e) {\n      if ($(e.target).hasClass('acu-avatar-manager-overlay')) closeManager();\n    });\n  };\n\n  // \n  const showImportConfirmDialog = (jsonData, analysis, onComplete) => {\n    const { $ } = getCore();\n    $('.acu-import-confirm-overlay').remove();\n\n    const t = getThemeColors();\n    const config = getConfig();\n\n    const hasConflicts = analysis.conflicts.length > 0;\n    const conflictListHtml =\n      analysis.conflicts.length > 0\n        ? `<div style=\"max-height:80px;overflow-y:auto;background:rgba(0,0,0,0.1);border-radius:4px;padding:6px 8px;margin-top:6px;font-size:11px;color:${t.textSub};\">${analysis.conflicts.map(n => escapeHtml(n)).join(', ')}</div>`\n        : '';\n\n    const dialogHtml = `\n            <div class=\"acu-import-confirm-overlay acu-theme-${config.theme}\">\n                <div class=\"acu-import-confirm-dialog\">\n                    <div class=\"acu-import-confirm-header\">\n                        <i class=\"fa-solid fa-file-import\"></i> \n                    </div>\n                    <div class=\"acu-import-confirm-body\">\n                        <div class=\"acu-import-stats\">\n                            <div class=\"acu-import-stat\">\n                                <span class=\"acu-stat-num\">${analysis.total}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-new\">\n                                <span class=\"acu-stat-num\">${analysis.newItems.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                            <div class=\"acu-import-stat acu-stat-conflict\">\n                                <span class=\"acu-stat-num\">${analysis.conflicts.length}</span>\n                                <span class=\"acu-stat-label\"></span>\n                            </div>\n                        </div>\n\n                        ${\n                          hasConflicts\n                            ? `\n                            <div class=\"acu-import-conflict-section\">\n                                <div style=\"font-size:12px;font-weight:bold;color:${t.textMain};margin-bottom:4px;\">\n                                    <i class=\"fa-solid fa-exclamation-triangle\" style=\"color:#e67e22;\"></i> \n                                </div>\n                                ${conflictListHtml}\n                                <div class=\"acu-import-conflict-options\">\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"overwrite\" checked />\n                                        <span></span>\n                                    </label>\n                                    <label class=\"acu-import-radio\">\n                                        <input type=\"radio\" name=\"conflict-mode\" value=\"skip\" />\n                                        <span></span>\n                                    </label>\n                                </div>\n                            </div>\n                        `\n                            : `\n                            <div style=\"text-align:center;padding:10px;color:${t.successText};\">\n                                <i class=\"fa-solid fa-check-circle\"></i> \n                            </div>\n                        `\n                        }\n                    </div>\n                    <div class=\"acu-import-confirm-footer\">\n                        <button class=\"acu-import-cancel-btn\"></button>\n                        <button class=\"acu-import-confirm-btn\"></button>\n                    </div>\n                </div>\n            </div>\n        `;\n\n    const $dialog = $(dialogHtml);\n    $('body').append($dialog);\n\n    // \n    const overlayEl = $dialog[0];\n    overlayEl.style.cssText = `\n            position: fixed !important;\n            top: 0 !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            width: 100vw !important;\n            height: 100vh !important;\n            background: rgba(0,0,0,0.6) !important;\n            z-index: 2147483655 !important;\n            display: flex;\n            justify-content: center !important;\n            align-items: center !important;\n            padding: 16px;\n            box-sizing: border-box !important;\n        `;\n\n    const closeDialog = () => $dialog.remove();\n\n    $dialog.find('.acu-import-cancel-btn').click(closeDialog);\n    $dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-import-confirm-overlay')) closeDialog();\n    });\n\n    $dialog.find('.acu-import-confirm-btn').click(function () {\n      const overwrite = $dialog.find('input[name=\"conflict-mode\"]:checked').val() !== 'skip';\n      try {\n        const stats = AvatarManager.importData(jsonData, overwrite);\n        closeDialog();\n        onComplete && onComplete();\n      } catch (err) {\n        console.error('[ACU] :', err);\n        if (window.toastr) window.toastr.error('' + err.message);\n      }\n    });\n  };\n  // []  ()\n  const showCardEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n    let rawData = cachedRawData || getTableData() || loadSnapshot();\n\n    let displayRow = row;\n    // \n    if (rawData && rawData[tableKey] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n      displayRow = rawData[tableKey]?.content?.[rowIndex + 1];\n    }\n\n    const inputsHtml = displayRow\n      .map((cell, idx) => {\n        if (idx === 0) return ''; // \n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        //  textarea\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                    style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>\n                </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                     <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-card-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-card-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // --- []  ---\n    const adjustHeight = el => {\n      //  auto  0px shrinking  scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    // -----------------------------\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-card-cancel').click(closeDialog);\n\n    //  v8.4  saveDataToDatabase\n    dialog.find('#dlg-card-save').click(async () => {\n      let rawData = cachedRawData || getTableData() || loadSnapshot();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n        if (hasChanges) {\n          await saveDataToDatabase(rawData, false, true); //  v8.4 \n          renderInterface();\n        }\n      }\n      closeDialog();\n    });\n    dialog.on('click', function (e) {\n      // \n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        closeDialog();\n        return;\n      }\n      // \n      if ($(e.target).closest('#dlg-close-x, #dlg-close, .acu-close-btn').length) {\n        closeDialog();\n      }\n    });\n  };\n\n  // [] \n  let _configCache = null;\n  const getConfig = () => {\n    if (!_configCache) _configCache = { ...DEFAULT_CONFIG, ...Store.get(STORAGE_KEY_UI_CONFIG, {}) };\n    return _configCache;\n  };\n  const saveConfig = newCfg => {\n    _configCache = { ...getConfig(), ...newCfg };\n    Store.set(STORAGE_KEY_UI_CONFIG, _configCache);\n    applyConfigStyles(_configCache);\n  };\n\n  const generateDiffMap = currentData => {\n    const lastData = loadSnapshot();\n    const diffSet = new Set();\n    if (!lastData) return diffSet;\n\n    for (const sheetId in currentData) {\n      const newSheet = currentData[sheetId];\n      const oldSheet = lastData[sheetId];\n      if (!newSheet || !newSheet.name) continue;\n      const tableName = newSheet.name;\n      if (!oldSheet) {\n        if (newSheet.content) {\n          newSheet.content.forEach((row, rIdx) => {\n            if (rIdx > 0) diffSet.add(`${tableName}-row-${rIdx - 1}`);\n          });\n        }\n        continue;\n      }\n      const newRows = newSheet.content || [];\n      const oldRows = oldSheet.content || [];\n      newRows.forEach((row, rIdx) => {\n        if (rIdx === 0) return;\n        const oldRow = oldRows[rIdx];\n        if (!oldRow) {\n          diffSet.add(`${tableName}-row-${rIdx - 1}`);\n        } else {\n          row.forEach((cell, cIdx) => {\n            if (cIdx === 0) return;\n            const oldCell = oldRow[cIdx];\n            if (String(cell) !== String(oldCell)) diffSet.add(`${tableName}-${rIdx - 1}-${cIdx}`);\n          });\n        }\n      });\n    }\n    return diffSet;\n  };\n\n  const applyConfigStyles = config => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    const fontVal = FONTS.find(f => f.id === config.fontFamily)?.val || FONTS[0].val;\n\n    // []  ID  Style \n    const $styleTag = $('#acu-dynamic-font');\n    const currentFontId = $styleTag.data('font-id');\n\n    if (currentFontId !== config.fontFamily) {\n      $styleTag.remove();\n      const fontImport = `\n                @import url(\"https://fontsapi.zeoseven.com/3/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/442/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/256/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/482/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/446/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/570/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/292/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/69/main/result.css\");\n                @import url(\"https://fontsapi.zeoseven.com/7/main/result.css\");\n            `;\n      $('head').append(`\n                <style id=\"acu-dynamic-font\" data-font-id=\"${config.fontFamily}\">\n                    ${fontImport}\n                    .acu-wrapper, .acu-edit-dialog, .acu-cell-menu, .acu-nav-container, .acu-data-card, .acu-panel-title, .acu-settings-label, .acu-btn-block, .acu-nav-btn, .acu-edit-textarea, #acu-ghost-preview {\n                        font-family: ${fontVal} !important;\n                    }\n                </style>\n            `);\n    }\n\n    // []  CSS \n    const cssVars = {\n      '--acu-card-width': `${config.cardWidth}px`,\n      '--acu-font-size': `${config.fontSize}px`,\n      '--acu-opt-font-size': `${config.optionFontSize || 12}px`,\n      '--acu-grid-cols': config.gridColumns,\n    };\n\n    if ($wrapper.length) {\n      $wrapper.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $wrapper.addClass(`acu-theme-${config.theme}`);\n      $wrapper.css(cssVars);\n    }\n\n    const $optContainer = $('.acu-embedded-options-container');\n    if ($optContainer.length) {\n      $optContainer.removeClass((idx, cls) => (cls.match(/(^|\\s)acu-theme-\\S+/g) || []).join(' '));\n      $optContainer.addClass(`acu-theme-${config.theme}`);\n      $optContainer.css(cssVars);\n    }\n  };\n\n  const addStyles = () => {\n    const _styleStart = performance.now();\n    if (window._acuStylesInjected && $(`#${SCRIPT_ID}-styles`).length) return;\n    window._acuStylesInjected = true;\n    const { $ } = getCore();\n    $('style').each(function () {\n      if (this.id && this.id.startsWith('acu_') && this.id.endsWith('-styles') && this.id !== `${SCRIPT_ID}-styles`)\n        $(this).remove();\n    });\n    $(`#${SCRIPT_ID}-styles`).remove();\n    const styles = `\n        <style id=\"${SCRIPT_ID}-styles\">\n    /* ==========  ========== */\n    .acu-wrapper,\n    .acu-wrapper *:not(i[class*=\"fa-\"]),\n    .acu-edit-overlay,\n    .acu-edit-overlay *:not(i[class*=\"fa-\"]),\n    .acu-cell-menu,\n    .acu-cell-menu *:not(i[class*=\"fa-\"]),\n    .acu-dice-panel,\n    .acu-dice-panel *:not(i[class*=\"fa-\"]),\n    .acu-contest-panel,\n    .acu-contest-panel *:not(i[class*=\"fa-\"]),\n    .acu-relation-graph-overlay,\n    .acu-relation-graph-overlay *:not(i[class*=\"fa-\"]),\n    .acu-avatar-manager-overlay,\n    .acu-avatar-manager-overlay *:not(i[class*=\"fa-\"]),\n    .acu-preview-overlay,\n    .acu-preview-overlay *:not(i[class*=\"fa-\"]),\n    .acu-import-confirm-overlay,\n    .acu-import-confirm-overlay *:not(i[class*=\"fa-\"]),\n    .acu-embedded-options-container,\n    .acu-embedded-options-container *:not(i[class*=\"fa-\"]) {\n        box-sizing: border-box;\n        -webkit-tap-highlight-color: transparent;\n        -webkit-font-smoothing: antialiased;\n    }\n    /* ==========  ========== */\n    .acu-wrapper,\n    .acu-edit-overlay,\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-relation-graph-overlay,\n    .acu-avatar-manager-overlay,\n    .acu-preview-overlay,\n    .acu-import-confirm-overlay,\n    .acu-embedded-options-container,\n    .acu-cell-menu {\n        font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;\n        font-size: 13px;\n        line-height: 1.5;\n        color: var(--acu-text-main);\n    }\n    /*  ( !important  SillyTavern ) */\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-dice-config-dialog {\n        background: var(--acu-bg-panel);\n        color: var(--acu-text-main);\n    }\n    .acu-dice-panel input[type=\"text\"],\n    .acu-dice-panel input[type=\"number\"],\n    .acu-dice-panel input:not([type]),\n    .acu-dice-panel select,\n    .acu-contest-panel input[type=\"text\"],\n    .acu-contest-panel input[type=\"number\"],\n    .acu-contest-panel input:not([type]),\n    .acu-contest-panel select,\n    .acu-dice-config-dialog input[type=\"text\"],\n    .acu-dice-config-dialog input[type=\"number\"],\n    .acu-dice-config-dialog input:not([type]),\n    .acu-dice-config-dialog select {\n        width: 100%;\n        padding: 6px;\n        background: var(--acu-input-bg) !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 4px;\n        color: var(--acu-text-main) !important;\n        font-size: 12px;\n        text-align: center;\n        box-sizing: border-box;\n    }\n    .acu-dice-panel input::placeholder,\n    .acu-contest-panel input::placeholder,\n    .acu-dice-config-dialog input::placeholder {\n        color: var(--acu-text-sub) !important;\n        opacity: 0.7;\n    }\n    .acu-dice-panel input:focus,\n    .acu-dice-panel select:focus,\n    .acu-contest-panel input:focus,\n    .acu-contest-panel select:focus,\n    .acu-dice-config-dialog input:focus,\n    .acu-dice-config-dialog select:focus {\n        outline: none;\n        border-color: var(--acu-accent) !important;\n    }\n    .acu-dice-panel select option,\n    .acu-contest-panel select option,\n    .acu-dice-config-dialog select option {\n        background: var(--acu-bg-panel);\n        color: var(--acu-text-main);\n    }\n    /*  */\n    .acu-dice-select {\n        width: 100%;\n        padding: 6px 4px;\n        background: var(--acu-input-bg) !important;\n        border: 1px solid var(--acu-border) !important;\n        border-radius: 4px;\n        color: var(--acu-text-main) !important;\n        font-size: 11px;\n        box-sizing: border-box;\n        cursor: pointer;\n        -webkit-appearance: none;\n        appearance: none;\n    }\n    .acu-dice-select:focus {\n        outline: none;\n        border-color: var(--acu-accent) !important;\n    }\n    .acu-dice-select option {\n        background: var(--acu-bg-panel) !important;\n        color: var(--acu-text-main) !important;\n    }\n    /*  */\n    .acu-wrapper .acu-search-input {\n        background-color: var(--acu-input-bg) !important;\n        color: var(--acu-text-main) !important;\n        border: 1px solid var(--acu-border);\n    }\n    .acu-wrapper .acu-search-input:focus {\n        outline: none;\n        border-color: var(--acu-accent);\n        box-shadow: none !important;\n    }\n    .acu-wrapper .acu-search-input::placeholder {\n        color: var(--acu-text-sub) !important;\n        opacity: 0.7;\n    }\n    /* ==========  ========== */\n    /*  */\n    .acu-wrapper button,\n    .acu-edit-overlay button,\n    .acu-dice-panel button,\n    .acu-contest-panel button,\n    .acu-relation-graph-overlay button,\n    .acu-avatar-manager-overlay button,\n    .acu-preview-overlay button,\n    .acu-embedded-options-container button {\n        font-family: inherit;\n        font-size: inherit;\n        line-height: 1.4;\n        cursor: pointer;\n        border: 1px solid var(--acu-border);\n        border-radius: 6px;\n        background: var(--acu-btn-bg);\n        color: var(--acu-text-main);\n        transition: all 0.2s ease;\n        outline: none;\n    }\n    .acu-wrapper button:hover,\n    .acu-edit-overlay button:hover,\n    .acu-dice-panel button:hover,\n    .acu-contest-panel button:hover,\n    .acu-relation-graph-overlay button:hover,\n    .acu-avatar-manager-overlay button:hover,\n    .acu-preview-overlay button:hover,\n    .acu-embedded-options-container button:hover {\n        background: var(--acu-btn-hover);\n    }\n    .acu-wrapper button:focus,\n    .acu-edit-overlay button:focus,\n    .acu-dice-panel button:focus,\n    .acu-contest-panel button:focus,\n    .acu-relation-graph-overlay button:focus,\n    .acu-avatar-manager-overlay button:focus,\n    .acu-preview-overlay button:focus,\n    .acu-embedded-options-container button:focus {\n        outline: none;\n        box-shadow: none;\n    }\n\n    /*  */\n    .acu-wrapper input,\n    .acu-wrapper textarea,\n    .acu-wrapper select,\n    .acu-edit-overlay input,\n    .acu-edit-overlay textarea,\n    .acu-edit-overlay select,\n    .acu-dice-panel input,\n    .acu-dice-panel select,\n    .acu-contest-panel input,\n    .acu-contest-panel select,\n    .acu-avatar-manager-overlay input {\n        font-family: inherit;\n        font-size: inherit;\n        line-height: 1.4;\n        border: 1px solid var(--acu-border);\n        border-radius: 4px;\n        background: var(--acu-btn-bg);\n        color: var(--acu-text-main);\n        outline: none;\n        transition: border-color 0.2s;\n    }\n    .acu-wrapper input:focus,\n    .acu-wrapper textarea:focus,\n    .acu-wrapper select:focus,\n    .acu-edit-overlay input:focus,\n    .acu-edit-overlay textarea:focus,\n    .acu-edit-overlay select:focus,\n    .acu-dice-panel input:focus,\n    .acu-dice-panel select:focus,\n    .acu-contest-panel input:focus,\n    .acu-contest-panel select:focus,\n    .acu-avatar-manager-overlay input:focus {\n        border-color: var(--acu-accent);\n        box-shadow: none;\n        outline: none;\n    }\n    .acu-wrapper input::placeholder,\n    .acu-wrapper textarea::placeholder,\n    .acu-dice-panel input::placeholder,\n    .acu-contest-panel input::placeholder,\n    .acu-avatar-manager-overlay input::placeholder {\n        color: var(--acu-text-sub);\n        opacity: 0.7;\n    }\n\n    /*  */\n    .acu-edit-overlay,\n    .acu-dice-overlay,\n    .acu-contest-overlay,\n    .acu-relation-graph-overlay,\n    .acu-avatar-manager-overlay,\n    .acu-preview-overlay,\n    .acu-import-confirm-overlay,\n    .acu-dice-config-overlay,\n    .acu-crop-modal-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        width: 100vw;\n        height: 100vh;\n        background: rgba(0,0,0,0.6);\n        z-index: 2147483646;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 16px;\n        backdrop-filter: blur(2px);\n    }\n\n    /*  */\n    .acu-edit-dialog,\n    .acu-dice-panel,\n    .acu-contest-panel,\n    .acu-relation-graph-container,\n    .acu-avatar-manager,\n    .acu-preview-card,\n    .acu-import-confirm-dialog,\n    .acu-dice-config-dialog {\n        background: var(--acu-bg-panel);\n        border: 1px solid var(--acu-border);\n        border-radius: 12px;\n        box-shadow: 0 20px 60px rgba(0,0,0,0.4);\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n    }\n\n    /*  -  .acu-panel-header */\n    .acu-panel-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        padding: 12px 15px;\n        background: var(--acu-table-head);\n        border-bottom: 1px solid var(--acu-border);\n        flex-shrink: 0;\n    }\n\n    /*  -  .acu-close-btn */\n    .acu-close-btn {\n        background: none;\n        border: none;\n        color: var(--acu-text-sub);\n        cursor: pointer;\n        font-size: 16px;\n        padding: 4px 8px;\n        border-radius: 4px;\n        transition: all 0.2s;\n    }\n    .acu-close-btn:hover {\n        background: rgba(231, 76, 60, 0.15);\n        color: #e74c3c;\n    }\n\n    /*  */\n    [class^=\"acu-\"], [class^=\"acu-\"] * { scrollbar-width: none; -ms-overflow-style: none; }\n    [class^=\"acu-\"] *::-webkit-scrollbar { display: none !important; }\n\n    /* ==========  ========== */\n    .acu-theme-retro { --acu-bg-nav: #e6e2d3; --acu-bg-panel: #e6e2d3; --acu-border: #dcd0c0; --acu-text-main: #5e4b35; --acu-text-sub: #999; --acu-btn-bg: #dcd0c0; --acu-btn-hover: #cbbba8; --acu-btn-active-bg: #8d7b6f; --acu-btn-active-text: #fdfaf5; --acu-accent: #7a695f; --acu-table-head: #efebe4; --acu-table-hover: #f0ebe0; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #fffef9; --acu-badge-bg: #efebe4; --acu-menu-bg: #fff; --acu-menu-text: #333; --acu-success-text: #27ae60; --acu-success-bg: rgba(39, 174, 96, 0.15); --acu-scrollbar-track: #e6e2d3; --acu-scrollbar-thumb: #cbbba8; --acu-input-bg: #f5f2eb;--acu-hl-manual: #d35400; --acu-hl-manual-bg: rgba(211, 84, 0, 0.15); --acu-hl-diff: #2980b9; --acu-hl-diff-bg: rgba(41, 128, 185, 0.15); }\n    .acu-theme-dark { --acu-bg-nav: #2b2b2b; --acu-bg-panel: #252525; --acu-border: #444; --acu-text-main: #eee; --acu-text-sub: #aaa; --acu-btn-bg: #3a3a3a; --acu-btn-hover: #4a4a4a; --acu-btn-active-bg: #6a5acd; --acu-btn-active-text: #fff; --acu-accent: #9b8cd9; --acu-table-head: #333333; --acu-table-hover: #3a3a3a; --acu-shadow: rgba(0,0,0,0.6); --acu-card-bg: #2d3035; --acu-badge-bg: #3a3f4b; --acu-menu-bg: #333; --acu-menu-text: #eee; --acu-success-text: #4cd964; --acu-success-bg: rgba(76, 217, 100, 0.2); --acu-scrollbar-track: #2b2b2b; --acu-scrollbar-thumb: #555; --acu-hl-manual: #ff6b81; --acu-hl-manual-bg: rgba(255, 107, 129, 0.2); --acu-hl-diff: #00d2d3; --acu-hl-diff-bg: rgba(0, 210, 211, 0.2); }\n    .acu-theme-modern { --acu-bg-nav: #ffffff; --acu-bg-panel: #f8f9fa; --acu-border: #e0e0e0; --acu-text-main: #333; --acu-text-sub: #666; --acu-btn-bg: #f1f3f5; --acu-btn-hover: #e9ecef; --acu-btn-active-bg: #007bff; --acu-btn-active-text: #fff; --acu-accent: #007bff; --acu-table-head: #f8f9fa; --acu-table-hover: #f1f3f5; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #f1f3f5; --acu-menu-bg: #fff; --acu-menu-text: #333; --acu-success-text: #28a745; --acu-success-bg: rgba(40, 167, 69, 0.15); --acu-scrollbar-track: #fff; --acu-scrollbar-thumb: #ccc; --acu-hl-manual: #fd7e14; --acu-hl-manual-bg: rgba(253, 126, 20, 0.15); --acu-hl-diff: #0d6efd; --acu-hl-diff-bg: rgba(13, 110, 253, 0.15); }\n    .acu-theme-forest { --acu-bg-nav: #e8f5e9; --acu-bg-panel: #e8f5e9; --acu-border: #c8e6c9; --acu-text-main: #2e7d32; --acu-text-sub: #81c784; --acu-btn-bg: #c8e6c9; --acu-btn-hover: #a5d6a7; --acu-btn-active-bg: #43a047; --acu-btn-active-text: #fff; --acu-accent: #4caf50; --acu-table-head: #dcedc8; --acu-table-hover: #f1f8e9; --acu-shadow: rgba(0,0,0,0.1); --acu-card-bg: #ffffff; --acu-badge-bg: #dcedc8; --acu-menu-bg: #fff; --acu-menu-text: #2e7d32; --acu-success-text: #2e7d32; --acu-success-bg: rgba(46, 125, 50, 0.2); --acu-scrollbar-track: #e8f5e9; --acu-scrollbar-thumb: #a5d6a7; --acu-hl-manual: #e67e22; --acu-hl-manual-bg: rgba(230, 126, 34, 0.15); --acu-hl-diff: #1e8449; --acu-hl-diff-bg: rgba(30, 132, 73, 0.2); }\n    .acu-theme-ocean { --acu-bg-nav: #e3f2fd; --acu-bg-panel: #e3f2fd; --acu-border: #bbdefb; --acu-text-main: #1565c0; --acu-text-sub: #64b5f6; --acu-btn-bg: #bbdefb; --acu-btn-hover: #90caf9; --acu-btn-active-bg: #1976d2; --acu-btn-active-text: #fff; --acu-accent: #2196f3; --acu-table-head: #bbdefb; --acu-table-hover: #e1f5fe; --acu-shadow: rgba(0,0,0,0.15); --acu-card-bg: #ffffff; --acu-badge-bg: #e3f2fd; --acu-menu-bg: #fff; --acu-menu-text: #1565c0; --acu-success-text: #0288d1; --acu-success-bg: rgba(2, 136, 209, 0.15); --acu-scrollbar-track: #e3f2fd; --acu-scrollbar-thumb: #90caf9; --acu-hl-manual: #ff4757; --acu-hl-manual-bg: rgba(255, 71, 87, 0.15); --acu-hl-diff: #0277bd; --acu-hl-diff-bg: rgba(2, 119, 189, 0.2); }\n    .acu-theme-cyber { --acu-bg-nav: #000000; --acu-bg-panel: #0a0a0a; --acu-border: #333; --acu-text-main: #00ffcc; --acu-text-sub: #ff00ff; --acu-btn-bg: #111; --acu-btn-hover: #222; --acu-btn-active-bg: #ff00ff; --acu-btn-active-text: #fff; --acu-accent: #00ffcc; --acu-table-head: #050505; --acu-table-hover: #111; --acu-shadow: 0 0 15px rgba(0,255,204,0.15); --acu-card-bg: #050505; --acu-badge-bg: #1a1a1a; --acu-menu-bg: #111; --acu-menu-text: #00ffcc; --acu-success-text: #0f0; --acu-success-bg: rgba(0, 255, 0, 0.15); --acu-scrollbar-track: #000; --acu-scrollbar-thumb: #333; --acu-hl-manual: #ff9f43; --acu-hl-manual-bg: rgba(255, 159, 67, 0.2); --acu-hl-diff: #0abde3; --acu-hl-diff-bg: rgba(10, 189, 227, 0.2); }\n    .acu-theme-cyber .acu-nav-btn { border-color: #222; }\n    .acu-theme-cyber .acu-data-card { border-color: #222; }\n    .acu-theme-nightowl { --acu-bg-nav: #0a2133; --acu-bg-panel: #011627; --acu-border: #132e45; --acu-text-main: #e0e6f2; --acu-text-sub: #a6b8cc; --acu-btn-bg: #1f3a52; --acu-btn-hover: #2a4a68; --acu-btn-active-bg: #7fdbca; --acu-btn-active-text: #011627; --acu-accent: #7fdbca; --acu-table-head: #0a2133; --acu-table-hover: #01294a; --acu-shadow: rgba(0,0,0,0.5); --acu-card-bg: #0a2133; --acu-badge-bg: #1f3a52; --acu-menu-bg: #011627; --acu-menu-text: #e0e6f2; --acu-success-text: #addb67; --acu-success-bg: rgba(173, 219, 103, 0.15); --acu-scrollbar-track: #011627; --acu-scrollbar-thumb: #1f3a52; --acu-hl-manual: #ff8f66; --acu-hl-manual-bg: rgba(255, 143, 102, 0.2); --acu-hl-diff: #82aaff; --acu-hl-diff-bg: rgba(130, 170, 255, 0.2); }\n    /*  */\n    .acu-theme-cyber .acu-btn-confirm,\n    .acu-theme-cyber .acu-changes-count,\n    .acu-theme-nightowl .acu-btn-confirm,\n    .acu-theme-nightowl .acu-changes-count {\n        color: #111 !important;\n    }\n    .acu-wrapper { position: relative; width: 100%; margin: 15px 0; z-index: 2147483640 !important; font-family: 'Microsoft YaHei', sans-serif; display: flex; flex-direction: column-reverse; }\n    .acu-wrapper.acu-mode-embedded { position: relative !important; width: 100% !important; margin-top: 8px !important; z-index: 2147483641 !important; clear: both; display: flex; flex-direction: column-reverse !important; padding: 0; }\n    .acu-wrapper.acu-mode-embedded .acu-nav-container { position: relative !important; z-index: 2147483642 !important; }\n    .acu-wrapper.acu-mode-embedded .acu-data-display { position: absolute !important; bottom: 100% !important; left: 0 !important; right: 0 !important; width: 100% !important; box-shadow: 0 -10px 30px rgba(0,0,0,0.25) !important; border: 1px solid var(--acu-border); margin-bottom: 5px; z-index: 2147483647 !important; max-height: 70vh !important; overflow-y: auto !important; }\n    .acu-nav-container { display: grid; grid-template-columns: repeat(var(--acu-grid-cols, 3), 1fr); gap: 4px; padding: 6px; background: var(--acu-bg-nav); border: 1px solid var(--acu-border); border-radius: 10px; align-items: center; box-shadow: 0 2px 6px var(--acu-shadow); position: relative; z-index: 2147483641 !important; }\n    .acu-nav-btn { touch-action: manipulation; -webkit-tap-highlight-color: transparent; width: 100%; display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 3px; padding: 4px 2px; border: 1px solid transparent; border-radius: 6px; background: var(--acu-btn-bg); color: var(--acu-text-main); font-weight: 600; font-size: 11px; cursor: pointer; transition: all 0.2s ease; user-select: none; overflow: hidden; height: 28px; }\n    .acu-nav-btn span { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; margin-top: 1px; }\n    .acu-nav-btn:hover { background: var(--acu-btn-hover); transform: translateY(-2px); }\n    .acu-nav-btn:focus, .acu-nav-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--acu-accent) !important; }\n    /* []  */\n/* --- 1.  --- */\n.acu-height-control {\n    display: flex;\n    align-items: center;\n    margin-right: 8px;\n    cursor: ns-resize;\n    padding: 4px;\n    border-radius: 4px;\n    color: var(--acu-text-sub);\n    transition: all 0.2s;\n    /*  */\n    touch-action: none;\n}\n\n/*  */\n.acu-height-control:hover, .acu-height-control.active {\n    color: var(--acu-accent);\n    background: var(--acu-table-hover);\n}\n\n/* --- 2. []  --- */\n.acu-height-drag-handle {\n    cursor: ns-resize;\n    /*  */\n    touch-action: none;\n}\n\n            /*  */\n            .acu-view-btn { background: transparent !important; border: none; color: var(--acu-text-main) !important; cursor: pointer; padding: 4px; margin-right: 5px; font-size: 14px; opacity: 0.7; }\n            .acu-view-btn:hover { opacity: 1; color: var(--acu-accent) !important; background: var(--acu-table-hover) !important; border-radius: 4px; }\n            .acu-view-btn.acu-reverse-btn.active, .acu-reverse-btn[data-reversed=\"true\"] { color: var(--acu-accent) !important; opacity: 1; }\n            /* Grid  () */\n            .acu-card-body.view-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; }\n            /*  Grid  Flex  */\n.acu-card-body.view-grid .acu-card-row { display: flex; height: auto !important; min-height: fit-content; border: 1px solid var(--acu-border); border-radius: 6px; padding: 4px 6px; flex-direction: column !important; align-items: flex-start !important; background: rgba(0,0,0,0.02); box-sizing: border-box; }\n            .acu-card-body.view-grid .acu-card-row.acu-grid-span-full { grid-column: 1 / -1; }\n            .acu-card-body.view-grid .acu-card-label { width: 100% !important; font-size: 0.85em; opacity: 0.8; margin-bottom: 2px; }\n            .acu-card-body.view-grid .acu-card-value { width: 100% !important; }\n\n            /* List  ( - ) */\n            .acu-nav-btn.active { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); box-shadow: inset 0 1px 3px rgba(0,0,0,0.2); outline: none; border-color: transparent; }\n            .acu-nav-btn.active:hover { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); transform: none; }\n            .acu-nav-btn.active:focus, .acu-nav-btn.active:focus-visible { outline: none; box-shadow: inset 0 1px 3px rgba(0,0,0,0.2) !important; }\n            .acu-nav-btn.has-validation-errors { border-color: rgba(231, 76, 60, 0.5); }\n            .acu-nav-btn .acu-nav-warning-icon { color: #e74c3c; font-size: 10px; margin-left: 2px; animation: pulse 1.5s infinite; }\n            @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }\n            .acu-action-btn { flex: 1; height: 36px; display: flex; align-items: center; justify-content: center; background: var(--acu-btn-bg); border-radius: 8px; color: var(--acu-text-sub); cursor: pointer; border: 1px solid transparent; transition: all 0.2s; margin: 0; }\n            .acu-action-btn:hover { background: var(--acu-btn-hover); color: var(--acu-text-main); transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }\n            .acu-action-btn:focus, .acu-action-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--acu-accent) !important; }\n            #acu-btn-save-global { color: var(--acu-btn-active-bg); } #acu-btn-save-global:hover { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); }\n\n            .acu-data-display { position: absolute; bottom: calc(100% + 10px); left: 0; right: 0; max-height: 80vh; height: auto; background: var(--acu-bg-panel); border: 1px solid var(--acu-border); border-radius: 8px; box-shadow: 0 8px 30px var(--acu-shadow); display: none; flex-direction: column; z-index: 2147483642 !important; animation: popUp 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28); }\n            .acu-data-display.visible { display: flex; }\n            @keyframes popUp { from { opacity: 0; transform: translateY(10px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }\n            @keyframes highlightFlash { 0%, 100% { box-shadow: none; } 50% { box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.6); } }\n            .acu-highlight-flash { animation: highlightFlash 0.5s ease-in-out 3; }\n\n            .acu-panel-header { flex: 0 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--acu-table-head); border-bottom: 1px dashed var(--acu-border); border-radius: 8px 8px 0 0; }\n            /*  flex: 1  min-width: 0 */\n/* ---  --- */\n.acu-panel-title {\n    display: flex;\n    flex-direction: column; /*  */\n    justify-content: center;\n    align-items: flex-start;\n    flex: 1; /*  */\n    min-width: 0; /*  */\n    margin-right: 8px;\n    overflow: hidden;\n}\n\n/*  () */\n.acu-title-main {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    width: 100%;\n    font-size: 13px; /*  */\n    font-weight: bold;\n    color: var(--acu-text-main);\n    line-height: 1.2;\n}\n\n/*  () */\n.acu-title-text {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/*  () */\n.acu-title-sub {\n    font-size: 10px;\n    color: var(--acu-text-sub);\n    font-weight: normal;\n    opacity: 0.8;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    width: 100%;\n    line-height: 1.2;\n    margin-top: 1px;\n}\n            /*  flex-shrink: 0;  */\n/* flex-shrink: 0  */\n.acu-header-actions { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }\n            .acu-search-wrapper { position: relative; display: flex; align-items: center; }\n            .acu-wrapper input.acu-search-input { background: var(--acu-btn-bg) !important; border: 1px solid var(--acu-border) !important; color: var(--acu-text-main) !important; padding: 4px 8px 4px 24px; border-radius: 12px; font-size: 12px; width: 120px; transition: width 0.2s, border-color 0.2s; }\n            .acu-wrapper input.acu-search-input::placeholder { color: var(--acu-text-sub) !important; opacity: 0.7; }\n            .acu-wrapper input.acu-search-input:focus { width: 160px; outline: none !important; border-color: var(--acu-accent) !important; box-shadow: none !important; }\n            .acu-search-input::placeholder { color: var(--acu-text-sub) ; opacity: 0.7; }\n            .acu-search-icon { position: absolute; left: 8px; font-size: 10px; color: var(--acu-text-sub); pointer-events: none; }\n            /*  min-width  flex-shrink: 0 */\n            .acu-panel-content { flex: 1; overflow-x: auto; overflow-y: hidden; padding: 15px; background: transparent; scrollbar-width: thin; scrollbar-color: var(--acu-scrollbar-thumb) var(--acu-scrollbar-track); overscroll-behavior-x: contain; overscroll-behavior-y: auto; touch-action: pan-x pan-y; -webkit-overflow-scrolling: touch; }\n            /*  height: 100%;  */\n.acu-card-grid { display: flex; flex-wrap: nowrap; gap: 12px; align-items: flex-start; }\n            .acu-layout-vertical .acu-panel-content { overflow-x: hidden !important; overflow-y: auto !important; overscroll-behavior: auto; touch-action: manipulation; min-height: 0; }\n            /*  auto  */\n.acu-layout-vertical .acu-card-grid { flex-wrap: wrap !important; justify-content: center; padding-bottom: 20px; height: auto; }\n.acu-wrapper:not(.acu-layout-vertical) .acu-manual-mode .acu-card-grid { height: 100%; } .acu-manual-mode .acu-data-card { max-height: 100% !important; overscroll-behavior-y: auto; } .acu-data-card { flex: 0 0 var(--acu-card-width, 260px); width: var(--acu-card-width, 260px); background: var(--acu-card-bg); border: 1px solid var(--acu-border); border-radius: 8px; height: auto; max-height: 60vh; overflow-y: auto; overscroll-behavior-y: auto; touch-action: manipulation; transition: all 0.2s ease; display: flex; flex-direction: column; position: relative; }\n            .acu-data-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--acu-shadow); border-color: var(--acu-accent); }\n            .acu-data-card.pending-deletion { opacity: 0.6; border: 1px dashed #e74c3c; }\n            .acu-data-card.pending-deletion::after { content: \"\"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); color: #e74c3c; font-size: 24px; font-weight: bold; border: 2px solid #e74c3c; padding: 5px 10px; border-radius: 8px; opacity: 0.8; pointer-events: none; }\n            @keyframes pulse-highlight { 0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; } }\n            .acu-highlight-manual { color: var(--acu-hl-manual) !important; background-color: var(--acu-hl-manual-bg) !important; border-radius: 4px; padding: 0 4px; font-weight: bold; animation: pulse-highlight 2s infinite; display: inline-block; }\n            .acu-highlight-diff { color: var(--acu-hl-diff) !important; background-color: var(--acu-hl-diff-bg) !important; border-radius: 4px; padding: 0 4px; font-weight: bold; animation: pulse-highlight 2s infinite; display: inline-block; }\n            .acu-editable-title.acu-highlight-manual, .acu-editable-title.acu-highlight-diff { width: auto; display: inline-block; }\n            .acu-card-header { flex: 0 0 auto; padding: 8px 10px; background: var(--acu-table-head); border-bottom: 1px dashed var(--acu-border); font-weight: bold; color: var(--acu-text-main); font-size: 14px; display: flex; flex-direction: row !important; align-items: center !important; justify-content: flex-start !important; gap: 8px; min-height: 40px; height: auto !important; }\n            .acu-editable-title { flex: 1; width: auto !important; cursor: pointer; border-bottom: 1px dashed transparent; transition: all 0.2s; white-space: pre-wrap !important; overflow: visible !important; word-break: break-word !important; text-align: center; line-height: 1.3; margin: 0; }\n            .acu-editable-title:hover { border-bottom-color: var(--acu-accent); color: var(--acu-accent); }\n            .acu-card-index { position: static !important; transform: none !important; margin: 0; flex-shrink: 0; font-size: 11px; color: var(--acu-text-sub); font-weight: normal; background: var(--acu-badge-bg); padding: 2px 6px; border-radius: 4px; }\n            .acu-card-body { padding: 6px 12px; display: flex; flex-direction: column; gap: 0; font-size: var(--acu-font-size, 13px); flex: 1; }\n            .acu-card-row { display: block; padding: 6px 0; border-bottom: 1px dashed var(--acu-border); cursor: pointer; overflow: hidden; }\n            .acu-card-row:last-child { border-bottom: none; }\n            .acu-card-actions { display: flex; flex-wrap: wrap; gap: 6px; padding: 8px 10px; border-top: 1px dashed var(--acu-border); background: var(--acu-table-head); }\n            .acu-action-item { padding: 4px 10px; font-size: 11px; border: 1px solid var(--acu-border); border-radius: 4px; background: var(--acu-btn-bg); color: var(--acu-text-main); cursor: pointer; display: flex; align-items: center; gap: 4px; transition: all 0.15s; white-space: nowrap; }\n            .acu-action-item:hover { background: var(--acu-btn-hover); border-color: var(--acu-accent); color: var(--acu-accent); transform: translateY(-1px); }\n            .acu-action-item:active { transform: translateY(0); }\n            .acu-action-item.check-type { border-style: dashed; }\n            .acu-action-item i { font-size: 10px; opacity: 0.7; }\n            .acu-card-row:hover { background: var(--acu-table-hover); }\n            .acu-card-label { float: left !important; clear: left; width: auto !important; margin-right: 8px !important; color: var(--acu-text-sub); font-size: 0.9em; line-height: 1.5; padding-top: 0; }\n            .acu-hide-label .acu-card-label { display: none; }\n            .acu-hide-label .acu-card-value { width: 100% !important; }\n            .acu-inline-dice-btn:hover { opacity: 1 !important; transform: scale(1.2); }\n            .acu-card-value { display: block; width: auto !important; margin: 0; text-align: left !important; word-break: break-all !important; white-space: pre-wrap !important; line-height: 1.5 !important; color: var(--acu-text-main); font-size: 1em; }\n            .acu-tag-container { display: flex; flex-wrap: wrap; gap: 4px; align-items: center; margin-top: 2px; }\n            .acu-multi-attr-container { display: grid; grid-template-columns: 1fr 1fr; gap: 2px 8px; }\n            .acu-badge { display: inline-block; padding: 1px 8px; border-radius: 12px; font-size: 0.9em; font-weight: 500; line-height: 1.2; }\n            .acu-badge-green { background: var(--acu-success-bg); color: var(--acu-success-text); }\n            .acu-badge-neutral { background: var(--acu-badge-bg); color: var(--acu-text-main); border: 1px solid var(--acu-border); }\n            .acu-panel-footer { flex: 0 0 auto; padding: 8px; border-top: 1px dashed var(--acu-border); background: var(--acu-table-head); display: flex; justify-content: center; align-items: center; gap: 5px; flex-wrap: wrap; }\n            .acu-page-btn { padding: 4px 10px; min-width: 32px; height: 28px; border-radius: 4px; border: 1px solid var(--acu-border); background: var(--acu-btn-bg); color: var(--acu-text-main); cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }\n            .acu-page-btn:hover:not(.disabled):not(.active) { background: var(--acu-btn-hover); transform: translateY(-1px); }\n            .acu-page-btn.active { background: var(--acu-accent); color: #fff; border-color: var(--acu-accent); font-weight: bold; }\n            .acu-page-btn.disabled { opacity: 0.5; cursor: not-allowed; }\n            .acu-page-info { font-size: 12px; color: var(--acu-text-sub); margin: 0 10px; }\n            /* --- []  --- */\n            /*  Flex Column  */\n            /* --- []  --- */\n            .acu-option-panel {\n                display: flex;\n                flex-direction: column;\n                gap: 2px;                 /*  */\n                padding: 4px;             /*  */\n                background: var(--acu-bg-nav);\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;       /*  */\n                margin-top: 0;\n                margin-bottom: 4px;\n                backdrop-filter: blur(5px);\n                width: 100%;\n                box-sizing: border-box;\n                z-index: 2147483641;\n                animation: acuFadeIn 0.3s ease;\n            }\n\n            .acu-embedded-options-container {\n                width: 100%;\n                max-width: 100%;\n                margin-top: 6px;\n                clear: both;\n                animation: acuFadeIn 0.3s ease;\n            }\n\n            .acu-opt-header {\n                text-align: center;\n                font-size: 10px;          /*  */\n                font-weight: bold;\n                color: var(--acu-text-sub);\n                padding-bottom: 2px;\n                border-bottom: 1px dashed var(--acu-border);\n                margin-bottom: 2px;\n            }\n\n            /* --- []  --- */\n            .acu-opt-btn {\n                background: var(--acu-btn-bg);\n                border: 1px solid transparent; /*  */\n                padding: 3px 6px;              /*  */\n                border-radius: 4px;\n                cursor: pointer;\n                color: var(--acu-text-main);\n                font-size: var(--acu-opt-font-size, 12px) !important; /* []  */\n                transition: all 0.15s;\n                font-weight: normal;           /*  */\n                text-align: left;              /*  */\n                white-space: pre-wrap;\n                word-break: break-word;\n                min-height: 22px;              /*  */\n                line-height: 1.3;\n                display: flex;\n                align-items: center;\n                justify-content: flex-start;\n                opacity: 0.9;\n            }\n\n            .acu-opt-btn:hover {\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent); /*  */\n                transform: translateX(3px);      /*  */\n                opacity: 1;\n            }\n            .acu-opt-btn:active { background: var(--acu-btn-active-bg); color: var(--acu-btn-active-text); }\n            @keyframes acuFadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }\n\n            .acu-menu-backdrop { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: transparent; z-index: 2147483645 !important; }\n            /* 1.  */\n.acu-cell-menu {\n    position: fixed !important;\n    background: var(--acu-menu-bg) !important;\n    border: 1px solid var(--acu-border);\n    box-shadow: 0 6px 20px var(--acu-shadow) !important;\n    z-index: 2147483647 !important;\n    border-radius: 8px;\n    overflow: hidden;\n    min-width: 150px;\n    color: var(--acu-menu-text);\n}\n\n/* 2.  */\n.acu-cell-menu-item {\n    padding: 12px 16px;\n    cursor: pointer;\n    font-size: 14px;\n    display: flex;\n    gap: 12px;\n    align-items: center;\n    color: var(--acu-menu-text);\n    font-weight: 500;\n    background: transparent;\n    transition: background 0.2s;\n}\n\n/* 3.  */\n.acu-cell-menu-item:hover {\n    background: var(--acu-table-hover);\n}\n\n/* 4.  */\n            .acu-cell-menu-item#act-delete { color: #e74c3c; }\n            .acu-cell-menu-item#act-delete:hover { background: rgba(231, 76, 60, 0.1); } /*  */\n            .acu-cell-menu-item#act-close { border-top: 1px dashed var(--acu-border); color: var(--acu-text-sub); }\n            .acu-edit-overlay { position: fixed !important; top: 0; left: 0; right: 0; bottom: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.75) !important; z-index: 2147483646 !important; display: flex; justify-content: center !important; align-items: center !important; backdrop-filter: blur(2px); }\n            .acu-edit-dialog { background: var(--acu-bg-panel); width: 95%; max-width: 500px; max-height: 95vh; padding: 16px; border-radius: 12px; display: flex; flex-direction: column; gap: 10px; box-shadow: 0 15px 50px rgba(0,0,0,0.6); color: var(--acu-text-main); border: 1px solid var(--acu-border); overflow: hidden; flex-shrink: 0; }\n            @media (min-width: 768px) { .acu-edit-dialog { max-width: 900px; width: 90%; } .acu-edit-dialog.acu-settings-dialog { max-width: 400px; width: 400px; } }\n            .acu-edit-title { margin: 0; font-size: 16px; font-weight: bold; color: var(--acu-text-main); padding-bottom: 8px; border-bottom: 1px solid var(--acu-border); }\n            .acu-edit-textarea { width: 100%; height: auto; padding: 12px; border: 1px solid var(--acu-border) !important; background: var(--acu-input-bg) !important; color: var(--acu-text-main) !important; border-radius: 6px; resize: vertical; box-sizing: border-box; font-size: 14px; line-height: 1.6; overflow-y: auto !important; }\n            .acu-edit-textarea:focus { outline: none; border-color: var(--acu-accent) !important; }\n            .acu-edit-textarea::placeholder { color: var(--acu-text-sub) !important; opacity: 0.7; }\n            @media (min-width: 768px) { .acu-edit-textarea { height: auto !important; font-size: 15px !important; } }\n            .acu-edit-textarea:focus { outline: 1px solid #aaa; }\n            .acu-dialog-btns { display: flex; justify-content: flex-end; gap: 20px; margin-top: 10px; }\n            .acu-dialog-btn { background: none; border: none; cursor: pointer; font-size: 14px; font-weight: bold; display: flex; align-items: center; gap: 6px; color: var(--acu-text-sub); transition: color 0.2s; }\n            .acu-dialog-btn:hover { color: var(--acu-text-main); } .acu-btn-confirm { color: var(--acu-success-text); } .acu-btn-confirm:hover { opacity: 0.8; }\n            /* --- [UI Optimization] PC-First Edit Mode Styles --- */\n            .acu-order-controls { grid-column: 1 / -1; order: -2; display: none; width: 100%; text-align: left; background: var(--acu-accent); color: #fff; padding: 6px 12px; margin: 0 0 8px 0; border-radius: 4px; font-weight: bold; font-size: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }\n            .acu-order-controls.visible { display: flex; align-items: center; justify-content: space-between; }\n\n            .acu-nav-container.editing-order { border: 2px solid var(--acu-accent); background: var(--acu-bg-panel); }\n            .acu-nav-container.editing-order .acu-nav-btn, .acu-nav-container.editing-order .acu-action-btn { opacity: 1 !important; cursor: grab !important; border: 1px solid var(--acu-border); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }\n            .acu-nav-container.editing-order .acu-nav-btn:hover, .acu-nav-container.editing-order .acu-action-btn:hover { border-color: var(--acu-accent); transform: translateY(-1px); }\n\n            .acu-swap-selected { background-color: var(--acu-accent) !important; color: #fff !important; border-color: var(--acu-accent); box-shadow: 0 0 0 2px rgba(255,255,255,0.5), 0 4px 12px rgba(0,0,0,0.2); transform: scale(1.05); z-index: 10; }\n            .acu-drag-over { border: 2px dashed var(--acu-accent); opacity: 0.5; transform: scale(0.95); background: rgba(var(--acu-accent-rgb), 0.1); }\n\n            /* --- [PC Style] Unused Pool Optimization () --- */\n            .acu-unused-pool {\n                grid-column: 1 / -1;\n                display: none;\n                flex-wrap: wrap;\n                gap: 8px;\n                background: var(--acu-table-head); /*  */\n                border: 1px dashed var(--acu-border); /*  */\n                padding: 10px 15px;\n                margin: 0 0 10px 0;\n                border-radius: 8px;\n                justify-content: flex-start;\n                align-items: center;\n                min-height: 50px;\n                box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);\n            }\n            .acu-unused-pool.visible { display: flex; animation: acuFadeIn 0.2s ease-out; }\n\n            /* PC */\n            .acu-unused-pool::before {\n                content: \" ( )\";\n                display: flex;\n                align-items: center;\n                height: 32px;\n                font-size: 12px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n                margin-right: 15px;\n                padding-right: 15px;\n                border-right: 1px solid var(--acu-border);\n                white-space: nowrap;\n                opacity: 0.8;\n            }\n\n            .acu-actions-group { grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 4px; border-top: 1px dashed var(--acu-border); padding-top: 8px; margin-top: 4px; min-height: 36px; transition: all 0.2s; }\n\n            /* []  */\n            .acu-pos-top .acu-actions-group { order: -1; border-top: none; border-bottom: 1px dashed var(--acu-border); margin-top: 0; margin-bottom: 6px; padding-top: 0; padding-bottom: 8px; }\n\n            /* []  */\n            .acu-pos-top .acu-unused-pool { order: -1; margin-bottom: 10px; border-bottom: 1px dashed var(--acu-border); }\n            .acu-actions-group.dragging-over { background: rgba(127, 127, 127, 0.05); box-shadow: inset 0 0 10px rgba(0,0,0,0.05); }\n\n            /*  */\n                .acu-dash-body.acu-dash-horizontal {\n                    display: flex;\n                    flex-wrap: nowrap;\n                    gap: 15px;\n                    overflow-x: auto;\n                    overflow-y: hidden;\n                    padding-bottom: 10px;\n                }\n                .acu-dash-body.acu-dash-horizontal > div {\n                    flex: 0 0 280px;\n                    min-width: 280px;\n                    max-height: 60vh;\n                    overflow-y: auto;\n                }\n                @media (min-width: 769px) {\n                    .acu-dash-body.acu-dash-horizontal > div {\n                        flex: 0 0 320px;\n                        min-width: 320px;\n                    }\n                }\n            /* Mobile adjustments to keep it usable there */\n            @media (max-width: 768px) {\n                .acu-unused-pool { justify-content: center; background: rgba(0,0,0,0.05); border: 1px dashed var(--acu-border); border-bottom: none; margin: 0 0 8px 0; border-radius: 6px; }\n                .acu-unused-pool::before { display: block; width: 100%; text-align: center; margin-bottom: 4px; content: \" ()\"; }\n                .acu-order-controls { flex-direction: column; gap: 6px; text-align: center; }\n            }\n            .acu-actions-group.dragging-over { background: rgba(var(--acu-accent-rgb), 0.1); border-color: var(--acu-accent); }\n            .acu-actions-group .acu-divider { display: none; }\n            .acu-settings-item { margin-bottom: 15px; }\n            .acu-settings-label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 13px; color: #ccc; }\n            .acu-settings-val { float: right; color: #4cd964; font-size: 12px; }\n            .acu-slider { width: 100%; height: 4px; background: #555; border-radius: 2px; outline: none; -webkit-appearance: none; }\n            .acu-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #fff; border-radius: 50%; cursor: pointer; }\n            .acu-select { width: 100%; padding: 8px; background: rgba(0,0,0,0.3); border: 1px solid #555; color: #fff; border-radius: 4px; outline: none; }\n            .acu-edit-overlay input[type=\"checkbox\"].acu-checkbox { margin-right: 10px; accent-color: var(--acu-accent) !important; background: transparent !important; background-color: transparent !important; }\n            .acu-btn-block { width: 100%; padding: 10px; background: #444; color: #eee; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px; }\n            .acu-btn-block:hover { background: #555; color: #fff; }\n            .acu-expand-trigger { background: var(--acu-bg-nav); border: 1px solid var(--acu-border); box-shadow: 0 2px 6px var(--acu-shadow); cursor: pointer; color: var(--acu-text-main); font-size: 13px; font-weight: bold; display: flex; align-items: center; gap: 6px; transition: all 0.2s; z-index: 2147483645 !important; }\n            .acu-expand-trigger:hover { background: var(--acu-btn-hover); transform: translateY(-2px); }\n            /* []  */\n            .acu-nav-toggle-btn:hover { opacity: 1 !important; transform: translateY(-50%) scale(1.2); color: var(--acu-accent); }\n            .acu-align-right { margin-left: auto; align-self: flex-end; }\n            .acu-align-left { margin-right: auto; margin-left: 0; align-self: flex-start; }\n            .acu-nav-container.acu-left-mode .acu-actions-group { order: -1; margin-left: 0; margin-right: 10px; }\n            .acu-col-bar { width: 100%; justify-content: center; padding: 8px 10px; border-radius: 6px; }\n            .acu-col-pill { width: auto !important; padding: 6px 16px; border-radius: 50px; }\n            .acu-col-mini { width: 40px !important; height: 40px !important; padding: 0; justify-content: center; border-radius: 50%; }\n            .acu-col-mini span { display: none; }\n            #acu-btn-collapse { color: var(--acu-text-sub); }\n            #acu-btn-collapse:hover { color: var(--acu-text-main); background: rgba(0,0,0,0.05); }\n            @keyframes acu-breathe { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.6; transform: scale(0.85); color: #ff7e67; } 100% { opacity: 1; transform: scale(1); } } .acu-icon-breathe { animation: acu-breathe 3s infinite ease-in-out !important; display: inline-block; }\n\n            @media (min-width: 768px) {\n                .acu-wrapper.acu-mode-embedded .acu-nav-container { width: fit-content !important; min-width: 300px; max-width: 100%; margin: 0 auto; border-radius: 50px; box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important; border: 1px solid var(--acu-border); padding: 6px 20px; background: var(--acu-bg-nav) !important; }\n                .acu-wrapper.acu-mode-embedded .acu-data-display { bottom: calc(100% + 12px) !important; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2) !important; }\n                .acu-nav-container { display: flex; flex-wrap: wrap !important; gap: 6px !important; padding: 6px 10px; grid-template-columns: none !important; flex-direction: row !important; justify-content: flex-start !important; align-items: center !important; height: auto !important; }\n                .acu-nav-container .acu-nav-btn { width: fit-content !important; flex: 0 0 auto !important; height: 32px !important; padding: 0 12px; font-size: 13px !important; min-width: auto !important; }\n                .acu-nav-btn span { max-width: 200px; }\n                .acu-action-btn { flex: 0 0 32px !important; width: 32px !important; height: 32px !important; background: transparent !important; color: var(--acu-text-sub) !important; border-radius: 6px; border: 1px solid transparent; }\n                .acu-action-btn:hover { background: var(--acu-btn-hover) !important; color: var(--acu-text-main) !important; transform: scale(1.1); box-shadow: none; }\n                #acu-btn-save-global { color: var(--acu-accent) !important; }\n                #acu-btn-save-global:hover { background: var(--acu-accent) !important; color: #fff !important; }\n                .acu-order-controls { margin: 0 0 8px 0; padding: 4px; }\n                .acu-actions-group { width: auto !important; margin-left: auto !important; border-top: none !important; border-bottom: none !important; padding: 0; margin-top: 0 !important; margin-bottom: 0 !important; gap: 4px !important; background: transparent; justify-content: flex-end; order: 9999 !important; display: flex; }\n                .acu-pos-top .acu-actions-group { order: -1 !important; margin-left: 0 !important; margin-right: 10px !important; justify-content: flex-start !important; }\n            }\n            @media (max-width: 768px) {\n                .acu-panel-content { -webkit-overflow-scrolling: touch !important; overscroll-behavior-y: auto; }\n                .acu-data-card { box-shadow: none !important; border: 1px solid var(--acu-border); transform: translateZ(0); }\n                .acu-data-card:hover { transform: none !important; box-shadow: none !important; }\n                .acu-nav-btn:hover { transform: none !important; }\n            }\n            /* ===  === */\n            @media (max-width: 768px) {\n                .acu-dice-panel, .acu-contest-panel {\n                    position: fixed !important;\n                    top: 5% !important;\n                    left: 50% !important;\n                    transform: translateX(-50%) !important;\n                    width: 92vw !important;\n                    max-width: 400px !important;\n                    max-height: 88vh !important;\n                    overflow-y: auto !important;\n                }\n                .acu-dice-panel > div:last-child, .acu-contest-panel > div:last-child {\n                    max-height: none !important;\n                    overflow-y: visible !important;\n                }\n                .acu-dice-overlay, .acu-contest-overlay {\n                    align-items: flex-start !important;\n                    padding-top: 5vh !important;\n                }\n            }\n                /* ===  === */\n                .acu-dash-body {\n                    display: grid;\n                    grid-template-columns: 1fr 1.2fr 1fr;\n                    gap: 15px;\n                    margin: 15px 0;\n                }\n\n                .acu-dash-locations {\n                    background: var(--acu-card-bg);\n                    padding: 12px;\n                    border-radius: 8px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-locations h3 {\n                    margin: 0 0 10px 0;\n                    font-size: 14px;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                }\n\n                .acu-location-group {\n                    margin-bottom: 8px;\n                    border-radius: 6px;\n                    overflow: hidden;\n                    background: var(--acu-card-bg);\n                    border: 1px solid transparent;\n                    transition: all 0.2s;\n                }\n\n                .acu-location-group.expanded {\n                    border-color: var(--acu-accent);\n                }\n\n                .acu-location-header {\n                    padding: 8px 10px;\n                    cursor: pointer;\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                    background: var(--acu-table-head);\n                    transition: all 0.2s;\n                    user-select: none;\n                }\n\n                .acu-location-header:hover {\n                    background: var(--acu-table-hover);\n                }\n\n                .acu-expand-icon {\n                    font-size: 10px;\n                    transition: transform 0.2s;\n                    color: var(--acu-text-sub);\n                }\n\n                .acu-location-group.expanded .acu-expand-icon {\n                    transform: rotate(90deg);\n                    color: var(--acu-accent);\n                }\n\n                .acu-region-name {\n                    flex: 1;\n                    font-weight: bold;\n                    font-size: 13px;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-location-count {\n                    font-size: 11px;\n                    color: var(--acu-text-sub);\n                }\n\n                .acu-location-list {\n                    max-height: 0;\n                    overflow: hidden;\n                    transition: max-height 0.3s ease;\n                }\n\n                .acu-location-group.expanded .acu-location-list {\n                    max-height: 500px;\n                }\n\n                .acu-location-item {\n                    padding: 6px 10px 6px 26px;\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                    font-size: 12px;\n                    border-bottom: 1px dashed rgba(0,0,0,0.05);\n                    transition: all 0.15s;\n                }\n\n                .acu-location-item:last-child {\n                    border-bottom: none;\n                }\n\n                .acu-location-item:hover {\n                    background: var(--acu-table-hover);\n                    transform: translateX(4px);\n                }\n\n                .acu-location-item.current {\n                    background: var(--acu-hl-diff-bg);\n                    font-weight: bold;\n                    color: var(--acu-hl-diff);\n                }\n\n                .acu-location-item i {\n                    font-size: 10px;\n                    opacity: 0.6;\n                }\n\n                .acu-current-badge {\n                    margin-left: auto;\n                    font-size: 10px;\n                    padding: 2px 6px;\n                    background: var(--acu-btn-active-bg);\n                    color: var(--acu-btn-active-text);\n                    border-radius: 3px;\n                    font-weight: bold;\n                }\n                /* ===  === */\n                .acu-dash-context {\n                    background: linear-gradient(135deg, var(--acu-table-head), var(--acu-bg-panel));\n                    padding: 15px;\n                    border-radius: 8px;\n                    margin-bottom: 15px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-location {\n                    font-size: 18px;\n                    font-weight: bold;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                }\n\n                .acu-dash-location-desc {\n                    font-size: 13px;\n                    color: var(--acu-text-sub);\n                    margin-top: 6px;\n                    line-height: 1.5;\n                }\n\n                .acu-dash-player, .acu-dash-intel {\n                    background: var(--acu-card-bg);\n                    padding: 12px;\n                    border-radius: 8px;\n                    border: 1px solid var(--acu-border);\n                }\n\n                .acu-dash-player h3, .acu-dash-intel h3 {\n                    margin: 0 0 10px 0;\n                    font-size: 14px;\n                    color: var(--acu-accent);\n                    display: flex;\n                    align-items: center;\n                    gap: 6px;\n                }\n\n                .acu-player-status {\n                    font-size: 13px;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-task-item {\n                    padding: 8px;\n                    margin-bottom: 6px;\n                    background: rgba(0,0,0,0.03);\n                    border-radius: 6px;\n                    border-left: 3px solid var(--acu-border);\n                }\n\n                .acu-task-name {\n                    font-size: 13px;\n                    font-weight: 500;\n                    color: var(--acu-text-main);\n                }\n\n                .acu-empty-hint {\n                    font-size: 12px;\n                    color: var(--acu-text-sub);\n                    text-align: center;\n                    padding: 15px;\n                    opacity: 0.7;\n                }\n                /*  */\n                .acu-changes-content .acu-empty-hint {\n                    flex: 1;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    min-height: 200px;\n                }\n\n                .acu-dashboard-content {\n                    padding: 15px;\n                    overflow-y: auto !important;\n                    overflow-x: hidden !important;\n                    -webkit-overflow-scrolling: touch !important;\n                    touch-action: pan-y !important;\n                    overscroll-behavior-y: contain;\n                    max-height: calc(80vh - 60px);\n                }\n\n                /* ===  === */\n                h3.acu-dash-table-link,\n                h4.acu-dash-table-link {\n                    cursor: pointer;\n                    transition: all 0.15s;\n                    padding: 2px 4px;\n                    margin: -2px -4px;\n                    border-radius: 4px;\n                }\n                h3.acu-dash-table-link:hover,\n                h4.acu-dash-table-link:hover {\n                    color: var(--acu-accent);\n                    background: var(--acu-table-hover);\n                }\n\n                /*  - + */\n                .acu-dash-dice-btn,\n                .acu-dash-goto-btn,\n                .acu-dash-use-item-btn,\n                .acu-dash-use-skill-btn,\n                .acu-dash-track-task-btn,\n                .acu-dash-msg-btn,\n                .acu-dash-contest-btn,\n                .acu-dash-dice-free,\n                .acu-dash-relation-graph-btn,\n                .acu-dash-avatar-manager-btn {\n                    cursor: pointer;\n                    color: var(--acu-text-sub);\n                    opacity: 0.5;\n                    font-size: 14px !important;\n                    padding: 6px;\n                    margin: -4px;\n                    border-radius: 4px;\n                    transition: all 0.15s;\n                    display: inline-flex;\n                    align-items: center;\n                    justify-content: center;\n                    min-width: 28px;\n                    min-height: 28px;\n                }\n                .acu-dash-dice-btn:hover,\n                .acu-dash-goto-btn:hover,\n                .acu-dash-use-item-btn:hover,\n                .acu-dash-use-skill-btn:hover,\n                .acu-dash-track-task-btn:hover,\n                .acu-dash-msg-btn:hover,\n                .acu-dash-contest-btn:hover,\n                .acu-dash-dice-free:hover {\n                    opacity: 1;\n                    color: var(--acu-accent);\n                    background: var(--acu-table-hover);\n                    transform: scale(1.1);\n                }\n\n                /*  -  */\n                .acu-dash-clickable {\n                    cursor: pointer;\n                    transition: all 0.15s;\n                    border-radius: 4px;\n                }\n                .acu-dash-clickable:hover {\n                    background: var(--acu-table-hover);\n                }\n                .acu-dash-clickable:active {\n                    transform: scale(0.98);\n                }\n\n                @media (max-width: 768px) {\n                    .acu-dash-body {\n                        grid-template-columns: 1fr;\n                        max-height: none;\n                        overflow: visible;\n                    }\n\n                    .acu-dashboard-content {\n                        max-height: calc(75vh - 50px) !important;\n                        padding-bottom: 20px !important;\n                    }\n\n                    /*  */\n                    .acu-dash-dice-btn,\n                    .acu-dash-goto-btn,\n                    .acu-dash-use-item-btn,\n                    .acu-dash-use-skill-btn,\n                    .acu-dash-track-task-btn,\n                    .acu-dash-msg-btn,\n                    .acu-dash-contest-btn,\n                    .acu-dash-dice-free {\n                        font-size: 16px !important;\n                        padding: 8px;\n                        min-width: 36px;\n                        min-height: 36px;\n                    }\n                }\n            /* ===  === */\n            .acu-preview-overlay {\n                z-index: 2147483650;\n                backdrop-filter: blur(3px);\n                animation: acuFadeIn 0.2s ease;\n            }\n\n            .acu-preview-card {\n                background: var(--acu-card-bg);\n                width: 90%;\n                max-width: 400px;\n                max-height: 80vh;\n                overflow-y: auto;\n                animation: acuFadeIn 0.25s ease;\n            }\n                .acu-preview-overlay .acu-data-card {\n                    width: 90vw;\n                    max-width: 400px;\n                    flex: none;\n                }\n                @media (min-width: 768px) {\n                    .acu-preview-card,\n                    .acu-preview-overlay .acu-data-card {\n                        max-width: 550px;\n                    }\n                }\n            .acu-preview-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .acu-preview-close:hover {\n                background: rgba(231, 76, 60, 0.1);\n                color: #e74c3c;\n            }\n\n            .acu-preview-body {\n                padding: 15px;\n            }\n\n            .acu-preview-row {\n                display: flex;\n                padding: 8px 0;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n\n            .acu-preview-row:last-child {\n                border-bottom: none;\n            }\n\n            .acu-preview-label {\n                flex: 0 0 80px;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n            }\n\n            .acu-preview-value {\n                flex: 1;\n                color: var(--acu-text-main);\n                font-size: 13px;\n                word-break: break-word;\n            }\n\n            .acu-dash-clickable {\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n\n            .acu-dash-clickable:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-current-location span {\n                color: var(--acu-accent);\n                font-weight: 600;\n            }\n            .acu-current-location i {\n                color: var(--acu-accent);\n            }\n            /* ===  === */\n            .acu-dropdown-wrapper { position: relative; width: 100%; }\n            .acu-dropdown-list {\n                position: absolute;\n                top: 100%;\n                left: 0;\n                right: 0;\n                max-height: 150px;\n                overflow-y: auto;\n                border: 1px solid;\n                border-radius: 4px;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n                z-index: 2147483649;\n                display: none;\n            }\n            .acu-dropdown-list.visible { display: block; }\n            .acu-dropdown-item {\n                padding: 6px 10px;\n                font-size: 12px;\n                cursor: pointer;\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                background: transparent;\n                transition: background 0.1s;\n            }\n            .acu-dropdown-empty {\n                padding: 8px 10px;\n                font-size: 12px;\n                text-align: center;\n                opacity: 0.7;\n            }\n            /* ===  === */\n            .acu-input-wrapper { position: relative; display: flex; align-items: center; width: 100%; }\n            .acu-input-wrapper input { padding-right: 24px !important; }\n            .acu-clear-btn { position: absolute; right: 6px; top: 50%; transform: translateY(-50%); background: transparent !important; border: none; font-size: 12px; cursor: pointer; padding: 4px; line-height: 1; opacity: 0.5; transition: opacity 0.2s; z-index: 5; }\n            .acu-clear-btn:hover { background: transparent !important; opacity: 1 !important; }\n\n            /* ==========  ========== */\n            .acu-relation-graph-overlay {\n                background: rgba(0,0,0,0.8);\n                z-index: 2147483650;\n                backdrop-filter: blur(4px);\n            }\n            .acu-relation-graph-container {\n                width: 95%;\n                max-width: 900px;\n                height: 85vh;\n                max-height: 700px;\n            }\n            .acu-graph-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-graph-actions {\n                display: flex;\n                gap: 8px;\n            }\n            .acu-graph-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-graph-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n            .acu-graph-canvas-wrapper {\n                flex: 1;\n                overflow: hidden;\n                position: relative;\n                min-height: 0;\n            }\n            .acu-graph-svg {\n                width: 100%;\n                height: 100%;\n                cursor: grab;\n            }\n            .acu-graph-svg:active { cursor: grabbing; }\n            .acu-graph-edge {\n                stroke: var(--acu-border);\n                stroke-width: 2;\n                opacity: 0.6;\n            }\n            .acu-graph-edge-label {\n                font-size: 11px;\n                fill: var(--acu-text-sub);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-graph-node { cursor: grab; }\n            .acu-graph-node:active { cursor: grabbing; }\n            .acu-node-bg {\n                fill: var(--acu-btn-bg);\n                stroke: var(--acu-border);\n                stroke-width: 2;\n                transition: all 0.2s;\n            }\n            .acu-node-bg.player {\n                fill: var(--acu-accent);\n                stroke: var(--acu-btn-active-text);\n            }\n            .acu-graph-node:hover .acu-node-bg {\n                stroke-width: 3;\n                filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));\n            }\n            .acu-graph-svg.highlighting .acu-graph-node {\n                opacity: 0.2;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge {\n                opacity: 0.1;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge-label {\n                opacity: 0.1;\n                transition: opacity 0.2s ease;\n            }\n            .acu-graph-svg.highlighting .acu-graph-node.highlighted {\n                opacity: 1;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge.highlighted {\n                opacity: 1;\n                stroke: var(--acu-accent);\n                stroke-width: 3;\n            }\n            .acu-graph-svg.highlighting .acu-graph-edge-label.highlighted {\n                opacity: 1;\n                fill: var(--acu-accent);\n                font-weight: bold;\n            }\n            .acu-node-char {\n                font-size: 16px;\n                font-weight: bold;\n                fill: var(--acu-text-main);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-node-bg.player + text.acu-node-char,\n            .acu-node-bg.player ~ text.acu-node-char {\n                fill: var(--acu-btn-active-text);\n            }\n            .acu-node-label {\n                font-size: 12px;\n                fill: var(--acu-text-main);\n                text-anchor: middle;\n                pointer-events: none;\n            }\n            .acu-node-inscene-indicator {\n                fill: var(--acu-accent);\n                stroke: var(--acu-bg-panel);\n                stroke-width: 2;\n                filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));\n            }\n            .acu-graph-legend {\n                display: flex;\n                gap: 16px;\n                justify-content: center;\n                padding: 10px;\n                border-top: 1px solid var(--acu-border);\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                flex-shrink: 0;\n            }\n            .acu-graph-legend span {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n            .acu-zoom-display {\n                background: var(--acu-btn-bg);\n                padding: 2px 8px;\n                border-radius: 4px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                min-width: 45px;\n                text-align: center;\n            }\n            @media (max-width: 768px) {\n                .acu-relation-graph-container {\n                    width: 100%;\n                    height: 80vh;\n                    max-height: none;\n                    border-radius: 12px;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-avatar-manager-overlay {\n                background: rgba(0,0,0,0.7);\n                z-index: 2147483655;\n            }\n            .acu-avatar-manager {\n                width: 90%;\n                max-width: 500px;\n                max-height: 80vh;\n            }\n            .acu-avatar-title {\n                font-size: 15px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            .acu-avatar-list {\n                flex: 1;\n                overflow-y: auto;\n                padding: 12px;\n                min-height: 0;\n            }\n            .acu-avatar-item {\n                display: flex;\n                align-items: flex-start;\n                gap: 12px;\n                padding: 10px;\n                border-bottom: 1px dashed var(--acu-border);\n            }\n            .acu-avatar-item:last-child { border-bottom: none; }\n            .acu-avatar-preview {\n                width: 48px;\n                height: 48px;\n                border-radius: 50%;\n                background: var(--acu-btn-bg);\n                background-size: cover;\n                background-position: center;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                border: 2px solid var(--acu-border);\n                flex-shrink: 0;\n                position: relative;\n                cursor: pointer;\n            }\n            .acu-avatar-preview span {\n                font-size: 18px;\n                font-weight: bold;\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-camera-hint {\n                position: absolute;\n                bottom: 2px;\n                right: 2px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                opacity: 0.5;\n                pointer-events: none;\n            }\n            .acu-avatar-preview:hover .acu-avatar-camera-hint {\n                opacity: 0.8;\n                color: var(--acu-accent);\n            }\n            .acu-avatar-info {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-avatar-name {\n                font-size: 13px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                margin-bottom: 4px;\n            }\n            .acu-avatar-name-row {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                gap: 8px;\n                margin-bottom: 6px;\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-url,\n            .acu-avatar-manager-overlay input.acu-avatar-aliases {\n                width: 100%;\n                padding: 6px 8px;\n                font-size: 12px;\n                border: 1px solid var(--acu-border);\n                border-radius: 4px;\n                background: var(--acu-btn-bg) !important;\n                color: var(--acu-text-main) !important;\n                box-sizing: border-box;\n                -webkit-appearance: none;\n                appearance: none;\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-url:focus,\n            .acu-avatar-manager-overlay input.acu-avatar-aliases:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n                box-shadow: none !important;\n            }\n            /* URL +  */\n            .acu-avatar-input-row {\n                display: flex;\n                gap: 6px;\n                align-items: center;\n            }\n            .acu-avatar-input-row .acu-avatar-url {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-avatar-upload-btn {\n                width: 32px;\n                height: 32px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                flex-shrink: 0;\n                transition: all 0.15s;\n            }\n            .acu-avatar-upload-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n                border-color: var(--acu-accent);\n            }\n            .acu-avatar-upload-btn:active {\n                transform: scale(0.95);\n            }\n            /*  */\n            .acu-avatar-source {\n                position: absolute;\n                bottom: -10px;\n                left: 50%;\n                transform: translateX(-50%);\n                font-size: 9px;\n                padding: 1px 6px;\n                border-radius: 8px;\n                font-weight: bold;\n                white-space: nowrap;\n            }\n            .acu-avatar-preview-wrap {\n                position: relative;\n                flex-shrink: 0;\n            }\n            .acu-source-local,\n            .acu-source-url,\n            .acu-source-auto {\n                background: var(--acu-badge-bg);\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-manager-overlay input.acu-avatar-aliases {\n                padding: 4px 8px;\n                font-size: 11px;\n                margin-top: 4px;\n            }\n            .acu-avatar-manager-overlay input::placeholder {\n                color: var(--acu-text-sub) !important;\n                opacity: 0.7;\n            }\n            .acu-avatar-actions {\n                display: flex;\n                flex-direction: row;\n                gap: 4px;\n                flex-shrink: 0;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-actions button {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg) !important;\n                color: var(--acu-text-sub) !important;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-actions button:hover {\n                background: var(--acu-btn-hover) !important;\n                color: var(--acu-accent) !important;\n            }\n            .acu-avatar-save-btn:hover { color: #27ae60 !important; }\n            .acu-avatar-clear-btn:hover { color: #e74c3c !important; }\n            .acu-avatar-import-btn,\n            .acu-avatar-export-btn {\n                width: 28px;\n                height: 28px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 12px;\n                transition: all 0.2s;\n            }\n            .acu-avatar-import-btn:hover,\n            .acu-avatar-export-btn:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n            .acu-avatar-crop-row {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                margin-top: 6px;\n                font-size: 11px;\n                color: var(--acu-text-sub);\n            }\n            .acu-avatar-crop-row.hidden { display: none; }\n            .acu-avatar-manager-overlay .acu-avatar-scale {\n                flex: 1;\n                height: 6px !important;\n                -webkit-appearance: none !important;\n                appearance: none !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                outline: none;\n                border: none;\n                margin: 0 8px;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-webkit-slider-runnable-track {\n                height: 6px !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-webkit-slider-thumb {\n                -webkit-appearance: none !important;\n                appearance: none !important;\n                width: 16px !important;\n                height: 16px !important;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer !important;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 3px rgba(0,0,0,0.3) !important;\n                margin-top: -5px !important;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-moz-range-track {\n                height: 6px !important;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-avatar-manager-overlay .acu-avatar-scale::-moz-range-thumb {\n                width: 16px !important;\n                height: 16px !important;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                border: 2px solid var(--acu-bg-panel);\n                cursor: pointer !important;\n            }\n            @media (max-width: 768px) {\n                .acu-avatar-manager {\n                    width: 95%;\n                    max-height: 85vh;\n                }\n            }\n\n            /* ==========  ========== */\n            .acu-import-confirm-overlay {\n                z-index: 2147483660;\n            }\n            .acu-import-confirm-dialog {\n                width: 90%;\n                max-width: 320px;\n            }\n            .acu-import-confirm-body {\n                padding: 16px;\n            }\n            .acu-import-stats {\n                display: flex;\n                justify-content: space-around;\n                margin-bottom: 16px;\n            }\n            .acu-import-stat {\n                text-align: center;\n            }\n            .acu-stat-num {\n                display: block;\n                font-size: 24px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n            }\n            .acu-stat-label {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n            }\n            .acu-stat-new .acu-stat-num { color: var(--acu-success-text); }\n            .acu-stat-conflict .acu-stat-num { color: #e67e22; }\n            .acu-import-conflict-section {\n                margin-top: 12px;\n                padding-top: 12px;\n                border-top: 1px dashed var(--acu-border);\n            }\n            .acu-import-conflict-options {\n                margin-top: 10px;\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n            .acu-import-radio {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                cursor: pointer;\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-import-radio input {\n                accent-color: var(--acu-accent);\n            }\n            .acu-import-confirm-footer {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-import-cancel-btn,\n            .acu-import-confirm-btn {\n                flex: 1;\n                padding: 10px;\n                border-radius: 6px;\n                font-size: 13px;\n                font-weight: bold;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            .acu-import-cancel-btn {\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-import-cancel-btn:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-import-confirm-btn {\n                background: var(--acu-accent);\n                border: none;\n                color: #fff;\n            }\n            .acu-import-confirm-btn:hover {\n                opacity: 0.9;\n            }\n            /* ========== / ========== */\n            .acu-avatar-import-btn,\n            .acu-avatar-export-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n            }\n\n            /* ==========  ========== */\n            .acu-dice-config-dialog {\n                width: 320px;\n                max-width: 92vw;\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                box-shadow: 0 15px 40px rgba(0,0,0,0.4);\n                overflow: hidden;\n            }\n            .acu-dice-cfg-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 14px;\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-dice-cfg-header .acu-config-close {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                font-size: 14px;\n                padding: 4px;\n            }\n            .acu-dice-cfg-header .acu-config-close:hover {\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-body {\n                padding: 12px;\n            }\n            .acu-dice-cfg-row {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 10px;\n                margin-bottom: 10px;\n            }\n            .acu-dice-cfg-row.acu-cfg-full-row {\n                grid-template-columns: 1fr;\n            }\n            .acu-dice-cfg-item {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n            .acu-dice-cfg-item label {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                font-weight: 500;\n            }\n            .acu-dice-cfg-item input,\n            .acu-dice-cfg-item select {\n                width: 100%;\n                padding: 7px 8px;\n                background: var(--acu-input-bg) !important;\n                border: 1px solid var(--acu-border);\n                border-radius: 5px;\n                color: var(--acu-text-main) !important;\n                font-size: 13px;\n                text-align: center;\n                box-sizing: border-box;\n            }\n            .acu-dice-cfg-item input::placeholder {\n                color: var(--acu-text-sub);\n                opacity: 0.6;\n            }\n            .acu-dice-cfg-item select option {\n                background: var(--acu-bg-panel);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item input::placeholder {\n                color: var(--acu-text-sub);\n                opacity: 0.6;\n            }\n            .acu-dice-cfg-item select {\n                text-align: left;\n                cursor: pointer;\n            }\n            .acu-dice-cfg-item select option {\n                background: var(--acu-bg-panel);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-item input:focus,\n            .acu-dice-cfg-item select:focus {\n                outline: none;\n                border-color: var(--acu-accent);\n            }\n            .acu-cfg-hint {\n                font-size: 9px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n                text-align: center;\n            }\n            .acu-dice-cfg-actions {\n                display: flex;\n                gap: 8px;\n                margin-top: 12px;\n                padding-top: 10px;\n                border-top: 1px dashed var(--acu-border);\n            }\n            .acu-dice-cfg-actions button {\n                flex: 1;\n                padding: 9px 12px;\n                border-radius: 6px;\n                font-size: 12px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.2s;\n                border: 1px solid var(--acu-border);\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n            }\n            .acu-dice-cfg-actions button:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-dice-cfg-actions button.primary {\n                background: var(--acu-accent);\n                border-color: var(--acu-accent);\n                color: #fff;\n            }\n            .acu-dice-cfg-actions button.primary:hover {\n                opacity: 0.9;\n            }\n            /* ==========  ========== */\n            .acu-settings-dialog {\n                width: 380px;\n                max-width: 380px;\n                max-height: 85vh;\n                padding: 0;\n                gap: 0;\n            }\n            @media (max-width: 768px) {\n                .acu-settings-dialog {\n                    width: 92vw;\n                    max-width: 92vw;\n                    max-height: 85vh;\n                }\n                .acu-settings-body {\n                    max-height: calc(85vh - 110px);\n                    -webkit-overflow-scrolling: touch;\n                }\n                .acu-table-manager-list {\n                    max-height: 40vh;\n                    -webkit-overflow-scrolling: touch;\n                }\n            }\n            .acu-settings-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 14px 16px;\n                border-bottom: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            .acu-settings-title {\n                font-size: 16px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n            .acu-settings-body {\n                flex: 1;\n                min-height: 0;\n                overflow-y: auto;\n                overflow-x: hidden;\n                padding: 8px;\n                -webkit-overflow-scrolling: touch;\n            }\n            .acu-settings-group {\n                background: var(--acu-card-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 8px;\n            }\n            .acu-settings-group-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 12px 14px;\n                font-size: 13px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n                background: var(--acu-table-head);\n                cursor: pointer;\n                user-select: none;\n                transition: background 0.15s;\n            }\n            .acu-settings-group-title:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-group-chevron {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                width: 12px;\n                transition: transform 0.2s;\n            }\n            .acu-settings-group-body {\n                padding: 4px 12px 8px;\n            }\n            .acu-settings-group.collapsed .acu-settings-group-body {\n                display: none;\n            }\n            .acu-settings-group-body.acu-animating {\n                display: block !important;\n                overflow: hidden;\n            }\n            .acu-settings-group:last-child {\n                margin-bottom: 0;\n            }\n            .acu-setting-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 0;\n                border-bottom: 1px dashed var(--acu-border);\n                gap: 12px;\n                min-height: 44px;\n            }\n            .acu-setting-row:last-child {\n                border-bottom: none;\n            }\n            .acu-setting-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 8px 0;\n                border-bottom: 1px dashed var(--acu-border);\n                gap: 12px;\n            }\n            .acu-setting-row:last-child {\n                border-bottom: none;\n            }\n            .acu-setting-row-slider {\n                flex-direction: column;\n                align-items: stretch;\n            }\n            .acu-setting-info {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-setting-label {\n                font-size: 13px;\n                color: var(--acu-text-main);\n            }\n            .acu-setting-hint {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n            }\n            .acu-setting-value {\n                font-size: 12px;\n                font-weight: bold;\n                color: var(--acu-accent);\n                margin-left: auto;\n            }\n            .acu-setting-select {\n                padding: 6px 10px;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px;\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                color: var(--acu-text-main) !important;\n                font-size: 12px;\n                min-width: 120px;\n                cursor: pointer;\n                -webkit-appearance: none;\n                appearance: none;\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 8L2 4h8z'/%3E%3C/svg%3E\");\n                background-repeat: no-repeat;\n                background-position: right 8px center;\n                padding-right: 28px;\n            }\n            .acu-setting-select:focus {\n                outline: none;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-setting-select option {\n                background: var(--acu-bg-panel) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-select-short {\n                min-width: 80px;\n            }\n            .acu-setting-slider {\n                width: 100%;\n                height: 6px;\n                margin-top: 8px;\n                -webkit-appearance: none;\n                appearance: none;\n                background: var(--acu-border) !important;\n                border-radius: 3px;\n                outline: none;\n                border: none;\n            }\n            .acu-setting-slider::-webkit-slider-runnable-track {\n                height: 6px;\n                background: var(--acu-border);\n                border-radius: 3px;\n            }\n            .acu-setting-slider::-webkit-slider-thumb {\n                -webkit-appearance: none;\n                appearance: none;\n                width: 18px;\n                height: 18px;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 4px rgba(0,0,0,0.2);\n                margin-top: -6px;\n            }\n            .acu-setting-slider::-moz-range-track {\n                height: 6px;\n                background: var(--acu-border);\n                border-radius: 3px;\n                border: none;\n            }\n            .acu-setting-slider::-moz-range-thumb {\n                width: 18px;\n                height: 18px;\n                background: var(--acu-accent) !important;\n                border-radius: 50%;\n                cursor: pointer;\n                border: 2px solid var(--acu-bg-panel);\n                box-shadow: 0 1px 4px rgba(0,0,0,0.2);\n            }\n            .acu-setting-slider:focus {\n                outline: none;\n            }\n            .acu-setting-mini-btn {\n                width: 28px;\n                height: 28px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 11px;\n                flex-shrink: 0;\n                transition: all 0.15s;\n            }\n            .acu-setting-mini-btn:hover, .acu-setting-mini-btn.active {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n\n            /* ==========  ========== */\n            .acu-preset-item {\n                padding: 12px;\n                background: var(--acu-card-bg);\n                border: 1px solid var(--acu-border);\n                border-radius: 8px;\n                margin-bottom: 10px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                gap: 12px;\n                transition: all 0.2s;\n            }\n            .acu-preset-item:hover {\n                background: var(--acu-table-hover);\n                border-color: var(--acu-accent);\n            }\n            .acu-preset-item.active {\n                border-color: var(--acu-accent);\n                background: var(--acu-table-hover);\n            }\n            .acu-preset-info {\n                flex: 1;\n            }\n            .acu-preset-name {\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-text-main);\n                margin-bottom: 4px;\n            }\n            .acu-preset-desc {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                margin-bottom: 4px;\n            }\n            .acu-preset-stats {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n            }\n            .acu-preset-actions {\n                display: flex;\n                gap: 8px;\n                flex-shrink: 0;\n                align-items: center;\n            }\n            .acu-preset-btn {\n                width: 32px;\n                height: 32px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 13px;\n                transition: all 0.15s;\n            }\n            .acu-preset-btn:hover {\n                background: var(--acu-accent);\n                color: #fff;\n                border-color: var(--acu-accent);\n            }\n            .acu-preset-btn.acu-preset-delete:hover {\n                background: rgba(231, 76, 60, 0.2);\n                color: #e74c3c;\n                border-color: #e74c3c;\n            }\n            /*  */\n            .acu-preset-editor-input,\n            .acu-preset-editor-textarea {\n                background: var(--acu-input-bg) !important;\n                color: var(--acu-text-main) !important;\n                border: 1px solid var(--acu-border) !important;\n            }\n            .acu-preset-editor-input:focus,\n            .acu-preset-editor-textarea:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n                box-shadow: 0 0 0 2px rgba(var(--acu-accent-rgb, 100, 150, 200), 0.2) !important;\n            }\n            .acu-preset-editor-textarea {\n                font-family: 'Consolas', 'Monaco', 'Courier New', monospace !important;\n            }\n            /* Toggle  */\n            .acu-toggle {\n                position: relative;\n                width: 44px;\n                height: 24px;\n                flex-shrink: 0;\n            }\n            .acu-toggle input {\n                opacity: 0;\n                width: 0;\n                height: 0;\n            }\n            .acu-toggle-slider {\n                position: absolute;\n                cursor: pointer;\n                top: 0; left: 0; right: 0; bottom: 0;\n                background: var(--acu-border);\n                border-radius: 24px;\n                transition: all 0.2s;\n            }\n            .acu-toggle-slider:before {\n                position: absolute;\n                content: \"\";\n                height: 18px;\n                width: 18px;\n                left: 3px;\n                bottom: 3px;\n                background: var(--acu-bg-panel);\n                border-radius: 50%;\n                transition: all 0.2s;\n                box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n            }\n            .acu-toggle input:checked + .acu-toggle-slider {\n                background: var(--acu-accent);\n            }\n            .acu-toggle input:checked + .acu-toggle-slider:before {\n                transform: translateX(20px);\n            }\n            .acu-setting-action-btn {\n                width: 100%;\n                padding: 10px 14px;\n                margin-bottom: 6px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                font-size: 13px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n                transition: all 0.15s;\n            }\n            /* Stepper  */\n            .acu-stepper {\n                display: flex;\n                align-items: center;\n                border: 1.5px solid var(--acu-accent);\n                border-radius: 6px;\n                overflow: hidden;\n                background: transparent !important;\n                flex-shrink: 0;\n            }\n            .acu-stepper-btn {\n                width: 36px;\n                height: 34px;\n                border: none !important;\n                background: transparent !important;\n                background-color: transparent !important;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.15s;\n                -webkit-appearance: none !important;\n                appearance: none !important;\n            }\n            .acu-stepper-btn:hover {\n                background: var(--acu-table-hover) !important;\n                color: var(--acu-accent);\n            }\n            .acu-stepper-btn:active {\n                transform: scale(0.95);\n                background: var(--acu-accent) !important;\n                color: #fff;\n            }\n            .acu-stepper-value {\n                min-width: 60px;\n                height: 34px;\n                line-height: 34px;\n                text-align: center;\n                font-size: 13px;\n                font-weight: 600;\n                color: var(--acu-text-main);\n                background: transparent !important;\n                border-left: 1px solid var(--acu-accent);\n                border-right: 1px solid var(--acu-accent);\n            }\n            /* ==========  ========== */\n            .acu-changes-content {\n                padding: 10px;\n                overflow-y: auto !important;\n                overflow-x: hidden !important;\n                -webkit-overflow-scrolling: touch !important;\n                touch-action: pan-y !important;\n                overscroll-behavior-y: contain;\n            }\n            /* ==========  ========== */\n            .acu-validation-error-msg {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                flex: 1;\n                min-width: 0;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n            }\n            /*  -  */\n            .acu-validation-mode-hint {\n                padding: 8px 12px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                background: var(--acu-table-head);\n                border-radius: 6px;\n                margin: 0 0 10px 0;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n            /*  */\n            .acu-changes-content.acu-changes-horizontal {\n                display: flex !important;\n                flex-direction: row !important;\n                flex-wrap: nowrap !important;\n                align-items: flex-start !important;\n                gap: 12px;\n                overflow-x: auto !important;\n                overflow-y: visible !important;\n                touch-action: pan-x pan-y !important;\n                padding-bottom: 5px;\n                -webkit-overflow-scrolling: touch;\n                overscroll-behavior-x: contain;\n                overscroll-behavior-y: auto;\n            }\n            .acu-changes-content.acu-changes-horizontal .acu-changes-list {\n                display: flex !important;\n                flex-direction: row !important;\n                flex-wrap: nowrap !important;\n                gap: 12px;\n                align-items: flex-start;\n                min-width: max-content;\n            }\n            .acu-changes-content.acu-changes-horizontal .acu-changes-group {\n                flex: 0 0 280px;\n                min-width: 280px;\n                max-width: 280px;\n                max-height: none;\n                overflow-y: visible;\n                -webkit-overflow-scrolling: auto;\n                overscroll-behavior-y: auto;\n            }\n            @media (min-width: 769px) {\n                .acu-changes-content.acu-changes-horizontal .acu-changes-group {\n                    flex: 0 0 320px;\n                    min-width: 320px;\n                    max-width: 320px;\n                }\n            }\n            .acu-changes-list { display: flex; flex-direction: column; gap: 10px; }\n            .acu-changes-group { background: var(--acu-card-bg); border: 1px solid var(--acu-border); border-radius: 8px; overflow: hidden; }\n            .acu-changes-group-header { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--acu-table-head); font-weight: bold; font-size: 13px; color: var(--acu-text-main); }\n            .acu-changes-count { margin-left: auto; background: var(--acu-accent); color: #fff; font-size: 11px; padding: 2px 8px; border-radius: 10px; font-weight: normal; }\n            .acu-changes-group-body { padding: 6px; display: flex; flex-direction: column; gap: 4px; }\n            .acu-change-item { display: flex; align-items: center; gap: 6px; padding: 6px 8px; border-radius: 6px; font-size: 12px; background: rgba(0,0,0,0.02); flex-wrap: wrap; transition: all 0.15s; }\n            .acu-change-item:hover { background: var(--acu-table-hover); }\n            .acu-change-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; flex-shrink: 0; }\n            .acu-badge-added { background: var(--acu-success-bg); color: var(--acu-success-text); }\n            .acu-badge-deleted { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); }\n            .acu-badge-modified { background: var(--acu-hl-diff-bg); color: var(--acu-hl-diff); }\n            .acu-change-title { color: var(--acu-text-main); font-weight: 500; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            .acu-change-field { color: var(--acu-text-sub); font-size: 11px; flex-shrink: 0; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            .acu-change-diff { display: flex; align-items: center; gap: 4px; flex: 1; min-width: 0; overflow: hidden; }\n            .acu-diff-old { color: var(--acu-hl-manual); text-decoration: line-through; opacity: 0.7; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }\n            .acu-diff-arrow { color: var(--acu-text-sub); flex-shrink: 0; }\n            .acu-diff-new { color: var(--acu-success-text); font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }\n            /*  */\n            .acu-change-actions { display: flex; gap: 4px; margin-left: auto; flex-shrink: 0; }\n            .acu-change-action-btn { width: 24px; height: 24px; border: 1px solid var(--acu-border); border-radius: 4px; background: var(--acu-btn-bg); color: var(--acu-text-sub); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 11px; transition: all 0.15s; padding: 0; }\n            .acu-change-action-btn:hover { background: var(--acu-btn-hover); color: var(--acu-text-main); transform: scale(1.1); }\n            .acu-action-accept:hover { background: var(--acu-success-bg); color: var(--acu-success-text); border-color: var(--acu-success-text); }\n            .acu-action-reject:hover, .acu-action-restore:hover { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); border-color: var(--acu-hl-manual); }\n            .acu-action-edit:hover { background: var(--acu-hl-diff-bg); color: var(--acu-hl-diff); border-color: var(--acu-hl-diff); }\n            /*  -  */\n            .acu-changes-batch-btn { width: 32px; height: 32px; border: 1.5px solid rgba(255,255,255,0.4); border-radius: 6px; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.85); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 13px; transition: all 0.15s; }\n            .acu-changes-batch-btn:hover { background: rgba(255,255,255,0.2); color: #fff; border-color: rgba(255,255,255,0.6); }\n            .acu-batch-accept:hover { background: var(--acu-success-bg); color: var(--acu-success-text); border-color: var(--acu-success-text); }\n            .acu-batch-reject:hover { background: var(--acu-hl-manual-bg); color: var(--acu-hl-manual); border-color: var(--acu-hl-manual); }\n            .acu-simple-mode-toggle.active { background: var(--acu-accent); color: #fff; border-color: var(--acu-accent); }\n            .acu-simple-mode-toggle:hover { background: var(--acu-accent); color: #fff; border-color: var(--acu-accent); }\n            /*  */\n            .acu-theme-light .acu-changes-batch-btn { border-color: rgba(0,0,0,0.3); background: rgba(0,0,0,0.05); color: rgba(0,0,0,0.7); }\n            .acu-theme-light .acu-changes-batch-btn:hover { background: rgba(0,0,0,0.1); color: rgba(0,0,0,0.9); border-color: rgba(0,0,0,0.5); }\n            .acu-changes-group.collapsed .acu-collapse-icon { transform: rotate(0deg); }\n            .acu-changes-group:not(.collapsed) .acu-collapse-icon { transform: rotate(0deg); }\n            .acu-changes-group-header:hover { background: var(--acu-table-hover); }\n            /*  */\n            .acu-diff-section { margin-bottom: 12px; }\n            .acu-diff-label { font-size: 12px; font-weight: bold; color: var(--acu-text-sub); margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }\n            .acu-diff-readonly { padding: 10px 12px; background: var(--acu-table-head); border: 1px dashed var(--acu-border); border-radius: 6px; color: var(--acu-text-main); font-size: 13px; line-height: 1.5; white-space: pre-wrap; word-break: break-word; max-height: 150px; overflow-y: auto; opacity: 0.8; }\n            .acu-diff-arrow-down { text-align: center; color: var(--acu-text-sub); font-size: 14px; margin: 8px 0; opacity: 0.5; }\n            /*  */\n            .acu-diff-new-section { padding: 12px; background: var(--acu-input-bg); border: 2px solid var(--acu-accent); border-radius: 6px; box-shadow: 0 0 0 3px rgba(127, 127, 255, 0.1); }\n            .acu-diff-new-section .acu-diff-label { color: var(--acu-accent); font-weight: 600; }\n            .acu-diff-new-section textarea,\n            .acu-diff-new-section input { background: var(--acu-input-bg) !important; border-color: var(--acu-border) !important; }\n            .acu-diff-new-section textarea:focus,\n            .acu-diff-new-section input:focus { border-color: var(--acu-accent) !important; box-shadow: 0 0 0 2px rgba(127, 127, 255, 0.15); }\n            /*  */\n            .acu-edit-dialog .acu-dialog-btns {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n                margin: 0 -16px -16px -16px;\n                border-radius: 0 0 12px 12px;\n            }\n            .acu-edit-dialog .acu-dialog-btn {\n                flex: 1;\n                padding: 10px 12px;\n                border: 1px solid var(--acu-border);\n                border-radius: 6px;\n                background: var(--acu-btn-bg);\n                color: var(--acu-text-main);\n                font-size: 13px;\n                font-weight: 500;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                white-space: nowrap;\n                transition: all 0.15s;\n            }\n            .acu-edit-dialog .acu-dialog-btn:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-edit-dialog .acu-btn-confirm {\n                background: var(--acu-accent);\n                border-color: var(--acu-accent);\n                color: #fff;\n            }\n            .acu-edit-dialog .acu-btn-confirm:hover {\n                opacity: 0.9;\n            }\n            @media (max-width: 768px) {\n                .acu-edit-dialog .acu-dialog-btns {\n                    flex-wrap: nowrap;\n                }\n                .acu-edit-dialog .acu-dialog-btn {\n                    padding: 10px 8px;\n                    font-size: 12px;\n                    min-width: 0;\n                }\n                .acu-edit-dialog .acu-dialog-btn i {\n                    font-size: 11px;\n                }\n            }\n            @media (max-width: 768px) {\n                .acu-change-item { padding: 8px 6px; }\n                .acu-change-diff { flex-basis: 100%; margin-top: 4px; order: 10; }\n                .acu-change-actions { order: 5; }\n                .acu-diff-old, .acu-diff-new { max-width: 100px; }\n                .acu-change-action-btn { width: 28px; height: 28px; }\n            }\n            .acu-change-field-count { font-size: 11px; color: var(--acu-text-sub); margin-left: 4px; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }\n            /*  */\n            .acu-row-edit-field { margin-bottom: 12px; padding: 10px; background: var(--acu-table-head); border-radius: 6px; border: 1px solid transparent; }\n            .acu-row-edit-field.acu-field-changed { border-color: var(--acu-accent); background: var(--acu-bg-panel); }\n            .acu-row-edit-label { font-size: 12px; font-weight: bold; color: var(--acu-text-sub); margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }\n            .acu-changed-badge { font-size: 10px; padding: 1px 6px; background: var(--acu-accent); color: #fff; border-radius: 3px; font-weight: normal; }\n            .acu-row-edit-old { font-size: 12px; color: var(--acu-text-sub); padding: 6px 8px; background: var(--acu-table-head); border-radius: 4px; margin-bottom: 6px; text-decoration: line-through; opacity: 0.7; white-space: pre-wrap; word-break: break-word; }\n            .acu-row-edit-input { width: 100%; min-height: 36px; max-height: 200px; padding: 8px; resize: none; }\n            .acu-empty-val { opacity: 0.5; font-style: italic; }\n            /* ==========  ========== */\n            .acu-table-manager-list {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                max-height: 300px;\n                overflow-y: auto;\n                padding: 4px;\n                -webkit-overflow-scrolling: touch;\n                overscroll-behavior-y: contain;\n                touch-action: pan-y;\n            }\n            .acu-table-manager-item {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 8px 10px;\n                background: transparent;\n                border: 1.5px solid var(--acu-accent);\n                border-radius: 6px;\n                cursor: default;\n                transition: all 0.15s;\n                user-select: none;\n                touch-action: pan-y;\n            }\n            .acu-table-manager-item:hover {\n                background: var(--acu-table-hover);\n            }\n            .acu-table-manager-item.hidden-table {\n                opacity: 0.5;\n                border-color: var(--acu-border);\n                border-style: dashed;\n            }\n            .acu-table-manager-item.hidden-table .acu-table-item-name {\n                text-decoration: line-through;\n            }\n            .acu-table-item-check {\n                width: 28px;\n                height: 28px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                cursor: pointer;\n                color: var(--acu-accent);\n                border-radius: 4px;\n                transition: all 0.15s;\n            }\n            .acu-table-item-check:hover {\n                background: var(--acu-table-hover);\n                transform: scale(1.1);\n            }\n            .acu-table-manager-item.hidden-table .acu-table-item-check {\n                color: var(--acu-text-sub);\n            }\n            .acu-table-item-icon {\n                width: 20px;\n                text-align: center;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n            }\n            .acu-table-item-name {\n                flex: 1;\n                font-size: 13px;\n                color: var(--acu-text-main);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-table-item-handle {\n                width: 28px;\n                height: 28px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--acu-text-sub);\n                cursor: grab;\n                opacity: 0.4;\n                transition: all 0.15s;\n                border-radius: 4px;\n            }\n            .acu-table-item-handle:hover {\n                opacity: 1;\n                background: var(--acu-table-hover);\n                color: var(--acu-accent);\n            }\n            .acu-table-manager-item.acu-dragging {\n                opacity: 0.9;\n                background: var(--acu-accent);\n                border-color: var(--acu-accent);\n                box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n                z-index: 100;\n            }\n            .acu-table-manager-item.acu-dragging .acu-table-item-name,\n            .acu-table-manager-item.acu-dragging .acu-table-item-check,\n            .acu-table-manager-item.acu-dragging .acu-table-item-icon,\n            .acu-table-manager-item.acu-dragging .acu-table-item-handle {\n                color: #fff;\n            }\n            .acu-table-manager-item.acu-drag-above {\n                border-top: 2px solid var(--acu-accent);\n                margin-top: -1px;\n            }\n            .acu-table-manager-item.acu-drag-below {\n                border-bottom: 2px solid var(--acu-accent);\n                margin-bottom: -1px;\n            }\n            @media (max-width: 768px) {\n                .acu-table-item-handle {\n                    opacity: 0.6;\n                }\n            }\n            /* // */\n            .acu-table-manager-item.acu-special-item {\n                background: linear-gradient(135deg, rgba(var(--acu-accent-rgb, 128, 128, 128), 0.08), transparent);\n                border-style: dashed;\n            }\n            .acu-table-manager-item.acu-special-item .acu-table-item-icon {\n                color: var(--acu-accent);\n            }\n            .acu-table-manager-item.acu-special-item .acu-table-item-name {\n                font-weight: 500;\n            }\n            /* ==========  ========== */\n            .acu-validation-rules-list {\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n                max-height: 280px;\n                overflow-y: auto;\n                padding: 2px;\n            }\n            .acu-validation-rule-item {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 8px 10px;\n                background: transparent;\n                border: 1.5px solid var(--acu-accent);\n                border-radius: 6px;\n                transition: all 0.2s ease;\n            }\n            .acu-validation-rule-item.disabled {\n                opacity: 0.5;\n            }\n            .acu-validation-rule-item:hover {\n                border-color: var(--acu-accent);\n            }\n            .acu-rule-toggle {\n                cursor: pointer;\n                font-size: 18px;\n                color: var(--acu-text-sub);\n                transition: color 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-toggle.active {\n                color: var(--acu-accent);\n            }\n            .acu-rule-toggle:hover {\n                opacity: 0.8;\n            }\n            .acu-rule-info {\n                flex: 1;\n                min-width: 0;\n            }\n            .acu-rule-name {\n                font-size: 12px;\n                font-weight: 500;\n                color: var(--acu-text-main);\n                white-space: nowrap;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n            .acu-rule-target {\n                font-size: 10px;\n                color: var(--acu-text-sub);\n                margin-top: 2px;\n            }\n            .acu-rule-type-icon {\n                width: 20px;\n                font-size: 12px;\n                color: var(--acu-text-sub);\n                flex-shrink: 0;\n                text-align: center;\n            }\n            .acu-rule-delete {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                cursor: pointer;\n                padding: 4px;\n                opacity: 0.6;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-delete:hover {\n                color: #e74c3c;\n                opacity: 1;\n            }\n            .acu-rule-intercept {\n                cursor: pointer;\n                font-size: 14px;\n                color: var(--acu-text-sub);\n                padding: 4px 6px;\n                border-radius: 4px;\n                opacity: 0.5;\n                transition: all 0.2s;\n                flex-shrink: 0;\n            }\n            .acu-rule-intercept:hover {\n                opacity: 0.8;\n                background: var(--acu-hover-bg);\n            }\n            .acu-rule-intercept.active {\n                color: var(--acu-accent);\n                opacity: 1;\n            }\n            .acu-add-rule-btn {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n                width: 100%;\n                padding: 10px;\n                margin-top: 8px;\n                background: var(--acu-btn-bg);\n                border: 1px dashed var(--acu-border);\n                border-radius: 6px;\n                color: var(--acu-text-sub);\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.2s;\n            }\n            .acu-add-rule-btn:hover {\n                border-color: var(--acu-accent);\n                color: var(--acu-accent);\n                background: rgba(var(--acu-accent-rgb, 128, 128, 128), 0.1);\n            }\n            /*  */\n            .acu-validation-modal-overlay {\n                z-index: 2147483659;\n            }\n            .acu-validation-modal {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                width: 90%;\n                max-width: 420px;\n                overflow: hidden;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n            }\n            .acu-validation-modal-body {\n                padding: 16px;\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n                max-height: 60vh;\n                overflow-y: auto;\n            }\n            .acu-validation-modal-body .acu-setting-row {\n                flex-wrap: wrap;\n            }\n            .acu-validation-modal-body .acu-panel-input,\n            .acu-validation-modal input[type=\"text\"],\n            .acu-validation-modal input[type=\"number\"],\n            .acu-validation-modal select {\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n                padding: 8px 10px !important;\n                color: var(--acu-text-main) !important;\n                font-size: 12px !important;\n                box-shadow: none !important;\n                -webkit-appearance: none !important;\n            }\n            .acu-validation-modal-body .acu-panel-input:focus,\n            .acu-validation-modal input[type=\"text\"]:focus,\n            .acu-validation-modal input[type=\"number\"]:focus,\n            .acu-validation-modal select:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-rule-config-section {\n                padding: 8px 0;\n            }\n            .acu-validation-modal-footer {\n                display: flex;\n                justify-content: flex-end;\n                gap: 10px;\n                padding: 12px 16px;\n                border-top: 1px solid var(--acu-border);\n                background: var(--acu-table-head);\n            }\n            /*  */\n            .acu-smart-fix-meta {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 4px 0 !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n                flex-wrap: wrap !important;\n            }\n            .acu-smart-fix-separator {\n                color: var(--acu-border) !important;\n                opacity: 0.5 !important;\n            }\n            .acu-smart-fix-diff {\n                display: flex !important;\n                align-items: center !important;\n                gap: 8px !important;\n                padding: 6px 0 !important;\n                margin: 4px 0 !important;\n                flex-wrap: wrap !important;\n            }\n            .acu-smart-fix-diff-old-text {\n                color: var(--acu-hl-manual) !important;\n                text-decoration: line-through !important;\n                opacity: 0.7 !important;\n                font-size: 13px !important;\n                white-space: nowrap !important;\n                overflow: hidden !important;\n                text-overflow: ellipsis !important;\n                max-width: 150px !important;\n            }\n            .acu-smart-fix-diff-arrow {\n                color: var(--acu-text-sub) !important;\n                flex-shrink: 0 !important;\n            }\n            .acu-smart-fix-empty {\n                opacity: 0.5 !important;\n                font-style: italic !important;\n            }\n            .acu-smart-fix-diff-input-wrapper {\n                flex: 1 !important;\n                min-width: 120px !important;\n            }\n            .acu-smart-fix-diff-input-wrapper input,\n            .acu-smart-fix-diff-input-wrapper select {\n                width: 100% !important;\n                background: var(--acu-input-bg, var(--acu-btn-bg)) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 4px !important;\n                padding: 4px 8px !important;\n                color: var(--acu-text-main) !important;\n                font-size: 13px !important;\n                font-weight: 500 !important;\n                box-shadow: none !important;\n                -webkit-appearance: none !important;\n                -moz-appearance: none !important;\n                appearance: none !important;\n                min-height: 26px !important;\n                line-height: 1.3 !important;\n            }\n            .acu-smart-fix-diff-input-wrapper input:focus,\n            .acu-smart-fix-diff-input-wrapper select:focus {\n                outline: none !important;\n                border-color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-diff-input-wrapper select {\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 10 10'%3E%3Cpath fill='%23666' d='M5 7L1 3h8z'/%3E%3C/svg%3E\") !important;\n                background-repeat: no-repeat !important;\n                background-position: right 6px center !important;\n                padding-right: 24px !important;\n            }\n            .acu-smart-fix-diff-input-wrapper select option {\n                background: var(--acu-card-bg) !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-smart-fix-suggest {\n                padding: 10px !important;\n                background: var(--acu-card-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n                margin-top: 8px !important;\n            }\n            .acu-smart-fix-suggest-label {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                margin-bottom: 6px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 4px !important;\n            }\n            .acu-smart-fix-suggest-label i {\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-suggest-value {\n                font-size: 13px !important;\n                color: var(--acu-success-text) !important;\n                font-weight: 500 !important;\n                padding: 6px 8px !important;\n                background: var(--acu-success-bg) !important;\n                border-radius: 4px !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-suggest-value:hover {\n                background: var(--acu-success-text) !important;\n                color: white !important;\n            }\n            .acu-smart-fix-suggest-options {\n                display: flex !important;\n                flex-wrap: wrap !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-suggest-options-scroll {\n                max-height: 120px !important;\n                overflow-y: auto !important;\n                padding-right: 4px !important;\n            }\n            .acu-smart-fix-option {\n                display: inline-block !important;\n                font-size: 12px !important;\n                padding: 4px 10px !important;\n                background: var(--acu-btn-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 4px !important;\n                color: var(--acu-text-main) !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-option:hover {\n                background: var(--acu-btn-hover) !important;\n                border-color: var(--acu-accent) !important;\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-option-current {\n                background: var(--acu-hl-manual-bg) !important;\n                border-color: var(--acu-hl-manual) !important;\n                color: var(--acu-hl-manual) !important;\n                text-decoration: line-through !important;\n                opacity: 0.7 !important;\n            }\n            .acu-smart-fix-error-hint {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 8px !important;\n                background: var(--acu-card-bg) !important;\n                border-radius: 4px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-error-hint i {\n                color: var(--acu-accent) !important;\n                flex-shrink: 0 !important;\n            }\n            @media (max-width: 600px) {\n                .acu-smart-fix-diff {\n                    flex-direction: column !important;\n                    align-items: stretch !important;\n                }\n                .acu-smart-fix-diff-arrow {\n                    transform: rotate(90deg) !important;\n                }\n            }\n            .acu-btn {\n                padding: 8px 16px;\n                border-radius: 6px;\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.2s;\n                border: 1px solid transparent;\n            }\n            .acu-btn-secondary {\n                background: var(--acu-btn-bg);\n                border-color: var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-btn-secondary:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-btn-primary {\n                background: var(--acu-accent);\n                color: white;\n            }\n            .acu-btn-primary:hover {\n                opacity: 0.9;\n            }\n            /*  */\n            .acu-smart-fix-rule-info {\n                padding: 10px 12px !important;\n                background: var(--acu-table-head) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-left: 3px solid var(--acu-accent) !important;\n                border-radius: 4px !important;\n                margin-bottom: 12px !important;\n            }\n            .acu-smart-fix-rule-header {\n                display: flex !important;\n                align-items: center !important;\n                gap: 8px !important;\n                font-size: 13px !important;\n                font-weight: 600 !important;\n                color: var(--acu-text-main) !important;\n                margin-bottom: 4px !important;\n            }\n            .acu-smart-fix-rule-header i {\n                color: var(--acu-accent) !important;\n            }\n            .acu-smart-fix-rule-desc {\n                font-size: 12px !important;\n                color: var(--acu-text-sub) !important;\n                line-height: 1.4 !important;\n            }\n            .acu-smart-fix-suggest-section {\n                margin-top: 12px !important;\n            }\n            .acu-smart-fix-suggest code {\n                background: var(--acu-table-head) !important;\n                padding: 2px 6px !important;\n                border-radius: 3px !important;\n                font-size: 11px !important;\n                color: var(--acu-text-main) !important;\n            }\n            .acu-smart-fix-quick-btn {\n                display: inline-flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n                padding: 6px 12px !important;\n                background: var(--acu-success-bg) !important;\n                color: var(--acu-success-text) !important;\n                border: 1px solid var(--acu-success-text) !important;\n                border-radius: 4px !important;\n                font-size: 12px !important;\n                font-weight: 500 !important;\n                cursor: pointer !important;\n                transition: all 0.2s !important;\n            }\n            .acu-smart-fix-quick-btn:hover {\n                background: var(--acu-success-text) !important;\n                color: white !important;\n            }\n            .acu-smart-fix-table-summary {\n                padding: 12px !important;\n                background: var(--acu-card-bg) !important;\n                border: 1px solid var(--acu-border) !important;\n                border-radius: 6px !important;\n            }\n            .acu-smart-fix-stat {\n                font-size: 13px !important;\n                color: var(--acu-text-main) !important;\n                margin-bottom: 8px !important;\n            }\n            .acu-smart-fix-stat strong {\n                color: var(--acu-hl-manual) !important;\n            }\n            .acu-smart-fix-change-list {\n                max-height: 150px !important;\n                overflow-y: auto !important;\n                margin-top: 8px !important;\n            }\n            .acu-smart-fix-change-item {\n                font-size: 11px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 4px 8px !important;\n                background: var(--acu-table-head) !important;\n                border-radius: 3px !important;\n                margin-bottom: 4px !important;\n            }\n            .acu-smart-fix-hint {\n                font-size: 12px !important;\n                color: var(--acu-text-sub) !important;\n                padding: 8px !important;\n                background: var(--acu-table-head) !important;\n                border-radius: 4px !important;\n                margin-top: 8px !important;\n                display: flex !important;\n                align-items: center !important;\n                gap: 6px !important;\n            }\n            .acu-smart-fix-hint i {\n                color: var(--acu-accent) !important;\n            }\n            /* ==========  ========== */\n            .acu-crop-modal-overlay {\n                z-index: 2147483658;\n            }\n            .acu-crop-modal {\n                background: var(--acu-bg-panel);\n                border: 1px solid var(--acu-border);\n                border-radius: 12px;\n                width: 90%;\n                max-width: 360px;\n                overflow: hidden;\n                box-shadow: 0 20px 60px rgba(0,0,0,0.5);\n            }\n            .acu-crop-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px 16px;\n                background: var(--acu-table-head);\n                border-bottom: 1px solid var(--acu-border);\n                font-size: 14px;\n                font-weight: bold;\n                color: var(--acu-accent);\n            }\n            .acu-crop-close {\n                background: none;\n                border: none;\n                color: var(--acu-text-sub);\n                font-size: 16px;\n                cursor: pointer;\n                padding: 4px;\n            }\n            .acu-crop-close:hover {\n                color: var(--acu-text-main);\n            }\n            .acu-crop-body {\n                padding: 20px;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                gap: 12px;\n            }\n            .acu-crop-container {\n                position: relative;\n                width: 200px;\n                height: 200px;\n                border-radius: 50%;\n                overflow: hidden;\n                touch-action: none;\n                user-select: none;\n            }\n            .acu-crop-image {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background-repeat: no-repeat;\n                cursor: grab;\n            }\n            .acu-crop-mask {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                border: 3px solid var(--acu-accent);\n                border-radius: 50%;\n                pointer-events: none;\n                box-shadow: 0 0 0 1000px rgba(0,0,0,0.3);\n            }\n            .acu-crop-hint {\n                font-size: 11px;\n                color: var(--acu-text-sub);\n                opacity: 0.7;\n            }\n            .acu-crop-footer {\n                display: flex;\n                gap: 10px;\n                padding: 12px 16px;\n                background: var(--acu-table-head);\n                border-top: 1px solid var(--acu-border);\n            }\n            .acu-crop-btn {\n                flex: 1;\n                padding: 10px 16px;\n                border-radius: 6px;\n                font-size: 13px;\n                font-weight: 500;\n                cursor: pointer;\n                transition: all 0.15s;\n            }\n            .acu-crop-cancel {\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n            }\n            .acu-crop-cancel:hover {\n                background: var(--acu-btn-hover);\n            }\n            .acu-crop-confirm {\n                background: var(--acu-accent);\n                border: 1px solid var(--acu-accent);\n                color: #fff;\n            }\n            .acu-crop-confirm:hover {\n                opacity: 0.9;\n            }\n            .acu-crop-reupload {\n                flex: 0 0 auto;\n                padding: 10px 14px;\n                background: var(--acu-btn-bg);\n                border: 1px solid var(--acu-border);\n                color: var(--acu-text-main);\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n            .acu-crop-reupload:hover {\n                background: var(--acu-btn-hover);\n                color: var(--acu-accent);\n            }\n    </style>\n    `;\n    $('head').append(styles);\n  };\n\n  const getTableData = () => {\n    const api = getCore().getDB();\n    return api && api.exportTableAsJson ? api.exportTableAsJson() : null;\n  };\n\n  const saveDataToDatabase = async (tableData, skipRender = false, commitDeletes = false) => {\n    if (isSaving) return; // \n    isSaving = true;\n    const { $ } = getCore();\n    const $saveBtn = $('#acu-btn-save-global');\n\n    // UI \n    if (!skipRender && $saveBtn.length) {\n      $saveBtn.find('i').removeClass('fa-save').addClass('fa-spinner fa-spin');\n      $saveBtn.prop('disabled', true);\n    }\n\n    try {\n      // 1.  sheet_  ( = )\n      const dataToSave = {};\n      //  mate \n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      // 2.  ()\n      if (commitDeletes) {\n        const deletions = getPendingDeletions();\n        Object.keys(deletions).forEach(key => {\n          if (dataToSave[key] && dataToSave[key].content) {\n            deletions[key]\n              .sort((a, b) => b - a)\n              .forEach(idx => {\n                if (dataToSave[key].content[idx + 1]) dataToSave[key].content.splice(idx + 1, 1);\n              });\n          }\n        });\n        savePendingDeletions({});\n      }\n\n      // 3.  API  ()\n      const api = getCore().getDB();\n      if (api && api.importTableAsJson) {\n        await api.importTableAsJson(JSON.stringify(dataToSave));\n      }\n\n      // 4. \n      cachedRawData = dataToSave;\n      saveSnapshot(dataToSave);\n      hasUnsavedChanges = false;\n      currentDiffMap = new Set();\n      if (window.acuModifiedSet) window.acuModifiedSet.clear();\n\n      if (!skipRender) {\n        renderInterface();\n      }\n    } catch (e) {\n      console.error('Save error:', e);\n      if (window.toastr) window.toastr.error('');\n    } finally {\n      isSaving = false;\n      if (!skipRender && $saveBtn.length) {\n        $saveBtn.find('i').removeClass('fa-spinner fa-spin').addClass('fa-save');\n        $saveBtn.prop('disabled', false);\n      }\n    }\n  };\n\n  // [] \n  const saveDataOnly = async tableData => {\n    try {\n      const dataToSave = {};\n      if (!tableData.mate) dataToSave.mate = { type: 'chatSheets', version: 1 };\n      else dataToSave.mate = tableData.mate;\n\n      Object.keys(tableData).forEach(k => {\n        if (k.startsWith('sheet_')) {\n          dataToSave[k] = tableData[k];\n        }\n      });\n\n      const api = getCore().getDB();\n      if (api && api.importTableAsJson) {\n        await api.importTableAsJson(JSON.stringify(dataToSave));\n      }\n\n      cachedRawData = dataToSave;\n      //  saveSnapshot() hasUnsavedChanges\n    } catch (e) {\n      console.error('[ACU] saveDataOnly error:', e);\n    }\n  };\n  const processJsonData = json => {\n    const tables = {};\n    if (!json || typeof json !== 'object') return tables;\n    for (const sheetId in json) {\n      if (json[sheetId]?.name) {\n        const sheet = json[sheetId];\n        tables[sheet.name] = {\n          key: sheetId,\n          headers: sheet.content ? sheet.content[0] || [] : [],\n          rows: sheet.content ? sheet.content.slice(1) : [],\n          rawContent: sheet.content || [],\n          exportConfig: sheet.exportConfig || {},\n          updateConfig: sheet.updateConfig || {},\n          ...sheet,\n        };\n      }\n    }\n    return tables;\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  // \n  function suggestFormatValue(pattern, rowIndex, existingValues = []) {\n    if (!pattern || rowIndex === undefined || rowIndex < 0) return null;\n\n    try {\n      //  \"+\"  ^AM\\d{3}$\n      // pattern  JavaScript  '^AM\\\\d{3}$' '^AM\\d{3}$'\n      //  \\d{3} /\\\\d\\{3\\}/+d\n      // ^?[]+\\d\\{\\}$?\n      const prefixMatch = pattern.match(/^\\^?([A-Za-z]+)\\\\d\\{(\\d+)\\}\\$?$/);\n\n      if (prefixMatch) {\n        const prefix = prefixMatch[1]; // \"AM\"\n        const digits = parseInt(prefixMatch[2], 10); // 3\n        const nextNum = String(rowIndex + 1).padStart(digits, '0'); // rowIndex0-based+1\n        return prefix + nextNum; // \"AM001\"\n      }\n\n      //  \\d{3} \n      const numOnlyMatch = pattern.match(/^\\^?\\\\d\\{(\\d+)\\}\\$?$/);\n      if (numOnlyMatch) {\n        const digits = parseInt(numOnlyMatch[1], 10);\n        return String(rowIndex + 1).padStart(digits, '0');\n      }\n    } catch (e) {\n      console.error('[ACU] :', e);\n    }\n\n    return null; // \n  }\n\n  //  OR \n  function getRelationOptions(refTable, refColumns, rawData) {\n    const options = new Set();\n    if (!refTable || !refColumns || !rawData) return Array.from(options);\n\n    const columns = Array.isArray(refColumns) ? refColumns : [refColumns];\n\n    // \n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === refTable) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n\n        // \n        columns.forEach(col => {\n          const colIdx = headers.indexOf(col);\n          if (colIdx >= 0) {\n            rows.forEach(row => {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                options.add(String(value).trim());\n              }\n            });\n          }\n        });\n\n        break; // \n      }\n    }\n\n    return Array.from(options).sort();\n  }\n\n  //  required \n  function getColumnExamples(tableName, columnName, currentRowIndex, rawData, maxCount = 5) {\n    const examples = new Set();\n    if (!tableName || !columnName || !rawData) return [];\n\n    for (const sheetId in rawData) {\n      if (rawData[sheetId]?.name === tableName) {\n        const headers = rawData[sheetId].content?.[0] || [];\n        const rows = rawData[sheetId].content?.slice(1) || [];\n        const colIdx = headers.indexOf(columnName);\n\n        if (colIdx >= 0) {\n          rows.forEach((row, idx) => {\n            if (idx !== currentRowIndex) {\n              const value = row?.[colIdx];\n              if (value !== null && value !== undefined && String(value).trim() !== '') {\n                examples.add(String(value).trim());\n              }\n            }\n          });\n        }\n        break;\n      }\n    }\n\n    return Array.from(examples).slice(0, maxCount);\n  }\n\n  // \n  function getNearestValidNumber(currentValue, min, max) {\n    const num = parseFloat(currentValue);\n    if (isNaN(num)) return min !== undefined ? min : 0;\n    if (min !== undefined && num < min) return min;\n    if (max !== undefined && num > max) return max;\n    return num;\n  }\n\n  // ========================================\n  // \n  // ========================================\n  const showAddValidationRuleModal = parentDialog => {\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const tables = processJsonData(rawData || {});\n    const tableNames = Object.keys(tables);\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\">\n          <div class=\"acu-settings-header\">\n            <div class=\"acu-settings-title\"><i class=\"fa-solid fa-plus\"></i> </div>\n            <button class=\"acu-close-btn\" id=\"dlg-rule-close\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n          <div class=\"acu-validation-modal-body\">\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-name\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-table\" class=\"acu-setting-select\">\n                <option value=\"\">...</option>\n                ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n              </select>\n            </div>\n            <div class=\"acu-setting-row\" id=\"row-column\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-column\" class=\"acu-setting-select\" disabled>\n                <option value=\"\">...</option>\n              </select>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <select id=\"rule-type\" class=\"acu-setting-select\">\n                <optgroup label=\"  \">\n                  <option value=\"tableReadonly\"></option>\n                  <option value=\"rowLimit\"></option>\n                </optgroup>\n                <optgroup label=\"  \">\n                  <option value=\"required\"></option>\n                  <option value=\"format\"></option>\n                  <option value=\"enum\"></option>\n                  <option value=\"numeric\"></option>\n                  <option value=\"relation\"></option>\n                </optgroup>\n              </select>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-tableReadonly\">\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:8px;background:var(--acu-card-bg);border-radius:4px;\">\n                <i class=\"fa-solid fa-info-circle\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-rowLimit\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-row-max\" class=\"acu-panel-input\" placeholder=\"\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-required\" style=\"display:none;\">\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:8px;background:var(--acu-card-bg);border-radius:4px;\">\n                <i class=\"fa-solid fa-info-circle\"></i> \n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-format\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-pattern\" class=\"acu-panel-input\" placeholder=\"^AM\\\\d{3}$\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-enum\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"text\" id=\"cfg-values\" class=\"acu-panel-input\" placeholder=\",,\" style=\"flex:1;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-numeric\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-min\" class=\"acu-panel-input\" placeholder=\"0\" style=\"width:80px;\">\n                <div class=\"acu-setting-info\" style=\"margin-left:16px;\"><span class=\"acu-setting-label\"></span></div>\n                <input type=\"number\" id=\"cfg-max\" class=\"acu-panel-input\" placeholder=\"100\" style=\"width:80px;\">\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"acu-rule-config-section\" id=\"config-relation\" style=\"display:none;\">\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-table\" class=\"acu-setting-select\">\n                  <option value=\"\">...</option>\n                  ${tableNames.map(name => `<option value=\"${escapeHtml(name)}\">${escapeHtml(name)}</option>`).join('')}\n                </select>\n              </div>\n              <div class=\"acu-setting-row\">\n                <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n                <select id=\"cfg-ref-column\" class=\"acu-setting-select\" multiple style=\"flex:1;min-height:80px;\">\n                  <option value=\"\">...</option>\n                </select>\n              </div>\n              <div style=\"font-size:11px;color:var(--acu-text-sub);padding:8px;background:var(--acu-card-bg);border-radius:4px;margin-top:8px;\">\n                <i class=\"fa-solid fa-info-circle\"></i> OR  Ctrl/Cmd \n              </div>\n            </div>\n            <div class=\"acu-setting-row\">\n              <div class=\"acu-setting-info\"><span class=\"acu-setting-label\"></span></div>\n              <input type=\"text\" id=\"rule-error-msg\" class=\"acu-panel-input\" placeholder=\"\" style=\"flex:1;\">\n            </div>\n          </div>\n          <div class=\"acu-validation-modal-footer\">\n            <button class=\"acu-btn acu-btn-secondary\" id=\"dlg-rule-cancel\"></button>\n            <button class=\"acu-btn acu-btn-primary\" id=\"dlg-rule-save\"></button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    dialog.find('#rule-table').on('change', function () {\n      const tableName = $(this).val();\n      const $colSelect = dialog.find('#rule-column');\n\n      if (!tableName || !tables[tableName]) {\n        $colSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        return;\n      }\n\n      const headers = tables[tableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $colSelect.html('<option value=\"\">...</option>' + options).prop('disabled', false);\n    });\n\n    // \n    dialog.find('#cfg-ref-table').on('change', function () {\n      const refTableName = $(this).val();\n      const $refColSelect = dialog.find('#cfg-ref-column');\n\n      if (!refTableName || !tables[refTableName]) {\n        $refColSelect.html('<option value=\"\">...</option>').prop('disabled', true);\n        return;\n      }\n\n      const headers = tables[refTableName].headers || [];\n      const options = headers\n        .filter((h, i) => i > 0 && h) // \n        .map(h => `<option value=\"${escapeHtml(h)}\">${escapeHtml(h)}</option>`)\n        .join('');\n\n      $refColSelect.html(options).prop('disabled', false);\n    });\n\n    // \n    dialog.find('#rule-type').on('change', function () {\n      const type = $(this).val();\n      const typeInfo = RULE_TYPE_INFO[type];\n      const isTableRule = typeInfo?.scope === 'table';\n\n      // \n      dialog.find('.acu-rule-config-section').hide();\n      dialog.find('#config-' + type).show();\n\n      // \n      if (isTableRule) {\n        dialog.find('#row-column').hide();\n        dialog.find('#rule-column').val('').prop('disabled', true);\n      } else {\n        dialog.find('#row-column').show();\n        // \n        if (dialog.find('#rule-table').val()) {\n          dialog.find('#rule-column').prop('disabled', false);\n        }\n      }\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#dlg-rule-close, #dlg-rule-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-rule-save').on('click', function () {\n      const name = dialog.find('#rule-name').val()?.trim();\n      const targetTable = dialog.find('#rule-table').val();\n      const targetColumn = dialog.find('#rule-column').val();\n      const ruleType = dialog.find('#rule-type').val();\n      const errorMessage = dialog.find('#rule-error-msg').val()?.trim();\n      const typeInfo = RULE_TYPE_INFO[ruleType];\n      const isTableRule = typeInfo?.scope === 'table';\n\n      // \n      if (!name) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!targetTable) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      // \n      if (!isTableRule && !targetColumn) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      const ruleConfig = {};\n      if (ruleType === 'tableReadonly') {\n        // \n      } else if (ruleType === 'rowLimit') {\n        const min = dialog.find('#cfg-row-min').val();\n        const max = dialog.find('#cfg-row-max').val();\n        if (min !== '') ruleConfig.min = parseInt(min, 10);\n        if (max !== '') ruleConfig.max = parseInt(max, 10);\n      } else if (ruleType === 'required') {\n        // \n      } else if (ruleType === 'format') {\n        const pattern = dialog.find('#cfg-pattern').val()?.trim();\n        if (!pattern) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        // \n        try {\n          new RegExp(pattern);\n        } catch (e) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n        ruleConfig.pattern = pattern;\n      } else if (ruleType === 'enum') {\n        const valuesStr = dialog.find('#cfg-values').val()?.trim();\n        if (!valuesStr) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        ruleConfig.values = valuesStr\n          .split(',')\n          .map(v => v.trim())\n          .filter(v => v);\n      } else if (ruleType === 'numeric') {\n        const min = dialog.find('#cfg-min').val();\n        const max = dialog.find('#cfg-max').val();\n        if (min !== '') ruleConfig.min = parseFloat(min);\n        if (max !== '') ruleConfig.max = parseFloat(max);\n      } else if (ruleType === 'relation') {\n        const refTable = dialog.find('#cfg-ref-table').val();\n        const refColumns = dialog.find('#cfg-ref-column').val(); // \n\n        if (!refTable) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        const selectedColumns = Array.isArray(refColumns) ? refColumns : refColumns ? [refColumns] : [];\n        if (selectedColumns.length === 0 || (selectedColumns.length === 1 && !selectedColumns[0])) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        ruleConfig.refTable = refTable;\n        // \n        ruleConfig.refColumn = selectedColumns.length === 1 ? selectedColumns[0] : selectedColumns;\n      }\n\n      //  ID\n      const ruleId = 'custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);\n\n      // \n      const newRule = {\n        id: ruleId,\n        name: name,\n        description: '',\n        targetTable: targetTable,\n        targetColumn: isTableRule ? '' : targetColumn, //  targetColumn\n        ruleType: ruleType,\n        config: ruleConfig,\n        errorMessage: errorMessage || typeInfo?.desc || '',\n        intercept: false, // \n      };\n\n      if (ValidationRuleManager.addCustomRule(newRule)) {\n        closeDialog();\n\n        // \n        const $rulesList = parentDialog.find('#validation-rules-list');\n        const ruleHtml = `\n          <div class=\"acu-validation-rule-item\" data-rule-id=\"${escapeHtml(ruleId)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo?.name || ruleType)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo?.icon || 'fa-question'}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(targetTable)}${isTableRule ? ' ()' : '.' + escapeHtml(targetColumn)}</div>\n            </div>\n            <div class=\"acu-rule-intercept\" data-rule-id=\"${escapeHtml(ruleId)}\" title=\"\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <div class=\"acu-rule-toggle active\" title=\"/\">\n              <i class=\"fa-solid fa-toggle-on\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(ruleId)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>\n        `;\n        $rulesList.append(ruleHtml);\n        // \n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showSmartFixModal = error => {\n    if (!error || !error.rule) {\n      if (window.toastr) window.toastr.warning('');\n      return;\n    }\n\n    const { $ } = getCore();\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const rule = error.rule;\n    const ruleType = error.ruleType || rule.ruleType;\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n    const isTableRule = typeInfo?.scope === 'table';\n\n    // \n    const rawData = cachedRawData || getTableData();\n    const snapshot = loadSnapshot();\n\n    // \n    let snapshotValue = '';\n    if (!isTableRule && snapshot && error.tableName && error.columnName !== undefined) {\n      for (const sheetId in snapshot) {\n        if (snapshot[sheetId]?.name === error.tableName) {\n          const headers = snapshot[sheetId].content?.[0] || [];\n          const colIdx = headers.indexOf(error.columnName);\n          const rowIdx = error.rowIndex + 1;\n          if (colIdx >= 0 && snapshot[sheetId].content?.[rowIdx]) {\n            snapshotValue = snapshot[sheetId].content[rowIdx][colIdx] ?? '';\n          }\n          break;\n        }\n      }\n    }\n\n    const hasSnapshotValue = snapshotValue !== '' && String(snapshotValue) !== String(error.currentValue || '');\n\n    // ========================================\n    // \n    // ========================================\n    if (isTableRule) {\n      showTableRuleFixModal(error, rule, ruleType, rawData, snapshot, currentThemeClass);\n      return;\n    }\n\n    // ========================================\n    // \n    // ========================================\n\n    // UI\n    let inputHtml = '';\n\n    if (ruleType === 'enum' && rule.config?.values) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'numeric') {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    } else {\n      // \n      inputHtml = `<textarea id=\"smart-fix-value\" class=\"acu-edit-textarea\" spellcheck=\"false\"\n        style=\"width:100%;min-height:60px;max-height:200px;resize:none;\">${escapeHtml(error.currentValue || '')}</textarea>`;\n    }\n\n    // \n    let smartSuggestHtml = '';\n\n    if (ruleType === 'required') {\n      // \n      const examples = getColumnExamples(error.tableName, error.columnName, error.rowIndex, rawData, 5);\n      if (examples.length > 0) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            <div class=\"acu-smart-fix-suggest-label\">\n              <i class=\"fa-solid fa-lightbulb\"></i> :\n            </div>\n            <div class=\"acu-smart-fix-suggest-options\">\n              ${examples\n                .map(\n                  val => `\n                <span class=\"acu-smart-fix-option\" data-value=\"${escapeHtml(val)}\" title=\"\">\n                  ${escapeHtml(val.length > 20 ? val.substring(0, 20) + '...' : val)}\n                </span>\n              `,\n                )\n                .join('')}\n            </div>\n          </div>\n        `;\n      }\n    } else if (ruleType === 'enum' && rule.config?.values) {\n      // \n      const validValues = rule.config.values;\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-list\"></i>  ():\n          </div>\n          <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\">\n            ${validValues\n              .map(\n                val => `\n              <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                    data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                ${escapeHtml(val)}\n              </span>\n            `,\n              )\n              .join('')}\n          </div>\n        </div>\n      `;\n    } else if (ruleType === 'format' && rule.config?.pattern) {\n      // \n      const suggestedValue = suggestFormatValue(rule.config.pattern, error.rowIndex);\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-font\"></i> : <code>${escapeHtml(rule.config.pattern)}</code>\n          </div>\n          ${\n            suggestedValue\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-suggest-label\" style=\"margin-bottom:4px;display:block;\">\n                <i class=\"fa-solid fa-lightbulb\"></i> :\n              </span>\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${escapeHtml(suggestedValue)}\">\n                <i class=\"fa-solid fa-magic\"></i> ${escapeHtml(suggestedValue)}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'numeric') {\n      // \n      const min = rule.config?.min;\n      const max = rule.config?.max;\n      const currentNum = parseFloat(error.currentValue);\n      const isOutOfRange =\n        !isNaN(currentNum) && ((min !== undefined && currentNum < min) || (max !== undefined && currentNum > max));\n      const nearestValid = isOutOfRange ? getNearestValidNumber(error.currentValue, min, max) : null;\n\n      smartSuggestHtml = `\n        <div class=\"acu-smart-fix-suggest\">\n          <div class=\"acu-smart-fix-suggest-label\">\n            <i class=\"fa-solid fa-hashtag\"></i> : ${min !== undefined ? min : '-'} ~ ${max !== undefined ? max : '+'}\n          </div>\n          ${\n            isOutOfRange && nearestValid !== null\n              ? `\n            <div style=\"margin-top:8px;\">\n              <span class=\"acu-smart-fix-quick-btn\" data-value=\"${nearestValid}\">\n                <i class=\"fa-solid fa-arrow-right\"></i>  ${nearestValid}\n              </span>\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n    } else if (ruleType === 'relation' && rule.config?.refTable && rule.config?.refColumn) {\n      // \n      const options = getRelationOptions(rule.config.refTable, rule.config.refColumn, rawData);\n      if (options.length > 0) {\n        smartSuggestHtml = `\n          <div class=\"acu-smart-fix-suggest\">\n            <div class=\"acu-smart-fix-suggest-label\">\n              <i class=\"fa-solid fa-link\"></i>  \"${escapeHtml(rule.config.refTable)}\"  (${options.length}):\n            </div>\n            <div class=\"acu-smart-fix-suggest-options acu-smart-fix-suggest-options-scroll\" id=\"smart-fix-options-container\">\n              ${options\n                .map(\n                  val => `\n                <span class=\"acu-smart-fix-option ${error.currentValue === val ? 'acu-smart-fix-option-current' : ''}\"\n                      data-value=\"${escapeHtml(val)}\" title=\"${error.currentValue === val ? '' : ''}\">\n                  ${escapeHtml(val)}\n                </span>\n              `,\n                )\n                .join('')}\n            </div>\n          </div>\n        `;\n      }\n    }\n\n    // HTML\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} - ${escapeHtml(error.columnName || '')}</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            <!--  -->\n            <div class=\"acu-smart-fix-rule-info\">\n              <div class=\"acu-smart-fix-rule-header\">\n                <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                <span>${escapeHtml(error.ruleName || rule.name || '')}</span>\n              </div>\n              <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || typeInfo.desc || '')}</div>\n            </div>\n\n            <!--  -->\n            ${\n              hasSnapshotValue\n                ? `\n              <div class=\"acu-diff-section acu-diff-old-section\">\n                <div class=\"acu-diff-label\">\n                  <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                </div>\n                <div class=\"acu-diff-readonly\">${escapeHtml(snapshotValue)}</div>\n              </div>\n              <div class=\"acu-diff-arrow-down\"><i class=\"fa-solid fa-arrow-down\"></i></div>\n            `\n                : ''\n            }\n\n            <!--  -->\n            <div class=\"acu-diff-section acu-diff-new-section\">\n              <div class=\"acu-diff-label\">\n                <i class=\"fa-solid fa-pen\"></i> \n              </div>\n              ${inputHtml}\n            </div>\n\n            <!--  -->\n            ${\n              smartSuggestHtml\n                ? `\n              <div class=\"acu-smart-fix-suggest-section\">\n                ${smartSuggestHtml}\n              </div>\n            `\n                : ''\n            }\n          </div>\n          <div class=\"acu-dialog-btns\">\n            <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n            ${hasSnapshotValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n            <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-confirm\"><i class=\"fa-solid fa-check\"></i> </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    dialog.on('click', '.acu-smart-fix-option, .acu-smart-fix-quick-btn', function () {\n      if ($(this).hasClass('acu-smart-fix-option-current')) return;\n      const optionValue = $(this).data('value') || $(this).text().trim();\n      dialog.find('#smart-fix-value').val(optionValue).trigger('input');\n    });\n\n    // \n    dialog.on('click', '#smart-fix-revert', function () {\n      dialog.find('#smart-fix-value').val(snapshotValue);\n    });\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-close, #smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#smart-fix-confirm').on('click', async function () {\n      const newValue = dialog.find('#smart-fix-value').val()?.trim() || '';\n\n      if (newValue === '' && ruleType === 'required') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      // \n      try {\n        const rawData = cachedRawData || getTableData();\n        let updated = false;\n\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName) {\n            const sheet = rawData[sheetId];\n            const headers = sheet.content?.[0] || [];\n\n            if (error.rowIndex >= 0 && error.columnName) {\n              const colIdx = headers.indexOf(error.columnName);\n              const rowIdx = error.rowIndex + 1;\n\n              if (colIdx >= 0 && sheet.content && sheet.content[rowIdx]) {\n                sheet.content[rowIdx][colIdx] = newValue;\n                updated = true;\n                break;\n              }\n            }\n          }\n        }\n\n        if (updated) {\n          await saveDataToDatabase(rawData, false, false);\n          closeDialog();\n          renderInterface();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      } catch (e) {\n        console.error('[ACU] :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n  const showTableRuleFixModal = (error, rule, ruleType, rawData, snapshot, currentThemeClass) => {\n    const { $ } = getCore();\n    const typeInfo = RULE_TYPE_INFO[ruleType] || { name: ruleType, icon: 'fa-question' };\n\n    let contentHtml = '';\n    let actionBtns = '';\n\n    if (ruleType === 'tableReadonly') {\n      // \n      let changeCount = 0;\n      let changeDetails = [];\n\n      if (snapshot && rawData) {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            const newRows = rawData[sheetId].content?.slice(1) || [];\n            const oldRows = snapshot[sheetId].content?.slice(1) || [];\n\n            // \n            newRows.forEach((row, idx) => {\n              const oldRow = oldRows[idx];\n              if (!oldRow) {\n                changeDetails.push(`${idx + 1}: `);\n                changeCount++;\n              } else {\n                for (let c = 0; c < row.length; c++) {\n                  if (String(row[c] || '') !== String(oldRow[c] || '')) {\n                    changeDetails.push(`${idx + 1}: `);\n                    changeCount++;\n                    break;\n                  }\n                }\n              }\n            });\n\n            // \n            if (oldRows.length > newRows.length) {\n              for (let i = newRows.length; i < oldRows.length; i++) {\n                changeDetails.push(`${i + 1}: `);\n                changeCount++;\n              }\n            }\n            break;\n          }\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-lock\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\"></div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            <i class=\"fa-solid fa-exclamation-triangle\"></i>\n             <strong>${changeCount}</strong> \n          </div>\n          ${\n            changeDetails.length > 0\n              ? `\n            <div class=\"acu-smart-fix-change-list\">\n              ${changeDetails\n                .slice(0, 10)\n                .map(d => `<div class=\"acu-smart-fix-change-item\">${escapeHtml(d)}</div>`)\n                .join('')}\n              ${changeDetails.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${changeDetails.length - 10} </div>` : ''}\n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n      actionBtns = `\n        <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n        <button class=\"acu-dialog-btn acu-btn-revert\" id=\"smart-fix-restore-table\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n      `;\n    } else if (ruleType === 'rowLimit') {\n      // \n      const minRows = rule.config?.min;\n      const maxRows = rule.config?.max;\n      let currentRowCount = 0;\n      let excessRows = [];\n\n      for (const sheetId in rawData) {\n        if (rawData[sheetId]?.name === error.tableName) {\n          currentRowCount = (rawData[sheetId].content?.length || 1) - 1; // \n          break;\n        }\n      }\n\n      const isTooMany = maxRows !== undefined && currentRowCount > maxRows;\n      const isTooFew = minRows !== undefined && currentRowCount < minRows;\n\n      if (isTooMany) {\n        for (let i = maxRows + 1; i <= currentRowCount; i++) {\n          excessRows.push(i);\n        }\n      }\n\n      contentHtml = `\n        <div class=\"acu-smart-fix-rule-info\">\n          <div class=\"acu-smart-fix-rule-header\">\n            <i class=\"fa-solid fa-arrows-up-down\"></i>\n            <span></span>\n          </div>\n          <div class=\"acu-smart-fix-rule-desc\">${escapeHtml(error.errorMessage || rule.errorMessage || '')}</div>\n        </div>\n        <div class=\"acu-smart-fix-table-summary\">\n          <div class=\"acu-smart-fix-stat\">\n            : <strong>${currentRowCount}</strong> \n            ${minRows !== undefined || maxRows !== undefined ? ` | : ${minRows !== undefined ? minRows : 0} ~ ${maxRows !== undefined ? maxRows : ''} ` : ''}\n          </div>\n          ${\n            isTooMany && excessRows.length > 0\n              ? `\n            <div class=\"acu-smart-fix-excess-rows\">\n              <div class=\"acu-smart-fix-suggest-label\">\n                <i class=\"fa-solid fa-trash\"></i>  ( ${excessRows[0]} ):\n              </div>\n              <div class=\"acu-smart-fix-change-list\">\n                ${excessRows\n                  .slice(0, 10)\n                  .map(r => `<div class=\"acu-smart-fix-change-item\"> ${r} </div>`)\n                  .join('')}\n                ${excessRows.length > 10 ? `<div class=\"acu-smart-fix-change-item\">...  ${excessRows.length} </div>` : ''}\n              </div>\n            </div>\n          `\n              : ''\n          }\n          ${\n            isTooFew\n              ? `\n            <div class=\"acu-smart-fix-hint\">\n              <i class=\"fa-solid fa-info-circle\"></i>  ${minRows - currentRowCount} \n            </div>\n          `\n              : ''\n          }\n        </div>\n      `;\n\n      if (isTooMany && excessRows.length > 0) {\n        actionBtns = `\n          <button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n          <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"smart-fix-delete-rows\" data-start=\"${maxRows}\" data-table=\"${escapeHtml(error.tableName)}\">\n            <i class=\"fa-solid fa-trash\"></i>  ${excessRows.length} \n          </button>\n        `;\n      } else {\n        actionBtns = `<button class=\"acu-dialog-btn\" id=\"smart-fix-cancel\"><i class=\"fa-solid fa-times\"></i> </button>`;\n      }\n    }\n\n    const dialog = $(`\n      <div class=\"acu-edit-overlay acu-validation-modal-overlay\">\n        <div class=\"acu-edit-dialog acu-validation-modal ${currentThemeClass}\" style=\"max-width:450px;\">\n          <div class=\"acu-edit-title\">: ${escapeHtml(error.tableName || '')} ()</div>\n          <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n            ${contentHtml}\n          </div>\n          <div class=\"acu-dialog-btns\">\n            ${actionBtns}\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(dialog);\n\n    // \n    const closeDialog = () => dialog.remove();\n    dialog.on('click', '#smart-fix-cancel', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-validation-modal-overlay')) closeDialog();\n    });\n\n    // \n    dialog.on('click', '#smart-fix-restore-table', async function () {\n      if (!snapshot) {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n\n      try {\n        // \n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === error.tableName && snapshot[sheetId]) {\n            rawData[sheetId] = JSON.parse(JSON.stringify(snapshot[sheetId]));\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[ACU] :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n\n    // \n    dialog.on('click', '#smart-fix-delete-rows', async function () {\n      const startRow = parseInt($(this).data('start'), 10);\n      const tableName = $(this).data('table');\n\n      try {\n        for (const sheetId in rawData) {\n          if (rawData[sheetId]?.name === tableName) {\n            // (index 0) startRow (index 1  startRow)\n            rawData[sheetId].content = rawData[sheetId].content.slice(0, startRow + 1);\n            break;\n          }\n        }\n\n        await saveDataToDatabase(rawData, false, false);\n        closeDialog();\n        renderInterface();\n      } catch (e) {\n        console.error('[ACU] :', e);\n        if (window.toastr) window.toastr.error(': ' + (e.message || ''));\n      }\n    });\n  };\n\n  // ========================================\n  // \n  // ========================================\n\n  const showAttributePresetManager = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const presets = AttributePresetManager.getAllPresets();\n    const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n\n    // HTML\n    const presetsHtml = presets\n      .map(preset => {\n        const isActive = preset.id === activeId;\n        const isBuiltin = preset.builtin;\n\n        return `\n        <div class=\"acu-preset-item ${isActive ? 'active' : ''}\" data-id=\"${preset.id}\">\n          <div class=\"acu-preset-info\">\n            <div class=\"acu-preset-name\">\n              ${escapeHtml(preset.name)}\n              ${isBuiltin ? `<span style=\"font-size: 10px; color: ${t.textSub}; margin-left: 6px;\">()</span>` : ''}\n            </div>\n            ${preset.description ? `<div class=\"acu-preset-desc\">${escapeHtml(preset.description)}</div>` : ''}\n            <div class=\"acu-preset-stats\">\n              : ${preset.baseAttributes.length} | : ${preset.specialAttributes?.length || 0}\n            </div>\n          </div>\n          <div class=\"acu-preset-actions\" style=\"display: flex; align-items: center; gap: 8px;\">\n            <label class=\"acu-toggle\" style=\"margin: 0;\">\n              <input type=\"checkbox\" class=\"acu-preset-toggle\" data-id=\"${preset.id}\" ${isActive ? 'checked' : ''}>\n              <span class=\"acu-toggle-slider\"></span>\n            </label>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-edit\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>` : ''}\n            <button class=\"acu-preset-btn acu-preset-export\" data-id=\"${preset.id}\" title=\"\"><i class=\"fa-solid fa-download\"></i></button>\n            ${!isBuiltin ? `<button class=\"acu-preset-btn acu-preset-delete\" data-id=\"${preset.id}\" title=\"\" style=\"color: #e74c3c;\"><i class=\"fa-solid fa-trash\"></i></button>` : ''}\n          </div>\n        </div>\n      `;\n      })\n      .join('');\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 600px; max-width: 92vw; max-height: 80vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-dice-d20\"></i> \n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div id=\"acu-presets-list\">\n              ${presetsHtml || `<div style=\"text-align: center; padding: 40px; color: ${t.textSub};\"></div>`}\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"acu-preset-new\" style=\"flex: 1; padding: 10px; background: ${t.accent}; border: none; border-radius: 6px; color: #fff; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-plus\"></i> \n            </button>\n            <button id=\"acu-preset-import\" style=\"flex: 1; padding: 10px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-file-import\"></i> \n            </button>\n            <button id=\"acu-preset-back\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-arrow-left\"></i> \n            </button>\n          </div>\n\n          <input type=\"file\" id=\"acu-preset-file-input\" accept=\".json\" style=\"display: none;\" />\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    // \n    overlay.find('.acu-close-btn, #acu-preset-back').on('click', () => {\n      overlay.remove();\n      showSettingsModal();\n    });\n\n    // Toggle\n    overlay.on('change', '.acu-preset-toggle', function () {\n      const $toggle = $(this);\n      const id = $toggle.data('id');\n      const isChecked = $toggle.is(':checked');\n\n      if (isChecked) {\n        // \n        AttributePresetManager.setActivePreset(id);\n\n        // toggle\n        overlay.find('.acu-preset-toggle').each(function () {\n          const $thisToggle = $(this);\n          const thisId = $thisToggle.data('id');\n          if (thisId !== id) {\n            $thisToggle.prop('checked', false);\n          }\n        });\n\n        // active\n        overlay.find('.acu-preset-item').removeClass('active');\n        overlay.find(`.acu-preset-item[data-id=\"${id}\"]`).addClass('active');\n      } else {\n        // null\n        AttributePresetManager.setActivePreset(null);\n\n        // active\n        overlay.find('.acu-preset-item').removeClass('active');\n      }\n    });\n\n    // \n    overlay.on('click', '.acu-preset-edit', function () {\n      const id = $(this).data('id');\n      overlay.remove();\n      showAttributePresetEditor(id);\n    });\n\n    // \n    overlay.on('click', '.acu-preset-export', function () {\n      const id = $(this).data('id');\n      const json = AttributePresetManager.exportPreset(id);\n      if (!json) {\n        if (window.toastr) window.toastr.error('');\n        return;\n      }\n\n      const preset = presets.find(p => p.id === id);\n      const filename = `acu_preset_${preset?.name || id}_${Date.now()}.json`;\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n\n      if (window.toastr) window.toastr.success('');\n    });\n\n    // \n    overlay.on('click', '.acu-preset-delete', function () {\n      const id = $(this).data('id');\n      const preset = presets.find(p => p.id === id);\n\n      if (confirm(`${preset?.name}`)) {\n        const success = AttributePresetManager.deletePreset(id);\n        if (success) {\n          if (window.toastr) window.toastr.success('');\n          overlay.remove();\n          showAttributePresetManager();\n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      }\n    });\n\n    // \n    overlay.find('#acu-preset-new').on('click', () => {\n      overlay.remove();\n      showAttributePresetEditor();\n    });\n\n    // \n    overlay.find('#acu-preset-import').on('click', () => {\n      overlay.find('#acu-preset-file-input').click();\n    });\n\n    overlay.find('#acu-preset-file-input').on('change', function (e) {\n      const file = e.target.files[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = evt => {\n        try {\n          const imported = AttributePresetManager.importPreset(evt.target.result);\n          if (imported) {\n            if (window.toastr) window.toastr.success(`${imported.name}`);\n            overlay.remove();\n            showAttributePresetManager();\n          } else {\n            if (window.toastr) window.toastr.error('');\n          }\n        } catch (err) {\n          console.error('[ACU] :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      };\n      reader.readAsText(file);\n\n      // \n      $(this).val('');\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showSettingsModal();\n      }\n    });\n  };\n\n  // \n  const showAttributePresetEditor = (presetId = null) => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').remove();\n\n    const config = getConfig();\n    const t = getThemeColors();\n    const isEdit = !!presetId;\n    const existingPreset = isEdit ? AttributePresetManager.getAllPresets().find(p => p.id === presetId) : null;\n\n    // \n    const defaultData = {\n      name: existingPreset?.name || '',\n      description: existingPreset?.description || '',\n      baseAttributes: existingPreset?.baseAttributes || [\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n        { name: '', formula: '3d6', range: [3, 18] },\n      ],\n      specialAttributes: existingPreset?.specialAttributes || [],\n    };\n\n    const overlay = $(`\n      <div class=\"acu-edit-overlay\">\n        <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"width: 650px; max-width: 95vw; max-height: 85vh;\">\n          <div style=\"display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid ${t.border};\">\n            <div style=\"font-size: 16px; font-weight: bold; color: ${t.textMain};\">\n              <i class=\"fa-solid fa-pen\"></i> ${isEdit ? '' : ''}\n            </div>\n            <button class=\"acu-close-btn\"><i class=\"fa-solid fa-times\"></i></button>\n          </div>\n\n          <div style=\"flex: 1; overflow-y: auto; padding: 12px 0;\">\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-name\" type=\"text\" value=\"${escapeHtml(defaultData.name)}\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 4px;\"></label>\n              <input id=\"preset-desc\" type=\"text\" value=\"${escapeHtml(defaultData.description)}\" placeholder=\"\" class=\"acu-preset-editor-input\" style=\"width: 100%; padding: 8px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; box-sizing: border-box;\" />\n            </div>\n\n            <div style=\"margin-bottom: 16px;\">\n              <label style=\"display: block; font-size: 12px; color: ${t.textSub}; margin-bottom: 8px;\">\n                JSON <span style=\"font-size: 10px; color: ${t.textSub};\">()</span>\n              </label>\n              <textarea id=\"preset-json\" class=\"acu-preset-editor-textarea\" style=\"width: 100%; height: 320px; padding: 10px; border: 1px solid ${t.border} !important; border-radius: 6px; background: ${t.inputBg} !important; color: ${t.textMain} !important; font-family: 'Consolas', 'Monaco', monospace !important; font-size: 12px; resize: vertical; box-sizing: border-box;\"></textarea>\n            </div>\n\n            <div style=\"font-size: 11px; color: ${t.textSub}; padding: 8px; background: var(--acu-table-head); border-radius: 6px; line-height: 1.6;\">\n              <strong></strong><br/>\n               baseAttributes:  nameformularangemodifier()<br/>\n               specialAttributes:  nameformularange()<br/>\n               : 3d6, 4d6kh3, (/2), (+-*/)\n            </div>\n          </div>\n\n          <div style=\"display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid ${t.border};\">\n            <button id=\"preset-save\" style=\"flex: 1; padding: 10px; background: ${t.accent}; border: none; border-radius: 6px; color: #fff; cursor: pointer; font-size: 13px; font-weight: bold;\">\n              <i class=\"fa-solid fa-check\"></i> \n            </button>\n            <button id=\"preset-cancel\" style=\"padding: 10px 16px; background: ${t.btnBg}; border: 1px solid ${t.border}; border-radius: 6px; color: ${t.textMain}; cursor: pointer; font-size: 13px;\">\n              <i class=\"fa-solid fa-times\"></i> \n            </button>\n          </div>\n        </div>\n      </div>\n    `);\n\n    $('body').append(overlay);\n\n    const $jsonTextarea = overlay.find('#preset-json');\n\n    // JSON\n    const updateJSON = () => {\n      const data = {\n        baseAttributes: defaultData.baseAttributes,\n        specialAttributes: defaultData.specialAttributes,\n      };\n      $jsonTextarea.val(JSON.stringify(data, null, 2));\n    };\n    updateJSON();\n\n    // \n    overlay.find('.acu-close-btn, #preset-cancel').on('click', () => {\n      overlay.remove();\n      showAttributePresetManager();\n    });\n\n    // \n    overlay.find('#preset-save').on('click', () => {\n      try {\n        const name = overlay.find('#preset-name').val().trim();\n        const description = overlay.find('#preset-desc').val().trim();\n        const jsonStr = $jsonTextarea.val().trim();\n\n        if (!name) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // JSON\n        const jsonData = JSON.parse(jsonStr);\n\n        // \n        if (\n          !jsonData.baseAttributes ||\n          !Array.isArray(jsonData.baseAttributes) ||\n          jsonData.baseAttributes.length === 0\n        ) {\n          if (window.toastr) window.toastr.error('');\n          return;\n        }\n\n        // \n        const preset = {\n          format: 'acu_attr_preset_v1',\n          version: 1,\n          id: presetId || `custom_${Date.now()}`,\n          name,\n          description,\n          baseAttributes: jsonData.baseAttributes,\n          specialAttributes: jsonData.specialAttributes || [],\n        };\n\n        // \n        if (isEdit) {\n          AttributePresetManager.updatePreset(presetId, preset);\n          if (window.toastr) window.toastr.success('');\n        } else {\n          AttributePresetManager.createPreset(preset);\n          if (window.toastr) window.toastr.success('');\n        }\n\n        overlay.remove();\n        showAttributePresetManager();\n      } catch (err) {\n        console.error('[ACU] :', err);\n        if (window.toastr) window.toastr.error('' + (err.message || 'JSON'));\n      }\n    });\n\n    // \n    overlay.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) {\n        overlay.remove();\n        showAttributePresetManager();\n      }\n    });\n  };\n\n  const showSettingsModal = () => {\n    const { $ } = getCore();\n    $('.acu-edit-overlay').not(':has(.acu-settings-dialog)').remove();\n    isSettingsOpen = true;\n    const config = getConfig();\n    const currentThemeClass = `acu-theme-${config.theme}`;\n    const t = getThemeColors();\n\n    // \n    const expandedGroups = Store.get('acu_settings_expanded', ['appearance']);\n\n    const isGroupExpanded = groupId => expandedGroups.includes(groupId);\n    // HTML\n    const SPECIAL_BUTTONS = [\n      { key: '__dice__', name: '', icon: 'fa-dice-d20' },\n      { key: '__changes__', name: '', icon: 'fa-clipboard-check' },\n      { key: '__mvu__', name: 'MVU', icon: 'fa-code-branch' },\n    ];\n\n    // HTMLMVU\n    const SPECIAL_BUTTONS_CONFIG = [\n      { key: '__dice__', name: '', icon: 'fa-dice-d20' },\n      { key: '__changes__', name: '', icon: 'fa-code-compare' },\n      { key: '__mvu__', name: 'MVU', icon: 'fa-code-branch' },\n    ];\n\n    const tableManagerHtml = (() => {\n      const rawData = cachedRawData || getTableData();\n      const tables = processJsonData(rawData || {});\n      const savedOrder = getSavedTableOrder() || [];\n      const hiddenList = getHiddenTables();\n\n      //  + \n      let allItems = [];\n\n      // \n      SPECIAL_BUTTONS_CONFIG.forEach(btn => {\n        // MVU  MVU \n        if (btn.key === '__mvu__' && !MvuModule.isAvailable()) return;\n        allItems.push({ key: btn.key, name: btn.name, icon: btn.icon, isSpecial: true });\n      });\n\n      // \n      Object.keys(tables).forEach(name => {\n        allItems.push({ key: name, name: name, icon: getIconForTableName(name), isSpecial: false });\n      });\n\n      // \n      if (savedOrder.length > 0) {\n        const orderMap = new Map(savedOrder.map((k, i) => [k, i]));\n        allItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      return allItems\n        .map(item => {\n          const isHidden = hiddenList.includes(item.key);\n          const specialClass = item.isSpecial ? ' acu-special-item' : '';\n          const displayName = item.name;\n          return (\n            '<div class=\"acu-table-manager-item' +\n            specialClass +\n            (isHidden ? ' hidden-table' : '') +\n            '\" data-table-name=\"' +\n            escapeHtml(item.key) +\n            '\" draggable=\"false\">' +\n            '<div class=\"acu-table-item-check\" title=\"/\">' +\n            '<i class=\"fa-solid ' +\n            (isHidden ? 'fa-eye-slash' : 'fa-eye') +\n            '\"></i>' +\n            '</div>' +\n            '<div class=\"acu-table-item-icon\"><i class=\"fa-solid ' +\n            item.icon +\n            '\"></i></div>' +\n            '<div class=\"acu-table-item-name\">' +\n            escapeHtml(displayName) +\n            '</div>' +\n            '<div class=\"acu-table-item-handle\" title=\"\">' +\n            '<i class=\"fa-solid fa-grip-vertical\"></i>' +\n            '</div>' +\n            '</div>'\n          );\n        })\n        .join('');\n    })();\n    const chevron = groupId => (isGroupExpanded(groupId) ? 'fa-chevron-down' : 'fa-chevron-right');\n\n    const dialog = $(`\n        <div class=\"acu-edit-overlay\">\n            <div class=\"acu-edit-dialog acu-settings-dialog ${currentThemeClass}\">\n                <div class=\"acu-settings-header\">\n                    <div class=\"acu-settings-title\"><i class=\"fa-solid fa-cog\"></i> </div>\n                    <button class=\"acu-close-btn\" id=\"dlg-close-x\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n\n                <div class=\"acu-settings-body\">\n                <!--  -->\n                <div class=\"acu-settings-group ${isGroupExpanded('appearance') ? '' : 'collapsed'}\" data-group=\"appearance\">                    <div class=\"acu-settings-group-title\">\n                        <i class=\"fa-solid ${chevron('appearance')} acu-group-chevron\"></i>\n                        <i class=\"fa-solid fa-palette\"></i> \n                    </div>\n                    <div class=\"acu-settings-group-body\">\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-theme\" class=\"acu-setting-select\">\n                                ${THEMES.map(t => `<option value=\"${t.id}\" ${t.id === config.theme ? 'selected' : ''}>${t.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <select id=\"cfg-font-family\" class=\"acu-setting-select\">\n                                ${FONTS.map(f => `<option value=\"${f.id}\" ${f.id === config.fontFamily ? 'selected' : ''}>${f.name}</option>`).join('')}\n                            </select>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-main\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.fontSize}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"> ()</span>\n                            </div>\n                            <div class=\"acu-stepper\" data-id=\"cfg-font-opt\" data-min=\"10\" data-max=\"24\" data-step=\"1\">\n                                <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                <span class=\"acu-stepper-value\">${config.optionFontSize || 12}px</span>\n                                <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                            </div>\n                        </div>\n                        <div class=\"acu-setting-row acu-setting-row-toggle\">\n                            <div class=\"acu-setting-info\">\n                                <span class=\"acu-setting-label\"></span>\n                            </div>\n                            <label class=\"acu-toggle\">\n                                <input type=\"checkbox\" id=\"cfg-new\" ${config.highlightNew ? 'checked' : ''}>\n                                <span class=\"acu-toggle-slider\"></span>\n                            </label>\n                        </div>\n                    </div>\n                </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('layout') ? '' : 'collapsed'}\" data-group=\"layout\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('layout')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-th-large\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-width\" data-min=\"200\" data-max=\"500\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.cardWidth}px</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-layout\" class=\"acu-setting-select\">\n                                    <option value=\"horizontal\" ${config.layout !== 'vertical' ? 'selected' : ''}></option>\n                                    <option value=\"vertical\" ${config.layout === 'vertical' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                    <span class=\"acu-setting-hint\"></span>\n                                </div>\n                                <select id=\"cfg-grid-cols\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"2\" ${config.gridColumns == 2 ? 'selected' : ''}>2</option>\n                                    <option value=\"3\" ${config.gridColumns == 3 ? 'selected' : ''}>3</option>\n                                    <option value=\"4\" ${config.gridColumns == 4 ? 'selected' : ''}>4</option>\n                                    <option value=\"auto\" ${config.gridColumns === 'auto' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <div class=\"acu-stepper\" data-id=\"cfg-per-page\" data-min=\"10\" data-max=\"200\" data-step=\"10\">\n                                    <button class=\"acu-stepper-btn acu-stepper-dec\"><i class=\"fa-solid fa-minus\"></i></button>\n                                    <span class=\"acu-stepper-value\">${config.itemsPerPage}</span>\n                                    <button class=\"acu-stepper-btn acu-stepper-inc\"><i class=\"fa-solid fa-plus\"></i></button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('attrRules') ? '' : 'collapsed'}\" data-group=\"attrRules\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('attrRules')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-dice-d20\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                    <span class=\"acu-setting-hint\"></span>\n                                </div>\n                                <select id=\"cfg-attr-preset\" class=\"acu-setting-select\">\n                                    <option value=\"\"></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <button id=\"cfg-attr-preset-manage\" style=\"width: 100%; padding: 8px; background: ${t.accent}; border: none; border-radius: 6px; color: #fff; cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 6px;\">\n                                    <i class=\"fa-solid fa-cog\"></i> \n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('position') ? '' : 'collapsed'}\" data-group=\"position\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('position')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-arrows-alt\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-position\" class=\"acu-setting-select\">\n                                    <option value=\"fixed\" ${config.positionMode !== 'embedded' ? 'selected' : ''}></option>\n                                    <option value=\"embedded\" ${config.positionMode === 'embedded' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-action-pos\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bottom\" ${config.actionsPosition !== 'top' ? 'selected' : ''}></option>\n                                    <option value=\"top\" ${config.actionsPosition === 'top' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-style\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"bar\" ${config.collapseStyle === 'bar' ? 'selected' : ''}></option>\n                                    <option value=\"pill\" ${config.collapseStyle === 'pill' ? 'selected' : ''}></option>\n                                    <option value=\"mini\" ${config.collapseStyle === 'mini' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                            <div class=\"acu-setting-row\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <select id=\"cfg-col-align\" class=\"acu-setting-select acu-select-short\">\n                                    <option value=\"right\" ${config.collapseAlign !== 'left' ? 'selected' : ''}></option>\n                                    <option value=\"left\" ${config.collapseAlign === 'left' ? 'selected' : ''}></option>\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('options') ? '' : 'collapsed'}\" data-group=\"options\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('options')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-gamepad\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-setting-row acu-setting-row-toggle\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-show-opt\" ${config.showOptionPanel !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                            <div class=\"acu-setting-row acu-setting-row-toggle\" id=\"row-auto-send\" style=\"${config.showOptionPanel !== false ? '' : 'display:none;'}\">\n                                <div class=\"acu-setting-info\">\n                                    <span class=\"acu-setting-label\"></span>\n                                </div>\n                                <label class=\"acu-toggle\">\n                                    <input type=\"checkbox\" id=\"cfg-auto-send\" ${config.clickOptionToAutoSend !== false ? 'checked' : ''}>\n                                    <span class=\"acu-toggle-slider\"></span>\n                                </label>\n                            </div>\n                        </div>\n                    </div>\n\n                <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('tables') ? '' : 'collapsed'}\" data-group=\"tables\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('tables')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-table\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <div class=\"acu-table-manager-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> \n                            </div>\n                            <div class=\"acu-table-manager-list\" id=\"table-manager-list\">\n                                ${tableManagerHtml}\n                            </div>\n                        </div>\n                    </div>\n\n                    <!--  -->\n                    <div class=\"acu-settings-group ${isGroupExpanded('validation') ? '' : 'collapsed'}\" data-group=\"validation\">\n                        <div class=\"acu-settings-group-title\">\n                            <i class=\"fa-solid ${chevron('validation')} acu-group-chevron\"></i>\n                            <i class=\"fa-solid fa-shield-check\"></i> \n                        </div>\n                        <div class=\"acu-settings-group-body\">\n                            <!--  -->\n                            <div class=\"acu-setting-row\" style=\"margin-bottom:8px;\">\n                                <span></span>\n                                <select class=\"acu-setting-select\" id=\"preset-select\" style=\"flex:1;max-width:160px;\">\n                                    ${PresetManager.getAllPresets()\n                                      .map(\n                                        p =>\n                                          `<option value=\"${escapeHtml(p.id)}\" ${p.id === PresetManager.getActivePreset()?.id ? 'selected' : ''}>${escapeHtml(p.name)}${p.builtin ? ' ()' : ''}</option>`,\n                                      )\n                                      .join('')}\n                                </select>\n                            </div>\n                            <!--  -->\n                            <div style=\"display:flex;gap:6px;margin-bottom:10px;\">\n                                <button class=\"acu-action-btn\" id=\"btn-preset-dup\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-copy\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-new\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-plus\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-del\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-trash\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-export\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-export\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-import\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-file-import\"></i></button>\n                                <button class=\"acu-action-btn\" id=\"btn-preset-reset\" title=\"\" style=\"flex:1;height:28px;\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            </div>\n                            <div class=\"acu-validation-hint\" style=\"font-size:11px;color:var(--acu-text-sub);margin-bottom:8px;padding:0 4px;\">\n                                <i class=\"fa-solid fa-info-circle\"></i> <i class=\"fa-solid fa-shield-halved\"></i> \n                            </div>\n                            <div class=\"acu-validation-rules-list\" id=\"validation-rules-list\">\n                                ${ValidationRuleManager.getAllRules()\n                                  .map(rule => {\n                                    const typeInfo = RULE_TYPE_INFO[rule.ruleType] || {\n                                      name: rule.ruleType,\n                                      icon: 'fa-question',\n                                    };\n                                    const isTableRule = typeInfo.scope === 'table';\n                                    const hasIntercept = rule.intercept;\n                                    return `\n                                    <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n                                        <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n                                            <i class=\"fa-solid ${typeInfo.icon}\"></i>\n                                        </div>\n                                        <div class=\"acu-rule-info\">\n                                            <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n                                            <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n                                        </div>\n                                        <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n                                        <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n                                            <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n                                        </div>\n                                        <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n                                    </div>\n                                `;\n                                  })\n                                  .join('')}\n                            </div>\n                            <button class=\"acu-add-rule-btn\" id=\"btn-add-validation-rule\">\n                                <i class=\"fa-solid fa-plus\"></i> \n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                </div><!--  .acu-settings-body -->\n            </div>\n        </div>\n    `);\n    $('body').append(dialog);\n\n    // ===  ===\n    dialog.find('.acu-settings-group-title').on('click', function () {\n      const $group = $(this).closest('.acu-settings-group');\n      const $body = $group.find('.acu-settings-group-body');\n\n      // \n      if ($body.hasClass('acu-animating')) return;\n\n      const groupId = $group.data('group');\n      const $chevron = $(this).find('.acu-group-chevron');\n      let expanded = Store.get('acu_settings_expanded', ['appearance']);\n\n      if ($group.hasClass('collapsed')) {\n        // \n        $group.removeClass('collapsed');\n        $chevron.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n        if (!expanded.includes(groupId)) expanded.push(groupId);\n\n        $body.addClass('acu-animating').show();\n        const targetHeight = $body.prop('scrollHeight');\n        $body.css('height', 0).animate({ height: targetHeight }, 180, function () {\n          $(this).css('height', '').removeClass('acu-animating');\n        });\n      } else {\n        // \n        $group.addClass('collapsed');\n        $chevron.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n        expanded = expanded.filter(id => id !== groupId);\n\n        const currentHeight = $body.outerHeight();\n        $body\n          .addClass('acu-animating')\n          .css('height', currentHeight)\n          .animate({ height: 0 }, 180, function () {\n            $(this).hide().css('height', '').removeClass('acu-animating');\n          });\n      }\n\n      Store.set('acu_settings_expanded', expanded);\n    });\n\n    // ===  ===\n    // \n    dialog.find('#cfg-theme').on('change', function () {\n      const newTheme = $(this).val();\n      saveConfig({ theme: newTheme });\n      dialog\n        .find('.acu-edit-dialog')\n        .removeClass(THEMES.map(t => `acu-theme-${t.id}`).join(' '))\n        .addClass(`acu-theme-${newTheme}`);\n    });\n\n    // \n    dialog.find('#cfg-font-family').on('change', function () {\n      saveConfig({ fontFamily: $(this).val() });\n    });\n\n    // \n    (() => {\n      const $select = dialog.find('#cfg-attr-preset');\n      const activeId = Store.get(STORAGE_KEY_ACTIVE_ATTR_PRESET, null);\n\n      // \n      const presets = AttributePresetManager.getAllPresets();\n      presets.forEach(preset => {\n        const isActive = preset.id === activeId;\n        $select.append(\n          `<option value=\"${preset.id}\" ${isActive ? 'selected' : ''}>${preset.name}${preset.builtin ? '' : ' ()'}</option>`,\n        );\n      });\n\n      // \n      $select.on('change', function () {\n        const selectedId = $(this).val();\n        AttributePresetManager.setActivePreset(selectedId || null);\n        if (window.toastr) {\n          if (selectedId) {\n            const preset = presets.find(p => p.id === selectedId);\n            window.toastr.success(`${preset?.name || ''}`);\n          } else {\n            window.toastr.info('');\n          }\n        }\n      });\n\n      // \n      dialog.find('#cfg-attr-preset-manage').on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        dialog.remove();\n        isSettingsOpen = false;\n        showAttributePresetManager();\n      });\n    })();\n\n    // \n    dialog.find('#cfg-layout').on('change', function () {\n      saveConfig({ layout: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-grid-cols').on('change', function () {\n      saveConfig({ gridColumns: $(this).val() });\n    });\n\n    // \n    dialog.find('#cfg-position').on('change', function () {\n      saveConfig({ positionMode: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-action-pos').on('change', function () {\n      saveConfig({ actionsPosition: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-style').on('change', function () {\n      saveConfig({ collapseStyle: $(this).val() });\n      renderInterface();\n    });\n    dialog.find('#cfg-col-align').on('change', function () {\n      saveConfig({ collapseAlign: $(this).val() });\n      renderInterface();\n    });\n\n    // \n    dialog.find('#cfg-show-opt').on('change', function () {\n      const checked = $(this).is(':checked');\n      saveConfig({ showOptionPanel: checked });\n      if (!checked) Store.set('acu_hide_nav_only', false);\n      if (checked) dialog.find('#row-auto-send').slideDown(200);\n      else dialog.find('#row-auto-send').slideUp(200);\n      renderInterface();\n    });\n    dialog.find('#cfg-auto-send').on('change', function () {\n      saveConfig({ clickOptionToAutoSend: $(this).is(':checked') });\n    });\n    dialog.find('#cfg-new').on('change', function () {\n      saveConfig({ highlightNew: $(this).is(':checked') });\n      renderInterface();\n    });\n\n    // === / ===\n    dialog.find('.acu-table-item-check').on('click', function (e) {\n      e.stopPropagation();\n      const $item = $(this).closest('.acu-table-manager-item');\n      const tableName = $item.data('table-name');\n      let hiddenList = getHiddenTables();\n      const $icon = $(this).find('i');\n\n      if (hiddenList.includes(tableName)) {\n        // \n        hiddenList = hiddenList.filter(n => n !== tableName);\n        $item.removeClass('hidden-table');\n        $icon.removeClass('fa-eye-slash').addClass('fa-eye');\n      } else {\n        // \n        hiddenList.push(tableName);\n        $item.addClass('hidden-table');\n        $icon.removeClass('fa-eye').addClass('fa-eye-slash');\n      }\n\n      saveHiddenTables(hiddenList);\n      renderInterface();\n    });\n\n    // ===  ===\n    const $list = dialog.find('#table-manager-list');\n    let dragState = {\n      isDragging: false,\n      element: null,\n      timer: null,\n      startY: 0,\n    };\n\n    const clearDragState = () => {\n      if (dragState.timer) {\n        clearTimeout(dragState.timer);\n        dragState.timer = null;\n      }\n      if (dragState.element) {\n        $(dragState.element).removeClass('acu-dragging');\n      }\n      $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n      dragState.isDragging = false;\n      dragState.element = null;\n    };\n\n    const startDrag = $item => {\n      dragState.isDragging = true;\n      dragState.element = $item[0];\n      $item.addClass('acu-dragging');\n    };\n\n    const finishDrag = () => {\n      if (!dragState.isDragging || !dragState.element) {\n        clearDragState();\n        return;\n      }\n\n      const $dragged = $(dragState.element);\n      const $target = $list.find('.acu-drag-above, .acu-drag-below').first();\n\n      if ($target.length && $target[0] !== dragState.element) {\n        if ($target.hasClass('acu-drag-above')) {\n          $dragged.insertBefore($target);\n        } else {\n          $dragged.insertAfter($target);\n        }\n\n        // \n        const newOrder = [];\n        $list.find('.acu-table-manager-item').each(function () {\n          newOrder.push($(this).data('table-name'));\n        });\n        saveTableOrder(newOrder);\n      }\n\n      clearDragState();\n    };\n\n    // \n    $list[0].addEventListener(\n      'pointerdown',\n      function (e) {\n        const handle = e.target.closest('.acu-table-item-handle');\n        if (!handle) return;\n\n        e.preventDefault();\n        const $item = $(handle).closest('.acu-table-manager-item');\n        dragState.startY = e.clientY;\n        startDrag($item);\n        handle.setPointerCapture(e.pointerId);\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerdown', function (e) {\n      const item = e.target.closest('.acu-table-manager-item');\n      if (!item) return;\n      // \n      if (e.target.closest('.acu-table-item-check, .acu-table-item-handle')) return;\n\n      dragState.startY = e.clientY;\n      const $item = $(item);\n\n      dragState.timer = setTimeout(() => {\n        startDrag($item);\n      }, 350);\n    });\n\n    // \n    $list[0].addEventListener(\n      'pointermove',\n      function (e) {\n        // \n        if (dragState.timer && Math.abs(e.clientY - dragState.startY) > 8) {\n          clearTimeout(dragState.timer);\n          dragState.timer = null;\n        }\n\n        if (!dragState.isDragging || !dragState.element) return;\n        e.preventDefault();\n\n        // \n        const items = $list.find('.acu-table-manager-item').not('.acu-dragging');\n        let targetItem = null;\n        let insertBefore = true;\n\n        items.each(function () {\n          const rect = this.getBoundingClientRect();\n          const midY = rect.top + rect.height / 2;\n\n          if (e.clientY < midY && !targetItem) {\n            targetItem = this;\n            insertBefore = true;\n          } else if (e.clientY >= rect.top && e.clientY <= rect.bottom) {\n            targetItem = this;\n            insertBefore = e.clientY < midY;\n          }\n        });\n\n        // \n        $list.find('.acu-drag-above, .acu-drag-below').removeClass('acu-drag-above acu-drag-below');\n        if (targetItem && targetItem !== dragState.element) {\n          $(targetItem).addClass(insertBefore ? 'acu-drag-above' : 'acu-drag-below');\n        }\n      },\n      { passive: false },\n    );\n\n    // \n    $list[0].addEventListener('pointerup', finishDrag);\n    $list[0].addEventListener('pointercancel', clearDragState);\n\n    // \n    $list[0].addEventListener(\n      'touchmove',\n      function (e) {\n        if (dragState.isDragging) {\n          e.preventDefault();\n        }\n      },\n      { passive: false },\n    );\n\n    // === Stepper  ===\n    dialog.find('.acu-stepper').each(function () {\n      const $stepper = $(this);\n      const id = $stepper.data('id');\n      const min = parseInt($stepper.data('min'));\n      const max = parseInt($stepper.data('max'));\n      const step = parseInt($stepper.data('step'));\n      const $value = $stepper.find('.acu-stepper-value');\n\n      const updateValue = newVal => {\n        newVal = Math.max(min, Math.min(max, newVal));\n        const unit = id === 'cfg-per-page' ? '' : 'px';\n        $value.text(newVal + unit);\n\n        // \n        if (id === 'cfg-width') {\n          $('.acu-wrapper').css('--acu-card-width', newVal + 'px');\n          saveConfig({ cardWidth: newVal });\n        } else if (id === 'cfg-font-main') {\n          $('.acu-wrapper').css('--acu-font-size', newVal + 'px');\n          saveConfig({ fontSize: newVal });\n        } else if (id === 'cfg-font-opt') {\n          $('.acu-wrapper, .acu-embedded-options-container').css('--acu-opt-font-size', newVal + 'px');\n          saveConfig({ optionFontSize: newVal });\n        } else if (id === 'cfg-per-page') {\n          saveConfig({ itemsPerPage: newVal });\n        }\n      };\n\n      const getCurrentValue = () => {\n        const text = $value.text().replace(/[^\\d]/g, '');\n        return parseInt(text) || min;\n      };\n\n      $stepper.find('.acu-stepper-dec').on('click', function () {\n        updateValue(getCurrentValue() - step);\n      });\n\n      $stepper.find('.acu-stepper-inc').on('click', function () {\n        updateValue(getCurrentValue() + step);\n      });\n    });\n\n    // === /===\n    dialog.on('click', '.acu-rule-toggle', function (e) {\n      e.stopPropagation();\n      const $toggle = $(this);\n      const $item = $toggle.closest('.acu-validation-rule-item');\n      const ruleId = $item.data('rule-id');\n      const $icon = $toggle.find('i');\n      const isCurrentlyActive = $toggle.hasClass('active');\n\n      // \n      ValidationRuleManager.toggleRuleEnabled(ruleId, !isCurrentlyActive);\n\n      //  UI\n      if (isCurrentlyActive) {\n        $toggle.removeClass('active');\n        $icon.removeClass('fa-toggle-on').addClass('fa-toggle-off');\n        $item.addClass('disabled');\n      } else {\n        $toggle.addClass('active');\n        $icon.removeClass('fa-toggle-off').addClass('fa-toggle-on');\n        $item.removeClass('disabled');\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-delete', function (e) {\n      e.stopPropagation();\n      const ruleId = $(this).data('rule-id');\n      const $item = $(this).closest('.acu-validation-rule-item');\n\n      if (confirm('')) {\n        if (ValidationRuleManager.removeCustomRule(ruleId)) {\n          $item.fadeOut(200, function () {\n            $(this).remove();\n          });\n        }\n      }\n    });\n\n    // === ===\n    dialog.on('click', '.acu-rule-intercept', function (e) {\n      e.stopPropagation();\n      const $btn = $(this);\n      const ruleId = $btn.data('rule-id');\n      const isCurrentlyActive = $btn.hasClass('active');\n\n      if (ValidationRuleManager.toggleRuleIntercept(ruleId, !isCurrentlyActive)) {\n        if (isCurrentlyActive) {\n          $btn.removeClass('active').attr('title', '');\n        } else {\n          $btn.addClass('active').attr('title', '');\n        }\n      }\n    });\n\n    // ===  ===\n    const refreshPresetUI = () => {\n      ValidationRuleManager.clearCache();\n      const rules = ValidationRuleManager.getAllRules();\n      let html = '';\n      rules.forEach(rule => {\n        const typeInfo = RULE_TYPE_INFO[rule.ruleType] || { name: rule.ruleType, icon: 'fa-question' };\n        const isTableRule = typeInfo.scope === 'table';\n        const hasIntercept = rule.intercept;\n        html += `\n          <div class=\"acu-validation-rule-item ${rule.enabled ? '' : 'disabled'}\" data-rule-id=\"${escapeHtml(rule.id)}\">\n            <div class=\"acu-rule-type-icon\" title=\"${escapeHtml(typeInfo.name)}${isTableRule ? ' ()' : ''}\">\n              <i class=\"fa-solid ${typeInfo.icon}\"></i>\n            </div>\n            <div class=\"acu-rule-info\">\n              <div class=\"acu-rule-name\">${escapeHtml(rule.name)}</div>\n              <div class=\"acu-rule-target\">${escapeHtml(rule.targetTable)}${rule.targetColumn ? '.' + escapeHtml(rule.targetColumn) : isTableRule ? ' ()' : ''}</div>\n            </div>\n            <div class=\"acu-rule-intercept ${hasIntercept ? 'active' : ''}\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"${hasIntercept ? '' : ''}\"><i class=\"fa-solid fa-shield-halved\"></i></div>\n            <div class=\"acu-rule-toggle ${rule.enabled ? 'active' : ''}\" title=\"/\">\n              <i class=\"fa-solid ${rule.enabled ? 'fa-toggle-on' : 'fa-toggle-off'}\"></i>\n            </div>\n            <button class=\"acu-rule-delete\" data-rule-id=\"${escapeHtml(rule.id)}\" title=\"\"><i class=\"fa-solid fa-trash\"></i></button>\n          </div>`;\n      });\n      dialog.find('#validation-rules-list').html(html);\n    };\n\n    // \n    dialog.find('#preset-select').on('change', function () {\n      if (PresetManager.setActivePreset($(this).val())) {\n        refreshPresetUI();\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-dup').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const newPreset = PresetManager.duplicatePreset(preset.id);\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-new').on('click', function () {\n      const name = prompt(':', '');\n      if (!name?.trim()) return;\n      const newPreset = PresetManager.createPreset(name.trim());\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-del').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      if (preset.id === 'default') {\n        if (window.toastr) window.toastr.warning('');\n        return;\n      }\n      if (!confirm(`\"${preset.name}\"`)) return;\n      if (PresetManager.deletePreset(preset.id)) {\n        dialog.find(`#preset-select option[value=\"${preset.id}\"]`).remove();\n        dialog.find('#preset-select').val('default').trigger('change');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-export').on('click', function () {\n      const preset = PresetManager.getActivePreset();\n      if (!preset) return;\n      const json = PresetManager.exportPreset(preset.id);\n      if (json) {\n        navigator.clipboard\n          .writeText(json)\n          .then(() => {})\n          .catch(() => {\n            prompt(':', json);\n          });\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-import').on('click', function () {\n      const json = prompt(' JSON:');\n      if (!json?.trim()) return;\n      const newPreset = PresetManager.importPreset(json.trim());\n      if (newPreset) {\n        dialog\n          .find('#preset-select')\n          .append(`<option value=\"${escapeHtml(newPreset.id)}\">${escapeHtml(newPreset.name)}</option>`);\n        dialog.find('#preset-select').val(newPreset.id).trigger('change');\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // \n    dialog.find('#btn-preset-reset').on('click', function () {\n      if (!confirm('\\n')) return;\n      if (PresetManager.resetDefaultPreset()) {\n        // \n        if (PresetManager.getActivePreset()?.id === 'default') {\n          refreshPresetUI();\n        }\n      } else {\n        if (window.toastr) window.toastr.error('');\n      }\n    });\n\n    // ===  ===\n    dialog.find('#btn-add-validation-rule').on('click', function () {\n      showAddValidationRuleModal(dialog);\n    });\n\n    // ===  ===\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n      renderInterface();\n    };\n    dialog.on('click', '#dlg-close-x, .acu-settings-header .acu-close-btn', closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n  };\n\n  const renderInterface = () => {\n    // \n    if (isSettingsOpen) return;\n    const _renderStart = performance.now();\n    const { $ } = getCore();\n\n    // [] Observer  ()\n    if (!observer && $('#chat').length) {\n      const $chat = $('#chat');\n      let mutationLock = false;\n      const handleMutation = () => {\n        if (mutationLock) return;\n        mutationLock = true;\n        requestAnimationFrame(() => {\n          const config = getConfig();\n          if (config.positionMode === 'embedded') {\n            mutationLock = false;\n            return;\n          }\n          const children = $chat.children();\n          const lastChild = children.last()[0];\n          const wrapper = $('.acu-wrapper')[0];\n          if (wrapper && lastChild && lastChild !== wrapper) {\n            if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n              $chat.append(wrapper);\n            }\n          }\n          mutationLock = false;\n        });\n      };\n      observer = new MutationObserver(handleMutation);\n      observer.observe($chat[0], { childList: true });\n    }\n    let rawData;\n    if (hasUnsavedChanges && cachedRawData) {\n      rawData = cachedRawData;\n    } else {\n      rawData = getTableData();\n\n      // [] \n      if (rawData) {\n        let anyLockApplied = false;\n        for (const sheetId in rawData) {\n          if (!sheetId.startsWith('sheet_')) continue;\n          const sheet = rawData[sheetId];\n          if (!sheet || !sheet.name || !sheet.content) continue;\n\n          const result = LockManager.applyLocks(sheet.name, sheet.content);\n          if (result.modified) {\n            anyLockApplied = true;\n          }\n          if (result.restored.length > 0) {\n          }\n        }\n        if (anyLockApplied) {\n        }\n      }\n      if (rawData) {\n        cachedRawData =\n          typeof structuredClone === 'function' ? structuredClone(rawData) : JSON.parse(JSON.stringify(rawData));\n\n        const existingSnapshot = loadSnapshot();\n        const currentCtx = getCurrentContextFingerprint();\n\n        // \n        const hasValidSnapshotData =\n          existingSnapshot && Object.keys(existingSnapshot).some(k => k.startsWith('sheet_'));\n\n        if (!existingSnapshot || !hasValidSnapshotData) {\n          // 1    \n          saveSnapshot({ ...cachedRawData, _contextId: currentCtx });\n        } else if (!existingSnapshot._contextId) {\n          // 2 ID \n          saveSnapshot({ ...existingSnapshot, _contextId: currentCtx });\n        } else if (existingSnapshot._contextId !== currentCtx) {\n          // 3  \n          cachedRawData._contextId = currentCtx;\n          saveSnapshot(cachedRawData);\n        }\n        // 4  \n      }\n    }\n\n    const $searchInput = $('.acu-search-input');\n    if ($('.acu-wrapper').length && $searchInput.is(':focus')) {\n      if (rawData) {\n        if (!isSaving) currentDiffMap = generateDiffMap(rawData);\n        const tables = processJsonData(rawData);\n        const activeTab = getActiveTabState();\n        const currentTabName = activeTab && tables[activeTab] ? activeTab : null;\n\n        if (currentTabName && tables[currentTabName]) {\n          const newHtml = renderTableContent(tables[currentTabName], currentTabName);\n          const $virtualDom = $('<div>').html(newHtml);\n          $('.acu-card-grid').replaceWith($virtualDom.find('.acu-card-grid'));\n          $('.acu-panel-title').html($virtualDom.find('.acu-panel-title').html());\n          // [] \n          bindEvents(tables);\n          bindOptionEvents(); // <--- \n          return;\n        }\n      }\n    }\n\n    let lastScrollX = 0;\n    let lastScrollY = 0;\n\n    const $oldContent = $('.acu-panel-content');\n    if ($oldContent.length) {\n      lastScrollX = $oldContent.scrollLeft();\n      lastScrollY = $oldContent.scrollTop();\n    }\n\n    $('.acu-wrapper').remove();\n    const tables = processJsonData(rawData || {});\n\n    if (isSaving) {\n      currentDiffMap = new Set();\n    } else {\n      currentDiffMap = generateDiffMap(rawData);\n    }\n\n    const savedOrder = getSavedTableOrder();\n    let orderedNames = Object.keys(tables);\n    if (savedOrder)\n      orderedNames = savedOrder.filter(n => tables[n]).concat(orderedNames.filter(n => !savedOrder.includes(n)));\n\n    const hiddenList = getHiddenTables();\n    orderedNames = orderedNames.filter(n => !hiddenList.includes(n));\n\n    const activeTab = getActiveTabState();\n    let currentTabName = activeTab && tables[activeTab] && !hiddenList.includes(activeTab) ? activeTab : null;\n\n    const config = getConfig();\n    const isCollapsed = getCollapsedState();\n\n    const layoutClass = config.layout === 'vertical' ? 'acu-layout-vertical' : '';\n    // []  (/)\n    const positionClass = `acu-mode-${config.positionMode || 'fixed'}`;\n\n    // []  () \n    let finalGridCols = config.gridColumns;\n    if (finalGridCols === 'auto') {\n      const n = orderedNames.length;\n\n      if (n <= 4) {\n        finalGridCols = n < 2 ? 2 : n;\n      } else {\n        const empty3 = Math.ceil(n / 3) * 3 - n;\n        const empty4 = Math.ceil(n / 4) * 4 - n;\n        finalGridCols = empty4 <= empty3 ? 4 : 3;\n      }\n    }\n\n    // --- []  +  ---\n    let optionHtml = '';\n    let currentOptionHash = null; // \n\n    if (config.showOptionPanel !== false) {\n      const optionTables = [];\n      Object.keys(tables).forEach(k => {\n        if (k.includes('')) optionTables.push(tables[k]);\n      });\n\n      // [] \n      if (optionTables.length > 0) {\n        const isNavHidden = Store.get('acu_hide_nav_only', false);\n        const eyeIcon = isNavHidden ? 'fa-eye-slash' : 'fa-eye';\n        const eyeTitle = isNavHidden ? '' : '';\n        // \n        let buttonsHtml = `\n                    <div class=\"acu-opt-header\" style=\"position:relative;\">\n                        \n                        <i class=\"fa-solid ${eyeIcon} acu-nav-toggle-btn\"\n                           style=\"position:absolute; right:6px; top:50%; transform:translateY(-50%); cursor:pointer; opacity:0.6;\"\n                           title=\"${eyeTitle}\"></i>\n                    </div>`;\n        let hasBtns = false;\n        // []\n        let optionValues = []; // \n\n        optionTables.forEach(table => {\n          if (table.rows) {\n            table.rows.forEach(row => {\n              row.forEach((cell, idx) => {\n                if (idx > 0 && cell && String(cell).trim()) {\n                  const cellStr = String(cell).trim();\n                  buttonsHtml += `<button class=\"acu-opt-btn\" data-val=\"${encodeURIComponent(cellStr)}\">${escapeHtml(cellStr)}</button>`;\n                  optionValues.push(cellStr);\n                  hasBtns = true;\n                }\n              });\n            });\n          }\n        });\n\n        if (hasBtns) {\n          optionHtml = `<div class=\"acu-option-panel\">${buttonsHtml}</div>`;\n          //  ()\n          // [] \n          currentOptionHash = optionValues.join('|||') + (isNavHidden ? '_hidden' : '_show');\n        }\n      }\n    }\n\n    // [] \n    const optionChanged = currentOptionHash !== lastOptionHash;\n    if (optionChanged && currentOptionHash !== null) {\n      // \n      optionPanelVisible = true;\n    }\n    lastOptionHash = currentOptionHash; // \n\n    let html = `<div class=\"acu-wrapper ${positionClass} acu-theme-${config.theme} ${layoutClass}\" style=\"--acu-card-width:${config.cardWidth}px; --acu-font-size:${config.fontSize}px; --acu-opt-font-size:${config.optionFontSize || 12}px; --acu-grid-cols:${finalGridCols}\">`;\n\n    // []  DOM  column-reverse\n    // []  optionPanelVisible \n    if (config.positionMode === 'embedded' && optionHtml && optionPanelVisible) {\n      html += optionHtml;\n    }\n\n    // [] \n    const isNavHidden = Store.get('acu_hide_nav_only', false);\n    const hideStyle = isNavHidden ? 'display:none !important;' : '';\n\n    if (isCollapsed) {\n      const colStyleClass = `acu-col-${config.collapseStyle || 'bar'}`;\n      // \n      const collapseStyle = isNavHidden ? 'display:none !important;' : '';\n      const alignClass = `acu-align-${config.collapseAlign || 'right'}`;\n      html += `\n                <div class=\"acu-expand-trigger ${colStyleClass} ${alignClass}\" id=\"acu-btn-expand\" style=\"${collapseStyle}\">\n                    <i class=\"fa-solid fa-table\"></i> <span> (${Object.keys(tables).length})</span>\n                </div>\n            `;\n    } else {\n      // [] \n      const savedHeight = currentTabName ? getTableHeights()[currentTabName] : null;\n      // [] \n      const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n      const isChangesPanelActive = Store.get('acu_changes_panel_active', false);\n      const shouldShowPanel = isDashboardActive || isChangesPanelActive || currentTabName;\n\n      html += `\n                <div class=\"acu-data-display ${shouldShowPanel ? 'visible' : ''} ${savedHeight ? 'acu-manual-mode' : ''}\" id=\"acu-data-area\" style=\"${savedHeight ? 'height:' + savedHeight + 'px;' : ''} ${hideStyle}\">\n                    ${\n                      isChangesPanelActive\n                        ? renderChangesPanel(rawData)\n                        : isDashboardActive\n                          ? renderDashboard(tables)\n                          : currentTabName\n                            ? renderTableContent(tables[currentTabName], currentTabName)\n                            : ''\n                    }\n                </div>\n                `;\n\n      // [] \n      // PC(>768px) CSS display:flex !important grid \n      const gridFixStyle = `grid-template-columns: repeat(${finalGridCols}, 1fr);`;\n\n      html += `\n                <div class=\"acu-nav-container ${config.actionsPosition === 'top' ? 'acu-pos-top' : ''}\" id=\"acu-nav-bar\" style=\"${hideStyle} ${gridFixStyle}\">\n                    <div class=\"acu-order-controls\" id=\"acu-order-hint\"><i class=\"fa-solid fa-arrows-alt\"></i> </div>\n            `;\n\n      // ===  +  ===\n      const isChangesActive = Store.get('acu_changes_panel_active', false);\n      const isSimpleModeNav = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n      let changesCount = 0;\n      let validationErrorCount = 0;\n      if (rawData) {\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          for (const sheetId in rawData) {\n            if (!sheetId.startsWith('sheet_')) continue;\n            const newSheet = rawData[sheetId];\n            const oldSheet = snapshot[sheetId];\n            if (!newSheet?.content) continue;\n            const newRows = newSheet.content.slice(1);\n            const oldRows = oldSheet?.content?.slice(1) || [];\n            newRows.forEach((row, rowIdx) => {\n              const oldRow = oldRows[rowIdx];\n              if (!oldRow) {\n                changesCount++;\n                return;\n              }\n              row.forEach((cell, colIdx) => {\n                if (colIdx === 0) return;\n                if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n              });\n            });\n            if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n          }\n          for (const sheetId in snapshot) {\n            if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n          }\n        }\n        // \n        validationErrorCount = ValidationEngine.getErrorCount(rawData);\n      }\n      // \n      const isValidationMode = isSimpleModeNav;\n      const displayCount = isValidationMode ? validationErrorCount : changesCount;\n      // \n      const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n      // ===  ===\n      const navHiddenList = getHiddenTables();\n      const navSavedOrder = getSavedTableOrder() || [];\n\n      //  + \n      const SPECIAL_NAV_ITEMS = [\n        { key: '__dice__', icon: 'fa-dice-d20', label: '', id: 'acu-btn-dice-nav', extraClass: 'acu-dice-nav-btn' },\n        {\n          key: '__changes__',\n          icon: 'fa-code-compare',\n          label: `${displayCount > 0 ? '(' + displayCount + ')' : ''}`,\n          id: 'acu-btn-changes',\n          extraClass: `acu-changes-btn${showWarningIcon ? ' has-validation-errors' : ''}`,\n          isActive: isChangesActive,\n          warningIcon: showWarningIcon,\n        },\n        {\n          key: '__mvu__',\n          icon: 'fa-code-branch',\n          label: '',\n          id: 'acu-btn-mvu',\n          extraClass: 'acu-mvu-btn',\n          checkAvailable: () => MvuModule.isAvailable(),\n          isActive: getActiveTabState() === MvuModule.MODULE_ID,\n        },\n      ];\n\n      // \n      let allNavItems = [];\n\n      // \n      SPECIAL_NAV_ITEMS.forEach(item => {\n        if (item.checkAvailable && !item.checkAvailable()) return;\n        if (navHiddenList.includes(item.key)) return; // \n        allNavItems.push({ ...item, isSpecial: true });\n      });\n\n      // \n      orderedNames.forEach(name => {\n        allNavItems.push({\n          key: name,\n          icon: getIconForTableName(name),\n          label: name,\n          isSpecial: false,\n          isActive: !isDashboardActive && !isChangesActive && currentTabName === name,\n        });\n      });\n\n      // \n      if (navSavedOrder.length > 0) {\n        const orderMap = new Map(navSavedOrder.map((k, i) => [k, i]));\n        allNavItems.sort((a, b) => {\n          const aIdx = orderMap.has(a.key) ? orderMap.get(a.key) : 9999;\n          const bIdx = orderMap.has(b.key) ? orderMap.get(b.key) : 9999;\n          return aIdx - bIdx;\n        });\n      }\n\n      // [] /\n      // order  1  Grid \n      html += `<button class=\"acu-nav-btn acu-dashboard-btn ${isDashboardActive ? 'active' : ''}\" id=\"acu-btn-dashboard\" style=\"order: 1;\">\n                <i class=\"fa-solid fa-chart-line\"></i><span></span>\n            </button>`;\n\n      // order  2 \n      allNavItems.forEach((item, idx) => {\n        const activeClass = item.isActive ? 'active' : '';\n        const extraClass = item.extraClass || '';\n        const orderVal = idx + 2; //  2  1\n\n        if (item.isSpecial) {\n          // \n          const warningIconHtml = item.warningIcon\n            ? '<i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>'\n            : '';\n          html += `<button class=\"acu-nav-btn ${extraClass} ${activeClass}\" id=\"${item.id}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>${warningIconHtml}\n                    </button>`;\n        } else {\n          // \n          html += `<button class=\"acu-nav-btn ${activeClass}\" data-table=\"${escapeHtml(item.key)}\" style=\"order: ${orderVal};\">\n                        <i class=\"fa-solid ${item.icon}\"></i><span>${escapeHtml(item.label)}</span>\n                    </button>`;\n        }\n      });\n      // order \n      html += `<div class=\"acu-actions-group\" id=\"acu-active-actions\" style=\"order: 9999;\">`;\n      ACTION_BUTTONS.forEach(btn => {\n        html += `<button class=\"acu-action-btn\" id=\"${btn.id}\" title=\"${btn.title}\"><i class=\"fa-solid ${btn.icon}\"></i></button>`;\n      });\n      html += `</div>`;\n\n      html += `</div>`; //  acu-nav-container\n    }\n\n    html += `</div>`; //  acu-wrapper\n\n    const $existing = $('.acu-wrapper');\n    if ($existing.length) {\n      $existing.replaceWith(html);\n    } else {\n      insertHtmlToPage(html);\n    }\n\n    // --- []  ---\n    if (config.positionMode !== 'embedded' && optionHtml && optionPanelVisible) {\n      if (optionChanged) {\n        //  AI \n        injectIndependentOptions(optionHtml);\n      } else {\n        // \n        const $existing = $('.acu-embedded-options-container');\n        if ($existing.length === 0) {\n          // \n          injectIndependentOptions(optionHtml);\n        }\n        // \n      }\n    } else if (config.positionMode !== 'embedded') {\n      // \n      $('.acu-embedded-options-container').remove();\n    } else {\n      // [] \n      $('.acu-embedded-options-container').remove();\n    }\n\n    bindEvents(tables);\n    bindOptionEvents();\n    updateSaveButtonState();\n    // [] \n    if (Store.get('acu_changes_panel_active', false)) {\n      bindChangesEvents();\n    }\n\n    setTimeout(() => {\n      const $newContent = $('.acu-panel-content');\n      const activeTab = getActiveTabState();\n      const savedState = tableScrollStates[activeTab];\n\n      if ($newContent.length) {\n        // 1. \n        //  savedState () lastScrollY ()\n        if (savedState) {\n          $newContent.scrollTop(savedState.top);\n          $newContent.scrollLeft(savedState.left);\n        } else {\n          if (lastScrollY > 0) $newContent.scrollTop(lastScrollY);\n          if (lastScrollX > 0) $newContent.scrollLeft(lastScrollX);\n        }\n\n        // 2.  ()\n        if (savedState && savedState.inner) {\n          Object.keys(savedState.inner).forEach(key => {\n            const scrollTop = savedState.inner[key];\n            // \n            const $targetTitle = $newContent.find(`.acu-editable-title[data-row=\"${key}\"]`);\n            if ($targetTitle.length) {\n              const $card = $targetTitle.closest('.acu-data-card');\n              //  ( overflow on card)\n              $card.scrollTop(scrollTop);\n              //  body  ( overflow on body)\n              $card.find('.acu-card-body').scrollTop(scrollTop);\n            }\n          });\n        }\n      }\n    }, 0);\n  };\n\n  // [] \n  const injectIndependentOptions = htmlContent => {\n    const { $ } = getCore();\n    $('.acu-embedded-options-container').remove();\n\n    //  AI \n    const getTargetContainer = () => {\n      const $allMes = $('#chat .mes');\n      const $aiMes = $allMes.filter(function () {\n        const $this = $(this);\n        if ($this.attr('is_user') === 'true' || $this.attr('is_system') === 'true' || $this.hasClass('sys_mes'))\n          return false;\n        //  data-is-system \n        if ($this.find('.name_text').text().trim() === 'System' || $this.attr('data-is-system') === 'true')\n          return false;\n        // [] \n        if ($this.find('.mes_text').length === 0) return false;\n        if ($this.css('display') === 'none') return false;\n        return true;\n      });\n      if ($aiMes.length === 0) return null;\n\n      const $targetMes = $aiMes.last();\n      const $targetBlock = $targetMes.find('.mes_block');\n      return $targetBlock.length ? $targetBlock : $targetMes;\n    };\n\n    const $target = getTargetContainer();\n    if ($target && $target.length) {\n      const optConfig = getConfig();\n      const $container = $(\n        `<div class=\"acu-embedded-options-container acu-theme-${optConfig.theme}\" style=\"--acu-opt-font-size:${optConfig.optionFontSize || 12}px;\"></div>`,\n      );\n      $container.html(htmlContent);\n      $target.append($container);\n    }\n  };\n\n  // []  ( + )\n  const bindOptionEvents = () => {\n    const { $ } = getCore();\n    //  Body \n    $('body')\n      .off('click.acu_opt')\n      .on('click.acu_opt', '.acu-opt-btn', async function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const config = getConfig();\n        const val = decodeURIComponent($(this).data('val'));\n\n        // 1:  -> \n        if (!config.clickOptionToAutoSend) {\n          smartInsertToTextarea(val, 'action');\n          $('#send_textarea').focus();\n          return;\n        }\n\n        // 2: \n        // A: TavernHelper ( refresh: 'affected' )\n        if (window.TavernHelper) {\n          try {\n            // 1.  createChatMessages \n            if (window.TavernHelper.createChatMessages) {\n              await window.TavernHelper.createChatMessages(\n                [\n                  {\n                    role: 'user',\n                    message: val,\n                  },\n                ],\n                {\n                  //  TavernHelper \n                  refresh: 'affected',\n                },\n              );\n\n              // 2. \n              if (window.TavernHelper.triggerSlash) {\n                await window.TavernHelper.triggerSlash('/trigger');\n              }\n              return;\n            }\n          } catch (err) {\n            console.warn('[ACU] TavernHelper ', err);\n          }\n        }\n\n        // B: SillyTavern  (Slash Command)\n        const ST = window.SillyTavern || window.parent?.SillyTavern;\n        if (ST && ST.executeSlashCommandsWithOptions) {\n          try {\n            //  raw=true  ( slash_command.txt)\n            const safeVal = val.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"');\n            const cmd = `/send raw=true \"${safeVal}\"`;\n\n            const sendResult = await ST.executeSlashCommandsWithOptions(cmd);\n\n            if (!sendResult.isError && !sendResult.isAborted) {\n              await ST.executeSlashCommandsWithOptions('/trigger');\n              return;\n            }\n            console.warn('[ACU] ST send :', sendResult);\n          } catch (err) {\n            console.warn('[ACU] ST', err);\n          }\n        }\n\n        // C:  +  ()\n        const ta = $('#send_textarea');\n        if (ta.length) {\n          ta.val(val);\n          ta.trigger('input').trigger('change');\n          //  React \n          await new Promise(r => setTimeout(r, 50));\n          const sendBtn = $('#send_but').filter(':visible');\n          if (sendBtn.length) {\n            sendBtn[0].click();\n          } else {\n            // \n            const enterEvent = $.Event('keydown', { keyCode: 13, which: 13, bubbles: true });\n            ta.trigger(enterEvent);\n          }\n        }\n      });\n  };\n\n  const insertHtmlToPage = html => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // ---  ---\n\n    // 1.  (Embedded) v19 \n    if (config.positionMode === 'embedded') {\n      $('.acu-wrapper').remove(); // \n\n      const getTargetContainer = () => {\n        const $allMes = $('#chat .mes');\n        const $aiMes = $allMes.filter(function () {\n          const $this = $(this);\n          if ($this.attr('is_user') === 'true') return false;\n          if ($this.attr('is_system') === 'true') return false;\n          if ($this.hasClass('sys_mes')) return false;\n          const name = $this.find('.name_text').text().trim();\n          if (name === 'System') return false;\n          if ($this.css('display') === 'none') return false;\n          const $textDiv = $this.find('.mes_text');\n          if ($textDiv.length === 0) return false;\n          const textContent = $textDiv.text().trim();\n          const hasImage = $textDiv.find('img').length > 0;\n          if (textContent.length === 0 && !hasImage) return false;\n          return true;\n        });\n        //  AI  chat\n        if ($aiMes.length === 0) return $('#chat');\n\n        // \n        const isGenerating = $('#send_but').is(':hidden') || $('#send_but_stop').is(':visible');\n\n        let targetIndex = $aiMes.length - 1;\n        const $targetMes = $aiMes.eq(targetIndex);\n        const $targetBlock = $targetMes.find('.mes_block');\n        return $targetBlock.length ? $targetBlock : $targetMes;\n      };\n\n      const $target = getTargetContainer();\n      if ($target.length) {\n        if ($target.hasClass('mes_block') || $target.hasClass('mes')) {\n          if ($target.find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          } else {\n            $target.find('.acu-wrapper').replaceWith(html);\n          }\n        } else {\n          // Fallback\n          if ($('#chat').find('.acu-wrapper').length === 0) {\n            $target.append(html);\n          }\n        }\n      } else {\n        $('body').append(html);\n      }\n      return;\n    }\n\n    // 2.  (Fixed) B \n    // \n    const $chat = $('#chat');\n    const $oldWrapper = $('.acu-wrapper');\n\n    if ($oldWrapper.length) {\n      $oldWrapper.replaceWith(html);\n    } else {\n      if ($chat.length) {\n        $chat.append(html);\n      } else {\n        $('body').append(html);\n      }\n    }\n  };\n  // [] \n  const renderChangesPanel = rawData => {\n    const snapshot = loadSnapshot();\n    const config = getConfig();\n\n    // \n    const validationErrors = rawData ? ValidationEngine.validateAllData(rawData) : [];\n\n    if (!snapshot || !rawData) {\n      // \n      if (validationErrors.length === 0) {\n        return `\n                <div class=\"acu-panel-header\">\n                    <div class=\"acu-panel-title\">\n                        <div class=\"acu-title-main\"><i class=\"fa-solid fa-code-compare\"></i> <span class=\"acu-title-text\"></span></div>\n                        <div class=\"acu-title-sub\"></div>\n                    </div>\n                    <div class=\"acu-header-actions\">\n                        <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                </div>\n                <div class=\"acu-panel-content\" style=\"display:flex;align-items:center;justify-content:center;\">\n                    <div class=\"acu-empty-hint\"></div>\n                </div>`;\n      }\n    }\n\n    // \n    const changes = [];\n\n    for (const sheetId in rawData) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      const newSheet = rawData[sheetId];\n      const oldSheet = snapshot[sheetId];\n      if (!newSheet?.name || !newSheet?.content) continue;\n\n      const tableName = newSheet.name;\n      const headers = newSheet.content[0] || [];\n      const newRows = newSheet.content.slice(1);\n      const oldRows = oldSheet?.content?.slice(1) || [];\n\n      // \n      newRows.forEach((row, rowIdx) => {\n        const oldRow = oldRows[rowIdx];\n\n        if (!oldRow) {\n          // \n          changes.push({\n            type: 'row_added',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: rowIdx,\n            headers,\n            row,\n            title: row[1] || ` ${rowIdx + 1}`,\n          });\n        } else {\n          // \n          const rowChanges = [];\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return; // \n            const oldVal = String(oldRow[colIdx] ?? '');\n            const newVal = String(cell ?? '');\n            if (oldVal !== newVal) {\n              rowChanges.push({\n                colIndex: colIdx,\n                header: headers[colIdx] || `${colIdx}`,\n                oldValue: oldVal,\n                newValue: newVal,\n              });\n            }\n          });\n\n          if (rowChanges.length === 1) {\n            // \n            const c = rowChanges[0];\n            changes.push({\n              type: 'cell_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              colIndex: c.colIndex,\n              header: c.header,\n              oldValue: c.oldValue,\n              newValue: c.newValue,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          } else if (rowChanges.length > 1) {\n            // \n            changes.push({\n              type: 'row_modified',\n              tableName,\n              tableKey: sheetId,\n              rowIndex: rowIdx,\n              headers,\n              row,\n              oldRow,\n              changedFields: rowChanges,\n              rowTitle: row[1] || ` ${rowIdx + 1}`,\n            });\n          }\n        }\n      });\n\n      // \n      if (oldRows.length > newRows.length) {\n        for (let i = newRows.length; i < oldRows.length; i++) {\n          const oldRow = oldRows[i];\n          changes.push({\n            type: 'row_deleted',\n            tableName,\n            tableKey: sheetId,\n            rowIndex: i,\n            headers,\n            row: oldRow,\n            title: oldRow[1] || ` ${i + 1}`,\n          });\n        }\n      }\n    }\n\n    // \n    for (const sheetId in snapshot) {\n      if (!sheetId.startsWith('sheet_')) continue;\n      if (!rawData[sheetId]) {\n        const oldSheet = snapshot[sheetId];\n        changes.push({\n          type: 'table_deleted',\n          tableName: oldSheet?.name || sheetId,\n          tableKey: sheetId,\n        });\n      }\n    }\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n\n    // \n    const panelTitle = isValidationMode ? '' : '';\n    const panelIcon = isValidationMode ? 'fa-shield-halved' : 'fa-code-compare';\n    const toggleTitle = isValidationMode ? '' : '';\n\n    //  HTML\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n                    <div class=\"acu-title-main\"><i class=\"fa-solid ${panelIcon}\"></i> <span class=\"acu-title-text\">${panelTitle}</span></div>\n                </div>\n                <div class=\"acu-header-actions\">\n                    ${!isValidationMode ? '<button class=\"acu-changes-batch-btn acu-batch-accept\" title=\"\"><i class=\"fa-solid fa-check-double\"></i></button>' : ''}\n                    <button class=\"acu-changes-batch-btn acu-batch-reject\" title=\"${isValidationMode ? '' : ''}\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                    <button class=\"acu-changes-batch-btn acu-simple-mode-toggle ${isValidationMode ? 'active' : ''}\" title=\"${toggleTitle}\">\n                        <i class=\"fa-solid ${isValidationMode ? 'fa-filter-circle-xmark' : 'fa-filter'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                    </div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>`;\n\n    // ===  ===\n    if (isValidationMode) {\n      html += `<div class=\"acu-validation-mode-hint\">\n        <i class=\"fa-solid fa-info-circle\"></i>\n      </div>`;\n    }\n\n    html += `<div class=\"acu-panel-content acu-changes-content ${config.layout === 'horizontal' ? 'acu-changes-horizontal' : ''}\">`;\n\n    // ===  ===\n    if (isValidationMode) {\n      if (validationErrors.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedErrors = ValidationEngine.groupErrorsByTable(validationErrors);\n        const collapsedGroups = Store.get('acu_validation_collapsed_groups', []);\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        for (const tableName in groupedErrors) {\n          const tableErrors = groupedErrors[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header acu-validation-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\" style=\"background:#e74c3c;\">${tableErrors.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableErrors.forEach(error => {\n            const ruleData = error.rule\n              ? escapeHtml(\n                  JSON.stringify({\n                    ruleId: error.ruleId,\n                    ruleType: error.ruleType,\n                    tableName: error.tableName,\n                    rowIndex: error.rowIndex,\n                    columnName: error.columnName || '',\n                    currentValue: error.currentValue || '',\n                    rule: error.rule,\n                  }),\n                )\n              : '';\n\n            html += `<div class=\"acu-change-item acu-validation-error-item\"\n                         data-table=\"${escapeHtml(error.tableName)}\"\n                         data-row=\"${error.rowIndex}\"\n                         data-column=\"${escapeHtml(error.columnName || '')}\"\n                         data-rule-id=\"${escapeHtml(error.ruleId || '')}\"\n                         data-rule-type=\"${escapeHtml(error.ruleType || '')}\"\n                         data-rule-data=\"${ruleData}\">\n                        <span class=\"acu-change-badge\" style=\"background:var(--acu-hl-manual-bg);color:var(--acu-hl-manual);\">!</span>\n                        <span class=\"acu-change-title\">${escapeHtml(error.columnName || '')}${error.currentValue ? `: ${escapeHtml(error.currentValue.length > 15 ? error.currentValue.substring(0, 15) + '...' : error.currentValue)}` : ''}</span>\n                        <span class=\"acu-validation-error-msg\">${escapeHtml(error.errorMessage.length > 25 ? error.errorMessage.substring(0, 25) + '...' : error.errorMessage)}</span>\n                        <div class=\"acu-change-actions\">\n                            <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                            <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                        </div>\n                    </div>`;\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    } else {\n      // ===  ===\n      if (changes.length === 0) {\n        html += `<div class=\"acu-empty-hint\" style=\"padding:40px;text-align:center;flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;\">\n                <i class=\"fa-solid fa-check-circle\" style=\"font-size:32px;color:var(--acu-success-text);margin-bottom:10px;display:block;\"></i>\n                \n            </div>`;\n      } else {\n        // \n        const groupedChanges = {};\n        changes.forEach(c => {\n          const key = c.tableName;\n          if (!groupedChanges[key]) groupedChanges[key] = [];\n          groupedChanges[key].push(c);\n        });\n\n        html += `<div class=\"acu-changes-list\">`;\n\n        const collapsedGroups = Store.get('acu_changes_collapsed_groups', []);\n\n        for (const tableName in groupedChanges) {\n          const tableChanges = groupedChanges[tableName];\n          const isCollapsed = collapsedGroups.includes(tableName);\n          html += `<div class=\"acu-changes-group ${isCollapsed ? 'collapsed' : ''}\">\n                    <div class=\"acu-changes-group-header\" data-table=\"${escapeHtml(tableName)}\" style=\"cursor:pointer;\">\n                        <i class=\"fa-solid fa-chevron-${isCollapsed ? 'right' : 'down'} acu-collapse-icon\" style=\"font-size:10px;width:12px;transition:transform 0.2s;\"></i>\n                        <i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${escapeHtml(tableName)}\n                        <span class=\"acu-changes-count\">${tableChanges.length}</span>\n                    </div>\n                    <div class=\"acu-changes-group-body\" style=\"${isCollapsed ? 'display:none;' : ''}\">`;\n\n          tableChanges.forEach(change => {\n            if (change.type === 'row_added') {\n              html += `<div class=\"acu-change-item acu-change-added\"\n                            data-change-type=\"row_added\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-added\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"row_deleted\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\">${escapeHtml(change.title)}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'cell_modified') {\n              const oldShort = change.oldValue.length > 15 ? change.oldValue.substring(0, 15) + '...' : change.oldValue;\n              const newShort = change.newValue.length > 15 ? change.newValue.substring(0, 15) + '...' : change.newValue;\n\n              const isOptionTable = change.tableName && change.tableName.includes('');\n              let fieldDisplay;\n              if (isOptionTable) {\n                fieldDisplay = `${escapeHtml(change.tableName)}.${escapeHtml(change.header)}`;\n              } else {\n                fieldDisplay = `${escapeHtml(change.rowTitle)}.${escapeHtml(change.header)}`;\n              }\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"cell_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\"\n                            data-col-index=\"${change.colIndex}\"\n                            data-old-value=\"${encodeURIComponent(change.oldValue)}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-field\">${fieldDisplay}</span>\n                            <span class=\"acu-change-diff\">\n                                <span class=\"acu-diff-old\">${escapeHtml(oldShort || '()')}</span>\n                                <span class=\"acu-diff-arrow\"></span>\n                                <span class=\"acu-diff-new\">${escapeHtml(newShort || '()')}</span>\n                            </span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'row_modified') {\n              // \n              const fieldCount = change.changedFields.length;\n              const fieldNames = change.changedFields\n                .slice(0, 2)\n                .map(f => f.header)\n                .join('');\n              const moreText = fieldCount > 2 ? ` ${fieldCount}` : '';\n\n              html += `<div class=\"acu-change-item acu-change-modified\"\n                            data-change-type=\"row_modified\"\n                            data-table-key=\"${change.tableKey}\"\n                            data-row-index=\"${change.rowIndex}\">\n                            <span class=\"acu-change-badge acu-badge-modified\"></span>\n                            <span class=\"acu-change-title\">${escapeHtml(change.rowTitle)}</span>\n                            <span class=\"acu-change-field-count\">${escapeHtml(fieldNames)}${moreText}</span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-reject\" title=\"\"><i class=\"fa-solid fa-rotate-left\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-edit\" title=\"\"><i class=\"fa-solid fa-pen\"></i></button>\n                            </div>\n                        </div>`;\n            } else if (change.type === 'table_deleted') {\n              html += `<div class=\"acu-change-item acu-change-deleted\"\n                            data-change-type=\"table_deleted\"\n                            data-table-key=\"${change.tableKey}\">\n                            <span class=\"acu-change-badge acu-badge-deleted\"></span>\n                            <span class=\"acu-change-title\" style=\"text-decoration:line-through;opacity:0.6;\"></span>\n                            <div class=\"acu-change-actions\">\n                                <button class=\"acu-change-action-btn acu-action-accept\" title=\"\"><i class=\"fa-solid fa-check\"></i></button>\n                                <button class=\"acu-change-action-btn acu-action-restore\" title=\"\"><i class=\"fa-solid fa-undo\"></i></button>\n                            </div>\n                        </div>`;\n            }\n          });\n\n          html += `</div></div>`;\n        }\n\n        html += `</div>`;\n      }\n    }\n\n    html += `</div>`;\n    return html;\n  };\n  // [] \n  const bindChangesEvents = () => {\n    const { $ } = getCore();\n\n    // \n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-close-btn')\n      .off('click')\n      .on('click', function () {\n        Store.set('acu_changes_panel_active', false);\n        $('#acu-data-area').removeClass('visible');\n        $('.acu-nav-btn').removeClass('active');\n      });\n\n    // === ===\n    const TOUCH_MOVE_THRESHOLD = 10; // 10px\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const tableName = $item.data('table');\n        const rowIndex = parseInt($item.data('row'), 10);\n        const columnName = $item.data('column');\n\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        try {\n          const rawData = cachedRawData || getTableData();\n          for (const sheetId in rawData) {\n            if (rawData[sheetId]?.name === tableName && snapshot[sheetId]) {\n              const headers = rawData[sheetId].content?.[0] || [];\n              const colIdx = headers.indexOf(columnName);\n              if (colIdx >= 0 && snapshot[sheetId].content?.[rowIndex + 1]) {\n                const snapshotValue = snapshot[sheetId].content[rowIndex + 1][colIdx];\n                rawData[sheetId].content[rowIndex + 1][colIdx] = snapshotValue;\n                await saveDataToDatabase(rawData, false, false);\n                renderInterface();\n                return;\n              }\n              break;\n            }\n          }\n          if (window.toastr) window.toastr.warning('');\n        } catch (err) {\n          console.error('[ACU] :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    $('.acu-validation-error-item .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-validation-error-item');\n        const ruleData = $item.data('rule-data');\n        if (!ruleData) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n        try {\n          const parsed = typeof ruleData === 'string' ? JSON.parse(ruleData) : ruleData;\n          const error = {\n            ruleId: parsed.ruleId,\n            ruleType: parsed.ruleType,\n            rule: parsed.rule,\n            tableName: $item.data('table') || parsed.tableName || '',\n            rowIndex: parseInt($item.data('row'), 10) || parsed.rowIndex || 0,\n            columnName: $item.data('column') || parsed.columnName || '',\n            currentValue: parsed.currentValue || '',\n            ruleName: parsed.ruleName || parsed.rule?.name || '',\n            errorMessage: parsed.errorMessage || parsed.rule?.errorMessage || '',\n          };\n          showSmartFixModal(error);\n        } catch (err) {\n          console.error('[ACU] :', err);\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    // === ===\n    let validationItemTouchStartPos: { x: number; y: number } | null = null;\n\n    $('.acu-validation-error-item')\n      .off('click touchstart touchend touchmove')\n      .on('touchstart', function (e) {\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        validationItemTouchStartPos = { x: touch.clientX, y: touch.clientY };\n      })\n      .on('touchmove', function (e) {\n        if (!validationItemTouchStartPos) return;\n        const touch = (e.originalEvent as TouchEvent).touches[0];\n        const deltaX = Math.abs(touch.clientX - validationItemTouchStartPos.x);\n        const deltaY = Math.abs(touch.clientY - validationItemTouchStartPos.y);\n        // \n        if (deltaX > TOUCH_MOVE_THRESHOLD || deltaY > TOUCH_MOVE_THRESHOLD) {\n          validationItemTouchStartPos = null;\n        }\n      })\n      .on('touchend', function (e) {\n        // \n        if (!validationItemTouchStartPos) return;\n        validationItemTouchStartPos = null;\n\n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      })\n      .on('click', function (e) {\n        //  click \n        // \n        if ($(e.target).closest('.acu-change-actions, .acu-change-action-btn').length) {\n          return;\n        }\n\n        //  touchend \n        if ('ontouchstart' in window) return;\n\n        // [] \n        const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        if (isValidationMode) {\n          // \n          return;\n        }\n\n        const tableName = $(this).data('table');\n        const rowIndex = $(this).data('row');\n\n        // \n        Store.set('acu_changes_panel_active', false);\n        saveActiveTabState(tableName);\n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $targetCard = $(`.acu-data-card[data-row-index=\"${rowIndex}\"]`);\n          if ($targetCard.length) {\n            $targetCard[0].scrollIntoView({ behavior: 'smooth', block: 'center' });\n            $targetCard.addClass('acu-highlight-flash');\n            setTimeout(() => $targetCard.removeClass('acu-highlight-flash'), 2000);\n          }\n        }, 300);\n      });\n\n    // /\n    $('.acu-changes-group-header')\n      .off('click')\n      .on('click', function (e) {\n        if ($(e.target).closest('.acu-change-item').length) return;\n\n        const tableName = $(this).data('table');\n        const $group = $(this).closest('.acu-changes-group');\n        const $body = $group.find('.acu-changes-group-body');\n        const $icon = $(this).find('.acu-collapse-icon');\n\n        // \n        const isValidationMode = $(this).hasClass('acu-validation-group-header');\n        const storageKey = isValidationMode ? 'acu_validation_collapsed_groups' : 'acu_changes_collapsed_groups';\n        let collapsedGroups = Store.get(storageKey, []);\n\n        if ($group.hasClass('collapsed')) {\n          $group.removeClass('collapsed');\n          $body.slideDown(200);\n          $icon.removeClass('fa-chevron-right').addClass('fa-chevron-down');\n          collapsedGroups = collapsedGroups.filter(n => n !== tableName);\n        } else {\n          $group.addClass('collapsed');\n          $body.slideUp(200);\n          $icon.removeClass('fa-chevron-down').addClass('fa-chevron-right');\n          if (!collapsedGroups.includes(tableName)) {\n            collapsedGroups.push(tableName);\n          }\n        }\n\n        Store.set(storageKey, collapsedGroups);\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-accept')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n\n        const snapshot = loadSnapshot();\n        const rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = rawData[tableKey].content[rowIndex + 1][colIndex];\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content && rawData[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            if (!snapshot[tableKey]) {\n              snapshot[tableKey] = JSON.parse(JSON.stringify(rawData[tableKey]));\n            } else {\n              snapshot[tableKey].content[rowIndex + 1] = [...rawData[tableKey].content[rowIndex + 1]];\n            }\n          }\n        } else if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            snapshot[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          delete snapshot[tableKey];\n        }\n\n        saveSnapshot(snapshot);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item .acu-action-reject')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const colIndex = $item.data('col-index');\n        const oldValue = decodeURIComponent($item.data('old-value') || '');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'cell_modified') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content[rowIndex + 1][colIndex] = oldValue;\n          }\n        } else if (changeType === 'row_modified') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1] && rawData[tableKey]?.content) {\n            rawData[tableKey].content[rowIndex + 1] = [...snapshot[tableKey].content[rowIndex + 1]];\n          }\n        } else if (changeType === 'row_added') {\n          // \n          if (rawData[tableKey]?.content?.[rowIndex + 1]) {\n            rawData[tableKey].content.splice(rowIndex + 1, 1);\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === /===\n    $('.acu-action-restore')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const changeType = $item.data('change-type');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n\n        const snapshot = loadSnapshot();\n        let rawData = cachedRawData || getTableData();\n        if (!snapshot || !rawData) return;\n\n        if (changeType === 'row_deleted') {\n          // \n          if (snapshot[tableKey]?.content?.[rowIndex + 1]) {\n            const restoredRow = [...snapshot[tableKey].content[rowIndex + 1]];\n            if (!rawData[tableKey]) {\n              rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n              rawData[tableKey].content = [snapshot[tableKey].content[0]];\n            }\n            // \n            rawData[tableKey].content.splice(rowIndex + 1, 0, restoredRow);\n          }\n        } else if (changeType === 'table_deleted') {\n          // \n          if (snapshot[tableKey]) {\n            rawData[tableKey] = JSON.parse(JSON.stringify(snapshot[tableKey]));\n          }\n        }\n\n        // [] \n        await saveDataOnly(rawData);\n\n        // \n        $item.fadeOut(200, function () {\n          $(this).remove();\n          refreshChangesPanel();\n        });\n      });\n\n    // === ===\n    $('.acu-change-item:not(.acu-validation-error-item) .acu-action-edit')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $item = $(this).closest('.acu-change-item');\n        const tableKey = $item.data('table-key');\n        const rowIndex = $item.data('row-index');\n        const changeType = $item.data('change-type');\n\n        if (!tableKey || rowIndex === undefined) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const sheet = rawData[tableKey];\n        const headers = sheet.content ? sheet.content[0] : [];\n        const row = sheet.content ? sheet.content[rowIndex + 1] : null;\n\n        if (!row) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        if (changeType === 'row_modified') {\n          // \n          showRowCompareEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        } else if (changeType === 'cell_modified') {\n          const colIndex = $item.data('col-index');\n          const headerName = headers[colIndex] || `${colIndex}`;\n          const cellValue = row[colIndex] || '';\n          showChangeSingleFieldModal(cellValue, headerName, sheet.name, rowIndex, colIndex, tableKey);\n        } else {\n          showChangeEditModal(row, headers, sheet.name || '', rowIndex, tableKey);\n        }\n      });\n\n    // ===  ===\n    $('.acu-batch-accept')\n      .off('click')\n      .on('click', async function () {\n        const rawData = cachedRawData || getTableData();\n        if (!rawData) return;\n\n        // \n        saveSnapshot(JSON.parse(JSON.stringify(rawData)));\n        currentDiffMap = new Set();\n\n        // \n        refreshChangesPanel();\n      });\n\n    // ===  ===\n    $('.acu-batch-reject')\n      .off('click')\n      .on('click', async function () {\n        const snapshot = loadSnapshot();\n        if (!snapshot) {\n          if (window.toastr) window.toastr.warning('');\n          return;\n        }\n\n        // \n        const restoredData = JSON.parse(JSON.stringify(snapshot));\n        cachedRawData = restoredData;\n        await saveDataToDatabase(restoredData, false, false);\n      });\n\n    // ===  ===\n    $('.acu-simple-mode-toggle')\n      .off('click')\n      .on('click', function () {\n        const currentMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n        const newMode = !currentMode;\n        Store.set(STORAGE_KEY_VALIDATION_MODE, newMode);\n\n        // \n        const rawData = cachedRawData || getTableData();\n        $('#acu-data-area').html(renderChangesPanel(rawData));\n        bindChangesEvents();\n\n        // \n        updateChangesCount(rawData);\n      });\n\n    // ===  ===\n    $('.acu-changes-content')\n      .closest('.acu-data-display')\n      .find('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          // \n          const finalHeight = $panel.height();\n          const heights = getTableHeights();\n          heights[tableName] = finalHeight;\n          saveTableHeights(heights);\n        };\n      })\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const $panel = $('#acu-data-area');\n        $panel.css('height', ''); // \n        // \n        const heights = getTableHeights();\n        delete heights[tableName];\n        saveTableHeights(heights);\n      });\n\n    // ===  ===\n    const $horizontalScroller = $('.acu-changes-content.acu-changes-horizontal');\n    if ($horizontalScroller.length) {\n      $horizontalScroller[0].addEventListener(\n        'touchstart',\n        function (e) {\n          this._touchStartX = e.touches[0].clientX;\n          this._touchStartY = e.touches[0].clientY;\n          this._scrollDirection = null; // \n        },\n        { passive: true },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchmove',\n        function (e) {\n          if (!this._touchStartX) return;\n\n          const deltaX = Math.abs(e.touches[0].clientX - this._touchStartX);\n          const deltaY = Math.abs(e.touches[0].clientY - this._touchStartY);\n\n          // \n          if (!this._scrollDirection && (deltaX > 5 || deltaY > 5)) {\n            this._scrollDirection = deltaX > deltaY ? 'horizontal' : 'vertical';\n          }\n\n          // \n          // \n          if (this._scrollDirection === 'horizontal' && deltaX > 10) {\n            e.stopPropagation();\n          }\n        },\n        { passive: false },\n      );\n\n      $horizontalScroller[0].addEventListener(\n        'touchend',\n        function () {\n          this._touchStartX = null;\n          this._touchStartY = null;\n          this._scrollDirection = null;\n        },\n        { passive: true },\n      );\n    }\n  };\n\n  // [] \n  const refreshChangesPanel = () => {\n    const { $ } = getCore();\n    const rawData = cachedRawData || getTableData();\n    currentDiffMap = generateDiffMap(rawData);\n\n    const $panel = $('#acu-data-area');\n    if ($panel.length && Store.get('acu_changes_panel_active', false)) {\n      $panel.html(renderChangesPanel(rawData));\n      bindChangesEvents();\n\n      // \n      updateChangesCount(rawData);\n    }\n  };\n\n  // []  + \n  const updateChangesCount = rawData => {\n    const { $ } = getCore();\n    const snapshot = loadSnapshot();\n    let changesCount = 0;\n\n    if (snapshot && rawData) {\n      for (const sheetId in rawData) {\n        if (!sheetId.startsWith('sheet_')) continue;\n        const newSheet = rawData[sheetId];\n        const oldSheet = snapshot[sheetId];\n        if (!newSheet?.content) continue;\n        const newRows = newSheet.content.slice(1);\n        const oldRows = oldSheet?.content?.slice(1) || [];\n        newRows.forEach((row, rowIdx) => {\n          const oldRow = oldRows[rowIdx];\n          if (!oldRow) {\n            changesCount++;\n            return;\n          }\n          row.forEach((cell, colIdx) => {\n            if (colIdx === 0) return;\n            if (String(cell ?? '') !== String(oldRow[colIdx] ?? '')) changesCount++;\n          });\n        });\n        if (oldRows.length > newRows.length) changesCount += oldRows.length - newRows.length;\n      }\n      for (const sheetId in snapshot) {\n        if (sheetId.startsWith('sheet_') && !rawData[sheetId]) changesCount++;\n      }\n    }\n\n    // \n    const validationErrorCount = rawData ? ValidationEngine.getErrorCount(rawData) : 0;\n\n    // \n    const isValidationMode = Store.get(STORAGE_KEY_VALIDATION_MODE, false);\n    const displayCount = isValidationMode ? validationErrorCount : changesCount;\n    // \n    const showWarningIcon = isValidationMode && validationErrorCount > 0;\n\n    const $btn = $('#acu-btn-changes');\n    const $span = $btn.find('span');\n    $span.html(displayCount > 0 ? `(${displayCount})` : '');\n\n    // \n    if (showWarningIcon) {\n      if (!$btn.find('.acu-nav-warning-icon').length) {\n        $span.append(' <i class=\"fa-solid fa-triangle-exclamation acu-nav-warning-icon\"></i>');\n      }\n      $btn.addClass('has-validation-errors');\n    } else {\n      $btn.find('.acu-nav-warning-icon').remove();\n      $btn.removeClass('has-validation-errors');\n    }\n  };\n  // [] \n  const showChangeEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const inputsHtml = row\n      .map((cell, idx) => {\n        if (idx === 0) return '';\n        const headerName = headers[idx] || ` ${idx}`;\n        const val = cell || '';\n        return `\n                <div class=\"acu-card-edit-field\" style=\"margin-bottom: 10px;\">\n                    <label style=\"display:block;font-size:12px;color:var(--acu-accent);font-weight:bold;margin-bottom:4px;\">${escapeHtml(headerName)}</label>\n                    <textarea class=\"acu-card-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\"\n                                                        style=\"width:100%;min-height:40px;max-height:500px;padding:10px;resize:none;overflow-y:hidden;\">${escapeHtml(val)}</textarea>                            </div>`;\n      })\n      .join('');\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"> (#${rowIndex + 1} - ${escapeHtml(tableName)})</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${inputsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-change-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-change-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // [] \n    const adjustHeight = el => {\n      //  auto  0px scrollHeight\n      el.style.height = 'auto';\n      const contentHeight = el.scrollHeight + 2;\n      const maxHeight = 500;\n      el.style.height = Math.min(contentHeight, maxHeight) + 'px';\n      el.style.overflowY = contentHeight > maxHeight ? 'auto' : 'hidden';\n    };\n\n    // 1.  requestAnimationFrame  DOM \n    requestAnimationFrame(() => {\n      dialog.find('textarea').each(function () {\n        adjustHeight(this);\n      });\n    });\n\n    // 2. \n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => {\n      isSettingsOpen = false;\n      dialog.remove();\n    };\n    dialog.find('#dlg-change-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    dialog.find('#dlg-change-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const currentRow = rawData[tableKey]?.content?.[rowIndex + 1];\n        if (!currentRow) {\n          closeDialog();\n          return;\n        }\n\n        let hasChanges = false;\n        dialog.find('textarea').each(function () {\n          const colIdx = parseInt($(this).data('col'));\n          const newVal = $(this).val();\n          if (String(currentRow[colIdx]) !== String(newVal)) {\n            hasChanges = true;\n            currentRow[colIdx] = newVal;\n          }\n        });\n\n        if (hasChanges) {\n          // 1. \n          const api = getCore().getDB();\n          if (api && api.importTableAsJson) {\n            const dataToSave = { mate: rawData.mate || { type: 'chatSheets', version: 1 } };\n            Object.keys(rawData).forEach(k => {\n              if (k.startsWith('sheet_')) dataToSave[k] = rawData[k];\n            });\n            await api.importTableAsJson(JSON.stringify(dataToSave));\n          }\n          cachedRawData = rawData;\n\n          // 2. \n          const snapshot = loadSnapshot();\n          if (snapshot && snapshot[tableKey] && snapshot[tableKey].content) {\n            snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n            saveSnapshot(snapshot);\n          }\n\n          // 3.  diffMap \n          currentDiffMap = generateDiffMap(rawData);\n\n          // 4. \n          const $panel = $('#acu-data-area');\n          $panel.html(renderChangesPanel(rawData));\n          bindChangesEvents();\n        }\n      }\n      closeDialog();\n    });\n  };\n  // [] \n  const showChangeSingleFieldModal = (value, headerName, tableName, rowIndex, colIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldValue = snapshot?.[tableKey]?.content?.[rowIndex + 1]?.[colIndex] ?? '';\n    const hasOldValue = oldValue !== '' && String(oldValue) !== String(value);\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:450px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(headerName)}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px;\">\n                        ${\n                          hasOldValue\n                            ? `\n                        <div class=\"acu-diff-section acu-diff-old-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-clock-rotate-left\"></i> \n                            </div>\n                            <div class=\"acu-diff-readonly\">${escapeHtml(oldValue)}</div>\n                        </div>\n                        <div class=\"acu-diff-arrow-down\">\n                            <i class=\"fa-solid fa-arrow-down\"></i>\n                        </div>\n                        `\n                            : ''\n                        }\n                        <div class=\"acu-diff-section acu-diff-new-section\">\n                            <div class=\"acu-diff-label\">\n                                <i class=\"fa-solid fa-pen\"></i> ${hasOldValue ? '' : ''}\n                            </div>\n                            <textarea class=\"acu-change-single-input acu-edit-textarea\" spellcheck=\"false\"\n                                style=\"width:100%;min-height:60px;max-height:300px;padding:12px;resize:none;\">${escapeHtml(value)}</textarea>\n                        </div>\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-single-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        ${hasOldValue ? `<button class=\"acu-dialog-btn acu-btn-revert\" id=\"dlg-single-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>` : ''}\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-single-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const $textarea = dialog.find('.acu-change-single-input');\n    const adjustHeight = () => {\n      $textarea[0].style.height = 'auto';\n      const h = Math.max(60, Math.min($textarea[0].scrollHeight + 2, 300));\n      $textarea[0].style.height = h + 'px';\n    };\n    setTimeout(adjustHeight, 0);\n    $textarea.on('input', adjustHeight);\n    $textarea.focus();\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-single-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // [] \n    dialog.find('#dlg-single-revert').click(function () {\n      $textarea.val(oldValue).trigger('input');\n    });\n\n    dialog.find('#dlg-single-save').click(async () => {\n      const newVal = $textarea.val();\n      let rawData = cachedRawData || getTableData();\n\n      if (rawData && rawData[tableKey] && rawData[tableKey].content) {\n        const currentRow = rawData[tableKey].content[rowIndex + 1];\n        if (currentRow && String(currentRow[colIndex]) !== String(newVal)) {\n          currentRow[colIndex] = newVal;\n\n          // \n          await saveDataOnly(rawData);\n\n          // \n          const snapshot = loadSnapshot();\n          if (\n            snapshot &&\n            snapshot[tableKey] &&\n            snapshot[tableKey].content &&\n            snapshot[tableKey].content[rowIndex + 1]\n          ) {\n            snapshot[tableKey].content[rowIndex + 1][colIndex] = newVal;\n            saveSnapshot(snapshot);\n          }\n\n          // \n          currentDiffMap = generateDiffMap(rawData);\n          refreshChangesPanel();\n        }\n      }\n      closeDialog();\n    });\n  };\n\n  // [] \n  const showRowCompareEditModal = (row, headers, tableName, rowIndex, tableKey) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    // \n    const snapshot = loadSnapshot();\n    const oldRow = snapshot?.[tableKey]?.content?.[rowIndex + 1] || [];\n\n    // \n    let fieldsHtml = '';\n    for (let idx = 1; idx < headers.length; idx++) {\n      const headerName = headers[idx] || ` ${idx}`;\n      const oldVal = oldRow[idx] ?? '';\n      const newVal = row[idx] ?? '';\n      const isChanged = String(oldVal) !== String(newVal);\n\n      fieldsHtml += `\n                <div class=\"acu-row-edit-field ${isChanged ? 'acu-field-changed' : ''}\">\n                    <div class=\"acu-row-edit-label\">${escapeHtml(headerName)} ${isChanged ? '<span class=\"acu-changed-badge\"></span>' : ''}</div>\n                    ${isChanged ? `<div class=\"acu-row-edit-old\">${escapeHtml(oldVal) || '<span class=\"acu-empty-val\">()</span>'}</div>` : ''}\n                    <textarea class=\"acu-row-edit-input acu-edit-textarea\" data-col=\"${idx}\" spellcheck=\"false\" rows=\"1\">${escapeHtml(newVal)}</textarea>\n                </div>\n            `;\n    }\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\" style=\"max-width:550px;\">\n                    <div class=\"acu-edit-title\">: ${escapeHtml(tableName)} - ${escapeHtml(row[1] || ' ' + (rowIndex + 1))}</div>\n                    <div class=\"acu-settings-content\" style=\"flex:1; overflow-y:auto; padding:15px; max-height:60vh;\">\n                        ${fieldsHtml}\n                    </div>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn\" id=\"dlg-row-revert\"><i class=\"fa-solid fa-rotate-left\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-row-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    // \n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = Math.min(el.scrollHeight + 2, 200) + 'px';\n    };\n    dialog.find('textarea').each(function () {\n      adjustHeight(this);\n    });\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    const closeDialog = () => dialog.remove();\n    dialog.find('#dlg-row-cancel').click(closeDialog);\n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) closeDialog();\n    });\n\n    // \n    dialog.find('#dlg-row-revert').click(function () {\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        $(this)\n          .val(oldRow[colIdx] ?? '')\n          .trigger('input');\n      });\n    });\n\n    // \n    dialog.find('#dlg-row-save').click(async () => {\n      let rawData = cachedRawData || getTableData();\n      if (!rawData?.[tableKey]?.content?.[rowIndex + 1]) {\n        closeDialog();\n        return;\n      }\n\n      const currentRow = rawData[tableKey].content[rowIndex + 1];\n      let hasChanges = false;\n\n      dialog.find('textarea').each(function () {\n        const colIdx = parseInt($(this).data('col'));\n        const newVal = $(this).val();\n        if (String(currentRow[colIdx]) !== String(newVal)) {\n          hasChanges = true;\n          currentRow[colIdx] = newVal;\n        }\n      });\n\n      if (hasChanges) {\n        await saveDataOnly(rawData);\n\n        // \n        const snapshot = loadSnapshot();\n        if (snapshot?.[tableKey]?.content) {\n          snapshot[tableKey].content[rowIndex + 1] = [...currentRow];\n          saveSnapshot(snapshot);\n        }\n\n        currentDiffMap = generateDiffMap(rawData);\n        refreshChangesPanel();\n      }\n      closeDialog();\n    });\n  };\n  const renderDashboard = allTables => {\n    const config = getConfig();\n\n    // []  - \n    const findColIndex = (headers, keywords) => {\n      if (!headers || !Array.isArray(keywords)) return -1;\n      for (let i = 0; i < headers.length; i++) {\n        const h = String(headers[i] || '').toLowerCase();\n        if (keywords.some(kw => h.includes(kw.toLowerCase()))) return i;\n      }\n      return -1;\n    };\n\n    // [] \n    const globalResult = DashboardDataParser.findTable(allTables, 'global');\n    const playerResult = DashboardDataParser.findTable(allTables, 'player');\n    const locationResult = DashboardDataParser.findTable(allTables, 'location');\n    const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n    const questResult = DashboardDataParser.findTable(allTables, 'quest');\n    const bagResult = DashboardDataParser.findTable(allTables, 'bag');\n    const skillResult = DashboardDataParser.findTable(allTables, 'skill');\n    const equipResult = DashboardDataParser.findTable(allTables, 'equip');\n\n    // [] \n    const locationTable = locationResult?.data;\n    const playerTable = playerResult?.data;\n    const questTable = questResult?.data;\n    const npcTable = npcResult?.data;\n    const bagTable = bagResult?.data;\n    const skillTable = skillResult?.data;\n    const equipTable = equipResult?.data;\n\n    // []  - \n    let player = { name: '', status: '', position: '', attrs: '', money: '0' };\n    const playerParsed = DashboardDataParser.parseRows(playerResult, 'player');\n\n    if (playerParsed.length > 0) {\n      const p = playerParsed[0];\n      player.name = p.name || '';\n      player.status = p.status || '';\n      player.position = p.position || '';\n      player.money = p.money || '';\n      player.resources = '';\n\n      // [] \n      if (playerResult?.data?.headers && playerResult?.data?.rows?.[0]) {\n        const headers = playerResult.data.headers;\n        const row = playerResult.data.rows[0];\n        let allAttrsStr = '';\n        headers.forEach((h, idx) => {\n          if (h && h.includes('')) {\n            const val = row[idx];\n            if (val) allAttrsStr += (allAttrsStr ? '; ' : '') + val;\n          }\n        });\n        player.attrs = allAttrsStr;\n\n        // \n        headers.forEach((h, idx) => {\n          if (h && (h.includes('') || h.includes(''))) {\n            const val = row[idx];\n            if (val) player.resources = val;\n          }\n        });\n      }\n    }\n\n    // [] HTML\n    const playerRows = playerTable?.rows || [];\n    const playerHeaders = playerTable?.headers || [];\n\n    // []  - \n    const globalTable = globalResult?.data;\n    let globalDetailLocation = ''; // \n    let globalLocation = ''; // \n\n    if (globalResult?.data?.rows?.length > 0) {\n      const headers = globalResult.data.headers || [];\n      const row = globalResult.data.rows[0];\n\n      // \n      const detailIdx = DashboardDataParser.findColumnIndex(headers, 'detailLocation', globalResult.config);\n      if (detailIdx >= 0 && row[detailIdx]) {\n        globalDetailLocation = row[detailIdx];\n      }\n\n      // \n      const locIdx = DashboardDataParser.findColumnIndex(headers, 'currentLocation', globalResult.config);\n      globalLocation = locIdx >= 0 && row[locIdx] ? row[locIdx] : row[2] || '';\n    }\n\n    // currentPlaceName \n    let currentPlaceName =\n      globalDetailLocation ||\n      globalLocation ||\n      (player.position.includes('-') ? player.position.split('-')[0].trim() : player.position);\n\n    // [] NPC - \n    const npcTableName = npcResult?.name || '';\n    const npcTableKey = npcResult?.key || '';\n    const npcHeaders = npcTable?.headers || [];\n\n    const npcParsed = DashboardDataParser.parseRows(npcResult, 'npc');\n\n    // NPC\n    let inSceneNPCs = [];\n    let offSceneNPCs = [];\n    npcParsed.forEach(npc => {\n      const inSceneVal = String(npc.inScene || '').toLowerCase();\n      const npcData = {\n        name: npc.name || '',\n        status: npc.status || '',\n        position: npc.position || '',\n        index: npc._rowIndex,\n      };\n      if (inSceneVal === 'true' || inSceneVal === '') {\n        inSceneNPCs.push(npcData);\n      } else {\n        offSceneNPCs.push(npcData);\n      }\n    });\n    // \n    let allNPCs = [...inSceneNPCs, ...offSceneNPCs];\n\n    // []  -  + \n    const questTableName = questResult?.name || '';\n    const questParsed = DashboardDataParser.parseRows(questResult, 'quest');\n    const activeQuestParsed = DashboardDataParser.applyFilter(questParsed, 'active', 'quest');\n\n    //  >  >  > \n    const questTypeOrder = type => {\n      const t = String(type || '').toLowerCase();\n      if (t.includes('')) return 0;\n      if (t.includes('')) return 1;\n      if (t.includes('')) return 2;\n      return 3;\n    };\n    let activeTasks = activeQuestParsed\n      .map(q => ({\n        name: q.name || '',\n        type: q.type || '',\n        progress: q.progress || '',\n        _rowIndex: q._rowIndex,\n      }))\n      .sort((a, b) => questTypeOrder(a.type) - questTypeOrder(b.type))\n      .slice(0, 5);\n    // []  - \n    const bagTableName = bagResult?.name || '';\n\n    const bagParsed = DashboardDataParser.parseRows(bagResult, 'bag');\n    let bagItems = bagParsed.slice(0, 6).map(item => ({\n      name: item.name || '',\n      count: item.count || '1',\n      type: item.type || '',\n    }));\n\n    // []  - \n    const skillTableName = skillResult?.name || '';\n\n    const skillParsed = DashboardDataParser.parseRows(skillResult, 'skill');\n    let skills = skillParsed.slice(0, 6).map(s => ({\n      name: s.name || '',\n      level: s.level || '',\n      type: s.type || '',\n    }));\n\n    // []  -  + \n    const equipTableName = equipResult?.name || '';\n\n    const equipParsed = DashboardDataParser.parseRows(equipResult, 'equip');\n    const equippedParsed = DashboardDataParser.applyFilter(equipParsed, 'equipped', 'equip');\n\n    let equippedItems = equippedParsed.slice(0, 4).map(e => ({\n      name: e.name || '',\n      type: e.type || '',\n      part: e.part || '',\n    }));\n    // []  - \n    const locationTableName = locationResult?.name || '';\n    const locationTableKey = locationResult?.key || '';\n\n    const locationParsed = DashboardDataParser.parseRows(locationResult, 'location');\n\n    // HTML\n    let html = `\n        <div class=\"acu-panel-header\">\n            <div class=\"acu-panel-title\">\n                <div class=\"acu-title-main\"><i class=\"fa-solid fa-chart-line\"></i> <span class=\"acu-title-text\"></span></div>\n                <div class=\"acu-title-sub\"></div>\n            </div>\n            <div class=\"acu-header-actions\">\n                <div class=\"acu-height-control\">\n                    <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"\" title=\"  | \"></i>\n                </div>\n                <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n            </div>\n        </div>\n        <div class=\"acu-panel-content acu-dashboard-content\">\n            <div class=\"acu-dash-body ${config.layout === 'horizontal' ? 'acu-dash-horizontal' : ''}\">\n            <!--  +  -->\n                <div class=\"acu-dash-player\">\n                    <h3 class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                        data-table-key=\"${playerResult?.key || ''}\"\n                        data-row-index=\"0\"\n                        data-preview-type=\"player\"\n                        style=\"cursor:pointer;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-user-circle\"></i> ${escapeHtml(replaceUserPlaceholders(player.name))}</span>\n                        <span style=\"font-size:11px;font-weight:normal;color:var(--acu-text-main);background:var(--acu-badge-bg);padding:2px 8px;border-radius:10px;max-width:80px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\" title=\"${escapeHtml(player.status)}\">${escapeHtml(player.status.length > 6 ? player.status.substring(0, 6) + '..' : player.status)}</span>\n                    </h3>\n                    <div class=\"acu-player-status\" style=\"margin-bottom:8px;\">\n                        ${(() => {\n                          // \n                          const resourcesStr = player.resources || player.money || '';\n                          const parsedResources = parseAttributeString(resourcesStr);\n                          if (parsedResources.length > 0) {\n                            return `<div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:52px;overflow-y:auto;margin-bottom:6px;padding-bottom:6px;border-bottom:1px dashed var(--acu-border);\">\n                                    ${parsedResources\n                                      .slice(0, 4)\n                                      .map(\n                                        res => `\n                                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;\">\n                                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(res.name)}\">${escapeHtml(res.name.substring(0, 3))}</span>\n                                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                                <span style=\"color:var(--acu-accent);font-size:11px;font-weight:bold;\">${res.value}</span>\n                                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${res.value}\" data-name=\"${escapeHtml(res.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${res.name}(${res.value})\"></i>\n                                            </div>\n                                        </div>\n                                    `,\n                                      )\n                                      .join('')}\n                                </div>`;\n                          }\n                          return '';\n                        })()}\n        ${(() => {\n          // \n          let allAttrs = [];\n          if (playerRows.length > 0 && playerHeaders.length > 0) {\n            const row = playerRows[0];\n            playerHeaders.forEach((h, idx) => {\n              if (h && h.includes('')) {\n                const parsed = parseAttributeString(row[idx] || '');\n                parsed.forEach(attr => {\n                  if (!allAttrs.some(a => a.name === attr.name)) {\n                    allAttrs.push(attr);\n                  }\n                });\n              }\n            });\n          }\n\n          if (allAttrs.length > 0) {\n            // 378px\n            return `<div style=\"display:grid;grid-template-columns:repeat(3,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${allAttrs\n                      .map(\n                        attr => `\n                        <div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(attr.name)}\">${escapeHtml(attr.name.substring(0, 2))}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                <span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${attr.value}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${attr.value}\" data-name=\"${escapeHtml(attr.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${attr.name}(${attr.value})\"></i>\n                            </div>\n                        </div>\n                    `,\n                      )\n                      .join('')}\n                </div>`;\n          }\n          return '';\n        })()}\n                    </div>\n\n                    <h4 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(skillTableName)}\" style=\"font-size:12px;color:var(--acu-accent);margin:10px 0 6px 0;\"><i class=\"fa-solid fa-bolt\"></i>  (${skillParsed.length})</h4>\n                    <div style=\"display:grid;grid-template-columns:repeat(2,1fr);gap:2px 6px;max-height:78px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      skills.length > 0\n                        ? skills\n                            .map((skill, idx) => {\n                              const skillValue = extractNumericValue(skill.level);\n                              const hasNumeric = skillValue > 0;\n                              const skillRowIndex = skillParsed.findIndex(s => s.name === skill.name);\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${skillResult?.key || ''}\"\n                            data-row-index=\"${skillRowIndex >= 0 ? skillRowIndex : idx}\"\n                            data-preview-type=\"skill\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 3px;border-bottom:1px dashed var(--acu-border);min-width:0;cursor:pointer;\">\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;white-space:nowrap;\" title=\"${escapeHtml(skill.name)}\">${escapeHtml(skill.name.length > 5 ? skill.name.substring(0, 5) + '..' : skill.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:2px;flex-shrink:0;\">\n                                ${\n                                  hasNumeric\n                                    ? `<span style=\"color:var(--acu-text-main);font-size:11px;font-weight:bold;\">${skillValue}</span>\n                                <i class=\"fa-solid fa-dice-d20 acu-dash-dice-btn\" data-target=\"${skillValue}\" data-name=\"${escapeHtml(skill.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${skill.name}(${skillValue})\"></i>`\n                                    : `<span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(skill.level || '-')}</span>`\n                                }\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div style=\"grid-column:1/-1;text-align:center;color:var(--acu-text-sub);padding:8px;font-size:11px;\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  + NPC -->\n                <div class=\"acu-dash-locations\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(locationTableName)}\"><i class=\"fa-solid fa-map\"></i>  (${locationParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:100px;overflow-y:auto;overflow-x:hidden;margin-bottom:10px;\">\n                    ${\n                      locationParsed.length > 0\n                        ? locationParsed\n                            .map((loc, idx) => {\n                              const areaName = loc.name || '';\n                              const isCurrent =\n                                currentPlaceName &&\n                                (areaName.includes(currentPlaceName) || currentPlaceName.includes(areaName));\n                              return `<div class=\"acu-location-item acu-dash-clickable acu-dash-preview-trigger ${isCurrent ? 'acu-current-location' : ''}\"\n                            data-table-key=\"${escapeHtml(locationTableKey)}\"\n                            data-row-index=\"${loc._rowIndex}\"\n                            data-preview-type=\"location\"\n                            style=\"padding:4px 8px;display:flex;justify-content:space-between;align-items:center;\">\n                            <span style=\"display:flex;align-items:center;gap:6px;\">\n                                ${isCurrent ? '<i class=\"fa-solid fa-location-dot\"></i>' : '<i class=\"fa-solid fa-map-pin\" style=\"font-size:9px;opacity:0.4;\"></i>'}\n                                <span title=\"${escapeHtml(areaName)}\">${escapeHtml(areaName.length > 6 ? areaName.substring(0, 6) + '..' : areaName)}</span>\n                            </span>\n                            ${!isCurrent ? `<i class=\"fa-solid fa-walking acu-dash-goto-btn\" data-location=\"${escapeHtml(areaName)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${areaName}\"></i>` : '<i class=\"fa-solid fa-street-view\" title=\"\"></i>'}\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(npcTableName)}\" style=\"margin-top:10px;display:flex;justify-content:space-between;align-items:center;\">\n                        <span><i class=\"fa-solid fa-users\"></i>  (${allNPCs.length})</span>\n                        <span style=\"display:flex;gap:8px;\">\n                            <i class=\"fa-solid fa-project-diagram acu-dash-relation-graph-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                            <i class=\"fa-solid fa-user-circle acu-dash-avatar-manager-btn\" title=\"\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.6;font-size:12px;padding:4px;\"></i>\n                        </span>\n                    </h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:150px;overflow-y:auto;overflow-x:hidden;\">\n                    ${\n                      allNPCs.length > 0\n                        ? allNPCs\n                            .slice(0, 12)\n                            .map((npc, npcIdx) => {\n                              const isInScene = inSceneNPCs.some(n => n.name === npc.name);\n                              const isLastNpc = npcIdx === Math.min(allNPCs.length, 12) - 1;\n                              const npcAvatar = AvatarManager.get(npc.name);\n                              const avatarOffsetX = AvatarManager.getOffsetX(npc.name);\n                              const avatarOffsetY = AvatarManager.getOffsetY(npc.name);\n                              const avatarScale = AvatarManager.getScale(npc.name);\n                              const avatarStyle = npcAvatar\n                                ? `background-image:url('${npcAvatar}');background-size:${avatarScale}%;background-position:${avatarOffsetX}% ${avatarOffsetY}%;`\n                                : '';\n                              const offSceneFilter = isInScene\n                                ? ''\n                                : 'filter:grayscale(80%) brightness(0.7);opacity:0.5;';\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${escapeHtml(npcTableKey)}\"\n                            data-row-index=\"${npc.index}\"\n                            data-preview-type=\"npc\"\n                            style=\"padding:6px 4px;${!isLastNpc ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <span class=\"acu-task-name\" style=\"font-size:12px;display:flex;align-items:center;gap:6px;\">\n                                    <span class=\"acu-dash-npc-avatar\" style=\"width:22px;height:22px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;background:var(--acu-btn-bg);border:1.5px solid ${isInScene ? 'var(--acu-accent)' : 'var(--acu-border)'};${avatarStyle}${offSceneFilter}\" title=\"${isInScene ? '' : ''}\">\n                                        ${!npcAvatar ? `<span style=\"font-size:10px;font-weight:bold;color:var(--acu-text-sub);${offSceneFilter}\">${escapeHtml(npc.name.charAt(0))}</span>` : ''}\n                                    </span>\n                                    <span title=\"${escapeHtml(npc.name)}\" style=\"${isInScene ? '' : 'opacity:0.6;'}\">${escapeHtml(npc.name.length > 4 ? npc.name.substring(0, 4) + '..' : npc.name)}</span>\n                                </span>\n                                <div style=\"display:flex;align-items:center;\">\n                                    <i class=\"fa-solid fa-people-arrows acu-dash-contest-btn\" data-npc=\"${escapeHtml(npc.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:11px;\" title=\"${npc.name}\"></i>\n                                </div>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n                </div>\n\n                <!--  +  +  -->\n                <div class=\"acu-dash-intel\">\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(bagTableName)}\"><i class=\"fa-solid fa-bag-shopping\"></i>  (${bagParsed.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      bagItems.length > 0\n                        ? bagItems\n                            .map((item, idx) => {\n                              const isLastBag = idx === bagItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${bagResult?.key || ''}\"\n                            data-row-index=\"${idx}\"\n                            data-preview-type=\"bag\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLastBag ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);flex:1;white-space:nowrap;\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 4 ? item.name.substring(0, 4) + '..' : item.name)}</span>\n                            <div style=\"display:flex;align-items:center;gap:6px;\">\n                                <i class=\"fa-solid fa-hand-pointer acu-dash-use-item-btn\" data-item=\"${escapeHtml(item.name)}\" style=\"cursor:pointer;color:var(--acu-text-sub);opacity:0.4;font-size:10px;\" title=\"${item.name}\"></i>\n                                <span style=\"color:var(--acu-accent);font-weight:bold;\">${escapeHtml(item.count)}</span>\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(equipTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-shield-halved\"></i>  (${equippedItems.length})</h3>\n                    <div style=\"display:grid;grid-template-columns:1fr 1fr;gap:2px 6px;max-height:80px;overflow-y:auto;margin-bottom:10px;\">\n                    ${\n                      equippedItems.length > 0\n                        ? equippedItems\n                            .map((item, idx) => {\n                              const isLast = idx === equippedItems.length - 1;\n                              return `<div class=\"acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${equipResult?.key || ''}\"\n                            data-row-index=\"${equipParsed.findIndex(r => r.name === item.name)}\"\n                            data-preview-type=\"equipment\"\n                            style=\"display:flex;justify-content:space-between;align-items:center;padding:5px 4px;font-size:11px;cursor:pointer;${!isLast ? 'border-bottom:1px dashed var(--acu-border);' : ''}\">\n                            <span style=\"color:var(--acu-text-main);\" title=\"${escapeHtml(item.name)}\">${escapeHtml(item.name.length > 5 ? item.name.substring(0, 5) + '..' : item.name)}</span>\n                            <span style=\"color:var(--acu-text-sub);font-size:10px;\">${escapeHtml(item.part || item.type)}</span>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                    </div>\n\n                    <h3 class=\"acu-dash-table-link\" data-table=\"${escapeHtml(questTableName)}\" style=\"margin-top:10px;\"><i class=\"fa-solid fa-clipboard-list\"></i>  (${activeTasks.length})</h3>\n                    ${\n                      activeTasks.length > 0\n                        ? activeTasks\n                            .map((t, idx) => {\n                              const isMain = String(t.type || '').includes('');\n                              // \n                              let progressPercent = null;\n                              const progressMatch = String(t.progress || '').match(/(\\d+)\\s*%/);\n                              if (progressMatch) {\n                                progressPercent = Math.min(100, Math.max(0, parseInt(progressMatch[1], 10)));\n                              }\n                              const progressBar =\n                                progressPercent !== null\n                                  ? `<div style=\"width:40px;height:4px;background:var(--acu-border);border-radius:2px;overflow:hidden;\"><div style=\"width:${progressPercent}%;height:100%;background:var(--acu-accent);\"></div></div>`\n                                  : '';\n                              return `<div class=\"acu-task-item acu-dash-clickable acu-dash-preview-trigger\"\n                            data-table-key=\"${questResult?.key || ''}\"\n                            data-row-index=\"${t._rowIndex !== undefined ? t._rowIndex : questParsed.findIndex(q => q.name === t.name)}\"\n                            data-preview-type=\"quest\"\n                            style=\"padding:4px 8px;margin-bottom:3px;cursor:pointer;\">\n                            <div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                                <div class=\"acu-task-name\" style=\"font-size:11px;${isMain ? 'font-weight:600;' : ''}\">${escapeHtml(t.name)}</div>\n                                ${progressBar}\n                            </div>\n                        </div>`;\n                            })\n                            .join('')\n                        : '<div class=\"acu-empty-hint\"></div>'\n                    }\n                </div>\n            </div>\n    `;\n    return html;\n  };\n\n  const renderTableContent = (tableData, tableName) => {\n    const _tableStart = performance.now();\n    if (!tableData || !tableData.rows.length)\n      return `\n            <div class=\"acu-panel-header\"><div class=\"acu-panel-title\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> ${tableName}</div><button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button></div>\n            <div class=\"acu-panel-content\"><div style=\"text-align:center;color:var(--acu-text-sub);padding:20px;\"></div></div>`;\n\n    const config = getConfig();\n    const pendingDeletions = getPendingDeletions()[tableData.key] || [];\n    const headers = (tableData.headers || []).slice(1);\n\n    //  ( list)\n    const currentStyle = (getTableStyles() || {})[tableName] || 'list';\n    const isGridMode = currentStyle === 'grid';\n\n    let titleColIndex = 1;\n    if (tableData.headers.length === 1) {\n      titleColIndex = 0;\n    } else if (tableName.includes('') || tableName.includes('')) {\n      const idx = tableData.headers.findIndex(\n        h => h && (h.includes('') || h.includes('') || h.includes('')),\n      );\n      if (idx > 0) titleColIndex = idx;\n    }\n\n    // ---  ---\n    let processedRows = tableData.rows.map((row, index) => ({ data: row, originalIndex: index }));\n    const searchTerm = (tableSearchStates[tableName] || '').toLowerCase().trim();\n\n    // \n    const isReversed = isTableReversed(tableName);\n\n    if (searchTerm) {\n      processedRows = processedRows.filter(item =>\n        item.data.some(cell => String(cell).toLowerCase().includes(searchTerm)),\n      );\n      processedRows.sort((a, b) => {\n        const titleA = String(a.data[titleColIndex] || '').toLowerCase();\n        const titleB = String(b.data[titleColIndex] || '').toLowerCase();\n        const aHitTitle = titleA.includes(searchTerm);\n        const bHitTitle = titleB.includes(searchTerm);\n        if (titleA === searchTerm && titleB !== searchTerm) return -1;\n        if (titleA !== searchTerm && titleB === searchTerm) return 1;\n        if (aHitTitle && !bHitTitle) return -1;\n        if (!aHitTitle && bHitTitle) return 1;\n        return a.originalIndex - b.originalIndex;\n      });\n    } else {\n      // \n      if (isReversed) {\n        processedRows.sort((a, b) => b.originalIndex - a.originalIndex);\n      } else {\n        processedRows.sort((a, b) => a.originalIndex - b.originalIndex);\n      }\n    }\n\n    const itemsPerPage = config.itemsPerPage || 50;\n    const totalItems = processedRows.length;\n    const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;\n    let currentPage = tablePageStates[tableName] || 1;\n    if (currentPage > totalPages) currentPage = totalPages;\n    if (currentPage < 1) currentPage = 1;\n    tablePageStates[tableName] = currentPage;\n\n    const startIdx = (currentPage - 1) * itemsPerPage;\n    const endIdx = startIdx + itemsPerPage;\n    const rowsToRender = processedRows.slice(startIdx, endIdx);\n    // []    \n    // \n    const showReverseBtn = shouldShowReverseButton(tableName);\n    const reverseBtnHtml = showReverseBtn\n      ? `\n            <button class=\"acu-view-btn acu-reverse-btn\" data-table=\"${escapeHtml(tableName)}\" title=\"${isReversed ? '' : ''}\">\n                <i class=\"fa-solid ${isReversed ? 'fa-sort-amount-up' : 'fa-sort-amount-down'}\"></i>\n            </button>\n        `\n      : '';\n\n    let html = `\n            <div class=\"acu-panel-header\">\n                <div class=\"acu-panel-title\">\n    <div class=\"acu-title-main\"><i class=\"fa-solid ${getIconForTableName(tableName)}\"></i> <span class=\"acu-title-text\">${escapeHtml(tableName)}</span></div>\n    <div class=\"acu-title-sub\">(${startIdx + 1}-${Math.min(endIdx, totalItems)} / ${totalItems})${isReversed ? ' <span style=\"color:var(--acu-accent);\"></span>' : ''}</div>\n</div>\n                <div class=\"acu-header-actions\">\n                    ${tableName.includes('') ? `<button class=\"acu-view-btn\" id=\"acu-btn-relation-graph\" data-table=\"${escapeHtml(tableName)}\" title=\"\"><i class=\"fa-solid fa-project-diagram\"></i></button>` : ''}\n                    ${reverseBtnHtml}\n                    <button class=\"acu-view-btn\" id=\"acu-btn-switch-style\" data-table=\"${escapeHtml(tableName)}\" title=\"  (: ${isGridMode ? '' : ''})\">\n                        <i class=\"fa-solid ${isGridMode ? 'fa-th-large' : 'fa-list'}\"></i>\n                    </button>\n                    <div class=\"acu-height-control\">\n                        <i class=\"fa-solid fa-arrows-up-down acu-height-drag-handle\" data-table=\"${escapeHtml(tableName)}\" title=\"  | \"></i>\n                    </div>\n\n                    <div class=\"acu-search-wrapper\"><i class=\"fa-solid fa-search acu-search-icon\"></i><input type=\"text\" class=\"acu-search-input\" placeholder=\"...\" value=\"${(tableSearchStates[tableName] || '').replace(/\"/g, '&quot;')}\" /></div>\n                    <button class=\"acu-close-btn\" title=\"\"><i class=\"fa-solid fa-times\"></i></button>\n                </div>\n            </div>\n            <div class=\"acu-panel-content\"><div class=\"acu-card-grid\">`;\n\n    html += rowsToRender\n      .map(item => {\n        const realRowIdx = item.originalIndex;\n        const row = item.data;\n        const isPending = pendingDeletions.includes(realRowIdx);\n        const cardTitle = row[titleColIndex] || '';\n        const showDefaultIndex = titleColIndex === 1;\n        const titleCellId = `${tableData.key}-${realRowIdx}-${titleColIndex}`;\n        const isTitleModified = window.acuModifiedSet && window.acuModifiedSet.has(titleCellId);\n        const isRowNew = currentDiffMap.has(`${tableName}-row-${realRowIdx}`);\n        let rowClass = '';\n        if (config.highlightNew) {\n          if (isTitleModified) rowClass = 'acu-highlight-manual';\n          else if (isRowNew) rowClass = 'acu-highlight-diff';\n        }\n\n        // \n        const validColIndices = row.map((_, i) => i).filter(i => i > 0 && i !== titleColIndex);\n        const isOddValidCount = validColIndices.length % 2 === 1;\n\n        const cardBody = row\n          .map((cell, cIdx) => {\n            if (cIdx <= 0 || cIdx === titleColIndex) return '';\n            // [] \"\"\n            const currentHeader = headers[cIdx - 1] || '';\n            if (currentHeader.includes('')) return '';\n            const isLastValidCol = cIdx === validColIndices[validColIndices.length - 1];\n            const spanFullRow = isLastValidCol && isOddValidCount;\n            // /\n            const rawHeaderName = headers[cIdx - 1] || '' + cIdx;\n            const headerName = rawHeaderName.replace(/[\\(\\[][^)\\]]*[\\)\\]]/g, '').trim();\n            const safeStr = str =>\n              String(str)\n                .replace(/&/g, '&amp;')\n                .replace(/</g, '&lt;')\n                .replace(/>/g, '&gt;')\n                .replace(/\"/g, '&quot;')\n                .replace(/'/g, '&#039;');\n            const rawStrOriginal = String(cell).trim();\n            const rawStr = replaceUserPlaceholders(rawStrOriginal);\n            const invalidPlaceholders = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n            if (invalidPlaceholders.includes(rawStr.toLowerCase())) {\n              return ''; // \n            }\n\n            let contentHtml = '';\n            let hideLabel = false; // \n            const splitRegex = /[;]/;\n\n            //  ( \":92\"  \":92, :88\")\n            const parsedAttrs = parseAttributeString(rawStr);\n            // [] \n            if (isRelationshipCell(rawStr, headerName)) {\n              const relations = parseRelationshipString(rawStr);\n              // [] \n              const validRelations = relations.filter(rel => {\n                if (!rel.relation) return true; // \n                return !invalidPlaceholders.includes(rel.relation.toLowerCase());\n              });\n\n              if (validRelations.length > 1) {\n                hideLabel = true;\n                let relHtml = '';\n                for (let i = 0; i < validRelations.length; i++) {\n                  const rel = validRelations[i];\n                  const borderStyle =\n                    i < validRelations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                  relHtml +=\n                    '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;' +\n                    borderStyle +\n                    '\">';\n                  relHtml +=\n                    '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' + safeStr(rel.name) + '</span>';\n                  if (rel.relation) {\n                    relHtml +=\n                      '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                      safeStr(rel.relation) +\n                      '</span>';\n                  }\n                  relHtml += '</div>';\n                }\n                contentHtml = '<div class=\"acu-relation-container\">' + relHtml + '</div>';\n              } else if (validRelations.length === 1) {\n                hideLabel = true;\n                const rel = validRelations[0];\n                contentHtml =\n                  '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;\">';\n                contentHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' + safeStr(rel.name) + '</span>';\n                if (rel.relation) {\n                  contentHtml +=\n                    '<span style=\"color:var(--acu-text-main);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">' +\n                    safeStr(rel.relation) +\n                    '</span>';\n                }\n                contentHtml += '</div>';\n              }\n            } else if (parsedAttrs.length > 1) {\n              // 2\n              hideLabel = true;\n              let attrsHtml = '';\n              for (let i = 0; i < parsedAttrs.length; i++) {\n                const attr = parsedAttrs[i];\n                attrsHtml +=\n                  '<div style=\"display:flex;justify-content:space-between;align-items:center;padding:2px 0;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-sub);font-size:0.9em;white-space:nowrap;\" title=\"' +\n                  safeStr(attr.name) +\n                  '\">' +\n                  safeStr(attr.name.length > 3 ? attr.name.substring(0, 5) : attr.name) +\n                  '</span>';\n                attrsHtml += '<div style=\"display:flex;align-items:center;gap:4px;\">';\n                attrsHtml +=\n                  '<span style=\"color:var(--acu-text-main);font-weight:bold;font-size:0.95em;\">' +\n                  attr.value +\n                  '</span>';\n                attrsHtml +=\n                  '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                  safeStr(attr.name) +\n                  '\" data-attr-value=\"' +\n                  attr.value +\n                  '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:10px;\" title=\"\"></i>';\n                attrsHtml += '</div></div>';\n              }\n              contentHtml = '<div class=\"acu-multi-attr-container\">' + attrsHtml + '</div>';\n            } else if (parsedAttrs.length === 1) {\n              //  ( \":92\") - \n              hideLabel = true;\n              const attr = parsedAttrs[0];\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml +=\n                '<span style=\"color:var(--acu-text-sub);font-size:0.95em;\">' + safeStr(attr.name) + '</span>';\n              contentHtml += '<div style=\"display:flex;align-items:center;gap:6px;\">';\n              contentHtml += '<span style=\"color:var(--acu-text-main);font-weight:bold;\">' + attr.value + '</span>';\n              contentHtml +=\n                '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                safeStr(attr.name) +\n                '\" data-attr-value=\"' +\n                attr.value +\n                '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>';\n              contentHtml += '</div></div>';\n            } else if (rawStr.length > 0 && splitRegex.test(rawStr) && !rawStr.includes('http')) {\n              // [] \n              const invalidTagValues = ['-', '--', '', 'null', 'none', '', '', 'n/a', 'undefined', '/', 'nil'];\n              const parts = rawStr\n                .split(splitRegex)\n                .map(s => s.trim())\n                .filter(s => s && !invalidTagValues.includes(s.toLowerCase()));\n              const allShort = parts.length > 1 && parts.every(p => p.length <= 6);\n              if (allShort) {\n                const tagsHtml = parts\n                  .map(part => {\n                    const subStyle = getBadgeStyle(part) || 'acu-badge-neutral';\n                    return '<span class=\"acu-badge ' + subStyle + '\">' + safeStr(part) + '</span>';\n                  })\n                  .join('');\n                contentHtml = '<div class=\"acu-tag-container\">' + tagsHtml + '</div>';\n              } else if (parts.length > 0) {\n                // \n                contentHtml = safeStr(parts.join('; '));\n              } else {\n                // \n                contentHtml = '';\n              }\n            } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n              // \n              const numVal = extractNumericValue(rawStr);\n              contentHtml = '<div style=\"display:flex;justify-content:space-between;align-items:center;\">';\n              contentHtml += '<span>' + safeStr(rawStr) + '</span>';\n              contentHtml +=\n                '<i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"' +\n                safeStr(headerName) +\n                '\" data-attr-value=\"' +\n                numVal +\n                '\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;margin-left:6px;\" title=\"\"></i>';\n              contentHtml += '</div>';\n            } else {\n              const badgeStyle = getBadgeStyle(rawStr);\n              const displayCell = safeStr(rawStr) === '' && String(cell) !== '0' ? '&nbsp;' : safeStr(rawStr);\n              contentHtml = badgeStyle\n                ? '<span class=\"acu-badge ' + badgeStyle + '\">' + displayCell + '</span>'\n                : displayCell;\n            }\n\n            const isDiffChanged = currentDiffMap.has(tableName + '-' + realRowIdx + '-' + cIdx);\n            const cellId = tableData.key + '-' + realRowIdx + '-' + cIdx;\n            const isUserModified = window.acuModifiedSet && window.acuModifiedSet.has(cellId);\n            let cellHighlight = '';\n            if (config.highlightNew) {\n              if (isUserModified) cellHighlight = 'acu-highlight-manual';\n              else if (isDiffChanged) cellHighlight = 'acu-highlight-diff';\n            }\n\n            //  class\n            // \n            const lockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n            const isThisFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, headers[cIdx - 1]);\n            const lockIcon = isThisFieldLocked\n              ? '<i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:10px;margin-left:4px;opacity:0.7;\" title=\"\"></i>'\n              : '';\n\n            const rowClass =\n              'acu-card-row acu-cell' +\n              (spanFullRow ? ' acu-grid-span-full' : '') +\n              (hideLabel ? ' acu-hide-label' : '');\n\n            return (\n              '<div class=\"' +\n              rowClass +\n              '\" data-key=\"' +\n              escapeHtml(tableData.key) +\n              '\" data-tname=\"' +\n              escapeHtml(tableName) +\n              '\" data-row=\"' +\n              realRowIdx +\n              '\" data-col=\"' +\n              cIdx +\n              '\" data-val=\"' +\n              encodeURIComponent(cell ?? '') +\n              '\"><div class=\"acu-card-label\">' +\n              headerName +\n              lockIcon +\n              '</div><div class=\"acu-card-value ' +\n              cellHighlight +\n              '\">' +\n              contentHtml +\n              '</div></div>'\n            );\n          })\n          .join('');\n\n        // []  acu-card-body  view-grid  view-list \n        // [] HTML\n        let tableActions = getActionsForTable(tableName);\n        let actionsHtml = '';\n\n        // [] \"\"\n        const interactColIdx = headers.findIndex(h => h && h.includes(''));\n        if (interactColIdx >= 0 && row[interactColIdx + 1]) {\n          // -nullnoneN/A \n          const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n          const interactOptions = String(row[interactColIdx + 1])\n            .split(/[,;]/)\n            .map(s => s.trim())\n            .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n          if (interactOptions.length > 0) {\n            // \n            const existingLabels = tableActions.map(a => a.label.toLowerCase());\n            // \n            const iconMap = {\n              : 'fa-hand-fist',\n              : 'fa-hand-fist',\n              : 'fa-comments',\n              : 'fa-comments',\n              : 'fa-eye',\n              : 'fa-eye',\n              : 'fa-hand-pointer',\n              : 'fa-gift',\n              : 'fa-gift',\n              : 'fa-trash',\n              : 'fa-shield-halved',\n              : 'fa-calendar-check',\n              : 'fa-hand',\n              : 'fa-heart',\n              : 'fa-music',\n            };\n            // \n            const newActions = interactOptions\n              .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n              .map(opt => ({\n                label: opt,\n                icon: iconMap[opt] || 'fa-hand-pointer',\n                type: 'prompt',\n                template: `<user>${opt}{Name}`,\n                auto_send: true,\n              }));\n            //  + \n            tableActions = [...tableActions, ...newActions];\n          }\n        }\n\n        if (tableActions.length > 0) {\n          const cardTitle = row[titleColIndex] || '';\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardLockRowKey = LockManager.getRowKey(tableName, row, tableData.headers);\n        const isCardRowLocked = cardLockRowKey && LockManager.isRowLocked(tableName, cardLockRowKey);\n        const cardLockIcon = isCardRowLocked\n          ? ' <i class=\"fa-solid fa-lock\" style=\"color:var(--acu-accent);font-size:11px;opacity:0.8;\" title=\"\"></i>'\n          : '';\n\n        return `<div class=\"acu-data-card ${isPending ? 'pending-deletion' : ''}\"><div class=\"acu-card-header\"><span class=\"acu-card-index\">${showDefaultIndex ? '#' + (realRowIdx + 1) : ''}</span><span class=\"acu-cell acu-editable-title ${rowClass}\" data-key=\"${escapeHtml(tableData.key)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(cardTitle ?? '')}\" title=\"\">${escapeHtml(cardTitle)}${cardLockIcon}</span></div><div class=\"acu-card-body ${isGridMode ? 'view-grid' : 'view-list'}\">${cardBody}</div>${actionsHtml}</div>`;\n      })\n      .join('');\n    html += `</div></div>`;\n\n    if (totalPages > 1) {\n      html += `<div class=\"acu-panel-footer\"><button class=\"acu-page-btn ${currentPage === 1 ? 'disabled' : ''}\" data-page=\"${currentPage - 1}\" ${currentPage === 1 ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-left\"></i></button>`;\n      const range = [];\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) range.push(i);\n      } else {\n        if (currentPage <= 4) range.push(1, 2, 3, 4, 5, '...', totalPages);\n        else if (currentPage >= totalPages - 3)\n          range.push(1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages);\n        else range.push(1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages);\n      }\n      range.forEach(p => {\n        if (p === '...') html += `<span class=\"acu-page-info\">...</span>`;\n        else html += `<button class=\"acu-page-btn ${p === currentPage ? 'active' : ''}\" data-page=\"${p}\">${p}</button>`;\n      });\n      html += `<button class=\"acu-page-btn ${currentPage === totalPages ? 'disabled' : ''}\" data-page=\"${currentPage + 1}\" ${currentPage === totalPages ? 'disabled' : ''}><i class=\"fa-solid fa-chevron-right\"></i></button></div>`;\n    }\n    return html;\n  };\n\n  // []  ( + )\n  const saveCurrentTabState = () => {\n    const { $ } = getCore();\n    const activeTab = getActiveTabState();\n    const $content = $('.acu-panel-content');\n\n    if (activeTab && $content.length) {\n      const innerScrolls = {};\n      // \n      $content.find('.acu-data-card, .acu-card-body, .acu-edit-textarea').each(function () {\n        if (this.scrollTop > 0) {\n          //  (Row Index)\n          const $card = $(this).closest('.acu-data-card');\n          const rIdx = $card.find('.acu-editable-title').data('row');\n          // \n          const isEdit = $(this).hasClass('acu-edit-textarea');\n\n          if (rIdx !== undefined) {\n            const key = isEdit ? `edit-${rIdx}` : rIdx;\n            innerScrolls[key] = this.scrollTop;\n          }\n        }\n      });\n\n      // \n      tableScrollStates[activeTab] = {\n        left: $content.scrollLeft(),\n        top: $content.scrollTop(),\n        inner: innerScrolls,\n        timestamp: Date.now(), // \n      };\n    }\n  };\n\n  const closePanel = () => {\n    const { $ } = getCore();\n    saveCurrentTabState(); // <--- \n\n    $('#acu-data-area').removeClass('visible');\n    $('.acu-nav-btn').removeClass('active');\n    saveActiveTabState(null);\n    // [] \n    // $('.acu-embedded-options-container').remove();\n  };\n\n  const bindEvents = tables => {\n    const { $ } = getCore();\n    const $wrapper = $('.acu-wrapper');\n    // [] -\n    $wrapper.on('click', '.acu-dash-relation-graph-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      if (npcResult && npcResult.data) {\n        showRelationshipGraph(npcResult.data);\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n\n    // [] -\n    $wrapper.on('click', '.acu-dash-avatar-manager-btn', function (e) {\n      e.stopPropagation();\n      const allTables = processJsonData(cachedRawData || getTableData());\n      const npcResult = DashboardDataParser.findTable(allTables, 'npc');\n      const playerResult = DashboardDataParser.findTable(allTables, 'player');\n      const nodeArr = [];\n      // \n      if (playerResult?.data?.rows?.[0]) {\n        nodeArr.push({ name: playerResult.data.rows[0][1] || '', isPlayer: true });\n      }\n      // NPC\n      if (npcResult?.data?.rows) {\n        npcResult.data.rows.forEach((row, idx) => {\n          if (row[1]) nodeArr.push({ name: row[1], isPlayer: false, rowIndex: idx });\n        });\n      }\n      if (nodeArr.length > 0) {\n        showAvatarManager(nodeArr, () => renderInterface());\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n    });\n    // \n    $wrapper.on('click', '.acu-dash-table-link', function (e) {\n      e.stopPropagation();\n      const tableName = $(this).data('table');\n      if (tableName) {\n        Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        saveActiveTabState(tableName);\n        renderInterface();\n      }\n    });\n\n    // []  SillyTavern\"\"\n    $('.acu-panel-content')\n      .off('touchstart.acu_swipe touchmove.acu_swipe')\n      .on('touchstart.acu_swipe', function (e) {\n        this._touchStartX = e.originalEvent.touches[0].clientX;\n        this._touchStartY = e.originalEvent.touches[0].clientY;\n      })\n      .on('touchmove.acu_swipe', function (e) {\n        if (!this._touchStartX) return;\n        const deltaX = Math.abs(e.originalEvent.touches[0].clientX - this._touchStartX);\n        const deltaY = Math.abs(e.originalEvent.touches[0].clientY - this._touchStartY);\n        // 45\n        if (deltaX > deltaY && deltaX > 10) {\n          e.stopPropagation();\n        }\n      });\n\n    $('body')\n      .off('click.acu_nav_toggle')\n      .on('click.acu_nav_toggle', '.acu-nav-toggle-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        // 1. \n        const current = Store.get('acu_hide_nav_only', false);\n        const newState = !current;\n        Store.set('acu_hide_nav_only', newState);\n\n        // 2. []  ()\n        const $icon = $(this);\n        if (newState) {\n          $icon.removeClass('fa-eye').addClass('fa-eye-slash');\n          $icon.attr('title', '');\n        } else {\n          $icon.removeClass('fa-eye-slash').addClass('fa-eye');\n          $icon.attr('title', '');\n        }\n\n        // 3. \n        renderInterface();\n      });\n\n    const $panel = $('.acu-panel-content');\n    if ($panel.length) {\n      // [] \n      let scrollTimer = null;\n      $panel.off('scroll.acu_save').on('scroll.acu_save', function () {\n        const $this = $(this);\n        if (scrollTimer) clearTimeout(scrollTimer);\n        scrollTimer = setTimeout(() => {\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            if (!tableScrollStates[activeTab]) tableScrollStates[activeTab] = { top: 0, left: 0, inner: {} };\n            tableScrollStates[activeTab].top = $this.scrollTop();\n            tableScrollStates[activeTab].left = $this.scrollLeft();\n            // \n          }\n        }, 200);\n      });\n    }\n\n    $('body')\n      .off('click.acu_delegate')\n      .on('click.acu_delegate', '.acu-wrapper', function (e) {\n        if (isEditingOrder) return;\n        const $target = $(e.target);\n\n        // []  - \n        const $settingsBtn = $target.closest('#acu-btn-settings');\n        if ($settingsBtn.length) {\n          e.stopPropagation();\n          e.preventDefault();\n          showSettingsModal();\n          return;\n        }\n\n        const $navBtn = $target.closest('.acu-nav-btn');\n        if ($navBtn.length) {\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-dashboard') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isDashboardActive && isPanelVisible) {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, true);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n              // \n              const rawData = cachedRawData || getTableData();\n              const tables = processJsonData(rawData || {});\n              $('#acu-data-area').html(renderDashboard(tables)).addClass('visible');\n              // \n              bindEvents(tables);\n            }\n            return false;\n          }\n          // [] \n          if ($navBtn.attr('id') === 'acu-btn-changes') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isChangesActive = Store.get('acu_changes_panel_active', false);\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isChangesActive && isPanelVisible) {\n              // \n              Store.set('acu_changes_panel_active', false);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // \n              Store.set('acu_changes_panel_active', true);\n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              saveActiveTabState(null);\n              $('.acu-nav-btn').removeClass('active');\n              $navBtn.addClass('active');\n              // \n              const rawData = cachedRawData || getTableData();\n              $('#acu-data-area').html(renderChangesPanel(rawData)).addClass('visible');\n              // \n              bindChangesEvents();\n            }\n            return false;\n          }\n          // [] MVU \n          if ($navBtn.attr('id') === 'acu-btn-mvu') {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const isMvuActive = getActiveTabState() === MvuModule.MODULE_ID;\n            const isPanelVisible = $('#acu-data-area').hasClass('visible');\n\n            if (isMvuActive && isPanelVisible) {\n              // MVU\n              saveActiveTabState(null);\n              $('#acu-data-area').removeClass('visible');\n              $('.acu-nav-btn').removeClass('active');\n            } else {\n              // MVU\n              Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n              Store.set('acu_changes_panel_active', false);\n              saveActiveTabState(MvuModule.MODULE_ID);\n              $('.acu-nav-btn').removeClass('active');\n              // MVU\n              const $panel = $('#acu-data-area');\n              $panel.html(MvuModule.renderPanel()).addClass('visible');\n              MvuModule.bindEvents($panel);\n            }\n            return false;\n          }\n          e.stopPropagation();\n          // [] \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          Store.set('acu_changes_panel_active', false);\n          const tableName = $navBtn.data('table');\n          const currentActiveTab = getActiveTabState();\n          if (currentActiveTab === tableName && $('#acu-data-area').hasClass('visible')) {\n            closePanel();\n            return;\n          }\n          $('.acu-nav-btn').removeClass('active');\n          $navBtn.addClass('active');\n          if ($('.acu-panel-content').length && currentActiveTab) {\n            saveCurrentTabState();\n          }\n          saveActiveTabState(tableName);\n          setTimeout(() => renderInterface(), 0);\n          return;\n        }\n        const $cell = $target.closest('.acu-cell');\n        if ($cell.length) {\n          e.stopPropagation();\n          showCellMenu(e, $cell[0]);\n          return;\n        }\n        const $pageBtn = $target.closest('.acu-page-btn');\n        if ($pageBtn.length) {\n          e.stopPropagation();\n          if ($pageBtn.hasClass('disabled') || $pageBtn.hasClass('active')) return;\n          const newPage = parseInt($pageBtn.data('page'));\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tablePageStates[activeTab] = newPage;\n            renderInterface();\n            requestAnimationFrame(() => {\n              $('.acu-panel-content').scrollTop(0);\n            });\n          }\n          return;\n        }\n        return;\n      });\n\n    $('#acu-btn-expand')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(false);\n        renderInterface();\n      });\n    // [] \n    $('#acu-btn-collapse')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        saveCollapsedState(true);\n        renderInterface();\n      });\n\n    // []  =  (Instant Revert)\n    $('#acu-btn-refresh')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n\n        // [] \n        if (isEditingOrder) return;\n\n        // 1. \n        if (isSaving) {\n          if (window.toastr) window.toastr.warning(' ...');\n          return;\n        }\n\n        const $btn = $(e.currentTarget);\n        const $icon = $btn.find('i');\n        // $icon.addClass('fa-spin'); // \n\n        // 2.  ()\n        // (1) \n        savePendingDeletions({});\n\n        // (2)  -> \n        cachedRawData = null;\n\n        // (3) \n        hasUnsavedChanges = false;\n        currentDiffMap.clear();\n        if (window.acuModifiedSet) window.acuModifiedSet.clear();\n\n        // (4)  ()\n        const $saveBtn = $('#acu-btn-save-global');\n        $saveBtn.find('i').removeClass('acu-icon-breathe');\n        $saveBtn.attr('title', '').css('color', '');\n\n        // 3.  300ms \n        // await new Promise(r => setTimeout(r, 300)); // <--- \n\n        // Last SnapshotAPI\n        const snapshot = loadSnapshot();\n        if (snapshot) {\n          cachedRawData = snapshot; // \n        }\n\n        // 4. \n        // \n        $('.acu-edit-overlay, .acu-cell-menu, .acu-menu-backdrop').remove();\n\n        // \n        renderInterface();\n\n        // $icon.removeClass('fa-spin');\n      });\n\n    // [] \n    $('#acu-btn-force-update')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[ACU] :', err);\n            if (window.toastr) window.toastr.error('');\n          }\n        } else {\n          if (window.toastr)\n            window.toastr.warning('  manualUpdate ');\n        }\n      });\n    $('body')\n      .off('click.acu_settings')\n      .on('click.acu_settings', '#acu-btn-settings', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        if (isEditingOrder) return;\n        showSettingsModal();\n      });\n    // [] \n    $('#acu-btn-dice-nav')\n      .off('click')\n      .on('click', e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        showDicePanel({\n          targetValue: null,\n          targetName: '',\n          //  diceType\n        });\n      });\n\n    /* // \n    $('#acu-btn-open-editor').off('click').on('click', (e) => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.openVisualizer === 'function') {\n            api.openVisualizer();\n        } else if (window.toastr) {\n            window.toastr.warning('()');\n        }\n    });\n    */\n\n    // \n    $('#acu-btn-refill')\n      .off('click')\n      .on('click', async e => {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        const api = getCore().getDB();\n        if (api && typeof api.manualUpdate === 'function') {\n          try {\n            console.log('[ACU] ');\n            await api.manualUpdate();\n          } catch (err) {\n            console.error('[ACU] :', err);\n          }\n        } else {\n          console.warn('[ACU] manualUpdate API ');\n        }\n      });\n    $('#acu-btn-save-global')\n      .off('click')\n      .on('click', async function (e) {\n        e.stopPropagation();\n        if (isEditingOrder) return;\n        let dataToSave = null;\n        if (hasUnsavedChanges && cachedRawData) {\n          dataToSave = cachedRawData;\n        } else {\n          dataToSave = getTableData();\n        }\n\n        if (dataToSave) {\n          // 1.  false  true\n          await saveDataToDatabase(dataToSave, true, true);\n\n          // 2. \n          // \n          $('.acu-highlight-manual').removeClass('acu-highlight-manual');\n\n          // 3. \n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          hasUnsavedChanges = false;\n\n          // 4. \n          const $btn = $(this);\n          const $icon = $btn.find('i');\n          $icon.removeClass('acu-icon-breathe fa-spinner fa-spin').addClass('fa-save');\n          $btn.attr('title', '').css('color', '');\n          $btn.prop('disabled', false);\n\n          // 5. \n        } else {\n          if (window.toastr) window.toastr.error('');\n        }\n      });\n\n    const $searchInput = $('.acu-search-input');\n    if ($searchInput.length) {\n      let searchTimeout;\n      let isComposing = false;\n      $searchInput\n        .off('compositionstart compositionend input')\n        .on('compositionstart', () => {\n          isComposing = true;\n        })\n        .on('compositionend', function () {\n          isComposing = false;\n          const val = $(this).val();\n          const activeTab = getActiveTabState();\n          if (activeTab) {\n            tableSearchStates[activeTab] = val;\n            tablePageStates[activeTab] = 1;\n            renderInterface();\n            setTimeout(() => {\n              $('.acu-search-input').focus();\n            }, 0);\n          }\n        })\n        .on('input', function () {\n          if (isComposing) return;\n          const val = $(this).val();\n          const selectionStart = this.selectionStart;\n          const selectionEnd = this.selectionEnd;\n          clearTimeout(searchTimeout);\n          searchTimeout = setTimeout(() => {\n            const activeTab = getActiveTabState();\n            if (activeTab) {\n              tableSearchStates[activeTab] = val;\n              tablePageStates[activeTab] = 1;\n              const isFocus = document.activeElement && document.activeElement.classList.contains('acu-search-input');\n              renderInterface();\n              if (isFocus) {\n                const $newInput = $('.acu-search-input');\n                $newInput.focus();\n                if ($newInput.length && $newInput[0].setSelectionRange) {\n                  try {\n                    $newInput[0].setSelectionRange(selectionStart, selectionEnd);\n                  } catch (e) {}\n                }\n              }\n            }\n          }, 300);\n        });\n    }\n    // \n    $('#acu-btn-relation-graph')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const rawData = cachedRawData || getTableData();\n        if (rawData) {\n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (sheet?.name === tableName) {\n              const tableData = {\n                headers: sheet.content?.[0] || [],\n                rows: sheet.content?.slice(1) || [],\n                key: key,\n              };\n              showRelationshipGraph(tableData);\n              return;\n            }\n          }\n        }\n        if (window.toastr) window.toastr.warning('');\n      });\n    // --- []  ---\n\n    // 1. \n    $('#acu-btn-switch-style')\n      .off('click')\n      .on('click', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const styles = getTableStyles();\n        const current = styles[tableName] || 'list';\n        styles[tableName] = current === 'grid' ? 'list' : 'grid'; // \n        saveTableStyles(styles);\n        renderInterface(); // \n      });\n\n    // 2. \n    $('.acu-height-drag-handle')\n      .off('pointerdown')\n      .on('pointerdown', function (e) {\n        if (e.button !== 0) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const handle = this;\n        handle.setPointerCapture(e.pointerId);\n        $(handle).addClass('active');\n        const $panel = $('#acu-data-area');\n        const startHeight = $panel.height();\n        const startY = e.clientY;\n        const tableName = $(handle).data('table');\n\n        handle.onpointermove = function (moveE) {\n          const dy = moveE.clientY - startY;\n          let newHeight = startHeight - dy; // \n          if (newHeight < MIN_PANEL_HEIGHT) newHeight = MIN_PANEL_HEIGHT;\n          if (newHeight > MAX_PANEL_HEIGHT) newHeight = MAX_PANEL_HEIGHT;\n          $panel.css('height', newHeight + 'px');\n        };\n        handle.onpointerup = function (upE) {\n          $(handle).removeClass('active');\n          handle.releasePointerCapture(upE.pointerId);\n          handle.onpointermove = null;\n          handle.onpointerup = null;\n          if (tableName) {\n            const heights = getTableHeights();\n            heights[tableName] = parseInt($panel.css('height'));\n            saveTableHeights(heights);\n            $panel.addClass('acu-manual-mode');\n          }\n        };\n      });\n\n    // 3.  - \n    $('.acu-height-drag-handle')\n      .off('dblclick')\n      .on('dblclick', function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    // [] \n    $wrapper.on('click', '.acu-reverse-btn', function (e) {\n      e.stopPropagation();\n      const tName = $(this).data('table');\n      if (!tName) return;\n\n      toggleTableReverse(tName);\n\n      // \n      renderInterface();\n    });\n    // [] \n    $('.acu-panel-header')\n      .off('dblclick.acu')\n      .on('dblclick.acu', function (e) {\n        if ($(e.target).closest('.acu-search-input, .acu-close-btn, .acu-view-btn').length) return;\n        e.preventDefault();\n        e.stopPropagation();\n        const tableName = getActiveTabState();\n        if (tableName) {\n          const heights = getTableHeights();\n          delete heights[tableName];\n          saveTableHeights(heights);\n          $('#acu-data-area').css('height', '').removeClass('acu-manual-mode');\n        }\n      });\n\n    $('.acu-close-btn')\n      .off('click')\n      .on('click', function (e) {\n        e.stopPropagation();\n        const $input = $('.acu-search-input');\n\n        // \n        if ($input.length && $input.val()) {\n          $input.val('').trigger('input').focus();\n          return;\n        }\n\n        // \n        const isDashboardActive = Store.get(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n        if (isDashboardActive) {\n          // \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n          saveActiveTabState(null);\n          renderInterface();\n          return;\n        }\n\n        // \n        closePanel();\n      });\n    // [] \n    $('body')\n      .off('click.acu_action')\n      .on('click.acu_action', '.acu-action-item', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        const $btn = $(this);\n        const rowIdx = parseInt($btn.data('row'), 10);\n        const actionIdx = parseInt($btn.data('action-idx'), 10);\n\n        // \n        const $card = $btn.closest('.acu-data-card');\n        const $title = $card.find('.acu-editable-title');\n        const tableKey = $title.data('key');\n        const tableName = $title.data('tname') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const headers = rawData[tableKey].content[0] || [];\n        const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n\n        // \n        const invalidValues = ['-', 'null', 'none', '', '', 'n/a', 'undefined', '/'];\n\n        // \n        let actions = getActionsForTable(tableName);\n\n        // \"\"\n        const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n        if (interactColIdx >= 0 && rowData[interactColIdx]) {\n          const cellValue = String(rowData[interactColIdx]).trim();\n          if (cellValue && !invalidValues.includes(cellValue.toLowerCase())) {\n            const interactOptions = cellValue\n              .split(/[,;]/)\n              .map(s => s.trim())\n              .filter(s => s && !invalidValues.includes(s.toLowerCase()));\n            if (interactOptions.length > 0) {\n              // \n              const existingLabels = actions.map(a => a.label.toLowerCase());\n              // \n              const newActions = interactOptions\n                .filter(opt => !existingLabels.includes(opt.toLowerCase()))\n                .map(opt => ({\n                  label: opt,\n                  icon: 'fa-hand-pointer',\n                  type: 'prompt',\n                  template: `<user>{Name}${opt}`,\n                  auto_send: true,\n                }));\n              //  + \n              actions = [...actions, ...newActions];\n            }\n          }\n        }\n\n        const action = actions[actionIdx];\n\n        // [] \n        if (action && action.type === 'skill_check') {\n          const skillName = rowData[1] || '';\n\n          // \n          let checkValue = null;\n          const attrValIdx = headers.findIndex(h => h && h.includes(''));\n          const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n          // \n          if (attrValIdx > 0 && rowData[attrValIdx]) {\n            const val = extractNumericValue(rowData[attrValIdx]);\n            if (val > 0) checkValue = val;\n          }\n          // \n          if (checkValue === null && profIdx > 0 && rowData[profIdx]) {\n            const val = extractNumericValue(rowData[profIdx]);\n            if (val > 0) checkValue = val;\n          }\n\n          // \n          const promptText = processTemplate(action.template, rowData, headers);\n          smartInsertToTextarea(promptText, 'action');\n\n          // \n          if (checkValue !== null && checkValue > 0) {\n            showDicePanel({\n              targetValue: checkValue,\n              targetName: skillName,\n              initiatorName: '<user>',\n            });\n          } else {\n            $('#send_textarea').focus();\n          }\n          return;\n        }\n\n        if (action && action.template) {\n          // \n          const rawData = cachedRawData || getTableData();\n          if (rawData && rawData[tableKey]) {\n            const headers = rawData[tableKey].content[0] || [];\n            const rowData = rawData[tableKey].content[rowIdx + 1] || [];\n            const npcName = rowData[1] || '';\n\n            // \"\"\n            if (action.label === '') {\n              const config = getConfig();\n              $('.acu-msg-overlay').remove();\n\n              const t = getThemeColors();\n\n              const overlay = $(`\n                        <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                            <div style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                                <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                                    <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                                </div>\n                                <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                                <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                                    <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                                    <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                                </div>\n                            </div>\n                        </div>\n                    `);\n\n              $('body').append(overlay);\n              // []  JS  overlay \n              const overlayEl = overlay[0];\n              overlayEl.style.setProperty('position', 'fixed', 'important');\n              overlayEl.style.setProperty('top', '0', 'important');\n              overlayEl.style.setProperty('left', '0', 'important');\n              overlayEl.style.setProperty('right', '0', 'important');\n              overlayEl.style.setProperty('bottom', '0', 'important');\n              overlayEl.style.setProperty('width', '100vw', 'important');\n              overlayEl.style.setProperty('height', '100vh', 'important');\n              overlayEl.style.setProperty('display', 'flex', 'important');\n              overlayEl.style.setProperty('justify-content', 'center', 'important');\n              overlayEl.style.setProperty('align-items', 'center', 'important');\n              overlayEl.style.setProperty('z-index', '2147483650', 'important');\n              setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n              const sendMessage = () => {\n                const msg = overlay.find('#acu-msg-input').val().trim();\n                if (msg) {\n                  const promptText = `<user>${npcName}\"${msg}\"`;\n                  smartInsertToTextarea(promptText, 'action');\n                  $('#send_textarea').focus();\n                }\n                overlay.remove();\n              };\n\n              overlay.find('#acu-msg-send').click(sendMessage);\n              overlay.find('#acu-msg-input').on('keydown', function (ev) {\n                if (ev.key === 'Enter') {\n                  ev.preventDefault();\n                  sendMessage();\n                }\n              });\n              overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n              overlay.on('click', function (ev) {\n                if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n              });\n              return;\n            }\n\n            //  processTemplate \n            const promptText = processTemplate(action.template, rowData, headers);\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n        }\n      });\n\n    // [] \n    $('body')\n      .off('click.acu_global_dice')\n      .on('click.acu_global_dice', '#acu-btn-dice', function (e) {\n        e.stopPropagation();\n        showDicePanel({\n          targetValue: 50,\n          targetName: '',\n          diceType: '1d100',\n        });\n      });\n    // ========== [] ==========\n    // /\n    $('body')\n      .off('click.acu_location_toggle')\n      .on('click.acu_location_toggle', '.acu-location-header', function (e) {\n        e.stopPropagation();\n        const $group = $(this).closest('.acu-location-group');\n        $group.toggleClass('expanded');\n      });\n\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_jump')\n      .on('click.acu_dash_jump', '.acu-dash-jump-link, .acu-dash-loc-item', function (e) {\n        e.stopPropagation();\n        const tableName = $(this).data('table');\n        const searchTerm = $(this).data('search') || '';\n\n        if (tableName) {\n          // 1. \n          Store.set(STORAGE_KEY_DASHBOARD_ACTIVE, false);\n\n          // 2. \n          saveActiveTabState(tableName);\n\n          // 3. \n          if (searchTerm) {\n            tableSearchStates[tableName] = searchTerm;\n            tablePageStates[tableName] = 1;\n          }\n\n          // 4. \n          renderInterface();\n\n          // 5. \n          if (searchTerm) {\n            setTimeout(() => {\n              const $input = $('.acu-search-input');\n              if ($input.length) $input.focus();\n            }, 100);\n          }\n        }\n      });\n    // ========== [] ==========\n    // [] \n    $('body')\n      .off('click.acu_inline_dice')\n      .on('click.acu_inline_dice', '.acu-inline-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n\n        //  .attr()  jQuery \n        const attrName = $(this).attr('data-attr-name') || '';\n        const attrValue = parseInt($(this).attr('data-attr-value'), 10) || 50;\n\n        // NPC\n        const $card = $(this).closest('.acu-data-card');\n        const cardTitle = $card.find('.acu-editable-title').text().trim();\n\n        // <user>\n        const tableName = $card.find('.acu-editable-title').data('tname') || '';\n        const isPlayerTable = tableName.includes('');\n        const initiatorName = isPlayerTable ? '<user>' : cardTitle;\n\n        showDicePanel({\n          targetValue: attrValue,\n          targetName: attrName,\n          initiatorName: initiatorName,\n          //  diceType\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_dice')\n      .on('click.acu_dash_dice', '.acu-dash-dice-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const targetValue = parseInt($(this).data('target'), 10) || 50;\n        const targetName = $(this).data('name') || '';\n        const npcName = $(this).data('npc') || '';\n\n        // NPC\n        if (npcName) {\n          // \n          const playerAttrValue = getAttributeValue('<user>', targetName) || 50;\n          showContestPanel({\n            initiatorName: '<user>',\n            initiatorValue: playerAttrValue,\n            opponentName: npcName,\n            opponentValue: targetValue,\n          });\n        } else {\n          showDicePanel({\n            targetValue: targetValue,\n            targetName: targetName,\n            initiatorName: '<user>',\n          });\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_goto')\n      .on('click.acu_dash_goto', '.acu-dash-goto-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const locationName = $(this).data('location') || '';\n        const promptText = `<user>${locationName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_use_item')\n      .on('click.acu_dash_use_item', '.acu-dash-use-item-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const itemName = $(this).data('item') || '';\n        const promptText = `<user>${itemName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\" - \n    $('body')\n      .off('click.acu_dash_use_skill')\n      .on('click.acu_dash_use_skill', '.acu-dash-use-skill-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const skillName = $(this).data('skill') || '';\n\n        // \n        const rawData = cachedRawData || getTableData();\n        let checkValue = null;\n\n        if (rawData) {\n          // \n          for (const key in rawData) {\n            const sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n            if (sheet.name.includes('') || sheet.name.includes('')) {\n              const headers = sheet.content[0] || [];\n              // \n              const nameIdx = headers.findIndex(h => h && (h.includes('') || h.includes(''))) || 1;\n              const attrValIdx = headers.findIndex(h => h && h.includes(''));\n              const profIdx = headers.findIndex(h => h && (h.includes('') || h.includes('')));\n\n              for (let i = 1; i < sheet.content.length; i++) {\n                const row = sheet.content[i];\n                if (row && row[nameIdx === -1 ? 1 : nameIdx] === skillName) {\n                  // \n                  if (attrValIdx > 0 && row[attrValIdx]) {\n                    const val = extractNumericValue(row[attrValIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  // \n                  if (profIdx > 0 && row[profIdx]) {\n                    const val = extractNumericValue(row[profIdx]);\n                    if (val > 0) {\n                      checkValue = val;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n              if (checkValue !== null) break;\n            }\n          }\n        }\n\n        // \n        const promptText = `<user>${skillName}`;\n        smartInsertToTextarea(promptText, 'action');\n\n        // \n        if (checkValue !== null && checkValue > 0) {\n          showDicePanel({\n            targetValue: checkValue,\n            targetName: skillName,\n            initiatorName: '<user>',\n          });\n        } else {\n          // \n          $('#send_textarea').focus();\n        }\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_track_task')\n      .on('click.acu_dash_track_task', '.acu-dash-track-task-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const taskName = $(this).data('task') || '';\n        const promptText = `<user>${taskName}`;\n        smartInsertToTextarea(promptText, 'action');\n        $('#send_textarea').focus();\n      });\n    // [] \"\"\n    $('body')\n      .off('click.acu_dash_msg')\n      .on('click.acu_dash_msg', '.acu-dash-msg-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n        const config = getConfig();\n\n        // \n        $('.acu-msg-overlay').remove();\n\n        // \n        const t = getThemeColors();\n\n        const overlay = $(`\n            <div class=\"acu-msg-overlay\" style=\"position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2147483647;display:flex;justify-content:center;align-items:center;\">\n                <div class=\"acu-msg-dialog\" style=\"background:${t.bgPanel};border:1px solid ${t.border};border-radius:12px;padding:16px;width:90%;max-width:320px;box-shadow:0 10px 40px rgba(0,0,0,0.4);\">\n                    <div style=\"font-size:14px;font-weight:bold;color:${t.accent};margin-bottom:12px;display:flex;align-items:center;gap:6px;\">\n                        <i class=\"fa-solid fa-comment\"></i>  ${escapeHtml(npcName)}\n                    </div>\n                    <input type=\"text\" id=\"acu-msg-input\" placeholder=\"...\" style=\"width:100%;padding:10px 12px;background:${t.inputBg} !important;border:1px solid ${t.border};border-radius:6px;color:${t.textMain} !important;font-size:14px;box-sizing:border-box;\" autofocus>\n                    <div style=\"display:flex;gap:8px;margin-top:12px;\">\n                        <button id=\"acu-msg-cancel\" style=\"flex:1;padding:8px;background:${t.inputBg};border:1px solid ${t.border};border-radius:6px;color:${t.textMain};cursor:pointer;\"></button>\n                        <button id=\"acu-msg-send\" style=\"flex:1;padding:8px;background:${t.btnActiveBg};border:none;border-radius:6px;color:${t.btnActiveText};cursor:pointer;font-weight:bold;\"></button>\n                    </div>\n                </div>\n            </div>\n        `);\n\n        $('body').append(overlay);\n        const overlayEl = overlay[0];\n        overlayEl.style.setProperty('position', 'fixed', 'important');\n        overlayEl.style.setProperty('top', '0', 'important');\n        overlayEl.style.setProperty('left', '0', 'important');\n        overlayEl.style.setProperty('right', '0', 'important');\n        overlayEl.style.setProperty('bottom', '0', 'important');\n        overlayEl.style.setProperty('width', '100vw', 'important');\n        overlayEl.style.setProperty('height', '100vh', 'important');\n        overlayEl.style.setProperty('display', 'flex', 'important');\n        overlayEl.style.setProperty('justify-content', 'center', 'important');\n        overlayEl.style.setProperty('align-items', 'center', 'important');\n        overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        setTimeout(() => overlay.find('#acu-msg-input').focus(), 50);\n\n        const sendMessage = () => {\n          const msg = overlay.find('#acu-msg-input').val().trim();\n          if (msg) {\n            const promptText = `<user>${npcName}\"${msg}\"`;\n            smartInsertToTextarea(promptText, 'action');\n            $('#send_textarea').focus();\n          }\n          overlay.remove();\n        };\n\n        // \n        overlay.find('#acu-msg-send').click(sendMessage);\n\n        // \n        overlay.find('#acu-msg-input').on('keydown', function (ev) {\n          if (ev.key === 'Enter') {\n            ev.preventDefault();\n            sendMessage();\n          }\n        });\n\n        // \n        overlay.find('#acu-msg-cancel').click(() => overlay.remove());\n        overlay.on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-msg-overlay')) overlay.remove();\n        });\n      });\n    // [] NPC\n    $('body')\n      .off('click.acu_dash_contest')\n      .on('click.acu_dash_contest', '.acu-dash-contest-btn', function (e) {\n        e.stopPropagation();\n        e.preventDefault();\n        const npcName = $(this).data('npc') || '';\n\n        const rawData = cachedRawData || getTableData();\n\n        var playerAttrValue = 50;\n        var npcAttrValue = 50;\n        var foundPlayer = false;\n        var foundNPC = false;\n\n        if (rawData) {\n          for (var key in rawData) {\n            var sheet = rawData[key];\n            if (!sheet || !sheet.name || !sheet.content) continue;\n\n            // \n            if (sheet.name === '') {\n              if (sheet.content[1]) {\n                var attrStr = sheet.content[1][7] || '';\n                var parts = attrStr.split(/[,;\\s]+/);\n                for (var i = 0; i < parts.length; i++) {\n                  var match = parts[i].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                  if (match) {\n                    playerAttrValue = parseInt(match[2], 10);\n                    foundPlayer = true;\n                    break;\n                  }\n                }\n              }\n            }\n\n            // \n            if (sheet.name === '' && npcName) {\n              for (var j = 1; j < sheet.content.length; j++) {\n                var row = sheet.content[j];\n                if (row && row[1] === npcName) {\n                  var npcAttrStr = row[9] || '';\n                  var npcParts = npcAttrStr.split(/[,;\\s]+/);\n                  for (var k = 0; k < npcParts.length; k++) {\n                    var npcMatch = npcParts[k].match(/^([\\u4e00-\\u9fa5a-zA-Z]+)[:\\s]\\s*(\\d+)/);\n                    if (npcMatch) {\n                      npcAttrValue = parseInt(npcMatch[2], 10);\n                      foundNPC = true;\n                      break;\n                    }\n                  }\n                  break;\n                }\n              }\n            }\n          }\n        }\n\n        showContestPanel({\n          initiatorName: '<user>',\n          initiatorValue: playerAttrValue,\n          opponentName: npcName,\n          opponentValue: npcAttrValue,\n          diceType: '1d100',\n        });\n      });\n    // [] \n    $('body')\n      .off('click.acu_dash_preview')\n      .on('click.acu_dash_preview', '.acu-dash-preview-trigger', function (e) {\n        e.stopPropagation();\n\n        const tableKey = $(this).data('table-key');\n        const rowIndex = parseInt($(this).data('row-index'), 10);\n\n        if (!tableKey || isNaN(rowIndex)) return;\n\n        const rawData = cachedRawData || getTableData();\n        if (!rawData || !rawData[tableKey]) return;\n\n        const table = rawData[tableKey];\n        const tableName = table.name || '';\n        const headers = table.content[0] || [];\n        const rowData = table.content[rowIndex + 1];\n\n        if (!rowData) return;\n\n        const config = getConfig();\n        const title = rowData[1] || '';\n\n        //  renderTableContent \n        const titleColIndex = 1;\n        const realRowIdx = rowIndex;\n\n        // \n        let cardBody = '';\n        rowData.forEach((cell, cIdx) => {\n          if (cIdx <= 0 || cIdx === titleColIndex) return;\n          const currentHeader = headers[cIdx] || '';\n          if (currentHeader.includes('')) return; // \n\n          const headerName = headers[cIdx] || '' + cIdx;\n          const rawStr = String(cell || '').trim();\n          if (!rawStr) return;\n\n          let contentHtml = '';\n          let hideLabel = false;\n\n          const parsedAttrs = parseAttributeString(rawStr);\n          // [] \n          if (isRelationshipCell(rawStr, headerName)) {\n            const relations = parseRelationshipString(rawStr);\n            if (relations.length > 1) {\n              hideLabel = true;\n              let relHtml = '';\n              relations.forEach((rel, i) => {\n                const borderStyle = i < relations.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n                relHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                            <span style=\"color:var(--acu-text-main);font-size:0.95em;\">${escapeHtml(rel.name)}</span>\n                            ${rel.relation ? `<span style=\"color:var(--acu-text-sub);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>` : ''}\n                        </div>`;\n              });\n              contentHtml = `<div class=\"acu-relation-container\">${relHtml}</div>`;\n            } else if (relations.length === 1 && relations[0].relation) {\n              const rel = relations[0];\n              contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                        <span style=\"color:var(--acu-text-main);\">${escapeHtml(rel.name)}</span>\n                        <span style=\"color:var(--acu-text-sub);font-size:0.85em;background:var(--acu-badge-bg);padding:1px 6px;border-radius:8px;\">${escapeHtml(rel.relation)}</span>\n                    </div>`;\n            }\n          } else if (parsedAttrs.length > 1) {\n            hideLabel = true;\n            let attrsHtml = '';\n            parsedAttrs.forEach((attr, i) => {\n              const borderStyle = i < parsedAttrs.length - 1 ? 'border-bottom:1px dashed rgba(128,128,128,0.2);' : '';\n              attrsHtml += `<div style=\"display:flex;justify-content:space-between;align-items:center;padding:3px 0;${borderStyle}\">\n                        <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}</span>\n                        <div style=\"display:flex;align-items:center;gap:6px;\">\n                            <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                            <i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>\n                        </div></div>`;\n            });\n            contentHtml = `<div class=\"acu-multi-attr-container\">${attrsHtml}</div>`;\n          } else if (parsedAttrs.length === 1) {\n            hideLabel = true;\n            const attr = parsedAttrs[0];\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                    <span style=\"color:var(--acu-text-sub);font-size:0.95em;\">${escapeHtml(attr.name)}</span>\n                    <div style=\"display:flex;align-items:center;gap:6px;\">\n                        <span style=\"color:var(--acu-text-main);font-weight:bold;\">${attr.value}</span>\n                        <i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(attr.name)}\" data-attr-value=\"${attr.value}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;\" title=\"\"></i>\n                    </div></div>`;\n          } else if (isNumericCell(rawStr) && !rawStr.includes(':') && !rawStr.includes('')) {\n            const numVal = extractNumericValue(rawStr);\n            contentHtml = `<div style=\"display:flex;justify-content:space-between;align-items:center;\">\n                    <span>${escapeHtml(rawStr)}</span>\n                    <i class=\"fa-solid fa-dice-d20 acu-inline-dice-btn\" data-attr-name=\"${escapeHtml(headerName)}\" data-attr-value=\"${numVal}\" style=\"cursor:pointer;color:var(--acu-accent);opacity:0.5;font-size:11px;margin-left:6px;\" title=\"\"></i>\n                </div>`;\n          } else {\n            const badgeStyle = getBadgeStyle(rawStr);\n            contentHtml = badgeStyle\n              ? `<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(rawStr)}</span>`\n              : escapeHtml(rawStr);\n          }\n\n          const rowClass = 'acu-card-row acu-cell' + (hideLabel ? ' acu-hide-label' : '');\n          cardBody += `<div class=\"${rowClass}\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${cIdx}\" data-val=\"${encodeURIComponent(cell ?? '')}\">\n                <div class=\"acu-card-label\">${escapeHtml(headerName)}</div>\n                <div class=\"acu-card-value\">${contentHtml}</div>\n            </div>`;\n        });\n\n        // \n        let actionsHtml = '';\n        let tableActions = getActionsForTable(tableName);\n        const interactColIdx = headers.findIndex(h => h && String(h).includes(''));\n        if (interactColIdx > 0 && rowData[interactColIdx]) {\n          const interactOptions = String(rowData[interactColIdx])\n            .split(/[,;]/)\n            .map(s => s.trim())\n            .filter(s => s);\n          if (interactOptions.length > 0) {\n            tableActions = interactOptions.map(opt => ({\n              label: opt,\n              icon: 'fa-hand-pointer',\n              type: 'prompt',\n              template: `<user>{Name}${opt}`,\n              auto_send: true,\n            }));\n          }\n        }\n        if (tableActions.length > 0) {\n          const actionBtns = tableActions\n            .map(\n              (act, actIdx) =>\n                `<button class=\"acu-action-item ${act.type === 'check' ? 'check-type' : ''}\" data-action-idx=\"${actIdx}\" data-row=\"${realRowIdx}\"><i class=\"fa-solid ${act.icon || 'fa-play'}\"></i> ${escapeHtml(act.label)}</button>`,\n            )\n            .join('');\n          actionsHtml = `<div class=\"acu-card-actions\">${actionBtns}</div>`;\n        }\n\n        // \n        const cardHtml = `\n            <div class=\"acu-preview-overlay acu-theme-${config.theme}\" style=\"--acu-card-width:${config.cardWidth}px;--acu-font-size:${config.fontSize}px;\">\n                <div class=\"acu-data-card\" style=\"width:90vw;max-width:420px;max-height:85vh;overflow-y:auto;\">\n                    <div class=\"acu-card-header\">\n                        <span class=\"acu-card-index\">#${realRowIdx + 1}</span>\n                        <span class=\"acu-cell acu-editable-title\" data-key=\"${escapeHtml(tableKey)}\" data-tname=\"${escapeHtml(tableName)}\" data-row=\"${realRowIdx}\" data-col=\"${titleColIndex}\" data-val=\"${encodeURIComponent(title)}\">${escapeHtml(title)}</span>\n                        <button class=\"acu-preview-close\" style=\"margin-left:auto;background:none;border:none;color:var(--acu-text-sub);cursor:pointer;font-size:16px;padding:4px;\"><i class=\"fa-solid fa-times\"></i></button>\n                    </div>\n                    <div class=\"acu-card-body view-list\">${cardBody}</div>\n                    ${actionsHtml}\n                </div>\n            </div>\n        `;\n\n        $('.acu-preview-overlay').remove();\n        $('body').append(cardHtml);\n\n        // \n        const overlayEl = $('.acu-preview-overlay')[0];\n        if (overlayEl) {\n          overlayEl.style.setProperty('position', 'fixed', 'important');\n          overlayEl.style.setProperty('top', '0', 'important');\n          overlayEl.style.setProperty('left', '0', 'important');\n          overlayEl.style.setProperty('right', '0', 'important');\n          overlayEl.style.setProperty('bottom', '0', 'important');\n          overlayEl.style.setProperty('width', '100vw', 'important');\n          overlayEl.style.setProperty('height', '100vh', 'important');\n          overlayEl.style.setProperty('display', 'flex', 'important');\n          overlayEl.style.setProperty('justify-content', 'center', 'important');\n          overlayEl.style.setProperty('align-items', 'center', 'important');\n          overlayEl.style.setProperty('z-index', '2147483650', 'important');\n        }\n\n        // \n        $('.acu-preview-overlay').on('click', function (ev) {\n          if ($(ev.target).hasClass('acu-preview-overlay') || $(ev.target).closest('.acu-preview-close').length) {\n            $(this).remove();\n          }\n        });\n      });\n\n    // === []  ST  swipe regenerate ===\n    (function () {\n      const $doc = $(document);\n      let touchStartX = 0;\n      let touchStartY = 0;\n\n      //  data-area\n      $doc.on('touchstart.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length === 1) {\n          touchStartX = e.originalEvent.touches[0].clientX;\n          touchStartY = e.originalEvent.touches[0].clientY;\n        }\n      });\n\n      $doc.on('touchmove.acuSwipeFix', '#acu-data-area', function (e) {\n        if (e.originalEvent.touches.length !== 1) return;\n\n        const touch = e.originalEvent.touches[0];\n        const deltaX = Math.abs(touch.clientX - touchStartX);\n        const deltaY = Math.abs(touch.clientY - touchStartY);\n\n        // X > Y * 1.5\n        if (deltaX > deltaY * 1.5 && deltaX > 10) {\n          e.stopPropagation();\n          console.log('[ACU]  ST swipe');\n        }\n      });\n    })();\n  };\n\n  let selectedSwapSource = null;\n  const toggleOrderEditMode = () => {\n    const { $ } = getCore();\n    isEditingOrder = !isEditingOrder;\n\n    const $container = $('#acu-nav-bar');\n    const $hint = $('#acu-order-hint');\n    const $pool = $('#acu-action-pool');\n\n    // \n    if (!$container.length) {\n      console.error('[ACU] ');\n      isEditingOrder = false;\n      return;\n    }\n\n    selectedSwapSource = null;\n    $('.acu-swap-selected').removeClass('acu-swap-selected');\n\n    if (isEditingOrder) {\n      // \n      $container.addClass('editing-order');\n      if ($pool.length) $pool.addClass('visible');\n\n      if ($hint.length) {\n        $hint\n          .html(\n            `\n                    <div style=\"display:flex; justify-content:space-between; align-items:center; width:100%; flex-wrap:wrap; gap:8px;\">\n                        <div style=\"display:flex; align-items:center; gap:10px; flex:1; min-width:200px;\">\n                            <span><i class=\"fa-solid fa-layer-group\"></i> </span>\n                            <span style=\"font-size:11px; opacity:0.9; font-weight:normal;\"></span>\n                        </div>\n                        <button id=\"acu-btn-finish-sort\" style=\"background:rgba(255,255,255,0.2); color:#fff; border:1px solid rgba(255,255,255,0.4); padding:4px 14px; border-radius:4px; cursor:pointer; font-size:12px; transition:all 0.2s; white-space:nowrap;\">\n                            <i class=\"fa-solid fa-check\"></i> \n                        </button>\n                    </div>\n                `,\n          )\n          .addClass('visible')\n          .css('display', 'flex');\n\n        $('#acu-btn-finish-sort').hover(\n          function () {\n            $(this).css({ background: '#fff', color: 'var(--acu-accent)' });\n          },\n          function () {\n            $(this).css({ background: 'rgba(255,255,255,0.2)', color: '#fff' });\n          },\n        );\n\n        $('#acu-btn-finish-sort')\n          .off('click')\n          .on('click', function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            toggleOrderEditMode();\n          });\n      }\n\n      // \n      $('#acu-data-area').removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn').not('#acu-btn-dashboard, #acu-btn-dice-nav').attr('draggable', 'true');\n      $container.find('.acu-action-btn').attr('draggable', 'true');\n\n      // \n      initSortable();\n    } else {\n      // \n      $container.removeClass('editing-order');\n      if ($hint.length) $hint.removeClass('visible').hide();\n      if ($pool.length) $pool.removeClass('visible');\n\n      // \n      $container.find('.acu-nav-btn, .acu-action-btn').attr('draggable', 'false');\n      $('.acu-nav-btn, .acu-action-btn').off('.sort');\n      $('#acu-action-pool, #acu-active-actions').off('.sort');\n\n      // \n      const newTableOrder = [];\n      $container.find('.acu-nav-btn[data-table]').each(function () {\n        const tableName = $(this).data('table');\n        if (tableName) {\n          newTableOrder.push(tableName);\n        }\n      });\n      if (newTableOrder.length > 0) {\n        saveTableOrder(newTableOrder);\n      }\n\n      // \n      const newActionOrder = [];\n      $('#acu-active-actions .acu-action-btn').each(function () {\n        const btnId = $(this).attr('id');\n        if (btnId) {\n          newActionOrder.push(btnId);\n        }\n      });\n\n      // \n      if (!newActionOrder.includes('acu-btn-settings')) {\n        newActionOrder.push('acu-btn-settings');\n      }\n\n      Store.set(STORAGE_KEY_ACTION_ORDER, newActionOrder);\n\n      // \n      renderInterface();\n    }\n  };\n\n  const initSortable = () => {\n    const { $ } = getCore();\n    let $dragSrcEl = null;\n\n    // \n    $('.acu-nav-btn, .acu-action-btn, #acu-action-pool, #acu-active-actions').off('.sort');\n\n    // --- 1.  () ---\n    const $items = $('.acu-nav-btn, .acu-action-btn');\n\n    $items.on('dragstart.sort', function (e) {\n      $dragSrcEl = $(this);\n      $(this).css('opacity', '0.4');\n      e.originalEvent.dataTransfer.effectAllowed = 'move';\n    });\n\n    $items.on('dragend.sort', function (e) {\n      $(this).css('opacity', '1');\n      $('.acu-drag-over').removeClass('acu-drag-over');\n      $('.acu-actions-group, .acu-unused-pool').removeClass('dragging-over');\n    });\n\n    $items.on('dragover.sort', function (e) {\n      e.preventDefault();\n      return false;\n    });\n    $items.on('dragenter.sort', function () {\n      if ($dragSrcEl && this !== $dragSrcEl[0]) $(this).addClass('acu-drag-over');\n    });\n    $items.on('dragleave.sort', function () {\n      $(this).removeClass('acu-drag-over');\n    });\n\n    $items.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('acu-drag-over');\n      if (!$dragSrcEl || $dragSrcEl[0] === this) return false;\n\n      const isSrcAction = $dragSrcEl.hasClass('acu-action-btn');\n      const isTgtAction = $(this).hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) return false;\n\n      if (isSrcAction) {\n        const targetPoolId = $(this).parent().attr('id');\n        const srcPoolId = $dragSrcEl.parent().attr('id');\n\n        if (srcPoolId === 'acu-action-pool' && targetPoolId === 'acu-active-actions') {\n          if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n            if (window.toastr) window.toastr.warning('6');\n            return false;\n          }\n        }\n\n        if (srcPoolId !== targetPoolId) {\n          $(this).before($dragSrcEl);\n          return false;\n        }\n      }\n\n      const $temp = $('<span>').hide();\n      $dragSrcEl.before($temp);\n      $(this).before($dragSrcEl);\n      $temp.replaceWith($(this));\n      return false;\n    });\n\n    // --- 2.  (/) ---\n    const $containers = $('#acu-action-pool, #acu-active-actions');\n\n    $containers.on('dragover.sort', function (e) {\n      e.preventDefault();\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        $(this).addClass('dragging-over');\n      }\n    });\n\n    $containers.on('dragleave.sort', function (e) {\n      $(this).removeClass('dragging-over');\n    });\n\n    $containers.on('drop.sort', function (e) {\n      e.stopPropagation();\n      $(this).removeClass('dragging-over');\n\n      if ($dragSrcEl && $dragSrcEl.hasClass('acu-action-btn')) {\n        const currentParentId = $dragSrcEl.parent().attr('id');\n        const targetId = $(this).attr('id');\n        const btnId = $dragSrcEl.attr('id');\n\n        if (currentParentId !== targetId) {\n          if (targetId === 'acu-action-pool') {\n            if (btnId === 'acu-btn-settings') {\n              if (window.toastr) window.toastr.warning('');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          } else if (targetId === 'acu-active-actions') {\n            if ($(this).children().length >= 6) {\n              if (window.toastr) window.toastr.warning('6');\n              return false;\n            }\n            $(this).append($dragSrcEl);\n          }\n        }\n      }\n      return false;\n    });\n\n    // --- 3.  -  ---\n    $containers.on('click.sort', function (e) {\n      e.stopPropagation();\n\n      // \n      if ($(e.target).closest('.acu-action-btn, .acu-nav-btn').length > 0) return;\n\n      // \n      if (!selectedSwapSource) return;\n\n      const $src = $(selectedSwapSource);\n\n      // \n      if (!$src.hasClass('acu-action-btn')) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const targetId = $(this).attr('id');\n      const btnId = $src.attr('id');\n\n      // \n      if (srcPoolId === targetId) {\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      //   \n      if (targetId === 'acu-action-pool') {\n        if (btnId === 'acu-btn-settings') {\n          if (window.toastr) window.toastr.warning('');\n          $src.removeClass('acu-swap-selected');\n          selectedSwapSource = null;\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n      //   \n      else if (targetId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n        $(this).append($src);\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n      }\n    });\n\n    // --- 4.  (Click-to-Swap) -  ---\n    $items.on('click.sort', function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      if (selectedSwapSource && selectedSwapSource === this) {\n        $(this).removeClass('acu-swap-selected');\n        selectedSwapSource = null;\n        return;\n      }\n\n      if (!selectedSwapSource) {\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const $src = $(selectedSwapSource);\n      const $tgt = $(this);\n\n      const isSrcAction = $src.hasClass('acu-action-btn');\n      const isTgtAction = $tgt.hasClass('acu-action-btn');\n      if (isSrcAction !== isTgtAction) {\n        if (window.toastr) window.toastr.warning('');\n        $src.removeClass('acu-swap-selected');\n        selectedSwapSource = this;\n        $(this).addClass('acu-swap-selected');\n        return;\n      }\n\n      const srcPoolId = $src.parent().attr('id');\n      const tgtPoolId = $tgt.parent().attr('id');\n\n      if (isSrcAction && srcPoolId === 'acu-action-pool' && tgtPoolId === 'acu-active-actions') {\n        if ($('#acu-active-actions').children().length >= MAX_ACTION_BUTTONS) {\n          if (window.toastr) window.toastr.warning('6');\n          return;\n        }\n      }\n\n      if (srcPoolId !== tgtPoolId) {\n        $tgt.before($src);\n      } else {\n        const $temp = $('<span>').hide();\n        $src.before($temp);\n        $tgt.before($src);\n        $temp.replaceWith($tgt);\n      }\n\n      $src.removeClass('acu-swap-selected');\n      selectedSwapSource = null;\n    });\n  };\n\n  const showCellMenu = (e, cell) => {\n    const { $ } = getCore();\n    $('.acu-cell-menu, .acu-menu-backdrop').remove();\n    const backdrop = $('<div class=\"acu-menu-backdrop\"></div>');\n    $('body').append(backdrop);\n\n    const rowIdx = parseInt($(cell).data('row'), 10);\n    const colIdx = parseInt($(cell).data('col'), 10);\n    if (isNaN(rowIdx) || isNaN(colIdx)) {\n      console.warn('[ACU] /');\n      backdrop.remove();\n      return;\n    }\n    const tableKey = $(cell).data('key');\n    // v19.x  tname\n    const tableName = $(cell).data('tname') || $(cell).closest('.acu-data-card').find('.acu-editable-title').text();\n    const content = decodeURIComponent($(cell).data('val'));\n    const config = getConfig();\n\n    //  ID\n    const cellId = `${tableKey}-${rowIdx}-${colIdx}`;\n    if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n\n    // \n    const isModified = window.acuModifiedSet.has(cellId);\n\n    // \n    const pendingDeletionsMap = getPendingDeletions();\n    const tableDeletions = pendingDeletionsMap[tableKey] || [];\n    const isPending = tableDeletions.includes(rowIdx);\n\n    // \n    const headers = cachedRawData?.[tableKey]?.content?.[0] || [];\n    const rowData = cachedRawData?.[tableKey]?.content?.[rowIdx + 1] || [];\n    const lockRowKey = LockManager.getRowKey(tableName, rowData, headers);\n    const currentHeader = headers[colIdx] || '';\n\n    const isFieldLocked = lockRowKey && LockManager.isFieldLocked(tableName, lockRowKey, currentHeader);\n    const isRowLocked = lockRowKey && LockManager.isRowLocked(tableName, lockRowKey);\n\n    // \n    let lockMenuHtml = '';\n    if (lockRowKey) {\n      lockMenuHtml = '<div style=\"border-top:1px dashed var(--acu-border); margin:4px 0;\"></div>';\n      if (isFieldLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-field\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-field\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n      if (isRowLocked) {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-unlock-row\" style=\"color:#27ae60;\"><i class=\"fa-solid fa-unlock\"></i> </div>';\n      } else {\n        lockMenuHtml +=\n          '<div class=\"acu-cell-menu-item\" id=\"act-lock-row\" style=\"color:#f39c12;\"><i class=\"fa-solid fa-lock\"></i> </div>';\n      }\n    }\n\n    const menu = $(`\n            <div class=\"acu-cell-menu acu-theme-${config.theme}\">\n                <div class=\"acu-cell-menu-item\" id=\"act-edit\"><i class=\"fa-solid fa-pen\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-edit-card\" style=\"color:#9b59b6\"><i class=\"fa-solid fa-edit\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-insert\" style=\"color:#2980b9\"><i class=\"fa-solid fa-plus\"></i> </div>\n                <div class=\"acu-cell-menu-item\" id=\"act-copy\"><i class=\"fa-solid fa-copy\"></i> </div>\n                ${isNumericCell(content) ? '<div class=\"acu-cell-menu-item\" id=\"act-dice\" style=\"color:#9b59b6; border-top:1px dashed var(--acu-border);\"><i class=\"fa-solid fa-dice-d20\"></i>  (' + extractNumericValue(content) + ')</div>' : ''}\n                ${lockMenuHtml}\n                ${isModified ? '<div class=\"acu-cell-menu-item\" id=\"act-undo\" style=\"color:#e67e22; border-top:1px solid #eee;\"><i class=\"fa-solid fa-undo\"></i> </div>' : ''}\n                ${isPending ? '<div class=\"acu-cell-menu-item\" id=\"act-restore\" style=\"color:#27ae60\"><i class=\"fa-solid fa-undo\"></i> </div>' : '<div class=\"acu-cell-menu-item\" id=\"act-delete\" style=\"color:#e74c3c\"><i class=\"fa-solid fa-trash\"></i> </div>'}\n                <div class=\"acu-cell-menu-item\" id=\"act-close\"><i class=\"fa-solid fa-times\"></i> </div>\n            </div>\n        `);\n    $('body').append(menu);\n\n    // \n    const winWidth = $(window).width();\n    const winHeight = $(window).height();\n    const mWidth = menu.outerWidth() || 150;\n    const mHeight = menu.outerHeight() || 150;\n    let clientX = e.clientX;\n    let clientY = e.clientY;\n    if (!clientX && e.originalEvent && e.originalEvent.touches && e.originalEvent.touches.length) {\n      clientX = e.originalEvent.touches[0].clientX;\n      clientY = e.originalEvent.touches[0].clientY;\n    } else if (!clientX && e.changedTouches && e.changedTouches.length) {\n      clientX = e.changedTouches[0].clientX;\n      clientY = e.changedTouches[0].clientY;\n    }\n\n    // \n    if (clientX === undefined) clientX = winWidth / 2;\n    if (clientY === undefined) clientY = winHeight / 2;\n\n    let left = clientX + 5;\n    let top = clientY + 5;\n    if (left + mWidth > winWidth) left = clientX - mWidth - 5;\n    if (top + mHeight > winHeight) top = clientY - mHeight - 5;\n\n    // \n    if (left < 5) left = 5;\n    if (top < 5) top = 5;\n\n    menu.css({ top: top + 'px', left: left + 'px' });\n\n    const closeAll = () => {\n      menu.remove();\n      backdrop.remove();\n    };\n    backdrop.on('click', closeAll);\n    menu.find('#act-close').click(closeAll);\n    // \n    menu.find('#act-lock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.lockField(tableName, lockRowKey, currentHeader, content);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-field').click(() => {\n      if (lockRowKey && currentHeader) {\n        LockManager.unlockField(tableName, lockRowKey, currentHeader);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-lock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.lockRow(tableName, lockRowKey, rowData, headers);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    // \n    menu.find('#act-unlock-row').click(() => {\n      if (lockRowKey) {\n        LockManager.unlockRow(tableName, lockRowKey);\n        renderInterface();\n      }\n      closeAll();\n    });\n\n    //  (v7.9 )\n    menu.find('#act-copy').click(async e => {\n      e.stopPropagation();\n\n      //  v7.7  (/PWA )\n      // : slash_command.txt /clipboard-set\n      if (window.TavernHelper && window.TavernHelper.triggerSlash) {\n        try {\n          // \n          const safeContent = content\n            .replace(/\\\\/g, '\\\\\\\\')\n            .replace(/\"/g, '\\\\\"')\n            .replace(/\\n/g, '\\\\n')\n            .replace(/\\{/g, '\\\\{')\n            .replace(/\\}/g, '\\\\}');\n          await window.TavernHelper.triggerSlash(`/clipboard-set \"${safeContent}\"`);\n          closeAll();\n          return; // \n        } catch (err) {\n          console.warn('', err);\n        }\n      }\n\n      //  (v7.8 )\n      const doCopy = text => {\n        // A:  API ( HTTPS  localhost )\n        if (navigator.clipboard && window.isSecureContext) {\n          navigator.clipboard\n            .writeText(text)\n            .then(() => {})\n            .catch(() => {\n              fallbackCopy(text);\n            });\n        } else {\n          // B:  execCommand ( HTTP)\n          fallbackCopy(text);\n        }\n      };\n\n      const fallbackCopy = text => {\n        try {\n          const textArea = document.createElement('textarea');\n          textArea.value = text;\n\n          // \n          textArea.style.position = 'fixed';\n          textArea.style.left = '-9999px';\n          textArea.style.top = '0';\n          textArea.setAttribute('readonly', '');\n\n          document.body.appendChild(textArea);\n\n          textArea.select();\n          textArea.setSelectionRange(0, 99999); //  iOS Safari\n\n          const successful = document.execCommand('copy');\n          document.body.removeChild(textArea);\n\n          if (successful) {\n          } else {\n            throw new Error('execCommand failed');\n          }\n        } catch (err) {\n          console.error(':', err);\n          prompt(':', text);\n        }\n      };\n\n      doCopy(content);\n      closeAll();\n    });\n\n    // \n    menu.find('#act-undo').click(() => {\n      const snapshot = loadSnapshot();\n      let originalValue = null;\n      if (snapshot && snapshot[tableKey]?.content[rowIdx + 1]) {\n        originalValue = snapshot[tableKey].content[rowIdx + 1][colIdx];\n      }\n\n      if (originalValue !== null) {\n        if (!cachedRawData) cachedRawData = getTableData();\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = originalValue;\n        }\n\n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(originalValue));\n        $cell.data('val', encodeURIComponent(originalValue));\n\n        // [1]  Label\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length > 0) {\n          $displayTarget = $cell.find('.acu-card-value');\n        } else if ($cell.hasClass('acu-grid-item')) {\n          $displayTarget = $cell.find('.acu-grid-value');\n        } else if ($cell.hasClass('acu-full-item')) {\n          $displayTarget = $cell.find('.acu-full-value');\n        }\n\n        const badgeStyle = getBadgeStyle(originalValue);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${originalValue}</span>`);\n        } else {\n          $displayTarget.text(originalValue);\n        }\n\n        // [] \n        $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n        if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n        window.acuModifiedSet.delete(cellId);\n\n        if (window.acuModifiedSet.size === 0) {\n          hasUnsavedChanges = false;\n          updateSaveButtonState();\n        }\n      } else {\n        if (window.toastr) window.toastr.warning('');\n      }\n      closeAll();\n    });\n\n    // []  ( & )\n    menu.find('#act-delete').click(async () => {\n      closeAll();\n\n      let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n      if (!actOrd || !Array.isArray(actOrd))\n        actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n      const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n      if (isInstantMode) {\n        // ---  DOM ---\n        const $card = $(cell).closest('.acu-data-card');\n        $card.css('transition', 'all 0.2s ease').css('opacity', '0').css('transform', 'scale(0.9)');\n        setTimeout(() => $card.slideUp(200, () => $card.remove()), 200);\n\n        // ---  ---\n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n        if (cachedRawData && cachedRawData[tableKey]?.content) {\n          cachedRawData[tableKey].content.splice(rowIdx + 1, 1);\n\n          //  skipRender=true ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        }\n      } else {\n        // ---  () ---\n        const dels = getPendingDeletions();\n        if (!dels[tableKey]) dels[tableKey] = [];\n        if (!dels[tableKey].includes(rowIdx)) {\n          dels[tableKey].push(rowIdx);\n          savePendingDeletions(dels);\n        }\n\n        // \n        $(cell).closest('.acu-data-card').addClass('pending-deletion');\n\n        // \n        updateSaveButtonState();\n      }\n    });\n\n    // \n    menu.find('#act-restore').click(() => {\n      const dels = getPendingDeletions();\n      if (dels[tableKey]) {\n        dels[tableKey] = dels[tableKey].filter(i => i !== rowIdx);\n        if (dels[tableKey].length === 0) delete dels[tableKey];\n        savePendingDeletions(dels);\n      }\n\n      $(cell).closest('.acu-data-card').removeClass('pending-deletion');\n      updateSaveButtonState();\n      closeAll();\n    });\n\n    // []  ()\n    menu.find('#act-insert').click(async () => {\n      closeAll();\n      // 1.  ()\n      if (!cachedRawData) cachedRawData = getTableData();\n      if (!cachedRawData) cachedRawData = loadSnapshot();\n\n      if (cachedRawData && cachedRawData[tableKey]?.content) {\n        const sheet = cachedRawData[tableKey];\n        // 2.  ()\n        const colCount = sheet.content[0] ? sheet.content[0].length : 2;\n        const newRow = new Array(colCount).fill('');\n        //  ()\n        if (colCount > 0) newRow[0] = String(sheet.content.length);\n\n        // 3.  (rowIdx+2  content )\n        sheet.content.splice(rowIdx + 2, 0, newRow);\n\n        // 4. \n        // \n        await saveDataToDatabase(cachedRawData, false, true);\n\n        // \n        renderInterface();\n\n        // \n        setTimeout(() => {\n          const $panel = $('.acu-panel-content');\n          // \n          if ($panel.length && $panel[0].scrollHeight > $panel.height()) {\n            $panel.scrollTop($panel.scrollTop() + 10);\n          }\n        }, 100);\n      }\n    });\n\n    // [] \n    menu.find('#act-edit-card').click(() => {\n      closeAll();\n      const rawData = cachedRawData || getTableData();\n      if (rawData && rawData[tableKey]) {\n        const headers = rawData[tableKey].content[0];\n        const row = rawData[tableKey].content[rowIdx + 1];\n        if (row) {\n          showCardEditModal(row, headers, tableName, rowIdx, tableKey);\n        }\n      }\n    });\n\n    // [] \n    menu.find('#act-dice').click(() => {\n      closeAll();\n      const targetValue = extractNumericValue(content);\n      const headerName = $(cell).find('.acu-card-label').text() || '';\n      showDicePanel({\n        targetValue: targetValue,\n        targetName: headerName,\n        diceType: '1d100',\n      });\n    });\n    menu.find('#act-edit').click(() => {\n      closeAll();\n      showEditDialog(content, async newVal => {\n        // 1. \n        if (!cachedRawData) cachedRawData = getTableData() || loadSnapshot();\n\n        if (cachedRawData && cachedRawData[tableKey]?.content[rowIdx + 1]) {\n          cachedRawData[tableKey].content[rowIdx + 1][colIdx] = newVal;\n        } else {\n          alert('');\n          return;\n        }\n\n        // 2.  UI \n        const $cell = $(cell);\n        $cell.attr('data-val', encodeURIComponent(newVal)).data('val', encodeURIComponent(newVal));\n\n        let $displayTarget = $cell;\n        if ($cell.find('.acu-card-value').length) $displayTarget = $cell.find('.acu-card-value');\n        else if ($cell.hasClass('acu-grid-item')) $displayTarget = $cell.find('.acu-grid-value');\n        else if ($cell.hasClass('acu-editable-title')) $displayTarget = $cell;\n\n        // 3.  UI / ()\n        const badgeStyle = getBadgeStyle(newVal);\n        if (badgeStyle && !$cell.hasClass('acu-editable-title')) {\n          $displayTarget.html(`<span class=\"acu-badge ${badgeStyle}\">${escapeHtml(newVal)}</span>`);\n        } else {\n          $displayTarget.text(newVal);\n        }\n\n        // 4.  vs \n        let actOrd = Store.get(STORAGE_KEY_ACTION_ORDER);\n        if (!actOrd || !Array.isArray(actOrd))\n          actOrd = ['acu-btn-save-global', 'acu-btn-collapse', 'acu-btn-refresh', 'acu-btn-settings'];\n        const isInstantMode = !actOrd.includes('acu-btn-save-global');\n\n        if (isInstantMode) {\n          // --- A.  ---\n          //  ()\n          $displayTarget.removeClass('acu-highlight-manual acu-highlight-diff');\n          if ($cell.hasClass('acu-editable-title')) $cell.removeClass('acu-highlight-manual acu-highlight-diff');\n\n          //  ()\n          saveSnapshot(cachedRawData);\n          await saveDataToDatabase(cachedRawData, true, true);\n        } else {\n          // --- B.  () ---\n          // \n          $displayTarget.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n          if ($cell.hasClass('acu-editable-title'))\n            $cell.removeClass('acu-highlight-diff').addClass('acu-highlight-manual');\n\n          // \n          if (!window.acuModifiedSet) window.acuModifiedSet = new Set();\n          window.acuModifiedSet.add(cellId);\n          hasUnsavedChanges = true;\n          updateSaveButtonState();\n        }\n      });\n    });\n  };\n\n  const showEditDialog = (content, onSave) => {\n    const { $ } = getCore();\n    const config = getConfig();\n\n    const dialog = $(`\n            <div class=\"acu-edit-overlay\">\n                <!-- 2. []  acu-theme-${config.theme} -->\n                <div class=\"acu-edit-dialog acu-theme-${config.theme}\">\n                    <div class=\"acu-edit-title\"></div>\n                    <textarea class=\"acu-edit-textarea\" spellcheck=\"false\">${escapeHtml(content)}</textarea>\n                    <div class=\"acu-dialog-btns\">\n                        <button class=\"acu-dialog-btn\" id=\"dlg-cancel\"><i class=\"fa-solid fa-times\"></i> </button>\n                        <button class=\"acu-dialog-btn acu-btn-confirm\" id=\"dlg-save\"><i class=\"fa-solid fa-check\"></i> </button>\n                    </div>\n                </div>\n            </div>\n        `);\n    $('body').append(dialog);\n\n    const adjustHeight = el => {\n      el.style.height = 'auto';\n      el.style.height = el.scrollHeight + 2 + 'px';\n    };\n    dialog.find('textarea').on('input', function () {\n      adjustHeight(this);\n    });\n\n    dialog.find('#dlg-cancel').click(() => dialog.remove());\n    // \n    dialog.on('click', function (e) {\n      if ($(e.target).hasClass('acu-edit-overlay')) dialog.remove();\n    });\n\n    dialog.find('#dlg-save').click(() => {\n      onSave(dialog.find('textarea').val());\n      dialog.remove();\n    });\n  };\n\n  // ==========================================\n  // []  (Observer )\n  // ==========================================\n  const init = () => {\n    if (isInitialized) return;\n    MvuModule.injectStyles();\n\n    //  Observer\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n    }\n    addStyles();\n    // 2.  SillyTavern \n    if (window.SillyTavern && window.SillyTavern.eventSource) {\n      const events = window.SillyTavern.eventTypes;\n      const source = window.SillyTavern.eventSource;\n      const triggers = [events.CHAT_CHANGED, events.MESSAGE_SWIPED, events.MESSAGE_DELETED, events.MESSAGE_UPDATED];\n\n      // \n      if (!_boundRenderHandler) {\n        _boundRenderHandler = () => {\n          if (!isEditingOrder) setTimeout(renderInterface, 500);\n        };\n      }\n\n      // \n      if (!window._acuBoundChatChangeHandler) {\n        window._acuBoundChatChangeHandler = () => {\n          cachedRawData = null;\n          tablePageStates = {};\n          tableSearchStates = {};\n          tableScrollStates = {};\n          hasUnsavedChanges = false;\n          currentDiffMap.clear();\n          if (window.acuModifiedSet) window.acuModifiedSet.clear();\n          setTimeout(renderInterface, 500);\n        };\n      }\n      const _boundChatChangeHandler = window._acuBoundChatChangeHandler;\n\n      triggers.forEach(evt => {\n        if (evt) {\n          source.removeListener(evt, _boundRenderHandler);\n          source.removeListener(evt, _boundChatChangeHandler); // \n          if (evt === events.CHAT_CHANGED) {\n            source.on(evt, _boundChatChangeHandler);\n          } else {\n            source.on(evt, _boundRenderHandler);\n          }\n        }\n      });\n    }\n\n    // 3.  API \n    const loop = () => {\n      const api = getCore().getDB();\n      if (api?.exportTableAsJson) {\n        isInitialized = true;\n\n        // --- [Fix]  API  #chat  () ---\n        const $chat = $('#chat');\n        if ($chat.length && !observer) {\n          let mutationLock = false;\n          const handleMutation = () => {\n            if (mutationLock) return;\n            mutationLock = true;\n            requestAnimationFrame(() => {\n              const config = getConfig();\n              if (config.positionMode === 'embedded') {\n                mutationLock = false;\n                return;\n              }\n\n              const children = $chat.children();\n              const lastChild = children.last()[0];\n              const wrapper = $('.acu-wrapper')[0];\n\n              if (wrapper && lastChild && lastChild !== wrapper) {\n                if ($(lastChild).hasClass('mes') || $(lastChild).hasClass('message-body')) {\n                  $chat.append(wrapper);\n                }\n              }\n              mutationLock = false;\n            });\n          };\n          observer = new MutationObserver(handleMutation);\n          observer.observe($chat[0], { childList: true });\n        }\n        // --------------------------------------------------\n\n        renderInterface(); // \n        // \n        if (api.registerTableUpdateCallback) {\n          api.registerTableUpdateCallback(UpdateController.handleUpdate);\n\n          // \n          if (api.registerTableFillStartCallback) {\n            api.registerTableFillStartCallback(() => {\n              const current = api.exportTableAsJson();\n              if (current) saveSnapshot(current);\n            });\n          }\n        }\n      } else {\n        //  ( 60)\n        if (!isInitialized) {\n          window._acuInitRetries = (window._acuInitRetries || 0) + 1;\n          if (window._acuInitRetries < 60) {\n            setTimeout(loop, 1000);\n          } else {\n            console.warn('[ACU]  API');\n          }\n        }\n      }\n    };\n    loop();\n\n    // []  - \n    const setupOptionHideListener = () => {\n      const hideOptionPanel = () => {\n        optionPanelVisible = false;\n        $('.acu-option-panel, .acu-embedded-options-container').fadeOut(200, function () {\n          $(this).remove();\n        });\n      };\n\n      // []  ( ST  -> )\n      const ST = window.SillyTavern || window.parent?.SillyTavern;\n      // \n      const evtName =\n        ST?.eventTypes?.MESSAGE_SENT || (window.tavern_events ? window.tavern_events.MESSAGE_SENT : 'message_sent');\n\n      // 1.  ST.eventSource ()\n      if (ST?.eventSource) {\n        ST.eventSource.on(evtName, hideOptionPanel);\n        return;\n      }\n\n      // 2.  eventOn (TavernHelper )\n      if (typeof window.eventOn === 'function') {\n        window.eventOn(evtName, hideOptionPanel);\n        return;\n      }\n    };\n\n    // \n    setTimeout(setupOptionHideListener, 2000);\n\n    // [] \n    $(window)\n      .off('beforeunload.acu pagehide.acu')\n      .on('beforeunload.acu pagehide.acu', () => {\n        try {\n          localStorage.setItem(STORAGE_KEY_SCROLL, JSON.stringify(tableScrollStates));\n          if (observer) {\n            observer.disconnect();\n            observer = null;\n          }\n        } catch (e) {}\n      });\n  };\n\n  const { $ } = getCore();\n  if ($) $(document).ready(init);\n  else window.addEventListener('load', init);\n})();\n"],"names":["SCRIPT_ID","LockManager","STORAGE_KEY_PREFIX","MAX_CONTEXTS","PRIMARY_KEYS","_cache","_currentContextId","_getStorageKey","ctxId","this","getCurrentContextFingerprint","_cleanupOldContexts","prefix","allKeys","i","localStorage","length","key","startsWith","push","keyWithTime","map","data","JSON","parse","getItem","time","_lastAccess","sort","a","b","toDelete","slice","forEach","item","removeItem","console","log","e","warn","_load","stored","_save","dataToSave","Date","now","setItem","stringify","getRowKey","tableName","row","headers","pkField","fieldIndex","idx","indexOf","lockField","rowKey","fieldName","value","_fullRow","_fields","_snapshot","lockRow","rowData","snapshot","h","unlockField","lock","Object","keys","unlockRow","isFieldLocked","hasOwnProperty","isRowLocked","applyLocks","tableContent","tableLocks","modified","restored","rowIndex","entries","undefined","newRow","_rebuildRow","fields","field","colIdx","Array","fill","getLockedFields","clearCurrentContext","escapeHtml","s","String","replace","smartInsertToTextarea","newContent","contentType","$ta","$","currentVal","val","trim","normalDiceRegex","contestDiceRegex","actionRegex","trigger","workingText","existingAction","existingDice","contestMatches","match","normalMatches","actionMatches","userInput","parts","finalVal","join","STORAGE_KEY_TABLE_ORDER","STORAGE_KEY_ACTION_ORDER","STORAGE_KEY_PENDING_DELETIONS","STORAGE_KEY_ACTIVE_TAB","STORAGE_KEY_UI_CONFIG","STORAGE_KEY_LAST_SNAPSHOT","STORAGE_KEY_IS_COLLAPSED","STORAGE_KEY_DASHBOARD_ACTIVE","STORAGE_KEY_TABLE_HEIGHTS","STORAGE_KEY_TABLE_STYLES","STORAGE_KEY_HIDDEN_TABLES","STORAGE_KEY_REVERSE_TABLES","MIN_PANEL_HEIGHT","MAX_PANEL_HEIGHT","STORAGE_KEY_DICE_CONFIG","STORAGE_KEY_ATTRIBUTE_PRESETS","STORAGE_KEY_ACTIVE_ATTR_PRESET","STORAGE_KEY_AVATAR_MAP","STORAGE_KEY_VALIDATION_ENABLED","STORAGE_KEY_VALIDATION_MODE","RULE_TYPE_INFO","tableReadonly","name","scope","icon","desc","rowLimit","required","format","enum","numeric","relation","BUILTIN_VALIDATION_RULES","id","description","enabled","builtin","intercept","targetTable","targetColumn","ruleType","config","pattern","errorMessage","values","min","max","refTable","refColumn","STORAGE_KEY_PRESETS","STORAGE_KEY_ACTIVE_PRESET","PresetManager","getAllPresets","Store","get","_initDefaultPreset","getActivePreset","presets","activeId","find","p","setActivePreset","set","ValidationRuleManager","clearCache","createPreset","newPreset","rules","createdAt","toISOString","duplicatePreset","source","deletePreset","preset","filtered","filter","updatePresetRules","exportPreset","importPreset","json","error","defaultPreset","r","oldCustom","resetDefaultPreset","_enabledCache","getAllRules","enabledStates","getEnabledStates","allRules","rule","toggleRuleEnabled","ruleId","states","toggleRuleIntercept","getEnabledRules","addCustomRule","some","newRule","removeCustomRule","index","findIndex","splice","updateCustomRule","updates","getRulesByTable","ValidationEngine","validateFormat","RegExp","test","validateEnum","allowedValues","isArray","includes","validateNumeric","strVal","numVal","endsWith","parseFloat","split","isNaN","validateRelation","rawData","refSheet","sheetId","content","columns","col","refColIndex","validateRequired","validateTableReadonly","oldContent","validateRowLimit","rowCount","checkTableRules","newData","violations","typeInfo","oldSheet","newSheet","message","colIndex","rowIdx","validateValue","columnName","currentValue","validateRow","errors","ruleName","severity","validateAllData","allErrors","sheet","tableRules","fieldRules","rowErrors","validateTable","targetSheet","groupErrorsByTable","grouped","getErrorCount","LocalAvatarDB","DB_NAME","STORE_NAME","DB_VERSION","_db","_urlCache","Map","init","Promise","resolve","reject","request","indexedDB","open","onerror","onsuccess","result","onupgradeneeded","event","db","target","objectStoreNames","contains","createObjectStore","keyPath","save","blob","store","transaction","objectStore","has","URL","revokeObjectURL","delete","size","type","updatedAt","put","url","createObjectURL","getKey","getAllNames","getAllKeys","getStats","getAll","items","totalSize","reduce","sum","count","totalSizeMB","toFixed","clearAll","clear","getUserAvatarUrl","w","window","parent","jQuery","$avatar","first","attr","$userMes","last","ST","SillyTavern","getContext","ctx","userAvatar","getPlayerName","cachedRawData","getTableData","getDisplayPlayerName","name1","$persona","text","getPersonaName","replaceUserPlaceholders","displayName","AvatarManager","load","raw","offsetX","offsetY","scale","aliases","playerName","stAvatar","getAsync","isPlayer","localUrl","userLocalUrl","primaryName","getPrimaryName","aliasLocalUrl","hasLocalAvatar","async","getOffsetX","_resolveByAlias","getOffsetY","getScale","setPosition","setScale","setAliases","remove","exportData","version","exportTime","avatars","importData","jsonData","overwriteConflicts","Error","current","stats","added","updated","skipped","imported","analyzeImport","valid","total","newItems","conflicts","MvuModule","MODULE_ID","isAvailable","Mvu","getMvuData","getData","allVars","message_id","stat_data","display_data","delta_data","schema","isVWD","isSimpleArray","every","countChildren","k","renderRow","path","deltaData","changeIndicator","part","oldVal","newVal","getChangeIndicator","changedClass","displayValue","valueClass","v","renderCard","depth","defaultExpanded","childCount","collapsedClass","bodyHtml","childKey","childValue","childPath","itemPath","countText","injectStyles","targetDoc","document","getElementById","styleEl","createElement","textContent","head","appendChild","renderNavButton","isActive","renderPanel","mvuData","topKeys","cardsHtml","bindEvents","$container","$panel","off","on","stopPropagation","$card","closest","toggleClass","hasClass","refresh","removeClass","$value","showEditDialog","newValue","success","setValue","toastr","css","setTimeout","onSave","html","getConfig","theme","body","append","$overlay","$input","focus","select","preventDefault","ctrlKey","parsedValue","Number","setMvuVariable","reason","is_recursive","replaceMvuData","isModuleTab","panelHtml","DEFAULT_DICE_CONFIG","critSuccessMax","hardSuccessDiv","difficultSuccessDiv","critFailMin","lastDiceType","dndCritSuccess","dndCritFail","contestTieRule","getDiceConfig","saveDiceConfig","cfg","BUILTIN_ATTRIBUTE_PRESETS","baseAttributes","formula","range","modifier","specialAttributes","AttributePresetManager","finalId","err","updatePreset","exported","jsonStr","rollDiceExpression","expr","NaN","countStr","sidesStr","keepDrop","parseInt","sides","rolls","from","Math","floor","random","rollDice","kd","toLowerCase","n","generateAttributeValue","context","varNames","Function","round","evaluateFormula","DASHBOARD_TABLE_CONFIG","global","tableKeywords","detailLocation","keywords","fallbackIndex","currentLocation","player","status","position","attrs","isMultiple","money","resources","location","npc","inScene","quest","progress","filters","active","column","excludeColumn","excludes","bag","skill","level","equip","isEquipped","equipped","DashboardDataParser","findTable","allTables","moduleKey","keyword","findColumnIndex","columnKey","moduleConfig","colConfig","kw","getValue","getColumnMap","colKey","parseRows","tableResult","rows","colMap","obj","_rowIndex","_raw","applyFilter","parsedRows","filterKey","matchInclude","inc","excludeValue","matchExclude","exc","DEFAULT_GM_CONFIG","diceSystem","showDiceIcon","autoSendPrompt","action_groups","table_keywords","actions","label","template","auto_send","THEME_COLORS","retro","bgPanel","border","textMain","textSub","btnBg","btnHover","accent","tableHead","successText","successBg","inputBg","inputText","placeholderText","btnActiveBg","btnActiveText","dark","modern","forest","ocean","cyber","nightowl","getThemeColors","getActionsForTable","lowerName","group","isNumericCell","str","extractNumericValue","matches","parseAttributeString","results","rawStr","jsonObj","parseRelationshipString","trimmed","colonMatch","parenMatch","isRelationshipCell","headerName","lowerHeader","processTemplate","cardData","header","regex","ACTION_BUTTONS","title","isInitialized","isSaving","isEditingOrder","isSettingsOpen","currentDiffMap","Set","observer","_boundRenderHandler","hasUnsavedChanges","tablePageStates","tableSearchStates","lastOptionHash","optionPanelVisible","STORAGE_KEY_SCROLL","tableScrollStates","saved","UpdateController","_lastValidationCount","_isRollingBack","handleUpdate","loadSnapshot","api","getCore","getDB","fillTable","timeOut","positionClass","renderInterface","newCount","updateValidationIndicator","$indicator","show","hide","getCurrentChatId","chatId","DEFAULT_CONFIG","layout","collapseStyle","collapseAlign","fontFamily","cardWidth","fontSize","highlightNew","itemsPerPage","actionsPosition","gridColumns","positionMode","showOptionPanel","clickOptionToAutoSend","optionFontSize","FONTS","THEMES","_coreCache","core","AutoCardUpdaterAPI","clipboard","navigator","top","updateSaveButtonState","$btn","$icon","deletions","getPendingDeletions","hasDeletions","addClass","getIconForTableName","getBadgeStyle","def","retryErr","_acuQuotaAlerted","warning","getActiveTabState","saveActiveTabState","savePendingDeletions","getSavedTableOrder","saveTableOrder","saveCollapsedState","currentCtx","_contextId","saveSnapshot","getTableHeights","saveTableHeights","getTableStyles","getHiddenTables","getReverseTables","toggleTableReverse","list","getAttributesForCharacter","characterName","isUser","sheetName","nameColIdx","getAttributeValue","attrName","found","STANDARD_ATTRS","getStandardAttrs","getRandomSkillPool","allAttrs","add","allPresets","RANDOM_SKILL_POOL","generateRPGAttributes","isDNDOrPreset","isDND","generate3d6","generateValue","base","adjust","special","baseResult","specialResult","clearPresetAttributesForCharacter","charName","targetRowIndex","targetColIndex","sheetKey","existingStr","existingAttrs","standardAttrs","presetAttrNames","newAttrString","saveDataOnly","attrString","writeAttributesToCharacter","newAttrs","existingMap","standardCount","isComplete","customAttrs","resultParts","writtenAttrs","wasComplete","getFullAttributesForCharacter","initCustomDropdown","options","themeColors","t","inputId","toString","substr","wrap","$dropdown","background","after","renderItems","lowerFilter","opt","hideDropdown","addClearButton","inputSelector","each","$clearBtn","color","opacity","showDiceSettingsPanel","diceCfg","ruleTitle","resetText","defaults","critSuccess","critFail","hardDiv","extremeDiv","currentCritSuccess","currentCritFail","currentHardDiv","currentExtremeDiv","tieRule","cocExtraHtml","left","right","bottom","width","height","display","padding","closePanel","click","newCfg","critSuccessVal","critFailVal","hardDivVal","extremeDivVal","showDicePanel","savedDiceType","rawDataForList","diceCharacterList","diceAttrList","targetValue","targetName","diceType","successCriteria","onResult","initiatorName","overlay","defaultCriteria","panel","buildAttrButtons","attrValue","numValue","prop","originalHtml","originalHandler","generated","baseAttrs","specialAttrs","confirm","shortName","substring","buildCharButtons","skillPool","randomSkill","newAttrList","convertTargetForDice","currentTarget","fromDice","toDice","getMaxRoll","dice","fromMax","toMax","ratio","updateRuleMode","$targetInput","$difficultyWrapper","$row3","currentDiceType","newDice","suggestedCriteria","currentTargetVal","convertedVal","newMax","customDice","mod","criteria","difficulty","targetInputVal","attrInputVal","isAutoTarget","getDefaultTarget","formulaStr","maxRoll","finalValue","requiredTarget","difficultyLabel","difficultyDiv","isCritSuccess","isCritFailure","isSuccess","outcomeText","outcomeClass","extremeTarget","hardTarget","successColor","criteriaSymbol","judgeExpr","formulaText","attrValueInput","currentDice","initiatorNameVal","showContestPanel","initiatorValue","currentCriteria","opponentName","passedInitiatorName","passedInitiatorValue","passedOpponentValue","opponentValue","playerAttrs","opponentAttrs","characterList","contestAttrList","attrStr","targetType","buildCharBtns","containerId","rebuildAttrBtns","aname","refreshedAttrs","initAttrs","oppAttrs","fullAttrs","getSuccessLevel","roll","initValue","initName","initAttrName","getHalfMax","m","initValueInput","initTarget","initTargetInput","oppValue","oppName","oppAttrName","oppValueInput","oppTarget","oppTargetInput","winner","winnerColor","initResult","oppResult","initSuccess","oppSuccess","contestResultText","currentInitName","showPreviewCard","tableKey","cellValue","showRelationshipGraph","npcTable","nameIdx","relationIdx","npcTableKey","nodes","edges","resolveName","resolvedPlayerName","playerTableKey","x","y","inSceneColIdx","rawNpcName","npcName","isInScene","inSceneVal","relationStr","rel","resolvedRelName","relRowIndex","ri","cleanedLabels","rawRel","commonRelations","specialSuffixMatch","lastChars","cleanRelation","existingEdge","combined","labelsFromSource","labelsFromTarget","nodeArr","centerX","centerY","connectionCount","node","edge","isMobileView","innerWidth","baseRadius","maxRadius","playerBaseRadius","radiusPerConnection","radius","nodeName","sqrt","getNodeRadius","maxNodeRadius","angle","PI","cos","sin","panX","panY","$svg","$transform","$edgesGroup","$nodesGroup","$zoomDisplay","$wrapper","updateTransform","zoomTo","newScale","oldScale","scaleChange","render","edgesHtml","edgeIdx","dx","dy","len","nx","ny","px","py","hasFromSource","l","hasFromTarget","sourceRadius","targetRadius","x1","y1","x2","y2","srcLabels","tgtLabels","srcSet","tgtSet","commonLabels","srcUnique","tgtUnique","markerStart","markerEnd","midX","midY","lineLen","lbl","offsetDir","offsetDist","safeOffset","relationEmojiMap","emoji","addRelationEmoji","truncateLabel","maxLen","truncated","labelsToShow","labelBaseX","labelBaseY","perpOffset","nodesHtml","nodeAvatar","indicatorRadius","indicatorOffset","inSceneIndicator","nodeDisplayName","scaleVal","charAt","then","highlightNode","connectedNodes","otherNode","connectedEdgeIndices","clearHighlight","maxTouchPoints","currentHighlightedNode","$node","startX","clientX","startY","clientY","startTime","hasMoved","longPressTriggered","longPressTimer","vibrate","moveE","abs","clearTimeout","elapsed","isPanning","panStartX","panStartY","panStartPanX","panStartPanY","lastPinchDist","activePointerId","wrapperEl","svgEl","onpointerdown","button","setPointerCapture","pointerId","style","cursor","onpointermove","rect","getBoundingClientRect","onpointerup","releasePointerCapture","onpointercancel","onwheel","delta","deltaY","addEventListener","touches","hypot","passive","newDist","showAvatarManager","closeGraph","showAvatarCropModal","imageSource","existing","modalHtml","$modal","$image","containerEl","imageEl","updateImageStyle","backgroundSize","backgroundPosition","isDragging","startOffsetX","startOffsetY","deltaX","sensitivity","pinchStartScale","pinchRatio","file","files","saveLocalAvatar","newUrl","onUpdate","managerHtml","$manager","listHtml","currentUrl","hasLocal","displayUrl","sourceLabel","hasAvatar","buildList","bindAvatarEvents","refreshItem","$item","$preview","aliasesStr","deleteLocalAvatar","Blob","href","download","removeChild","reader","FileReader","onload","evt","analysis","showImportConfirmDialog","readAsText","closeManager","onComplete","hasConflicts","conflictListHtml","dialogHtml","$dialog","cssText","closeDialog","overwrite","showCardEditModal","displayRow","inputsHtml","cell","dialog","adjustHeight","el","contentHeight","scrollHeight","overflowY","requestAnimationFrame","currentRow","hasChanges","saveDataToDatabase","_configCache","saveConfig","applyConfigStyles","generateDiffMap","currentData","lastData","diffSet","rIdx","newRows","oldRows","oldRow","cIdx","oldCell","fontVal","f","$styleTag","fontImport","cssVars","cls","$optContainer","addStyles","performance","_acuStylesInjected","styles","exportTableAsJson","tableData","skipRender","commitDeletes","$saveBtn","mate","importTableAsJson","acuModifiedSet","processJsonData","tables","rawContent","exportConfig","updateConfig","showAddValidationRuleModal","parentDialog","currentThemeClass","tableNames","$colSelect","refTableName","$refColSelect","isTableRule","ruleConfig","valuesStr","refColumns","selectedColumns","$rulesList","ruleHtml","showSmartFixModal","snapshotValue","hasSnapshotValue","showTableRuleFixModal","inputHtml","smartSuggestHtml","examples","currentRowIndex","maxCount","getColumnExamples","suggestedValue","prefixMatch","digits","padStart","numOnlyMatch","suggestFormatValue","currentNum","isOutOfRange","nearestValid","num","getNearestValidNumber","getRelationOptions","optionValue","contentHtml","actionBtns","changeCount","changeDetails","c","d","minRows","maxRows","currentRowCount","excessRows","isTooMany","isTooFew","startRow","showAttributePresetManager","presetsHtml","isBuiltin","showSettingsModal","$toggle","is","$thisToggle","showAttributePresetEditor","filename","presetId","isEdit","existingPreset","defaultData","$jsonTextarea","updateJSON","not","expandedGroups","isGroupExpanded","groupId","SPECIAL_BUTTONS_CONFIG","tableManagerHtml","savedOrder","hiddenList","allItems","btn","isSpecial","orderMap","isHidden","specialClass","chevron","hasIntercept","$group","$body","$chevron","expanded","targetHeight","animate","currentHeight","outerHeight","newTheme","$select","selectedId","info","checked","slideDown","slideUp","$list","dragState","element","timer","clearDragState","startDrag","handle","targetItem","insertBefore","$dragged","$target","insertAfter","newOrder","$stepper","step","updateValue","unit","getCurrentValue","isCurrentlyActive","fadeOut","refreshPresetUI","prompt","writeText","catch","$chat","mutationLock","MutationObserver","lastChild","children","wrapper","observe","childList","anyLockApplied","structuredClone","existingSnapshot","hasValidSnapshotData","$searchInput","activeTab","currentTabName","newHtml","renderTableContent","$virtualDom","replaceWith","bindOptionEvents","lastScrollX","lastScrollY","$oldContent","scrollLeft","scrollTop","orderedNames","concat","isCollapsed","layoutClass","finalGridCols","empty3","ceil","optionHtml","currentOptionHash","optionTables","isNavHidden","buttonsHtml","hasBtns","optionValues","table","cellStr","encodeURIComponent","optionChanged","hideStyle","colStyleClass","alignClass","savedHeight","isDashboardActive","isChangesPanelActive","renderChangesPanel","renderDashboard","gridFixStyle","isChangesActive","isSimpleModeNav","changesCount","validationErrorCount","displayCount","showWarningIcon","navHiddenList","navSavedOrder","SPECIAL_NAV_ITEMS","extraClass","warningIcon","checkAvailable","allNavItems","activeClass","orderVal","warningIconHtml","$existing","insertHtmlToPage","injectIndependentOptions","bindChangesEvents","$newContent","savedState","inner","$targetTitle","htmlContent","$aiMes","$this","$targetMes","$targetBlock","getTargetContainer","optConfig","decodeURIComponent","TavernHelper","createChatMessages","role","triggerSlash","executeSlashCommandsWithOptions","cmd","sendResult","isError","isAborted","ta","sendBtn","enterEvent","Event","keyCode","which","bubbles","$textDiv","hasImage","targetIndex","eq","$oldWrapper","validationErrors","changes","rowChanges","oldValue","rowTitle","changedFields","isValidationMode","groupedErrors","collapsedGroups","tableErrors","ruleData","groupedChanges","tableChanges","change","oldShort","newShort","fieldDisplay","fieldCount","fieldNames","moreText","parsed","validationItemTouchStartPos","touch","originalEvent","$targetCard","scrollIntoView","behavior","block","storageKey","changeType","refreshChangesPanel","restoredRow","showRowCompareEditModal","showChangeSingleFieldModal","showChangeEditModal","restoredData","newMode","updateChangesCount","startHeight","newHeight","upE","finalHeight","heights","$horizontalScroller","_touchStartX","_touchStartY","_scrollDirection","$span","hasOldValue","$textarea","fieldsHtml","isChanged","globalResult","playerResult","locationResult","npcResult","questResult","bagResult","skillResult","equipResult","playerTable","playerParsed","allAttrsStr","playerRows","playerHeaders","globalDetailLocation","globalLocation","detailIdx","locIdx","currentPlaceName","npcTableName","npcParsed","inSceneNPCs","offSceneNPCs","npcData","allNPCs","questTableName","questParsed","activeQuestParsed","questTypeOrder","activeTasks","q","bagTableName","bagParsed","bagItems","skillTableName","skillParsed","skills","equipTableName","equipParsed","equippedItems","locationTableName","locationTableKey","locationParsed","resourcesStr","parsedResources","res","skillValue","hasNumeric","skillRowIndex","loc","areaName","isCurrent","npcIdx","isLastNpc","npcAvatar","avatarOffsetX","avatarOffsetY","avatarScale","avatarStyle","offSceneFilter","isLastBag","isLast","isMain","progressPercent","progressMatch","progressBar","pendingDeletions","isGridMode","titleColIndex","processedRows","originalIndex","searchTerm","isReversed","isTableReversed","titleA","titleB","aHitTitle","bHitTitle","totalItems","totalPages","currentPage","startIdx","endIdx","rowsToRender","showReverseBtn","shouldShowReverseButton","reverseBtnHtml","realRowIdx","isPending","cardTitle","showDefaultIndex","titleCellId","isTitleModified","isRowNew","rowClass","validColIndices","_","isOddValidCount","cardBody","spanFullRow","safeStr","rawStrOriginal","invalidPlaceholders","hideLabel","splitRegex","parsedAttrs","validRelations","relHtml","attrsHtml","invalidTagValues","badgeStyle","displayCell","isDiffChanged","cellId","isUserModified","cellHighlight","lockRowKey","lockIcon","tableActions","actionsHtml","interactColIdx","invalidValues","interactOptions","existingLabels","iconMap","newActions","act","actIdx","cardLockRowKey","cardLockIcon","saveCurrentTabState","$content","innerScrolls","timestamp","newState","scrollTimer","$navBtn","stopImmediatePropagation","isPanelVisible","isMvuActive","currentActiveTab","$cell","showCellMenu","$pageBtn","newPage","manualUpdate","searchTimeout","isComposing","selectionStart","selectionEnd","isFocus","activeElement","classList","$newInput","setSelectionRange","tName","actionIdx","$title","action","skillName","checkValue","attrValIdx","profIdx","promptText","overlayEl","setProperty","sendMessage","msg","ev","isPlayerTable","playerAttrValue","locationName","itemName","taskName","npcAttrValue","j","npcParts","npcMatch","relations","borderStyle","cardHtml","$doc","touchStartX","touchStartY","backdrop","isModified","currentHeader","lockMenuHtml","menu","winWidth","winHeight","mWidth","outerWidth","mHeight","changedTouches","closeAll","safeContent","fallbackCopy","textArea","setAttribute","successful","execCommand","isSecureContext","originalValue","$displayTarget","actOrd","dels","colCount","alert","disconnect","eventSource","events","eventTypes","triggers","CHAT_CHANGED","MESSAGE_SWIPED","MESSAGE_DELETED","MESSAGE_UPDATED","_acuBoundChatChangeHandler","_boundChatChangeHandler","removeListener","loop","registerTableUpdateCallback","registerTableFillStartCallback","_acuInitRetries","hideOptionPanel","evtName","MESSAGE_SENT","tavern_events","eventOn","ready"],"ignoreList":[],"sourceRoot":""}