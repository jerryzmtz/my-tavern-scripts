# 分支维护说明

## 概述

现在系统支持两个独立的分支，可以分别维护和更新：

- **main 分支**：稳定版，生成 `stable.js`
- **nightly 分支**：开发版，生成 `nightly.js`

两个分支可以独立更新，互不影响。

## 用户使用方式

### Stable 版本（稳定版，推荐普通用户使用）

```typescript
import 'https://testingcf.jsdelivr.net/gh/jerryzmtz/my-tavern-scripts@main/dist/骰子系统/stable.js'
```

或者使用自动更新脚本（获取最新 tag 版本，缓存更快）：

```typescript
async function getLatestVersion() {
  try {
    const response = await fetch('https://api.github.com/repos/jerryzmtz/my-tavern-scripts/tags');
    const tags = await response.json();
    return tags[0]?.name || 'main';
  } catch {
    return 'main';
  }
}

const version = await getLatestVersion();
import(`https://testingcf.jsdelivr.net/gh/jerryzmtz/my-tavern-scripts@${version}/dist/骰子系统/stable.js`);
```

### Nightly 版本（开发版，推荐尝鲜用户使用）

```typescript
import 'https://testingcf.jsdelivr.net/gh/jerryzmtz/my-tavern-scripts@nightly/dist/骰子系统/nightly.js'
```

## 工作流程

### 更新 Nightly 版本（日常开发）

1. **切换到 nightly 分支**
   ```bash
   git checkout nightly
   ```

2. **修改代码**
   - 在 `src/骰子系统/index.ts` 中修改代码

3. **提交并推送**
   ```bash
   git add .
   git commit -m "feat: 添加新功能"
   git push origin nightly
   ```

4. **自动打包**
   - GitHub Actions 会自动构建
   - 生成 `dist/骰子系统/nightly.js`
   - **不会创建版本号 tag**

### 更新 Stable 版本（发布稳定版）

1. **切换到 main 分支**
   ```bash
   git checkout main
   ```

2. **合并 nightly 的更改（可选）**
   ```bash
   git merge nightly
   ```

3. **或者直接修改 main 分支的代码**

4. **提交并推送**
   ```bash
   git add .
   git commit -m "release: 发布稳定版"
   git push origin main
   ```

5. **自动打包和打 tag**
   - GitHub Actions 会自动构建
   - 生成 `dist/骰子系统/stable.js`
   - **自动创建版本号 tag**（如 `v0.0.10`）

## 关键特性

### 1. 独立维护
- main 和 nightly 分支完全独立
- 更新 nightly 不会影响 main
- 更新 main 不会影响 nightly

### 2. 自动构建
- 两个分支都会自动构建
- main 分支生成 `stable.js`
- nightly 分支生成 `nightly.js`

### 3. 版本号 tag
- **main 分支**：自动创建版本号 tag（用于加速 jsDelivr 缓存更新，12 小时缓存）
- **nightly 分支**：不创建 tag（用户直接使用 `@nightly`，7 天缓存）

### 4. 缓存策略
- 使用 `@main` 或 `@nightly`：jsDelivr 缓存 7 天
- 使用版本号 tag（如 `@v0.0.10`）：jsDelivr 缓存 12 小时

## 文件结构

构建后的文件结构：

```
dist/
└── 骰子系统/
    ├── stable.js      # main 分支生成
    ├── stable.js.map  # main 分支生成
    ├── nightly.js     # nightly 分支生成
    └── nightly.js.map # nightly 分支生成
```

注意：每个分支只会生成对应的文件，不会同时存在两个文件。

## 常见问题

### Q: 为什么 nightly 更新后 stable 用不了？

**A:** 这是正常的！两个分支是独立的：
- nightly 分支更新 → 只影响 `nightly.js`
- main 分支更新 → 只影响 `stable.js`

如果你希望 stable 也更新，需要：
1. 切换到 main 分支
2. 合并 nightly 的更改（或直接修改）
3. 提交并推送

### Q: 如何让用户同时使用两个版本？

**A:** 用户可以选择：
- 稳定用户：使用 `@main/dist/骰子系统/stable.js`
- 尝鲜用户：使用 `@nightly/dist/骰子系统/nightly.js`

### Q: 版本号 tag 的作用是什么？

**A:** 版本号 tag 主要用于：
1. **加速缓存更新**：使用 tag 时，jsDelivr 缓存 12 小时；使用分支名时，缓存 7 天
2. **固定版本**：用户可以使用特定版本号，确保使用固定版本

### Q: 如何查看当前版本？

**A:** 
- main 分支：查看 GitHub Releases 或 Tags 页面
- nightly 分支：直接使用 `@nightly`，总是最新版本

## 最佳实践

1. **日常开发**：在 nightly 分支工作，频繁更新
2. **发布稳定版**：合并到 main 分支，创建稳定版本
3. **用户推荐**：
   - 普通用户使用 `@main/dist/骰子系统/stable.js`
   - 尝鲜用户使用 `@nightly/dist/骰子系统/nightly.js`
   - 需要固定版本的用户使用版本号 tag
